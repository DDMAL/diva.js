(function(b){var a=1;b.generateId=function(d){var c;do{c=(a++)+(d?"-"+d:"");}while(document.getElementById(c));return c;};})(jQuery);jQuery.fn.oneFingerScroll=function(){var c=0;var a;var b;$(this).bind("touchstart",function(d){var f=d.originalEvent;a=$(this).scrollTop()+f.touches[0].pageY;b=$(this).scrollLeft()+f.touches[0].pageX;f.preventDefault();});$(this).bind("touchmove",function(d){var f=d.originalEvent;$(this).scrollTop(a-f.touches[0].pageY);$(this).scrollLeft(b-f.touches[0].pageX);f.preventDefault();});return this;};(function(a){a.fn.dragscrollable=function(b){var d=a.extend({dragSelector:">:first",acceptPropagatedEvent:true,preventDefault:true},b||{});var c={mouseDownHandler:function(e){if(e.which!=1||(!e.data.acceptPropagatedEvent&&e.target!=this)){return false;}e.data.lastCoord={left:e.clientX,top:e.clientY};a.event.add(document,"mouseup",c.mouseUpHandler,e.data);a.event.add(document,"mousemove",c.mouseMoveHandler,e.data);if(e.data.preventDefault){e.preventDefault();return false;}},mouseMoveHandler:function(e){var f={left:(e.clientX-e.data.lastCoord.left),top:(e.clientY-e.data.lastCoord.top)};e.data.scrollable.scrollLeft(e.data.scrollable.scrollLeft()-f.left);e.data.scrollable.scrollTop(e.data.scrollable.scrollTop()-f.top);e.data.lastCoord={left:e.clientX,top:e.clientY};if(e.data.preventDefault){e.preventDefault();return false;}},mouseUpHandler:function(e){a.event.remove(document,"mousemove",c.mouseMoveHandler);a.event.remove(document,"mouseup",c.mouseUpHandler);if(e.data.preventDefault){e.preventDefault();return false;}}};this.each(function(){var e={scrollable:a(this),acceptPropagatedEvent:d.acceptPropagatedEvent,preventDefault:d.preventDefault};a(this).find(d.dragSelector).bind("mousedown",e,c.mouseDownHandler);});};})(jQuery);(function(d){var i,a;var e;var b;d.extend({pnotify_remove_all:function(){var k=e.data("pnotify");if(k&&k.length){d.each(k,function(){if(this.pnotify_remove){this.pnotify_remove();}});}},pnotify_position_all:function(){if(a){clearTimeout(a);}a=null;var k=e.data("pnotify");if(!k||!k.length){return;}d.each(k,function(){var o=this.opts.pnotify_stack;if(!o){return;}if(!o.nextpos1){o.nextpos1=o.firstpos1;}if(!o.nextpos2){o.nextpos2=o.firstpos2;}if(!o.addpos2){o.addpos2=0;}if(this.css("display")!="none"){var q,p;var l={};var n;switch(o.dir1){case"down":n="top";break;case"up":n="bottom";break;case"left":n="right";break;case"right":n="left";break;}q=parseInt(this.css(n),10);if(isNaN(q)){q=0;}if(typeof o.firstpos1=="undefined"){o.firstpos1=q;o.nextpos1=o.firstpos1;}var m;switch(o.dir2){case"down":m="top";break;case"up":m="bottom";break;case"left":m="right";break;case"right":m="left";break;}p=parseInt(this.css(m),10);if(isNaN(p)){p=0;}if(typeof o.firstpos2=="undefined"){o.firstpos2=p;o.nextpos2=o.firstpos2;}if((o.dir1=="down"&&o.nextpos1+this.height()>b.height())||(o.dir1=="up"&&o.nextpos1+this.height()>b.height())||(o.dir1=="left"&&o.nextpos1+this.width()>b.width())||(o.dir1=="right"&&o.nextpos1+this.width()>b.width())){o.nextpos1=o.firstpos1;o.nextpos2+=o.addpos2+10;o.addpos2=0;}if(o.animation&&o.nextpos2<p){switch(o.dir2){case"down":l.top=o.nextpos2+"px";break;case"up":l.bottom=o.nextpos2+"px";break;case"left":l.right=o.nextpos2+"px";break;case"right":l.left=o.nextpos2+"px";break;}}else{this.css(m,o.nextpos2+"px");}switch(o.dir2){case"down":case"up":if(this.outerHeight(true)>o.addpos2){o.addpos2=this.height();}break;case"left":case"right":if(this.outerWidth(true)>o.addpos2){o.addpos2=this.width();}break;}if(o.nextpos1){if(o.animation&&(q>o.nextpos1||l.top||l.bottom||l.right||l.left)){switch(o.dir1){case"down":l.top=o.nextpos1+"px";break;case"up":l.bottom=o.nextpos1+"px";break;case"left":l.right=o.nextpos1+"px";break;case"right":l.left=o.nextpos1+"px";break;}}else{this.css(n,o.nextpos1+"px");}}if(l.top||l.bottom||l.right||l.left){this.animate(l,{duration:500,queue:false});}switch(o.dir1){case"down":case"up":o.nextpos1+=this.height()+10;break;case"left":case"right":o.nextpos1+=this.width()+10;break;}}});d.each(k,function(){var l=this.opts.pnotify_stack;if(!l){return;}l.nextpos1=l.firstpos1;l.nextpos2=l.firstpos2;l.addpos2=0;l.animation=true;});},pnotify:function(r){if(!e){e=d("body");}if(!b){b=d(window);}var s;var k;if(typeof r!="object"){k=d.extend({},d.pnotify.defaults);k.pnotify_text=r;}else{k=d.extend({},d.pnotify.defaults,r);}if(k.pnotify_before_init){if(k.pnotify_before_init(k)===false){return null;}}var l;var m=function(x,u){o.css("display","none");var t=document.elementFromPoint(x.clientX,x.clientY);o.css("display","block");var w=d(t);var v=w.css("cursor");o.css("cursor",v!="auto"?v:"default");if(!l||l.get(0)!=t){if(l){f.call(l.get(0),"mouseleave",x.originalEvent);f.call(l.get(0),"mouseout",x.originalEvent);}f.call(t,"mouseenter",x.originalEvent);f.call(t,"mouseover",x.originalEvent);}f.call(t,u,x.originalEvent);l=w;};var o=d("<div />",{"class":"ui-pnotify "+k.pnotify_addclass,css:{display:"none"},mouseenter:function(t){if(k.pnotify_nonblock){t.stopPropagation();}if(k.pnotify_mouse_reset&&s=="out"){o.stop(true);s="in";o.css("height","auto").animate({width:k.pnotify_width,opacity:k.pnotify_nonblock?k.pnotify_nonblock_opacity:k.pnotify_opacity},"fast");}if(k.pnotify_nonblock){o.animate({opacity:k.pnotify_nonblock_opacity},"fast");}if(k.pnotify_hide&&k.pnotify_mouse_reset){o.pnotify_cancel_remove();}if(k.pnotify_closer&&!k.pnotify_nonblock){o.closer.show();}},mouseleave:function(t){if(k.pnotify_nonblock){t.stopPropagation();}l=null;o.css("cursor","auto");if(k.pnotify_nonblock&&s!="out"){o.animate({opacity:k.pnotify_opacity},"fast");}if(k.pnotify_hide&&k.pnotify_mouse_reset){o.pnotify_queue_remove();}o.closer.hide();d.pnotify_position_all();},mouseover:function(t){if(k.pnotify_nonblock){t.stopPropagation();}},mouseout:function(t){if(k.pnotify_nonblock){t.stopPropagation();}},mousemove:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"onmousemove");}},mousedown:function(t){if(k.pnotify_nonblock){t.stopPropagation();t.preventDefault();m(t,"onmousedown");}},mouseup:function(t){if(k.pnotify_nonblock){t.stopPropagation();t.preventDefault();m(t,"onmouseup");}},click:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"onclick");}},dblclick:function(t){if(k.pnotify_nonblock){t.stopPropagation();m(t,"ondblclick");}}});o.opts=k;if(k.pnotify_shadow&&!d.browser.msie){o.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-corner-all ui-pnotify-shadow"}).prependTo(o);}o.container=d("<div />",{"class":"ui-widget ui-widget-content ui-corner-all ui-pnotify-container "+(k.pnotify_type=="error"?"ui-state-error":"ui-state-highlight")}).appendTo(o);o.pnotify_version="1.0.1";o.pnotify=function(t){var u=k;if(typeof t=="string"){k.pnotify_text=t;}else{k=d.extend({},k,t);}o.opts=k;if(k.pnotify_shadow!=u.pnotify_shadow){if(k.pnotify_shadow&&!d.browser.msie){o.shadow_container=d("<div />",{"class":"ui-widget-shadow ui-pnotify-shadow"}).prependTo(o);}else{o.children(".ui-pnotify-shadow").remove();}}if(k.pnotify_addclass===false){o.removeClass(u.pnotify_addclass);}else{if(k.pnotify_addclass!==u.pnotify_addclass){o.removeClass(u.pnotify_addclass).addClass(k.pnotify_addclass);}}if(k.pnotify_title===false){o.title_container.hide("fast");}else{if(k.pnotify_title!==u.pnotify_title){o.title_container.html(k.pnotify_title).show(200);}}if(k.pnotify_text===false){o.text_container.hide("fast");}else{if(k.pnotify_text!==u.pnotify_text){if(k.pnotify_insert_brs){k.pnotify_text=k.pnotify_text.replace(/\n/g,"<br />");}o.text_container.html(k.pnotify_text).show(200);}}o.pnotify_history=k.pnotify_history;if(k.pnotify_type!=u.pnotify_type){o.container.toggleClass("ui-state-error ui-state-highlight");}if((k.pnotify_notice_icon!=u.pnotify_notice_icon&&k.pnotify_type=="notice")||(k.pnotify_error_icon!=u.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_type!=u.pnotify_type)){o.container.find("div.ui-pnotify-icon").remove();if((k.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_notice_icon)){d("<div />",{"class":"ui-pnotify-icon"}).append(d("<span />",{"class":k.pnotify_type=="error"?k.pnotify_error_icon:k.pnotify_notice_icon})).prependTo(o.container);}}if(k.pnotify_width!==u.pnotify_width){o.animate({width:k.pnotify_width});}if(k.pnotify_min_height!==u.pnotify_min_height){o.container.animate({minHeight:k.pnotify_min_height});}if(k.pnotify_opacity!==u.pnotify_opacity){o.fadeTo(k.pnotify_animate_speed,k.pnotify_opacity);}if(!k.pnotify_hide){o.pnotify_cancel_remove();}else{if(!u.pnotify_hide){o.pnotify_queue_remove();}}o.pnotify_queue_position();return o;};o.pnotify_queue_position=function(){if(a){clearTimeout(a);}a=setTimeout(d.pnotify_position_all,10);};o.pnotify_display=function(){if(!o.parent().length){o.appendTo(e);}if(k.pnotify_before_open){if(k.pnotify_before_open(o)===false){return;}}o.pnotify_queue_position();if(k.pnotify_animation=="fade"||k.pnotify_animation.effect_in=="fade"){o.show().fadeTo(0,0).hide();}else{if(k.pnotify_opacity!=1){o.show().fadeTo(0,k.pnotify_opacity).hide();}}o.animate_in(function(){if(k.pnotify_after_open){k.pnotify_after_open(o);}o.pnotify_queue_position();if(k.pnotify_hide){o.pnotify_queue_remove();}});};o.pnotify_remove=function(){if(o.timer){window.clearTimeout(o.timer);o.timer=null;}if(k.pnotify_before_close){if(k.pnotify_before_close(o)===false){return;}}o.animate_out(function(){if(k.pnotify_after_close){if(k.pnotify_after_close(o)===false){return;}}o.pnotify_queue_position();if(k.pnotify_remove){o.detach();}});};o.animate_in=function(u){s="in";var t;if(typeof k.pnotify_animation.effect_in!="undefined"){t=k.pnotify_animation.effect_in;}else{t=k.pnotify_animation;}if(t=="none"){o.show();u();}else{if(t=="show"){o.show(k.pnotify_animate_speed,u);}else{if(t=="fade"){o.show().fadeTo(k.pnotify_animate_speed,k.pnotify_opacity,u);}else{if(t=="slide"){o.slideDown(k.pnotify_animate_speed,u);}else{if(typeof t=="function"){t("in",u,o);}else{if(o.effect){o.effect(t,{},k.pnotify_animate_speed,u);}}}}}}};o.animate_out=function(u){s="out";var t;if(typeof k.pnotify_animation.effect_out!="undefined"){t=k.pnotify_animation.effect_out;}else{t=k.pnotify_animation;}if(t=="none"){o.hide();u();}else{if(t=="show"){o.hide(k.pnotify_animate_speed,u);}else{if(t=="fade"){o.fadeOut(k.pnotify_animate_speed,u);}else{if(t=="slide"){o.slideUp(k.pnotify_animate_speed,u);}else{if(typeof t=="function"){t("out",u,o);}else{if(o.effect){o.effect(t,{},k.pnotify_animate_speed,u);}}}}}}};o.pnotify_cancel_remove=function(){if(o.timer){window.clearTimeout(o.timer);}};o.pnotify_queue_remove=function(){o.pnotify_cancel_remove();o.timer=window.setTimeout(function(){o.pnotify_remove();},(isNaN(k.pnotify_delay)?0:k.pnotify_delay));};o.closer=d("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",display:"none"},click:function(){o.pnotify_remove();o.closer.hide();}}).append(d("<span />",{"class":"ui-icon ui-icon-circle-close"})).appendTo(o.container);if((k.pnotify_error_icon&&k.pnotify_type=="error")||(k.pnotify_notice_icon)){d("<div />",{"class":"ui-pnotify-icon"}).append(d("<span />",{"class":k.pnotify_type=="error"?k.pnotify_error_icon:k.pnotify_notice_icon})).appendTo(o.container);}o.title_container=d("<div />",{"class":"ui-pnotify-title",html:k.pnotify_title}).appendTo(o.container);if(k.pnotify_title===false){o.title_container.hide();}if(k.pnotify_insert_brs&&typeof k.pnotify_text=="string"){k.pnotify_text=k.pnotify_text.replace(/\n/g,"<br />");}o.text_container=d("<div />",{"class":"ui-pnotify-text",html:k.pnotify_text}).appendTo(o.container);if(k.pnotify_text===false){o.text_container.hide();}if(typeof k.pnotify_width=="string"){o.css("width",k.pnotify_width);}if(typeof k.pnotify_min_height=="string"){o.container.css("min-height",k.pnotify_min_height);}o.pnotify_history=k.pnotify_history;var q=e.data("pnotify");if(q==null||typeof q!="object"){q=[];}if(k.pnotify_stack.push=="top"){q=d.merge([o],q);}else{q=d.merge(q,[o]);}e.data("pnotify",q);if(k.pnotify_after_init){k.pnotify_after_init(o);}if(k.pnotify_history){var p=e.data("pnotify_history");if(typeof p=="undefined"){p=d("<div />",{"class":"ui-pnotify-history-container ui-state-default ui-corner-bottom",mouseleave:function(){p.animate({top:"-"+i+"px"},{duration:100,queue:false});}}).append(d("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(d("<button />",{"class":"ui-pnotify-history-all ui-state-default ui-corner-all",text:"All",mouseenter:function(){d(this).addClass("ui-state-hover");},mouseleave:function(){d(this).removeClass("ui-state-hover");},click:function(){d.each(q,function(){if(this.pnotify_history&&this.pnotify_display){this.pnotify_display();}});return false;}})).append(d("<button />",{"class":"ui-pnotify-history-last ui-state-default ui-corner-all",text:"Last",mouseenter:function(){d(this).addClass("ui-state-hover");},mouseleave:function(){d(this).removeClass("ui-state-hover");},click:function(){var t=1;while(!q[q.length-t]||!q[q.length-t].pnotify_history||q[q.length-t].is(":visible")){if(q.length-t===0){return false;}t++;}var u=q[q.length-t];if(u.pnotify_display){u.pnotify_display();}return false;}})).appendTo(e);var n=d("<span />",{"class":"ui-pnotify-history-pulldown ui-icon ui-icon-grip-dotted-horizontal",mouseenter:function(){p.animate({top:"0"},{duration:100,queue:false});}}).appendTo(p);i=n.offset().top+2;p.css({top:"-"+i+"px"});e.data("pnotify_history",p);}}k.pnotify_stack.animation=false;o.pnotify_display();return o;}});var j=/^on/;var c=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/;var h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/;var g=/^(scroll|resize|(un)?load|abort|error)$/;var f=function(l,k){var m;l=l.toLowerCase();if(document.createEvent&&this.dispatchEvent){l=l.replace(j,"");if(l.match(c)){d(this).offset();m=document.createEvent("MouseEvents");m.initMouseEvent(l,k.bubbles,k.cancelable,k.view,k.detail,k.screenX,k.screenY,k.clientX,k.clientY,k.ctrlKey,k.altKey,k.shiftKey,k.metaKey,k.button,k.relatedTarget);}else{if(l.match(h)){m=document.createEvent("UIEvents");m.initUIEvent(l,k.bubbles,k.cancelable,k.view,k.detail);}else{if(l.match(g)){m=document.createEvent("HTMLEvents");m.initEvent(l,k.bubbles,k.cancelable);}}}if(!m){return;}this.dispatchEvent(m);}else{if(!l.match(j)){l="on"+l;}m=document.createEventObject(k);this.fireEvent(l,m);}};d.pnotify.defaults={pnotify_title:false,pnotify_text:false,pnotify_addclass:"",pnotify_nonblock:false,pnotify_nonblock_opacity:0.2,pnotify_history:true,pnotify_width:"300px",pnotify_min_height:"16px",pnotify_type:"notice",pnotify_notice_icon:"ui-icon ui-icon-info",pnotify_error_icon:"ui-icon ui-icon-alert",pnotify_animation:"fade",pnotify_animate_speed:"slow",pnotify_opacity:1,pnotify_shadow:false,pnotify_closer:true,pnotify_hide:true,pnotify_delay:8000,pnotify_mouse_reset:true,pnotify_remove:true,pnotify_insert_brs:true,pnotify_stack:{dir1:"down",dir2:"left",push:"bottom"}};})(jQuery);(function(a){var b=function(j,n){var t={adaptivePadding:0.05,backendServer:"",enableAutoTitle:true,enableFullscreen:true,enableGotoPage:true,enableKeyScroll:true,enableSpaceScroll:false,enableZoomSlider:true,fixedPadding:0,iipServerBaseUrl:"",maxZoomLevel:0,minZoomLevel:0,onJump:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,tileFadeSpeed:300,tileHeight:256,tileWidth:256,zoomLevel:2};var E=a.extend({},t,n);var m={centerX:0,centerY:0,currentPageIndex:0,dimAfterZoom:0,dimBeforeZoom:0,doubleClick:false,elementSelector:"",firstAjaxRequest:true,firstPageLoaded:-1,fullscreenStatusbar:null,heightAbovePages:[],horizontalOffset:0,horizontalPadding:0,inFullscreen:false,itemTitle:"",lastPageLoaded:-1,maxHeight:0,maxWidth:0,numPages:0,pages:[],panelHeight:0,panelWidth:0,prevVptTop:0,scaleWait:false,selector:"",scrollSoFar:0,totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0};a.extend(E,m);var x=function(N,K){var L=E.panelHeight;var J=E.scrollSoFar;var M=J+L;if(N>=J&&N<=M){return true;}else{if(K>=J&&K<=M){return true;}else{if(N<=J&&K>=M){return true;}else{return false;}}}};var f=function(J){if(a(E.selector+"page-"+J).length===0){return false;}else{return true;}};var D=function(J){var K=E.heightAbovePages[J];var L=K+E.pages[J].h+E.verticalPadding;return x(K,L);};var o=function(J,L,N){var K=E.heightAbovePages[J]+(L*E.tileHeight)+E.verticalPadding;var M=K+E.tileHeight;return x(K,M);};var d=function(J,K){if(a(E.selector+"tile-"+J+"-"+K).length>0){return true;}else{return false;}};var p=function(Y){var ad=[];var ae=E.pages[Y].fn;var U=E.pages[Y].r;var W=E.pages[Y].c;var ac=E.pages[Y].w;var Z=E.pages[Y].h;var ab=E.pages[Y].m_z;var V,P;var ag,L,R,Q,S,J,K;var ai=0;var N=E.heightAbovePages[Y]+E.verticalPadding;if(!f(Y)){if(ac===E.maxWidth){if(ac>=E.panelWidth-2*E.horizontalPadding){V=E.horizontalPadding;}else{V=(E.panelWidth-ac)/2;}}else{P=(E.maxWidth>E.panelWidth)?E.maxWidth+2*E.horizontalPadding:E.panelWidth;V=(P-ac)/2;}ad.push('<div id="'+E.ID+"page-"+Y+'" style="top: '+N+"px; width:"+ac+"px; height: "+Z+"px; left:"+V+'px;" class="diva-page">');}ag=Z-(U-1)*E.tileHeight;L=ac-(W-1)*E.tileWidth;var ah=[];for(R=0;R<U;R++){for(Q=0;Q<W;Q++){var X=R*E.tileHeight;var O=Q*E.tileWidth;var T=(E.tileFadeSpeed)?"none":"inline";var aa=(ab===E.maxZoomLevel)?E.zoomLevel:E.zoomLevel+(ab-E.maxZoomLevel);S=(R===U-1)?ag:E.tileHeight;J=(Q===W-1)?L:E.tileWidth;K=E.iipServerBaseUrl+ae+"&amp;JTL="+aa+","+ai;if(!d(Y,ai)&&o(Y,R,Q)){ad.push('<div id="'+E.ID+"tile-"+Y+"-"+ai+'"style="display: '+T+"; position: absolute; top: "+X+"px; left: "+O+"px; background-image: url('"+K+"'); height: "+S+"px; width: "+J+'px;"></div>');}ah.push(ai);ai++;}}if(!f(Y)){ad.push("</div>");var M=ad.join("");a(E.innerSelector).append(M);}else{a(E.selector+"page-"+Y).append(ad.join(""));}if(E.tileFadeSpeed){for(var af=0;af<ah.length;af++){a(E.selector+"tile-"+Y+"-"+ah[af]).fadeIn(E.tileFadeSpeed);}}};var I=function(J){if(f(J)){a(E.selector+"page-"+J).remove();}};var e=function(J){if(J>=0&&J<E.numPages){return true;}else{return false;}};var w=function(K){var L=E.heightAbovePages[K]+E.pages[K].h+E.verticalPadding;var J=E.scrollSoFar;if(L<J){return true;}return false;};var c=function(J){var K=E.heightAbovePages[J];var L=E.scrollSoFar+E.panelHeight;if(K>L){return true;}return false;};var s=function(O,K){var M=E.currentPageIndex;var J=E.currentPageIndex+parseInt(O,10);var N=E.scrollSoFar+(E.panelHeight/2);var L=false;if(O<0){if(J>=0&&(E.heightAbovePages[M]>=N||E.heightAbovePages[J]>=E.scrollSoFar)){L=true;}}else{if(O>0){if(E.heightAbovePages[M]+E.pages[M].h<E.scrollSoFar&&J<E.pages.length){L=true;}}else{L=true;J=K;}}if(L){E.currentPageIndex=J;a(E.selector+"current span").text(J+1);if(E.inFullscreen){if(E.fullscreenStatusbar==null){g("fade");}E.fullscreenStatusbar.pnotify({pnotify_text:"Page: "+(J+1)});}if(O!==0){s(O);}}};var l=function(J,K){if(K>0){if(e(J)){if(D(J)){p(J);E.lastPageLoaded=J;l(E.lastPageLoaded+1,K);}else{if(w(J)){l(J+1,K);}}}else{return;}}else{if(e(J)){if(D(J)){p(J);E.firstPageLoaded=J;l(E.firstPageLoaded-1,K);}else{if(c(J)){l(J-1,K);}}}else{return;}}};var y=function(J,K){if(K>0){if(e(J)&&w(J)){I(J);E.firstPageLoaded++;y(E.firstPageLoaded,K);}else{return;}}else{if(e(J)&&c(J)){I(J);E.lastPageLoaded--;y(E.lastPageLoaded,K);}else{return;}}};var i=function(J){if(J<0){l(E.firstPageLoaded,J);s(-1);y(E.lastPageLoaded,J);}else{if(J>0){y(E.firstPageLoaded,J);l(E.lastPageLoaded,J);s(1);}}if(typeof E.onScroll=="function"&&J!==0){E.onScroll.call(this,E.currentPageIndex);}if(typeof E.onScrollUp=="function"&&J<0){E.onScrollUp.call(this,E.currentPageIndex);}if(typeof E.onScrollDown=="function"&&J>0){E.onScrollDown.call(this,E.currentPageIndex);}};var C=function(){var N,M,L,J;var K=(E.dimBeforeZoom>0)?E.dimAfterZoom/E.dimBeforeZoom:1;if(E.doubleClick){N=E.centerX*K;M=E.centerY*K;L=Math.max((N)-(E.panelWidth/2),0);J=Math.max((M)-(E.panelHeight/2),0);}else{if(E.maxWidth+E.horizontalPadding*2<=E.panelWidth){L=0;}else{L=E.maxWidth/2-E.panelWidth/2+E.horizontalPadding;}L=(E.horizontalOffset>0)?E.horizontalOffset*K:E.maxWidth/2-E.panelWidth/2+E.horizontalPadding;J=E.verticalOffset*K;}E.prevVptTop=0;a(E.outerSelector).scrollTop(J);a(E.outerSelector).scrollLeft(L);};var F=function(J){a.ajax({url:E.backendServer+"&z="+J,cache:true,context:this,dataType:"json",success:function(N){if(E.firstAjaxRequest){E.itemTitle=N.item_title;E.numPages=N.pgs.length;E.maxZoomLevel=(E.maxZoomLevel>0)?E.maxZoomLevel:N.max_zoom;a(E.selector+"current label").text(E.numPages);if(E.enableZoomSlider){q();}if(E.enableAutoTitle){a(E.elementSelector).prepend('<div id="'+E.ID+'title">'+E.itemTitle+"</div>");}}if(E.adaptivePadding>0){E.horizontalPadding=N.dims.a_wid*E.adaptivePadding;E.verticalPadding=N.dims.a_hei*E.adaptivePadding;}else{E.horizontalPadding=E.fixedPadding;E.verticalPadding=E.fixedPadding;}a(E.outerSelector).scrollTop(0);E.scrollSoFar=0;a(E.innerSelector).text("");E.pages=N.pgs;E.totalHeight=N.dims.t_hei+E.verticalPadding*(E.numPages+1);E.zoomLevel=J;E.maxWidth=N.dims.mx_w;E.maxHeight=N.dims.mx_h;E.dimAfterZoom=E.totalHeight;E.firstPageLoaded=0;var K=0;var L;for(L=0;L<E.numPages;L++){E.heightAbovePages[L]=K;K=E.heightAbovePages[L]+E.pages[L].h+E.verticalPadding;if(D(L)){p(L);E.lastPageLoaded=L;}}a(E.innerSelector).css("height",E.totalHeight);var M=(N.dims.mx_w+E.horizontalPadding*2<E.panelWidth)?E.panelWidth:N.dims.mx_w+E.horizontalPadding*2;a(E.innerSelector).css("width",M);C();if(!E.firstAjaxRequest){if(typeof E.onZoom=="function"){E.onZoom.call(this,J);}if(E.dimBeforeZoom>E.dimAfterZoom){if(typeof E.onZoomOut=="function"){E.onZoomOut.call(this,J);}}else{if(E.dimBeforeZoom<E.dimAfterZoom){if(typeof E.onZoomIn=="function"){E.onZoomIn.call(this,J);}}}}E.dimBeforeZoom=E.dimAfterZoom;E.firstAjaxRequest=false;if(E.scaleWait){E.scaleWait=false;}}});};var h=function(){E.scrollSoFar=a(E.outerSelector).scrollTop();i(E.scrollSoFar-E.prevVptTop);E.prevVptTop=E.scrollSoFar;};var u=function(J){if(E.zoomLevel!=J){F(J);a(E.selector+"zoom-slider").slider({value:J});}};var z=function(J){E.verticalOffset=a(E.outerSelector).scrollTop();E.horizontalOffset=a(E.outerSelector).scrollLeft();E.doubleClick=false;u(J);};var H=function(J){J--;if(e(J)){var K=E.heightAbovePages[J];s(0,J);a(E.outerSelector).scrollTop(K);if(typeof E.onJump=="function"){E.onJump.call(this,J+1);}return true;}return false;};var A=function(K){var J;if(E.zoomLevel===E.maxZoomLevel){if(K.ctrlKey){J=E.zoomLevel-1;}else{return;}}else{if(E.zoomLevel===E.minZoomLevel){if(K.ctrlKey){return;}else{J=E.zoomLevel+1;}}else{if(K.ctrlKey){J=E.zoomLevel-1;}else{J=E.zoomLevel+1;}}}E.centerX=(K.pageX-E.viewerXOffset)+a(E.outerSelector).scrollLeft();E.centerY=(K.pageY-E.viewerYOffset)+a(E.outerSelector).scrollTop();E.doubleClick=true;u(J);};var r=function(J){J.preventDefault();};var G=function(K){var J=E.zoomLevel;if(K.scale>1&&J<E.maxZoomLevel){J++;}else{if(K.scale<1&&J>E.minZoomLevel){J--;}else{return;}}E.scaleWait=true;z(J);};var k=function(){if(E.enableFullscreen){a(E.selector+"fullscreen").click(function(){E.verticalOffset=a(E.outerSelector).scrollTop();E.horizontalOffset=a(E.outerSelector).scrollLeft();E.doubleClick=false;a(E.innerSelector).text("");if(E.inFullscreen){if(E.fullscreenStatusbar!=null){E.fullscreenStatusbar.pnotify({pnotify_animation:"none"});E.fullscreenStatusbar.pnotify_remove();E.fullscreenStatusbar=null;}a(E.outerSelector).removeClass("fullscreen");E.inFullscreen=false;a("body").css("overflow","auto");a(E.selector+"fullscreen").css("position","absolute").css("z-index","8999");}else{if(E.fullscreenStatusbar==null){g("none");}a(E.selector+"fullscreen").css("position","fixed").css("z-index","9001");a(E.outerSelector).addClass("fullscreen");E.inFullscreen=true;a("body").css("overflow","hidden");}E.panelWidth=parseInt(a(E.outerSelector).width(),10)-20;E.panelHeight=parseInt(a(E.outerSelector).height(),10);a(E.innerSelector).width(E.panelWidth);F(E.zoomLevel);});}a(E.innerSelector).mouseover(function(){a(this).removeClass("grabbing").addClass("grab");});a(E.innerSelector).mouseout(function(){a(this).removeClass("grab");});a(E.innerSelector).mousedown(function(){a(this).removeClass("grab").addClass("grabbing");});a(E.innerSelector).mouseup(function(){a(this).removeClass("grabbing").addClass("grab");});a(E.outerSelector).scroll(function(){h();});a(E.outerSelector+", "+E.innerSelector).dragscrollable({dragSelector:".dragger",acceptPropagatedEvent:true});a(E.outerSelector).dblclick(function(N){E.viewerXOffset=this.offsetLeft;E.viewerYOffset=this.offsetTop;A(N);});a(E.outerSelector).bind("contextmenu",function(N){var O=N.originalEvent;if(O.ctrlKey){O.preventDefault();O.stopPropagation();}});if(navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod"){a(E.outerSelector).oneFingerScroll();var K=[];K.push('<meta name="viewport" content="user-scalable=no, width=device-width" />');K.push('<meta name="apple-mobile-web-app-capable" content="yes" />');K.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');a("head").append(K.join("\n"));a("body").bind("touchmove",function(N){var O=N.originalEvent;r(O);});a("body").bind("gestureend",function(N){var O=N.originalEvent;if(!E.scaleWait){G(O);}return false;});}if(E.enableSpaceScroll||E.enableKeyScroll){var L=a.ui.keyCode.SPACE;var J=a.ui.keyCode.PAGE_UP;var M=a.ui.keyCode.PAGE_DOWN;a(document).keydown(function(N){if((E.enableSpaceScroll&&N.keyCode==L)||(E.enableKeyScroll&&N.keyCode==M)){a(E.outerSelector).scrollTop(E.scrollSoFar+E.panelHeight);return false;}if(E.enableKeyScroll&&N.keyCode==J){a(E.outerSelector).scrollTop(E.scrollSoFar-E.panelHeight);return false;}});}};var g=function(K){var J={pnotify_text:"Page: "+(E.currentPageIndex+1),pnotify_history:false,pnotify_width:"110px",pnotify_hide:false,pnotify_notice_icon:"",pnotify_animation:K,pnotify_before_close:function(){E.fullscreenStatusbar=null;}};E.fullscreenStatusbar=a.pnotify(J);};var q=function(){a(E.selector+"tools").prepend('<div id="'+E.ID+'zoom-slider"></div>');a(E.selector+"zoom-slider").slider({value:E.zoomLevel,min:E.minZoomLevel,max:E.maxZoomLevel,step:1,slide:function(J,K){z(K.value);}});};var v=function(){a(E.selector+"tools").append('<div id="'+E.ID+'goto-page">Go to page <input type="text" size="3" id="'+E.ID+'goto-input" /> <input type="submit" id="'+E.ID+'goto-submit" value="Go" /><br /><div id="'+E.ID+'current">Current page: <span>1</span> of <label></label></div></div>');a(E.selector+"goto-submit").click(function(){var J=parseInt(a(E.selector+"goto-input").val(),10);if(!H(J)){alert("Invalid page number");}});};var B=function(){E.elementSelector="#"+a(j).attr("id");E.ID=a.generateId("diva-");E.selector="#"+E.ID;E.outerSelector=E.selector+"outer";E.innerSelector=E.selector+"inner";if(E.zoomSlider||E.enableGotoPage){a(E.elementSelector).prepend('<div id="'+E.ID+'tools"></div>');}if(E.enableGotoPage){v();}a(E.elementSelector).append('<div id="'+E.ID+'outer"></div>');a(E.outerSelector).append('<div id="'+E.ID+'inner" class="dragger"></div>');if(navigator.platform=="iPad"||navigator.platform=="iPhone"||navigator.platform=="iPod"){E.panelWidth=screen.width-20;a(E.elementSelector).css("width",E.panelWidth);a(E.outerSelector).css("width",E.panelWidth+"px");E.panelHeight=screen.height-170;a(E.outerSelector).css("height",E.panelHeight+"px");}else{E.panelWidth=parseInt(a(E.elementSelector).width(),10)-18;a(E.outerSelector).css("width",(E.panelWidth+18)+"px");E.panelHeight=parseInt(a(E.outerSelector).height(),10);}if(E.enableFullscreen){a(E.elementSelector).prepend('<div id="'+E.ID+'fullscreen"></div>');}F(E.zoomLevel);k();};B();this.getItemTitle=function(){return E.itemTitle;};this.gotoPage=function(J){return H(J);};this.getCurrentPage=function(){return E.currentPageIndex;};this.getZoomLevel=function(){return E.zoomLevel;};};a.fn.diva=function(c){return this.each(function(){var e=a(this);if(e.data("diva")){return;}var d=new b(this,c);e.data("diva",d);});};})(jQuery);