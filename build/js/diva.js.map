{"version":3,"file":"diva.js","sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap fd978b947c3317b95080","webpack:///./source/js/register-builtin-plugins.js","webpack:///./source/js/diva-global.js","webpack:///./source/js/utils/events.js","webpack:///./source/js/plugin-registry.js","webpack:///./source/js/plugins/autoscroll.js","webpack:///./source/js/diva.js","webpack:///./source/js/utils/elt.js","webpack:///./source/js/utils/hash-params.js","webpack:///./source/js/active-diva-controller.js","webpack:///./source/js/image-manifest.js","webpack:///./source/js/parse-iiif-manifest.js","webpack:///./source/js/toolbar.js","webpack:///./source/js/viewer-core.js","webpack:///./source/js/utils/jquery-extensions.js","webpack:///./source/js/utils/get-scrollbar-width.js","webpack:///./source/js/gesture-events.js","webpack:///./source/js/document-handler.js","webpack:///./~/lodash.maxby/index.js","webpack:///(webpack)/buildin/module.js","webpack:///./source/js/page-tools-overlay.js","webpack:///./source/js/grid-handler.js","webpack:///./source/js/page-overlay-manager.js","webpack:///./source/js/renderer.js","webpack:///./~/debug/src/browser.js","webpack:///./~/process/browser.js","webpack:///./~/debug/src/debug.js","webpack:///./~/ms/index.js","webpack:///./source/js/composite-image.js","webpack:///./source/js/document-layout.js","webpack:///./source/js/image-cache.js","webpack:///./source/js/image-request-handler.js","webpack:///./source/js/interpolate-animation.js","webpack:///./source/js/page-layouts/index.js","webpack:///./source/js/page-layouts/book-layout.js","webpack:///./source/js/page-layouts/page-dimensions.js","webpack:///./source/js/page-layouts/singles-layout.js","webpack:///./source/js/page-layouts/grid-layout.js","webpack:///./source/js/settings-view.js","webpack:///./source/js/validation-runner.js","webpack:///./source/js/viewport.js","webpack:///./source/js/plugins/canvas.js","webpack:///./source/js/plugins/download.js","webpack:///./source/js/plugins/highlight.js","webpack:///./source/js/plugins/iiif-highlight.js","webpack:///./source/js/plugins/iiif-metadata.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"jquery\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"diva\"] = factory(require(\"jquery\"));\n\telse\n\t\troot[\"diva\"] = factory(root[\"jQuery\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_3__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap fd978b947c3317b95080","var diva = require('./diva-global');\n\ndiva.registerPlugin(require('./plugins/autoscroll'));\ndiva.registerPlugin(require('./plugins/canvas'));\ndiva.registerPlugin(require('./plugins/download'));\ndiva.registerPlugin(require('./plugins/highlight'));\ndiva.registerPlugin(require('./plugins/iiif-highlight'));\ndiva.registerPlugin(require('./plugins/iiif-metadata'));\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/register-builtin-plugins.js\n// module id = 1\n// module chunks = 0","var $ = require('jquery');\n\nvar Events = require('./utils/events');\nvar PluginRegistry = require('./plugin-registry');\n\nvar diva = module.exports = {\n    Events: new Events(),\n\n    registerPlugin: function (plugin)\n    {\n        PluginRegistry.register(plugin);\n    },\n\n    /**\n     * Create a new Diva instance at the given element\n     *\n     * @param element {Element}\n     * @param options {Object}\n     * @returns {Diva}\n     */\n    create: function (element, options)\n    {\n        if (diva.find(element))\n            throw new Error('Diva is already initialized on ' + reprElem(element));\n\n        var $elem = $(element);\n        $elem.diva(options);\n\n        return $elem.data('diva');\n    },\n\n    /**\n     * Return the Diva instance attached to the\n     * element, if any.\n     *\n     * @param element\n     * @returns {Diva|null}\n     */\n    find: function (element)\n    {\n        return $(element).data('diva') || null;\n    }\n};\n\nfunction reprElem(elem)\n{\n    var id = elem.id ? '#' + elem.id : elem.id;\n    var classes = elem.className ? '.' + elem.className.split(/\\s+/g).join('.') : '';\n\n    return (id ? id : elem.tagName.toLowerCase()) + classes;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/diva-global.js\n// module id = 2\n// module chunks = 0","module.exports = Events;\n\n/**\n *      Events. Pub/Sub system for Loosely Coupled logic.\n *      Based on Peter Higgins' port from Dojo to jQuery\n *      https://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js\n *\n *      Re-adapted to vanilla Javascript\n *\n *      @class Events\n */\nfunction Events()\n{\n    this._cache = {};\n}\n\n/**\n *      diva.Events.publish\n *      e.g.: diva.Events.publish(\"PageDidLoad\", [pageIndex, filename, pageSelector], this);\n *\n *      @class Events\n *      @method publish\n *      @param topic {String}\n *      @param args  {Array}\n *      @param scope {Object=} Optional - Subscribed functions will be executed with the supplied object as `this`.\n *          It is necessary to supply this argument with the self variable when within a Diva instance.\n *          The scope argument is matched with the instance ID of subscribers to determine whether they\n *              should be executed. (See instanceID argument of subscribe.)\n */\nEvents.prototype.publish = function (topic, args, scope)\n{\n    if (this._cache[topic])\n    {\n        var thisTopic = this._cache[topic];\n\n        if (typeof thisTopic.global !== 'undefined')\n        {\n            var thisTopicGlobal = thisTopic.global;\n            var globalCount = thisTopicGlobal.length;\n\n            for (var i=0; i < globalCount; i++)\n            {\n                thisTopicGlobal[i].apply(scope || null, args || []);\n            }\n        }\n\n        if (scope && typeof scope.getInstanceId !== 'undefined')\n        {\n            // get publisher instance ID from scope arg, compare, and execute if match\n            var instanceID = scope.getInstanceId();\n\n            if (this._cache[topic][instanceID])\n            {\n                var thisTopicInstance = this._cache[topic][instanceID];\n                var scopedCount = thisTopicInstance.length;\n\n                for (var j=0; j < scopedCount; j++)\n                {\n                    thisTopicInstance[j].apply(scope, args || []);\n                }\n            }\n        }\n    }\n};\n\n/**\n *      diva.Events.subscribe\n *      e.g.: diva.Events.subscribe(\"PageDidLoad\", highlight, settings.ID)\n *\n *      @class Events\n *      @method subscribe\n *      @param topic {String}\n *      @param callback {Function}\n *      @param instanceID {String=} Optional - String representing the ID of a Diva instance; if provided,\n *                                            callback only fires for events published from that instance.\n *      @return Event handler {Array}\n */\nEvents.prototype.subscribe = function (topic, callback, instanceID)\n{\n    if (!this._cache[topic])\n    {\n        this._cache[topic] = {};\n    }\n\n    if (typeof instanceID === 'string')\n    {\n        if (!this._cache[topic][instanceID])\n        {\n            this._cache[topic][instanceID] = [];\n        }\n\n        this._cache[topic][instanceID].push(callback);\n    }\n    else\n    {\n        if (!this._cache[topic].global)\n        {\n            this._cache[topic].global = [];\n        }\n\n        this._cache[topic].global.push(callback);\n    }\n\n    var handle = instanceID ? [topic, callback, instanceID] : [topic, callback];\n\n    return handle;\n};\n\n/**\n *      diva.Events.unsubscribe\n *      e.g.: var handle = Events.subscribe(\"PageDidLoad\", highlight);\n *              Events.unsubscribe(handle);\n *\n *      @class Events\n *      @method unsubscribe\n *      @param handle {Array}\n *      @param completely {Boolean=} - Unsubscribe all events for a given topic.\n *      @return success {Boolean}\n */\nEvents.prototype.unsubscribe = function (handle, completely)\n{\n    var t = handle[0];\n\n    if (this._cache[t])\n    {\n        var topicArray;\n        var instanceID = handle.length === 3 ? handle[2] : 'global';\n\n        topicArray = this._cache[t][instanceID];\n\n        if (!topicArray)\n        {\n            return false;\n        }\n\n        if (completely)\n        {\n            delete this._cache[t][instanceID];\n            return topicArray.length > 0;\n        }\n\n        var i = topicArray.length;\n        while (i--)\n        {\n            if (topicArray[i] === handle[1])\n            {\n                this._cache[t][instanceID].splice(i, 1);\n                return true;\n            }\n        }\n    }\n\n    return false;\n};\n\n/**\n *      diva.Events.unsubscribeAll\n *      e.g.: diva.Events.unsubscribeAll('global');\n *\n *      @class Events\n *      @param instanceID {String=} Optional - instance ID to remove subscribers from or 'global' (if omitted,\n *                                   subscribers in all scopes removed)\n *      @method unsubscribeAll\n */\nEvents.prototype.unsubscribeAll = function (instanceID)\n{\n    if (instanceID)\n    {\n        var topics = Object.keys(this._cache);\n        var i = topics.length;\n        var topic;\n\n        while (i--)\n        {\n            topic = topics[i];\n\n            if (typeof this._cache[topic][instanceID] !== 'undefined')\n            {\n                delete this._cache[topic][instanceID];\n            }\n        }\n    }\n    else\n    {\n        this._cache = {};\n    }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/utils/events.js\n// module id = 4\n// module chunks = 0","/**\n * @module\n * @private\n * The global plugin registry.\n */\n\nvar plugins = [];\n\nmodule.exports = {\n    register: function (plugin)\n    {\n        plugins.push(plugin);\n    },\n    getAll: function ()\n    {\n        return plugins;\n    }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugin-registry.js\n// module id = 5\n// module chunks = 0","/*\nDiva.JS autoscroll plugin\nAuthor: Andrew Horwitz\n\nLets Diva scroll in the primary direction (as determined by\nsettings.verticallyOriented) automatically at a given/changeable rate.\n\nRelevant settings:\n    -scrollSpeed: pixels per second (defaults to 10)\n    -disableManualScroll: disables manual scroll while automatic scroll is on (defaults to false)\n    -currentlyAutoScrolling: whether or not autoscroll is currently on\n    -autoScrollRefresh: ms between scrolling actions\n    -disableAutoscrollPrefs: disables the autoscroll preferences panel\n\nRelevant methods:\n    -startScrolling, stopScrolling, toggleScrolling\n    -changeRefresh, changeScrollSpeed (setters for respective options)\n    -disableManualScroll, enableManualScroll\n*/\n\nvar jQuery = require('jquery');\nvar diva = require('../diva');\n\n(function ($)\n{\n    module.exports = (function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                var pixelsPerScroll;\n                var disableManualScroll;\n                var autoScrollRefresh;\n                var defaultAutoRefresh;\n                var scrollSpeed;\n\n                function log10(x)\n                {\n                    return Math.log(x) / Math.log(10);\n                }\n\n                divaInstance.startScrolling = function()\n                {\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        console.warn(\"You are trying to start autoscrolling, but it is already scrolling.\");\n                        return;\n                    }\n\n                    $(\"#\" + divaSettings.ID + \"autoscroll-toggle\").text(\"Turn off\");\n                    if (disableManualScroll)\n                    {\n                        divaInstance.disableScrollable();\n                    }\n\n                    divaSettings.currentlyAutoScrolling = true;\n                    restartScrollingInterval();\n                };\n\n                var restartScrollingInterval = function()\n                {\n                    clearInterval(divaSettings.autoScrollInterval);\n                    if (divaSettings.verticallyOriented)\n                    {\n                        divaSettings.autoScrollInterval = setInterval(function(){\n                            divaSettings.viewportObject.scrollTop(divaSettings.viewportObject.scrollTop() + pixelsPerScroll);\n                        }, autoScrollRefresh);\n                    }\n                    else\n                    {\n                        divaSettings.autoScrollInterval = setInterval(function(){\n                            divaSettings.viewportObject.scrollLeft(divaSettings.viewportObject.scrollLeft() + pixelsPerScroll);\n                        }, autoScrollRefresh);\n                    }\n                };\n\n                divaInstance.stopScrolling = function()\n                {\n                    if (!divaSettings.currentlyAutoScrolling)\n                    {\n                        console.warn(\"You are trying to stop autoscrolling, but it is not currently active.\");\n                        return;\n                    }\n\n                    $(\"#\" + divaSettings.ID + \"autoscroll-toggle\").text(\"Turn on\");\n                    if (disableManualScroll)\n                    {\n                        divaInstance.enableScrollable();\n                    }\n\n                    divaSettings.currentlyAutoScrolling = false;\n                    clearInterval(divaSettings.autoScrollInterval);\n                };\n\n                divaInstance.toggleScrolling = function()\n                {\n                    if (divaSettings.currentlyAutoScrolling)\n                        divaInstance.stopScrolling();\n                    else\n                        divaInstance.startScrolling();\n                };\n\n                divaInstance.changeRefresh = function(newRefresh)\n                {\n                    autoScrollRefresh = newRefresh;\n                    updatePixelsPerScroll();\n                };\n\n                divaInstance.changeScrollSpeed = function(newSpeed)\n                {\n                    scrollSpeed = newSpeed;\n                    updatePixelsPerScroll();\n\n                    $(\"#\" + divaSettings.ID + \"autoscroll-pps\").val(log10(scrollSpeed));\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        restartScrollingInterval();\n                    }\n                };\n\n                var updatePixelsPerScroll = function()\n                {\n                    autoScrollRefresh = defaultAutoRefresh;\n                    pixelsPerScroll = scrollSpeed / (1000 / autoScrollRefresh);\n\n                    //should be minimum of one otherwise it won't change the actual value\n                    //user can change autoscrollrefresh or scrollspeed; this may overwrite autoScrollRefresh\n                    if (pixelsPerScroll < 1)\n                    {\n                        autoScrollRefresh = autoScrollRefresh * (1 / pixelsPerScroll);\n                        pixelsPerScroll = scrollSpeed / (1000 / autoScrollRefresh);\n                    }\n                };\n\n                divaInstance.disableManualScroll = function()\n                {\n                    disableManualScroll = true;\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        divaInstance.disableScrollable();\n                    }\n                };\n\n                divaInstance.enableManualScroll = function()\n                {\n                    disableManualScroll = false;\n                    if (divaSettings.currentlyAutoScrolling)\n                    {\n                        divaInstance.enableScrollable();\n                    }\n                };\n\n                divaSettings.currentlyAutoScrolling = false;\n                divaSettings.autoScrollInterval = \"\";\n\n                disableManualScroll = divaSettings.disableManualScroll || false;\n                autoScrollRefresh = divaSettings.autoScrollRefresh || 50;\n                defaultAutoRefresh = autoScrollRefresh;\n\n                divaInstance.changeScrollSpeed((divaSettings.scrollSpeed || 10));\n\n                $(window).on('keyup', function(e)\n                {\n                    if (e.shiftKey && e.keyCode === 32)\n                    {\n                        divaInstance.toggleScrolling();\n                    }\n                });\n\n                if (!divaSettings.disableAutoscrollPrefs)\n                {\n                    var setPosition = function(isFullscreen)\n                    {\n                        if (divaSettings.inFullscreen)\n                        {\n                            var fullscreenTools = $(divaSettings.selector + 'tools');\n                            var toolsMargin = fullscreenTools.css('right');\n                            settings.jqObj.css({\n                                'right': toolsMargin,\n                                'margin-right': 0,\n                                'top': fullscreenTools.offset().top + fullscreenTools.outerHeight() + 15\n                            });\n                        }\n                        else\n                        {\n                            settings.jqObj.css({\n                                'right': $(window).width() - (divaSettings.viewportObject.offset().left + divaSettings.viewportObject.outerWidth()) + divaSettings.scrollbarWidth,\n                                'margin-right': '.6em'\n                            });\n                            settings.jqObj.offset({'top': divaSettings.viewportObject.offset().top + 1});\n                        }\n                    };\n\n                    diva.Events.subscribe('ModeDidSwitch', setPosition, divaSettings.ID);\n\n                    diva.Events.subscribe('ViewerDidLoad', function(s)\n                    {\n                        var autoscrollPrefsString =\n                        \"<div id='\" + divaSettings.ID + \"autoscroll-prefs' class='diva-autoscroll-prefs diva-popup'>\" +\n                            \"<b>Autoscrolling options:</b><br>\" +\n                            \"<span class='diva-autoscroll-prefs-text'>Speed:</span>\" +\n                            \"<input type='range' id='\" + divaSettings.ID + \"autoscroll-pps' class='diva-autoscroll-pps diva-autoscroll-prefs-input' value='\" + log10(scrollSpeed) + \"' min='0' max='3' step='0.1'><br>\" +\n                            \"<span class='diva-autoscroll-prefs-text'>Allow manual scroll:</span>\" +\n                            \"<input type='checkbox' id='\" + divaSettings.ID + \"autoscroll-manual' class='diva-autoscroll-manual diva-autoscroll-prefs-input' checked='checked'><br>\" +\n                            \"<button id='\" + divaSettings.ID + \"autoscroll-toggle' class='diva-autoscroll-prefs-toggle diva-autoscroll-prefs-input'> Turn on </button>\" +\n                        \"</div>\";\n                        $(\"#\" + divaSettings.ID + \"page-nav\").before(\"<div id='\" + divaSettings.ID + \"autoscroll-icon' class='diva-button diva-autoscroll-icon' title='Expand autoscroll options'></div>\");\n                        $(\"body\").prepend(autoscrollPrefsString);\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-pps\").on('change', function(e)\n                        {\n                            divaInstance.changeScrollSpeed(Math.pow(10, e.target.value));\n                        });\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-manual\").on('change', function(e)\n                        {\n                            if (e.target.checked)\n                                divaInstance.enableManualScroll();\n                            else\n                                divaInstance.disableManualScroll();\n                        });\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-toggle\").on('click', divaInstance.toggleScrolling);\n\n                        $(\"#\" + divaSettings.ID + \"autoscroll-icon\").on('click', function(e)\n                        {\n                            settings.jqObj = $(\"#\" + divaSettings.ID + \"autoscroll-prefs\");\n\n                            if (settings.jqObj.css('display') === 'none')\n                            {\n                                settings.jqObj.css({'display': 'block'});\n\n                                setPosition(divaSettings.inFullscreen);\n\n                            }\n                            else\n                            {\n                                settings.jqObj.css('display', 'none');\n                            }\n                        });\n                    }, divaSettings.ID);\n                }\n            },\n            pluginName: 'autoscroll',\n            titleText: 'Automatically scrolls page along primary axis'\n        };\n        return retval;\n    })();\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugins/autoscroll.js\n// module id = 6\n// module chunks = 0","/*\nCopyright (C) 2011-2016 by Wendy Liu, Evan Magoni, Andrew Hankinson, Andrew Horwitz, Laurent Pugin\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n*/\n\nvar jQuery = require('jquery');\n\nvar elt = require('./utils/elt');\nvar HashParams = require('./utils/hash-params');\n\nvar ActiveDivaController = require('./active-diva-controller');\nvar diva = require('./diva-global');\nvar ImageManifest = require('./image-manifest');\nvar createToolbar = require('./toolbar');\nvar ViewerCore = require('./viewer-core');\n\n// Start the active Diva tracker\nvar activeDiva = new ActiveDivaController(); // jshint ignore: line\n\nmodule.exports = diva;\n\n// this pattern was taken from http://www.virgentech.com/blog/2009/10/building-object-oriented-jquery-plugin.html\n(function ($)\n{\n    var Diva = function (element, options)\n    {\n        // Global instance variables (set way down in `init`)\n        var settings, viewerState, divaState;\n        var self = this;\n\n        // These are elements that can be overridden upon instantiation\n        // See https://github.com/DDMAL/diva.js/wiki/Settings for more details\n        options = $.extend({\n            adaptivePadding: 0.05,      // The ratio of padding to the page dimension\n            arrowScrollAmount: 40,      // The amount (in pixels) to scroll by when using arrow keys\n            blockMobileMove: false,     // Prevent moving or scrolling the page on mobile devices\n            objectData: '',             // A IIIF Manifest or a JSON file generated by process.py that provides the object dimension data, or a URL pointing to such data - *REQUIRED*\n            enableAutoTitle: true,      // Shows the title within a div of id diva-title\n            enableFilename: true,       // Uses filenames and not page numbers for links (i=bm_001.tif, not p=1)\n            enableFullscreen: true,     // Enable or disable fullscreen icon (mode still available)\n            enableGotoPage: true,       // A \"go to page\" jump box\n            enableGotoSuggestions: true, // Controls whether suggestions are shown under the input field when the user is typing in the 'go to page' form\n            enableGridIcon: true,       // A grid view of all the pages\n            enableGridControls: 'buttons',  // Specify control of pages per grid row in Grid view. Possible values: 'buttons' (+/-), 'slider'. Any other value disables the controls.\n            enableImageTitles: true,    // Adds \"Page {n}\" title to page images if true\n            enableKeyScroll: true,      // Captures scrolling using the arrow and page up/down keys regardless of page focus. When off, defers to default browser scrolling behavior.\n            enableLinkIcon: true,       // Controls the visibility of the link icon\n            enableNonPagedVisibilityIcon: true, // Controls the visibility of the icon to toggle the visibility of non-paged pages. (Automatically hidden if no 'non-paged' pages).\n            enableSpaceScroll: false,   // Scrolling down by pressing the space key\n            enableToolbar: true,        // Enables the toolbar. Note that disabling this means you have to handle all controls yourself.\n            enableZoomControls: 'buttons', // Specify controls for zooming in and out. Possible values: 'buttons' (+/-), 'slider'. Any other value disables the controls.\n            fillParentHeight: true,     // Use a flexbox layout to allow Diva to fill its parent's height\n            fixedPadding: 10,           // Fallback if adaptive padding is set to 0\n            fixedHeightGrid: true,      // So each page in grid view has the same height (only widths differ)\n            goDirectlyTo: 0,            // Default initial page to show (0-indexed)\n            hashParamSuffix: null,      // Used when there are multiple document viewers on a page\n            iipServerURL: '',           // The URL to the IIPImage installation, including the `?FIF=` - *REQUIRED*, unless using IIIF\n            inFullscreen: false,        // Set to true to load fullscreen mode initially\n            inBookLayout: false,       // Set to true to view the document with facing pages in document mode\n            inGrid: false,              // Set to true to load grid view initially\n            imageDir: '',               // Image directory, either absolute path or relative to IIP's FILESYSTEM_PREFIX - *REQUIRED*, unless using IIIF\n            maxPagesPerRow: 8,          // Maximum number of pages per row in grid view\n            maxZoomLevel: -1,           // Optional; defaults to the max zoom returned in the JSON response\n            minPagesPerRow: 2,          // Minimum pages per row in grid view. Recommended default.\n            minZoomLevel: 0,            // Defaults to 0 (the minimum zoom)\n            onGotoSubmit: null,         // When set to a function that takes a string and returns a page index, this will override the default behaviour of the 'go to page' form submission\n            pageAliases: {},            // An object mapping specific page indices to aliases (has priority over 'pageAliasFunction'\n            pageAliasFunction: function(){return false;},  // A function mapping page indices to an alias. If false is returned, default page number is displayed\n            pageLoadTimeout: 200,       // Number of milliseconds to wait before loading pages\n            pagesPerRow: 5,             // The default number of pages per row in grid view\n            showNonPagedPages: false,   // Whether pages tagged as 'non-paged' (in IIIF manifests only) should be visible after initial load\n            throbberTimeout: 100,       // Number of milliseconds to wait before showing throbber\n            tileHeight: 256,            // The height of each tile, in pixels; usually 256\n            tileWidth: 256,             // The width of each tile, in pixels; usually 256\n            toolbarParentObject: null,  // The toolbar parent object.\n            verticallyOriented: true,   // Determines vertical vs. horizontal orientation\n            viewportMargin: 200,        // Pretend tiles +/- 200px away from viewport are in\n            zoomLevel: 2                // The initial zoom level (used to store the current zoom level)\n        }, options);\n\n        // Returns the page index associated with the given filename; must called after setting settings.manifest\n        var getPageIndex = function (filename)\n        {\n            return getPageIndexForManifest(settings.manifest, filename);\n        };\n\n        var getPageIndexForManifest = function (manifest, filename)\n        {\n            var i,\n                np = manifest.pages.length;\n\n            for (i = 0; i < np; i++)\n            {\n                if (!manifest.pages[i])\n                {\n                    return -1;\n                }\n\n                if (manifest.pages[i].f === filename)\n                {\n                    return i;\n                }\n            }\n\n            return -1;\n        };\n\n        // Check if a page index is valid\n        var isPageValid = function (pageIndex)\n        {\n            return settings.manifest.isPageValid(pageIndex, settings.showNonPagedPages);\n        };\n\n        var reloadViewer = function (newOptions)\n        {\n            return divaState.viewerCore.reload(newOptions);\n        };\n\n        // Called when the change view icon is clicked\n        var changeView = function (destinationView)\n        {\n            switch (destinationView)\n            {\n                case 'document':\n                    return reloadViewer({\n                        inGrid: false,\n                        inBookLayout: false\n                    });\n\n                case 'book':\n                    return reloadViewer({\n                        inGrid: false,\n                        inBookLayout: true\n                    });\n\n                case 'grid':\n                    return reloadViewer({\n                        inGrid: true\n                    });\n\n                default:\n                    return false;\n            }\n        };\n\n        //toggles between orientations\n        var toggleOrientation = function ()\n        {\n            var verticallyOriented = !settings.verticallyOriented;\n\n            //if in grid, switch out of grid\n            reloadViewer({\n                inGrid: false,\n                verticallyOriented: verticallyOriented,\n                goDirectlyTo: settings.currentPageIndex,\n                verticalOffset: divaState.viewerCore.getYOffset(),\n                horizontalOffset: divaState.viewerCore.getXOffset()\n            });\n\n            return verticallyOriented;\n        };\n\n        // Called when the fullscreen icon is clicked\n        var toggleFullscreen = function ()\n        {\n            reloadViewer({\n                inFullscreen: !settings.inFullscreen\n            });\n        };\n\n        var getState = function ()\n        {\n            var view;\n\n            if (settings.inGrid)\n            {\n                view = 'g';\n            }\n            else if (settings.inBookLayout)\n            {\n                view = 'b';\n            }\n            else\n            {\n                view = 'd';\n            }\n\n            var layout = divaState.viewerCore.getCurrentLayout();\n            var pageOffset = layout.getPageToViewportCenterOffset(settings.currentPageIndex, viewerState.viewport);\n\n            var state = {\n                'f': settings.inFullscreen,\n                'v': view,\n                'z': settings.zoomLevel,\n                'n': settings.pagesPerRow,\n                'i': settings.enableFilename ? settings.manifest.pages[settings.currentPageIndex].f : false,\n                'p': settings.enableFilename ? false : settings.currentPageIndex + 1,\n                'y': pageOffset ? pageOffset.y : false,\n                'x': pageOffset ? pageOffset.x : false\n            };\n\n            return state;\n        };\n\n        var getLoadOptionsForState = function (state, manifest)\n        {\n            manifest = manifest || settings.manifest;\n\n            var options = ('v' in state) ? getViewState(state.v) : {};\n\n            if ('f' in state)\n                options.inFullscreen = state.f;\n\n            if ('z' in state)\n                options.zoomLevel = state.z;\n\n            if ('n' in state)\n                options.pagesPerRow = state.n;\n\n            // Only change specify the page if state.i or state.p is valid\n            var pageIndex = getPageIndexForManifest(manifest, state.i);\n\n            if (!(pageIndex >= 0 && pageIndex < manifest.pages.length))\n            {\n                pageIndex = state.p - 1;\n\n                // Possibly NaN\n                if (!(pageIndex >= 0 && pageIndex < manifest.pages.length))\n                    pageIndex = null;\n            }\n\n            if (pageIndex !== null)\n            {\n                var horizontalOffset = parseInt(state.x, 10);\n                var verticalOffset = parseInt(state.y, 10);\n\n                options.goDirectlyTo = pageIndex;\n                options.horizontalOffset = horizontalOffset;\n                options.verticalOffset = verticalOffset;\n            }\n\n            return options;\n        };\n\n        var getURLHash = function ()\n        {\n            var hashParams = getState();\n            var hashStringBuilder = [];\n            var param;\n\n            for (param in hashParams)\n            {\n                if (hashParams[param] !== false)\n                    hashStringBuilder.push(param + settings.hashParamSuffix + '=' + encodeURIComponent(hashParams[param]));\n            }\n\n            return hashStringBuilder.join('&');\n        };\n\n        // Returns the URL to the current state of the document viewer (so it should be an exact replica)\n        var getCurrentURL = function ()\n        {\n            return location.protocol + '//' + location.host + location.pathname + location.search + '#' + getURLHash();\n        };\n\n        var getViewState = function(view)\n        {\n            switch (view)\n            {\n                case 'd':\n                    return {\n                        inGrid: false,\n                        inBookLayout: false\n                    };\n\n                case 'b':\n                    return {\n                        inGrid: false,\n                        inBookLayout: true\n                    };\n\n                case 'g':\n                    return {\n                        inGrid: true,\n                        inBookLayout: false\n                    };\n\n                default:\n                    return null;\n            }\n        };\n\n        var showError = function(message)\n        {\n            divaState.viewerCore.showError(message);\n        };\n\n        var ajaxError = function(jqxhr, status, error)\n        {\n            // Show a basic error message within the document viewer pane\n\n            var errorMessage = ['Invalid objectData setting. Error code: ' + jqxhr.status + ' ' + error];\n\n            // Detect and handle CORS errors\n            var dataHasAbsolutePath = settings.objectData.lastIndexOf('http', 0) === 0;\n\n            if (dataHasAbsolutePath && error === '')\n            {\n                var jsonHost = settings.objectData.replace(/https?:\\/\\//i, \"\").split(/[/?#]/)[0];\n\n                if (location.hostname !== jsonHost)\n                {\n                    errorMessage.push(\n                        elt('p', 'Attempted to access cross-origin data without CORS.'),\n                        elt('p',\n                            'You may need to update your server configuration to support CORS. For help, see the ',\n                            elt('a', {\n                                href: 'https://github.com/DDMAL/diva.js/wiki/Installation#a-note-about-cross-site-requests',\n                                target: '_blank'\n                            }, 'cross-site request documentation.')\n                        )\n                    );\n                }\n            }\n\n            showError(errorMessage);\n        };\n\n        var loadObjectData = function (responseData, hashState)\n        {\n            var isIIIF, manifest;\n\n            // parse IIIF manifest if it is an IIIF manifest. TODO improve IIIF detection method\n            if (responseData.hasOwnProperty('@context') && (responseData['@context'].indexOf('iiif') !== -1 ||\n                responseData['@context'].indexOf('shared-canvas') !== -1))\n            {\n                isIIIF = true;\n\n                // trigger ManifestDidLoad event\n                // FIXME: Why is this triggered before the manifest is parsed? See https://github.com/DDMAL/diva.js/issues/357\n                diva.Events.publish('ManifestDidLoad', [responseData], self);\n\n                manifest = ImageManifest.fromIIIF(responseData);\n            }\n            else\n            {\n                // IIP support is now deprecated\n                console.warn(\"Usage of IIP manifests is deprecated. Consider switching to IIIF manifests. Visit http://iiif.io/ for more information.\");\n\n                isIIIF = false;\n                manifest = ImageManifest.fromLegacyManifest(responseData, {\n                    iipServerURL: settings.iipServerURL,\n                    imageDir: settings.imageDir\n                });\n            }\n\n            var loadOptions = hashState ? getLoadOptionsForState(hashState, manifest) : {};\n\n            divaState.viewerCore.setManifest(manifest, isIIIF, loadOptions);\n        };\n\n        /** Parse the hash parameters into the format used by getState and setState */\n        var getHashParamState = function ()\n        {\n            var state = {};\n\n            ['f', 'v', 'z', 'n', 'i', 'p', 'y', 'x'].forEach(function (param)\n            {\n                var value = HashParams.get(param + settings.hashParamSuffix);\n\n                // `false` is returned if the value is missing\n                if (value !== false)\n                    state[param] = value;\n            });\n\n            // Do some awkward special-casing, since this format is kind of weird.\n\n            // For inFullscreen (f), true and false strings should be interpreted\n            // as booleans.\n            if (state.f === 'true')\n                state.f = true;\n            else if (state.f === 'false')\n                state.f = false;\n\n            // Convert numerical values to integers, if provided\n            ['z', 'n', 'p', 'x', 'y'].forEach(function (param)\n            {\n                if (param in state)\n                    state[param] = parseInt(state[param], 10);\n            });\n\n            return state;\n        };\n\n        var checkLoaded = function()\n        {\n            if (!viewerState.loaded)\n            {\n                console.warn(\"The viewer is not completely initialized. This is likely because it is still downloading data. To fix this, only call this function if the isReady() method returns true.\");\n                return false;\n            }\n            return true;\n        };\n\n        var init = function ()\n        {\n            // In order to fill the height, use a wrapper div displayed using a flexbox layout\n            var wrapperElement = elt('div', {\n                class: \"diva-wrapper\" + (options.fillParentHeight ? \" diva-wrapper-flexbox\" : \"\")\n            });\n            element.appendChild(wrapperElement);\n            options.toolbarParentObject = options.toolbarParentObject || $(wrapperElement);\n\n            var viewerCore = new ViewerCore(wrapperElement, options, self);\n\n            viewerState = viewerCore.getInternalState();\n            settings = viewerCore.getSettings();\n\n            // Add the ID to the wrapper element now that the ID has been generated by the viewer core\n            wrapperElement.id = settings.ID + 'wrapper';\n\n            divaState = {\n                viewerCore: viewerCore,\n                toolbar: settings.enableToolbar ? createToolbar(self) : null\n            };\n\n            var hashState = getHashParamState();\n\n            if (typeof settings.objectData === 'object')\n            {\n                // Defer execution until initialization has completed\n                setTimeout(function ()\n                {\n                    loadObjectData(settings.objectData, hashState);\n                }, 0);\n            }\n            else\n            {\n                var pendingManifestRequest = $.ajax({\n                    url: settings.objectData,\n                    cache: true,\n                    dataType: 'json',\n                    error: ajaxError,\n                    success: function (responseData)\n                    {\n                        loadObjectData(responseData, hashState);\n                    }\n                });\n\n                // Store the pending request so that it can be cancelled in the event that Diva needs to be destroyed\n                viewerCore.setPendingManifestRequest(pendingManifestRequest);\n            }\n        };\n\n        /* PUBLIC FUNCTIONS\n        ===============================================\n        */\n\n        // Returns the title of the document, based on the directory name\n        this.getItemTitle = function ()\n        {\n            return settings.manifest.itemTitle;\n        };\n\n        // Go to a particular page by its page number (with indexing starting at 1)\n            //xAnchor may either be \"left\", \"right\", or default \"center\"; the (xAnchor) side of the page will be anchored to the (xAnchor) side of the diva-outer element\n            //yAnchor may either be \"top\", \"bottom\", or default \"center\"; same process as xAnchor.\n        // returns True if the page number passed is valid; false if it is not.\n        this.gotoPageByNumber = function (pageNumber, xAnchor, yAnchor)\n        {\n            console.warn(\"This method is deprecated. Consider using gotoPageByIndex(pageIndex, xAnchor, yAnchor) instead.\");\n            var pageIndex = parseInt(pageNumber, 10) - 1;\n            return this.gotoPageByIndex(pageIndex, xAnchor, yAnchor);\n        };\n\n        // Go to a particular page (with indexing starting at 0)\n            //xAnchor may either be \"left\", \"right\", or default \"center\"; the (xAnchor) side of the page will be anchored to the (xAnchor) side of the diva-outer element\n            //yAnchor may either be \"top\", \"bottom\", or default \"center\"; same process as xAnchor.\n        // returns True if the page index is valid; false if it is not.\n        this.gotoPageByIndex = function (pageIndex, xAnchor, yAnchor)\n        {\n            pageIndex = parseInt(pageIndex, 10);\n            if (isPageValid(pageIndex))\n            {\n                var xOffset = divaState.viewerCore.getXOffset(pageIndex, xAnchor);\n                var yOffset = divaState.viewerCore.getYOffset(pageIndex, yAnchor);\n\n                viewerState.renderer.goto(pageIndex, yOffset, xOffset);\n                return true;\n            }\n            return false;\n        };\n\n        this.getNumberOfPages = function ()\n        {\n            if (!checkLoaded())\n                return false;\n\n            return settings.numPages;\n        };\n\n        // Get page dimensions in the current view and zoom level\n        this.getPageDimensions = function (pageIndex)\n        {\n            if (!checkLoaded())\n                return null;\n\n            return divaState.viewerCore.getCurrentLayout().getPageDimensions(pageIndex);\n        };\n\n        // Returns the dimensions of a given page index at a given zoom level\n        this.getPageDimensionsAtZoomLevel = function (pageIdx, zoomLevel)\n        {\n            if (!checkLoaded())\n                return false;\n\n            if (zoomLevel > settings.maxZoomLevel)\n                zoomLevel = settings.maxZoomLevel;\n\n            var pg = settings.manifest.pages[parseInt(pageIdx, 10)];\n            var pgAtZoom = pg.d[parseInt(zoomLevel, 10)];\n            return {'width': pgAtZoom.w, 'height': pgAtZoom.h};\n        };\n\n        // Returns the dimensions of a given page at the current zoom level\n        // The current page index will be used if no pageIndex is specified\n        // Also works in Grid view\n        this.getPageDimensionsAtCurrentZoomLevel = function(pageIndex)\n        {\n            pageIndex = isPageValid(pageIndex) ? pageIndex : settings.currentPageIndex;\n\n            if (!isPageValid(pageIndex))\n                throw new Error('Invalid Page Index');\n\n            return divaState.viewerCore.getCurrentLayout().getPageDimensions(pageIndex);\n        };\n\n        // Returns the dimensions of the current page at the current zoom level\n        // Also works in Grid view\n        this.getCurrentPageDimensionsAtCurrentZoomLevel = function ()\n        {\n            return this.getPageDimensionsAtCurrentZoomLevel(settings.currentPageIndex);\n        };\n\n        this.isReady = function ()\n        {\n            return viewerState.loaded;\n        };\n\n        this.getCurrentPageIndex = function ()\n        {\n            return settings.currentPageIndex;\n        };\n\n        this.getCurrentPageFilename = function ()\n        {\n            return settings.manifest.pages[settings.currentPageIndex].f;\n        };\n\n        this.getCurrentPageNumber = function ()\n        {\n            console.warn(\"This method is deprecated. Consider using getCurrentPageIndex() instead.\");\n            return settings.currentPageIndex + 1;\n        };\n\n        // Returns an array of all filenames in the document\n        this.getFilenames = function ()\n        {\n            var filenames = [];\n\n            for (var i = 0; i < settings.numPages; i++)\n            {\n                filenames[i] = settings.manifest.pages[i].f;\n            }\n\n            return filenames;\n        };\n\n        // Returns the current zoom level\n        this.getZoomLevel = function ()\n        {\n            return settings.zoomLevel;\n        };\n\n        // gets the maximum zoom level for the entire document\n        this.getMaxZoomLevel = function ()\n        {\n            return settings.maxZoomLevel;\n        };\n\n        // gets the max zoom level for a given page\n        this.getMaxZoomLevelForPage = function (pageIdx)\n        {\n            if (!checkLoaded)\n                return false;\n\n            return settings.manifest.pages[pageIdx].m;\n        };\n\n        this.getMinZoomLevel = function ()\n        {\n            return settings.minZoomLevel;\n        };\n\n        // Use the provided zoom level (will check for validity first)\n        // Returns false if the zoom level is invalid, true otherwise\n        this.setZoomLevel = function (zoomLevel)\n        {\n            if (settings.inGrid)\n            {\n                reloadViewer({\n                    inGrid: false\n                });\n            }\n\n            return divaState.viewerCore.zoom(zoomLevel);\n        };\n\n        this.getGridPagesPerRow = function ()\n        {\n            // TODO(wabain): Add test case\n            return this.pagesPerRow;\n        };\n\n        this.setGridPagesPerRow = function (newValue)\n        {\n            // TODO(wabain): Add test case\n            if (!divaState.viewerCore.isValidOption('pagesPerRow', newValue))\n                return false;\n\n            return reloadViewer({\n                inGrid: true,\n                pagesPerRow: newValue\n            });\n        };\n\n        // Zoom in. Will return false if it's at the maximum zoom\n        this.zoomIn = function ()\n        {\n            return this.setZoomLevel(settings.zoomLevel + 1);\n        };\n\n        // Zoom out. Will return false if it's at the minimum zoom\n        this.zoomOut = function ()\n        {\n            return this.setZoomLevel(settings.zoomLevel - 1);\n        };\n\n        // Check if something (e.g. a highlight box on a particular page) is visible\n        this.isRegionInViewport = function (pageIndex, leftOffset, topOffset, width, height)\n        {\n            var layout = divaState.viewerCore.getCurrentLayout();\n\n            if (!layout)\n                return false;\n\n            var offset = layout.getPageOffset(pageIndex);\n\n            var top = offset.top + topOffset;\n            var left = offset.left + leftOffset;\n\n            return viewerState.viewport.intersectsRegion({\n                top: top,\n                bottom: top + height,\n                left: left,\n                right: left + width\n            });\n        };\n\n        //Public wrapper for isPageVisible\n        //Determines if a page is currently in the viewport\n        this.isPageInViewport = function (pageIndex)\n        {\n            return viewerState.renderer.isPageVisible(pageIndex);\n        };\n\n        //Public wrapper for isPageLoaded\n        //Determines if a page is currently in the DOM\n        this.isPageLoaded = function (pageIndex)\n        {\n            console.warn(\"This method is deprecated. Consider using isPageInViewport(pageIndex) instead.\");\n            return this.isPageInViewport(pageIndex);\n        };\n\n        // Toggle fullscreen mode\n        this.toggleFullscreenMode = function ()\n        {\n            toggleFullscreen();\n        };\n\n        // Show/Hide non-paged pages\n        this.toggleNonPagedPagesVisibility = function ()\n        {\n            reloadViewer({ showNonPagedPages: !settings.showNonPagedPages });\n        };\n\n        // Show non-paged pages\n        this.showNonPagedPages = function ()\n        {\n            reloadViewer({ showNonPagedPages: true });\n        };\n\n        // Hide non-paged pages\n        this.hideNonPagedPages = function ()\n        {\n            reloadViewer({ showNonPagedPages: false });\n        };\n\n        // Close toolbar popups\n        this.closePopups = function ()\n        {\n            divaState.toolbar.closePopups();\n        };\n\n        // Enter fullscreen mode if currently not in fullscreen mode\n        // Returns false if in fullscreen mode initially, true otherwise\n        // This function will work even if enableFullscreen is set to false\n        this.enterFullscreenMode = function ()\n        {\n            if (!settings.inFullscreen)\n            {\n                toggleFullscreen();\n                return true;\n            }\n\n            return false;\n        };\n\n        // Leave fullscreen mode if currently in fullscreen mode\n        // Returns true if in fullscreen mode intitially, false otherwise\n        this.leaveFullscreenMode = function ()\n        {\n            if (settings.inFullscreen)\n            {\n                toggleFullscreen();\n                return true;\n            }\n\n            return false;\n        };\n\n        this.isInFullscreen = function ()\n        {\n            return settings.inFullscreen;\n        };\n\n        // Change views. Takes 'document', 'book', or 'grid' to specify which view to switch into\n        this.changeView = function(destinationView)\n        {\n            return changeView(destinationView);\n        };\n\n        // Enter grid view if currently not in grid view\n        // Returns false if in grid view initially, true otherwise\n        this.enterGridView = function ()\n        {\n            if (!settings.inGrid)\n            {\n                changeView('grid');\n                return true;\n            }\n\n            return false;\n        };\n\n        // Leave grid view if currently in grid view\n        // Returns true if in grid view initially, false otherwise\n        this.leaveGridView = function ()\n        {\n            if (settings.inGrid)\n            {\n                reloadViewer({ inGrid: false });\n                return true;\n            }\n\n            return false;\n        };\n\n        // Jump to a page based on its filename\n        // Returns true if successful and false if the filename is invalid\n        this.gotoPageByName = function (filename, xAnchor, yAnchor)\n        {\n            var pageIndex = getPageIndex(filename);\n            return this.gotoPageByIndex(pageIndex, xAnchor, yAnchor);\n        };\n\n        this.gotoPageByLabel = function (label, xAnchor, yAnchor)\n        {\n            var pages = settings.manifest.pages;\n            for (var i = 0, len = pages.length; i < len; i++)\n            {\n                if (pages[i].l.toLowerCase().indexOf(label.toLowerCase()) > -1)\n                    return this.gotoPageByIndex(i, xAnchor, yAnchor);\n            }\n\n            // If no label was found, try to parse a page number\n            var pageIndex = parseInt(label, 10) - 1;\n            return this.gotoPageByIndex(pageIndex, xAnchor, yAnchor);\n        };\n\n        // Get the page index (0-based) corresponding to a given filename\n        // If the page index doesn't exist, this will return -1\n        this.getPageIndex = function (filename)\n        {\n            return getPageIndex(filename);\n        };\n\n        // Get the current URL (exposes the private method)\n        this.getCurrentURL = function ()\n        {\n            return getCurrentURL();\n        };\n\n        // Check if a page index is within the range of the document\n        this.isPageIndexValid = function (pageIndex)\n        {\n            return isPageValid(pageIndex);\n        };\n\n        // Get the hash part only of the current URL (without the leading #)\n        this.getURLHash = function ()\n        {\n            return getURLHash();\n        };\n\n        // Get an object representing the state of this diva instance (for setState)\n        this.getState = function ()\n        {\n            return getState();\n        };\n\n        // Align this diva instance with a state object (as returned by getState)\n        this.setState = function (state)\n        {\n            reloadViewer(getLoadOptionsForState(state));\n        };\n\n        // Get the instance selector for this instance, since it's auto-generated.\n        this.getInstanceSelector = function ()\n        {\n            return settings.selector;\n        };\n\n        // Get the instance ID -- essentially the selector without the leading '#'.\n        this.getInstanceId = function ()\n        {\n            return settings.ID;\n        };\n\n        this.getSettings = function ()\n        {\n            return settings;\n        };\n\n        /*\n            Translates a measurement from the zoom level on the largest size\n            to one on the current zoom level.\n\n            For example, a point 1000 on an image that is on zoom level 2 of 5\n            translates to a position of 111.111... (1000 / (5 - 2)^2).\n\n            Works for a single pixel co-ordinate or a dimension (e.g., translates a box\n            that is 1000 pixels wide on the original to one that is 111.111 pixels wide\n            on the current zoom level).\n        */\n        this.translateFromMaxZoomLevel = function (position)\n        {\n            var zoomDifference = settings.maxZoomLevel - settings.zoomLevel;\n            return position / Math.pow(2, zoomDifference);\n        };\n\n        /*\n            Translates a measurement from the current zoom level to the position on the\n            largest zoom level.\n\n            Works for a single pixel co-ordinate or a dimension (e.g., translates a box\n            that is 111.111 pixels wide on the current image to one that is 1000 pixels wide\n            on the current zoom level).\n        */\n        this.translateToMaxZoomLevel = function (position)\n        {\n            var zoomDifference = settings.maxZoomLevel - settings.zoomLevel;\n\n            // if there is no difference, it's a box on the max zoom level and\n            // we can just return the position.\n            if (zoomDifference === 0)\n                return position;\n\n            return position * Math.pow(2, zoomDifference);\n        };\n\n        // Re-enables document dragging, scrolling (by keyboard if set), and zooming by double-clicking\n        this.enableScrollable = function()\n        {\n            divaState.viewerCore.enableScrollable();\n        };\n\n        // Disables document dragging, scrolling (by keyboard if set), and zooming by double-clicking\n        this.disableScrollable = function ()\n        {\n            divaState.viewerCore.disableScrollable();\n        };\n\n        //Changes between horizontal layout and vertical layout. Returns true if document is now vertically oriented, false otherwise.\n        this.toggleOrientation = function ()\n        {\n            return toggleOrientation();\n        };\n\n        //Returns distance between the northwest corners of diva-inner and page index\n        this.getPageOffset = function(pageIndex, options)\n        {\n            var region = divaState.viewerCore.getPageRegion(pageIndex, options);\n\n            return {\n                top: region.top,\n                left: region.left\n            };\n        };\n\n        //shortcut to getPageOffset for current page\n        this.getCurrentPageOffset = function()\n        {\n            return this.getPageOffset(settings.currentPageIndex);\n        };\n\n        //Returns the page dimensions of given page at the current zoom level\n        this.getPageDimensionsAtCurrentGridLevel = function(pageIndex)\n        {\n            console.warn(\"This method is deprecated. Consider using getPageDimensionsAtCurrentZoomLevel(pageIndex) instead.\");\n            return this.getPageDimensionsAtCurrentZoomLevel(pageIndex);\n        };\n\n        /*\n            Given a pageX and pageY value (as could be retreived from a jQuery event object),\n                returns either the page visible at that (x,y) position or -1 if no page is.\n        */\n        this.getPageIndexForPageXYValues = function(pageX, pageY)\n        {\n            //get the four edges of the outer element\n            var outerOffset = viewerState.outerElement.getBoundingClientRect();\n            var outerTop = outerOffset.top;\n            var outerLeft = outerOffset.left;\n            var outerBottom = outerOffset.bottom;\n            var outerRight = outerOffset.right;\n\n            //if the clicked position was outside the diva-outer object, it was not on a visible portion of a page\n            if (pageX < outerLeft || pageX > outerRight)\n                return -1;\n\n            if (pageY < outerTop || pageY > outerBottom)\n                return -1;\n\n            //navigate through all diva page objects\n            var pages = document.getElementsByClassName('diva-page');\n            var curPageIdx = pages.length;\n            while (curPageIdx--)\n            {\n                //get the offset for each page\n                var curPage = pages[curPageIdx];\n                var curOffset = curPage.getBoundingClientRect();\n\n                //if this point is outside the horizontal boundaries of the page, continue\n                if (pageX < curOffset.left || pageX > curOffset.right)\n                    continue;\n\n                //same with vertical boundaries\n                if (pageY < curOffset.top || pageY > curOffset.bottom)\n                    continue;\n\n                //if we made it through the above two, we found the page we're looking for\n                return curPage.getAttribute('data-index');\n            }\n\n            //if we made it through that entire while loop, we didn't click on a page\n            return -1;\n        };\n\n        /**\n         * Returns a URL for the image of the page at the given index. The\n         * optional size parameter supports setting the image width or height\n         * (default is full-sized).\n         */\n        this.getPageImageURL = function (pageIndex, size)\n        {\n            return settings.manifest.getPageImageURL(pageIndex, size);\n        };\n\n        //Pretty self-explanatory.\n        this.isVerticallyOriented = function()\n        {\n            return settings.verticallyOriented;\n        };\n\n        this.changeObject = function(objectData)\n        {\n            viewerState.loaded = false;\n            divaState.viewerCore.clear();\n\n            if (viewerState.renderer)\n                viewerState.renderer.destroy();\n\n            viewerState.options.objectData = objectData;\n\n            if (typeof objectData === 'object')\n            {\n                setTimeout(function ()\n                {\n                    loadObjectData(objectData);\n                });\n\n                return;\n            }\n\n            viewerState.throbberTimeoutID = setTimeout(function ()\n            {\n                $(settings.selector + 'throbber').show();\n            }, settings.throbberTimeout);\n\n            $.ajax({\n                url: settings.objectData,\n                cache: true,\n                dataType: 'json',\n                error: ajaxError,\n                success: function (responseData)\n                {\n                    loadObjectData(responseData);\n                }\n            });\n        };\n\n        this.activate = function ()\n        {\n            viewerState.isActiveDiva = true;\n        };\n\n        this.deactivate = function ()\n        {\n            viewerState.isActiveDiva = false;\n        };\n\n        // Destroys this instance, tells plugins to do the same (for testing)\n        this.destroy = function ()\n        {\n            divaState.viewerCore.destroy();\n        };\n\n        // \"Secretly\" expose the page overlay API for the highlight plugin\n        this.__addPageOverlay = function (overlay)\n        {\n            divaState.viewerCore.addPageOverlay(overlay);\n        };\n\n        this.__removePageOverlay = function (overlay)\n        {\n            divaState.viewerCore.removePageOverlay(overlay);\n        };\n\n        /**** Page Alias Functions ****/\n        /*\n         Main function. Will return the first of these three that\n         resolves to boolean true:\n         -Explicit alias as defined in pageAliases\n         -Result of pageAliasFunction\n         -originalPageIndex + 1 (to simulate the original mapping)\n\n         Else the function will return false.\n         */\n        this.getAliasForPageIndex = function(originalPageIndex)\n        {\n            var pageIndex = parseInt(originalPageIndex, 10);\n            return settings.pageAliases[pageIndex] || settings.pageAliasFunction(pageIndex) || pageIndex + 1;\n        };\n\n        /*\n         Returns the first page index found for a given aliased number or false if not found.\n         This may cause issues if a specific alias is found for multiple page indices; use getPageIndicesForAlias and reimplement functions as necessary if this is the case.\n         */\n        this.getPageIndexForAlias = function(aliasedNumber)\n        {\n            for(var idx = 0; idx < settings.numPages; idx++)\n            {\n                if(this.getAliasForPageIndex(idx) === aliasedNumber)\n                {\n                    return idx;\n                }\n            }\n            return false;\n        };\n\n        //Returns array of page indices for a given aliased number. Returns an empty array if none are found.\n        this.getPageIndicesForAlias = function(aliasedNumber)\n        {\n            var indexArr = [];\n            for(var idx = 0; idx < settings.numPages; idx++)\n            {\n                if(this.getAliasForPageIndex(idx) === aliasedNumber)\n                {\n                    indexArr.push(idx);\n                }\n            }\n            return indexArr;\n        };\n\n\n        //Maps the current page index to getAliasForPageIndex\n        this.getCurrentAliasedPageIndex = function()\n        {\n            return this.getAliasForPageIndex(settings.currentPageIndex);\n        };\n\n        //Wrapper for gotoPageByIndex, keeping the aliased numbers in mind\n        this.gotoPageByAliasedNumber = function(aliasedNumber, xAnchor, yAnchor)\n        {\n            return this.gotoPageByIndex(this.getPageIndexForAlias(aliasedNumber), xAnchor, yAnchor);\n        };\n\n        // Call the init function when this object is created.\n        init();\n    };\n\n    $.fn.diva = function (options)\n    {\n        return this.each(function ()\n        {\n            var divaParent = $(this);\n\n            // Return early if this element already has a plugin instance\n            if (divaParent.data('diva'))\n                return;\n\n            // Throw an error if the element is not in the DOM, since it causes some problems\n            if (!document.body.contains(this))\n                throw new Error('Diva could not be initialized because this element is not attached to the DOM');\n\n            // Otherwise, instantiate the document viewer\n            var diva = new Diva(this, options);\n            divaParent.data('diva', diva);\n        });\n    };\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/diva.js\n// module id = 7\n// module chunks = 0","module.exports = elt;\nmodule.exports.setAttributes = setDOMAttributes;\n\n/**\n * Convenience function to create a DOM element, set attributes on it, and\n * append children. All arguments which are not of primitive type, are not\n * arrays, and are not DOM nodes are treated as attribute hashes and are\n * handled as described for setDOMAttributes. Children can either be a DOM\n * node or a primitive value, which is converted to a text node. Arrays are\n * handled recursively. Null and undefined values are ignored.\n *\n * Inspired by the ProseMirror helper of the same name.\n */\nfunction elt(tag)\n{\n    var el = document.createElement(tag);\n    var args = Array.prototype.slice.call(arguments, 1);\n\n    while (args.length)\n    {\n        var arg = args.shift();\n        handleEltConstructorArg(el, arg);\n    }\n\n    return el;\n}\n\nfunction handleEltConstructorArg(el, arg)\n{\n    if (arg == null)\n        return;\n\n    if (typeof arg !== 'object' && typeof arg !== 'function')\n    {\n        // Coerce to string\n        el.appendChild(document.createTextNode(arg));\n    }\n    else if (arg instanceof window.Node)\n    {\n        el.appendChild(arg);\n    }\n    else if (arg instanceof Array)\n    {\n        var childCount = arg.length;\n        for (var i = 0; i < childCount; i++)\n            handleEltConstructorArg(el, arg[i]);\n    }\n    else\n    {\n        setDOMAttributes(el, arg);\n    }\n}\n\n/**\n * Set attributes of a DOM element. The `style` property is special-cased to\n * accept either a string or an object whose own attributes are assigned to\n * el.style.\n */\nfunction setDOMAttributes(el, attributes)\n{\n    for (var prop in attributes)\n    {\n        if (!attributes.hasOwnProperty(prop))\n            continue;\n\n        if (prop === 'style')\n        {\n            setStyle(el, attributes.style);\n        }\n        else\n        {\n            el.setAttribute(prop, attributes[prop]);\n        }\n    }\n}\n\nfunction setStyle(el, style)\n{\n    if (!style)\n        return;\n\n    if (typeof style !== 'object')\n    {\n        el.style.cssText = style;\n        return;\n    }\n\n    for (var cssProp in style)\n    {\n        if (!style.hasOwnProperty(cssProp))\n            continue;\n\n        el.style[cssProp] = style[cssProp];\n    }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/utils/elt.js\n// module id = 8\n// module chunks = 0","module.exports.get = getHashParam;\nmodule.exports.update = updateHashParam;\n\n// For getting the #key values from the URL. For specifying a page and zoom level\n// Look into caching, because we only need to get this during the initial load\n// Although for the tests I guess we would need to override caching somehow\nfunction getHashParam(key) {\n    var hash = window.location.hash;\n    if (hash !== '') {\n        // Check if there is something that looks like either &key= or #key=\n        var startIndex = (hash.indexOf('&' + key + '=') > 0) ? hash.indexOf('&' + key + '=') : hash.indexOf('#' + key + '=');\n\n        // If startIndex is still -1, it means it can't find either\n        if (startIndex >= 0) {\n            // Add the length of the key plus the & and =\n            startIndex += key.length + 2;\n\n            // Either to the next ampersand or to the end of the string\n            var endIndex = hash.indexOf('&', startIndex);\n            if (endIndex > startIndex) {\n                return decodeURIComponent(hash.substring(startIndex, endIndex));\n            } else if (endIndex < 0) {\n                // This means this hash param is the last one\n                return decodeURIComponent(hash.substring(startIndex));\n            }\n            // If the key doesn't have a value I think\n            return '';\n        } else {\n            // If it can't find the key\n            return false;\n        }\n    } else {\n        // If there are no hash params just return false\n        return false;\n    }\n}\n\nfunction updateHashParam(key, value) {\n    // First make sure that we have to do any work at all\n    var originalValue = getHashParam(key);\n    var hash = window.location.hash;\n    if (originalValue !== value) {\n        // Is the key already in the URL?\n        if (typeof originalValue == 'string') {\n            // Already in the URL. Just get rid of the original value\n            var startIndex = (hash.indexOf('&' + key + '=') > 0) ? hash.indexOf('&' + key + '=') : hash.indexOf('#' + key + '=');\n            var endIndex = startIndex + key.length + 2 + originalValue.length;\n            // # if it's the first, & otherwise\n            var startThing = (startIndex === 0) ? '#' : '&';\n            window.location.replace(hash.substring(0, startIndex) + startThing + key + '=' + value + hash.substring(endIndex));\n        } else {\n            // It's not present - add it\n            if (hash.length === 0) {\n                window.location.replace('#' + key + '=' + value);\n            } else {\n                // Append it\n                window.location.replace(hash + '&' + key + '=' + value);\n            }\n        }\n    }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/utils/hash-params.js\n// module id = 9\n// module chunks = 0","var jQuery = require('jquery');\n\n//Used to keep track of whether Diva was last clicked or which Diva was last clicked when there are multiple\nvar ActiveDivaController = (function ($)\n{\n    return function ()\n    {\n        var active;\n\n        //global click listener\n        $(document).on('click', function(e)\n        {\n            updateActive($(e.target));\n        });\n\n        //parameter should already be a jQuery selector\n        var updateActive = function (target)\n        {\n            var nearestOuter;\n\n            //these will find 0 or 1 objects, never more\n            var findOuter = target.find('.diva-outer');\n            var closestOuter = target.closest('.diva-outer');\n            var outers = document.getElementsByClassName('diva-outer');\n            var outerLen = outers.length;\n            var idx;\n\n            //clicked on something that was not either a parent or sibling of a diva-outer\n            if (findOuter.length > 0)\n            {\n                nearestOuter = findOuter;\n            }\n            //clicked on something that was a child of a diva-outer\n            else if (closestOuter.length > 0)\n            {\n                nearestOuter = closestOuter;\n            }\n            //clicked on something that was not in any Diva tree\n            else\n            {\n                //deactivate everything and return\n                for (idx = 0; idx < outerLen; idx++)\n                {\n                    $(outers[idx].parentElement.parentElement).data('diva').deactivate();\n                }\n                return;\n            }\n\n            //if we found one, activate it...\n            nearestOuter.parent().parent().data('diva').activate();\n            active = nearestOuter.parent();\n\n            //...and deactivate all the others\n            outers = document.getElementsByClassName('diva-outer');\n            for(idx = 0; idx < outerLen; idx++)\n            {\n                //getAttribute to attr - comparing DOM element to jQuery element\n                if (outers[idx].getAttribute('id') != nearestOuter.attr('id'))\n                    $(outers[idx].parentElement.parentElement).data('diva').deactivate();\n            }\n        };\n\n        //public accessor in case. Will return a jQuery selector.\n        this.getActive = function()\n        {\n            return active;\n        };\n    };\n})(jQuery);\n\nmodule.exports = ActiveDivaController;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/active-diva-controller.js\n// module id = 10\n// module chunks = 0","/* jshint unused: true */\n\nvar parseIIIFManifest = require('./parse-iiif-manifest');\n\nmodule.exports = ImageManifest;\n\nfunction ImageManifest(data, urlAdapter)\n{\n    // Save all the data we need\n    this.pages = data.pgs;\n    this.maxZoom = data.max_zoom;\n    this.maxRatio = data.dims.max_ratio;\n    this.minRatio = data.dims.min_ratio;\n    this.itemTitle = data.item_title;\n\n    // Only given for IIIF manifests\n    this.paged = !!data.paged;\n\n    // These are arrays, the index corresponding to the zoom level\n    this._maxWidths = data.dims.max_w;\n    this._maxHeights = data.dims.max_h;\n    this._averageWidths = data.dims.a_wid;\n    this._averageHeights = data.dims.a_hei;\n    this._totalHeights = data.dims.t_hei;\n    this._totalWidths = data.dims.t_wid;\n\n    this._urlAdapter = urlAdapter;\n}\n\nImageManifest.fromIIIF = function (iiifManifest)\n{\n    var data = parseIIIFManifest(iiifManifest);\n    return new ImageManifest(data, new IIIFSourceAdapter());\n};\n\nImageManifest.fromLegacyManifest = function (data, config)\n{\n    // For IIP manifests, use the page number (indexed starting from 1) as a label for each page\n    for (var i = 0, len = data.pgs.length; i < len; i++)\n        data.pgs[i].l = (i + 1).toString();\n\n    return new ImageManifest(data, new LegacyManifestSourceAdapter(config));\n};\n\nImageManifest.prototype.isPageValid = function (pageIndex, showNonPagedPages)\n{\n    if (!showNonPagedPages && this.paged && !this.pages[pageIndex].paged)\n        return false;\n\n    return pageIndex >= 0 && pageIndex < this.pages.length;\n};\n\nImageManifest.prototype.getMaxPageDimensions = function (pageIndex)\n{\n    var maxDims = this.pages[pageIndex].d[this.maxZoom];\n\n    return {\n        height: maxDims.h,\n        width: maxDims.w\n    };\n};\n\nImageManifest.prototype.getPageDimensionsAtZoomLevel = function (pageIndex, zoomLevel)\n{\n    var maxDims = this.pages[pageIndex].d[this.maxZoom];\n\n    var scaleRatio = getScaleRatio(this.maxZoom, zoomLevel);\n\n    return {\n        height: maxDims.h * scaleRatio,\n        width: maxDims.w * scaleRatio\n    };\n};\n\n/**\n * Returns a URL for the image of the given page. The optional size\n * parameter supports setting the image width or height (default is\n * full-sized).\n */\nImageManifest.prototype.getPageImageURL = function (pageIndex, size)\n{\n    return this._urlAdapter.getPageImageURL(this, pageIndex, size);\n};\n\n/**\n * Return an array of tile objects for the specified page and integer zoom level\n */\nImageManifest.prototype.getPageImageTiles = function (pageIndex, zoomLevel, tileDimensions)\n{\n    var page = this.pages[pageIndex];\n\n    if (!isFinite(zoomLevel) || zoomLevel % 1 !== 0)\n        throw new TypeError('Zoom level must be an integer: ' + zoomLevel);\n\n    var rows = Math.ceil(page.d[zoomLevel].h / tileDimensions.height);\n    var cols = Math.ceil(page.d[zoomLevel].w / tileDimensions.width);\n\n    var tiles = [];\n\n    var row, col, url;\n\n    for (row = 0; row < rows; row++)\n    {\n        for (col = 0; col < cols; col++)\n        {\n            url = this._urlAdapter.getTileImageURL(this, pageIndex, {\n                row: row,\n                col: col,\n                rowCount: rows,\n                colCount: cols,\n                zoomLevel: zoomLevel,\n                tileDimensions: tileDimensions\n            });\n\n            // FIXME: Dimensions should account for partial tiles (e.g. the\n            // last row and column in a tiled image)\n            tiles.push({\n                row: row,\n                col: col,\n                zoomLevel: zoomLevel,\n                dimensions: {\n                    height: tileDimensions.height,\n                    width: tileDimensions.width\n                },\n                offset: {\n                    top: row * tileDimensions.height,\n                    left: col * tileDimensions.width\n                },\n                url: url\n            });\n        }\n    }\n\n    return {\n        zoomLevel: zoomLevel,\n        rows: rows,\n        cols: cols,\n        tiles: tiles\n    };\n};\n\nImageManifest.prototype.getMaxWidth = zoomedPropertyGetter('_maxWidths');\nImageManifest.prototype.getMaxHeight = zoomedPropertyGetter('_maxHeights');\nImageManifest.prototype.getAverageWidth = zoomedPropertyGetter('_averageWidths');\nImageManifest.prototype.getAverageHeight = zoomedPropertyGetter('_averageHeights');\nImageManifest.prototype.getTotalWidth = zoomedPropertyGetter('_totalWidths');\nImageManifest.prototype.getTotalHeight = zoomedPropertyGetter('_totalHeights');\n\nfunction zoomedPropertyGetter(privateName)\n{\n    return function (zoomLevel)\n    {\n        return this[privateName][zoomLevel];\n    };\n}\n\nfunction getScaleRatio(sourceZoomLevel, targetZoomLevel)\n{\n    return 1 / Math.pow(2, sourceZoomLevel - targetZoomLevel);\n}\n\nfunction IIIFSourceAdapter()\n{\n    // No-op\n}\n\nIIIFSourceAdapter.prototype.getPageImageURL = function (manifest, pageIndex, size)\n{\n    var dimens;\n\n    if (!size || (size.width == null && size.height == null))\n        dimens = 'full';\n    else\n        dimens = (size.width == null ? '' : size.width) + ',' + (size.height == null ? '' : size.height);\n\n    var page = manifest.pages[pageIndex];\n    var quality = (page.api > 1.1) ? 'default' : 'native';\n\n    return encodeURI(page.url + 'full/' + dimens + '/0/' + quality + '.jpg');\n};\n\nIIIFSourceAdapter.prototype.getTileImageURL = function (manifest, pageIndex, params)\n{\n    var page = manifest.pages[pageIndex];\n\n    var height, width;\n\n    if (params.row === params.rowCount - 1)\n        height = page.d[params.zoomLevel].h - (params.rowCount - 1) * params.tileDimensions.height;\n    else\n        height = params.tileDimensions.height;\n\n    if (params.col === params.colCount - 1)\n        width = page.d[params.zoomLevel].w - (params.colCount - 1) * params.tileDimensions.width;\n    else\n        width = params.tileDimensions.width;\n\n    var zoomDifference = Math.pow(2, manifest.maxZoom - params.zoomLevel);\n\n    var x = params.col * params.tileDimensions.width * zoomDifference;\n    var y = params.row * params.tileDimensions.height * zoomDifference;\n\n    if (page.hasOwnProperty('xoffset'))\n    {\n        x += page.xoffset;\n        y += page.yoffset;\n    }\n\n    var region = [x, y, width * zoomDifference, height * zoomDifference].join(',');\n\n    var quality = (page.api > 1.1) ? 'default' : 'native';\n\n    return encodeURI(page.url + region + '/' + width + ',' + height + '/0/' + quality + '.jpg');\n};\n\nfunction LegacyManifestSourceAdapter(config)\n{\n    this._config = config;\n}\n\nLegacyManifestSourceAdapter.prototype.getPageImageURL = function (manifest, pageIndex, size)\n{\n    // Without width or height specified, IIPImage defaults to full-size\n    var dimens = '';\n\n    if (size)\n    {\n        if (size.width != null)\n            dimens += '&WID=' + size.width;\n\n        if (size.height != null)\n            dimens += '&HEI=' + size.height;\n    }\n\n    var filename = manifest.pages[pageIndex].f;\n\n    return this._config.iipServerURL + \"?FIF=\" + this._config.imageDir + '/' + filename + dimens + '&CVT=JPEG';\n};\n\nLegacyManifestSourceAdapter.prototype.getTileImageURL = function (manifest, pageIndex, params)\n{\n    var page = manifest.pages[pageIndex];\n    var requestedZoomLevel = params.zoomLevel + page.m - manifest.maxZoom;\n    var index = (params.row * params.colCount) + params.col;\n    var jtl = requestedZoomLevel + ',' + index;\n\n    return encodeURI(this._config.iipServerURL + \"?FIF=\" + this._config.imageDir + '/' + page.f + '&JTL=' + jtl + '&CVT=JPEG');\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/image-manifest.js\n// module id = 11\n// module chunks = 0","/* jshint unused: true */\n/* jshint -W097 */\n\"use strict\";\n\nmodule.exports = parseIIIFManifest;\n\nvar getMaxZoomLevel = function (width, height)\n{\n    var largestDimension = Math.max(width, height);\n    return Math.ceil(Math.log((largestDimension + 1) / (256 + 1)) / Math.log(2));\n};\n\nvar incorporateZoom = function (imageDimension, zoomDifference)\n{\n    return imageDimension / (Math.pow(2, zoomDifference));\n};\n\nvar getOtherImageData = function(otherImages, lowestMaxZoom, canvasWidth, canvasHeight)\n{\n    return otherImages.map(\n        function (itm)\n        {\n            var w = itm.width || canvasWidth;\n            var h = itm.height || canvasHeight;\n\n            var dims = new Array(lowestMaxZoom + 1);\n            for (var j = 0; j < lowestMaxZoom + 1; j++)\n            {\n                dims[j] = {\n                    h: Math.floor(incorporateZoom(h, lowestMaxZoom - j)),\n                    w: Math.floor(incorporateZoom(w, lowestMaxZoom - j))\n                };\n            }\n            return {\n                label: itm.label || \"\",\n                dims: dims\n            };\n        }\n    );\n};\n\n/**\n * Parses a IIIF Presentation API Manifest and converts it into a Diva.js-format object\n * (See https://github.com/DDMAL/diva.js/wiki/Development-notes#data-received-through-ajax-request)\n * (This is a client-side re-implementation of generate_json.py)\n *\n * @param {Object} manifest - an object that represents a valid IIIF manifest\n * @returns {Object} divaServiceBlock - the data needed by Diva to show a view of a single document\n */\nfunction parseIIIFManifest(manifest)\n{\n    var sequence = manifest.sequences[0];\n    var canvases = sequence.canvases;\n    var numCanvases = canvases.length;\n\n    var pages = new Array(canvases.length);\n\n    var thisCanvas, thisResource, thisImage, otherImages, context, url, info, imageAPIVersion,\n        width, height, maxZoom, canvas, label, imageLabel, zoomDimensions, widthAtCurrentZoomLevel,\n        heightAtCurrentZoomLevel;\n\n    var lowestMaxZoom = 100;\n    var maxRatio = 0;\n    var minRatio = 100;\n\n    // quickly determine the lowest possible max zoom level (i.e., the upper bound for images) across all canvases.\n    // while we're here, compute the global ratios as well.\n    for (var z = 0; z < numCanvases; z++)\n    {\n        var c = canvases[z];\n\n        // if this canvas has an empty width or height, don't factor that into our calculations.\n        if (c.width === 0 || c.height === 0)\n        {\n            continue;\n        }\n\n        var w = c.width;\n        var h = c.height;\n        var mz = getMaxZoomLevel(w, h);\n        var ratio = w / h;\n        maxRatio = Math.max(ratio, maxRatio);\n        minRatio = Math.min(ratio, minRatio);\n\n        lowestMaxZoom = Math.min(lowestMaxZoom, mz);\n    }\n\n    // Uint8Arrays are pre-initialized with zeroes.\n    var totalWidths = new Array(lowestMaxZoom + 1).fill(0);\n    var totalHeights = new Array(lowestMaxZoom + 1).fill(0);\n    var maxWidths = new Array(lowestMaxZoom + 1).fill(0);\n    var maxHeights = new Array(lowestMaxZoom + 1).fill(0);\n\n    for (var i = 0; i < numCanvases; i++)\n    {\n        thisCanvas = canvases[i];\n        canvas = thisCanvas['@id'];\n\n        if (!thisCanvas.images || thisCanvas.images.length === 0)\n        {\n            console.warn(\"An empty canvas was found: \" + canvas);\n            continue;\n        }\n\n        label = thisCanvas.label;\n        thisResource = thisCanvas.images[0].resource;\n\n        /*\n         * If a canvas has multiple images it will be encoded\n         * with a resource type of \"oa:Choice\". The primary image will be available\n         * on the 'default' key, with other images available under 'item.'\n         * */\n        if (thisResource['@type'] === \"oa:Choice\")\n        {\n            thisImage = thisResource.default;\n        }\n        else\n        {\n            thisImage = thisResource;\n        }\n\n        // Prioritize the canvas height / width first, since images may not have h/w\n        width = thisCanvas.width || thisImage.width;\n        height = thisCanvas.height || thisImage.height;\n        maxZoom = getMaxZoomLevel(width, height);\n\n        if (thisResource.item)\n        {\n            otherImages = getOtherImageData(thisResource.item, lowestMaxZoom, width, height);\n        }\n\n        imageLabel = thisImage.label || null;\n\n        info = parseImageInfo(thisImage);\n        url = info.url.slice(-1) !== '/' ? info.url + '/' : info.url;  // append trailing slash to url if it's not there.\n\n        context = thisImage.service['@context'];\n\n        if (context === 'http://iiif.io/api/image/2/context.json')\n        {\n            imageAPIVersion = 2;\n        }\n        else if (context === 'http://library.stanford.edu/iiif/image-api/1.1/context.json')\n        {\n            imageAPIVersion = 1.1;\n        }\n        else\n        {\n            imageAPIVersion = 1.0;\n        }\n\n        zoomDimensions = new Array(lowestMaxZoom + 1);\n\n        for (var k = 0; k < lowestMaxZoom + 1; k++)\n        {\n            widthAtCurrentZoomLevel = Math.floor(incorporateZoom(width, lowestMaxZoom - k));\n            heightAtCurrentZoomLevel = Math.floor(incorporateZoom(height, lowestMaxZoom - k));\n            zoomDimensions[k] = {\n                h: heightAtCurrentZoomLevel,\n                w: widthAtCurrentZoomLevel\n            };\n\n            var currentTotalWidths = totalWidths[k] + widthAtCurrentZoomLevel;\n            var currentTotalHeights = totalHeights[k] + heightAtCurrentZoomLevel;\n\n            totalWidths[k] = currentTotalWidths;\n            totalHeights[k] = currentTotalHeights;\n            maxWidths[k] = Math.max(widthAtCurrentZoomLevel, maxWidths[k]);\n            maxHeights[k] = Math.max(heightAtCurrentZoomLevel, maxHeights[k]);\n        }\n\n        pages[i] = {\n            d: zoomDimensions,\n            m: maxZoom,\n            l: label,         // canvas label ('page 1, page 2', etc.)\n            il: imageLabel,   // default image label ('primary image', 'UV light', etc.)\n            f: url,\n            url: url,\n            api: imageAPIVersion,\n            paged: thisCanvas.viewingHint !== 'non-paged',\n            facingPages: thisCanvas.viewingHint === 'facing-pages',\n            canvas: canvas,\n            otherImages: otherImages,\n            xoffset: info.x || null,\n            yoffset: info.y || null\n        };\n    }\n\n    var averageWidths = new Array(lowestMaxZoom + 1).fill(0);\n    var averageHeights = new Array(lowestMaxZoom + 1).fill(0);\n\n    for (var a = 0; a < lowestMaxZoom + 1; a++)\n    {\n        averageWidths[a] = totalWidths[a] / numCanvases;\n        averageHeights[a] = totalHeights[a] / numCanvases;\n    }\n\n    var dims = {\n        a_wid: averageWidths,\n        a_hei: averageHeights,\n        max_w: maxWidths,\n        max_h: maxHeights,\n        max_ratio: maxRatio,\n        min_ratio: minRatio,\n        t_hei: totalHeights,\n        t_wid: totalWidths\n    };\n\n    return {\n        item_title: manifest.label,\n        dims: dims,\n        max_zoom: lowestMaxZoom,\n        pgs: pages,\n        pages: manifest.viewingHint === 'paged' || sequence.viewingHint === 'paged'\n    };\n}\n\n/**\n * Takes in a resource block from a canvas and outputs the following information associated with that resource:\n * - Image URL\n * - Image region to be displayed\n *\n * @param {Object} resource - an object representing the resource block of a canvas section in a IIIF manifest\n * @returns {Object} imageInfo - an object containing image URL and region\n */\nfunction parseImageInfo(resource)\n{\n    var url = resource['@id'];\n    var fragmentRegex = /#xywh=([0-9]+,[0-9]+,[0-9]+,[0-9]+)/;\n    var xywh = '';\n    var stripURL = true;\n\n    if (/\\/([0-9]+,[0-9]+,[0-9]+,[0-9]+)\\//.test(url))\n    {\n        // if resource in image API format, extract region x,y,w,h from URL (after 4th slash from last)\n        // matches coordinates in URLs of the form http://www.example.org/iiif/book1-page1/40,50,1200,1800/full/0/default.jpg\n        var urlArray = url.split('/');\n        xywh = urlArray[urlArray.length - 4];\n    }\n    else if (fragmentRegex.test(url))\n    {\n        // matches coordinates of the style http://www.example.org/iiif/book1/canvas/p1#xywh=50,50,320,240\n        var result = fragmentRegex.exec(url);\n        xywh = result[1];\n    }\n    else if (resource.service && resource.service['@id'])\n    {\n        // assume canvas size based on image size\n        url = resource.service['@id'];\n        // this URL excludes region parameters so we don't need to remove them\n        stripURL = false;\n    }\n\n    if (stripURL)\n    {\n        // extract URL up to identifier (we eliminate the last 5 parameters: /region/size/rotation/quality.format)\n        url = url.split('/').slice(0, -4).join('/');\n    }\n\n    var imageInfo = {\n        url: url\n    };\n\n    if (xywh.length)\n    {\n        // parse into separate components\n        var dimensions = xywh.split(',');\n        imageInfo.x = parseInt(dimensions[0], 10);\n        imageInfo.y = parseInt(dimensions[1], 10);\n        imageInfo.w = parseInt(dimensions[2], 10);\n        imageInfo.h = parseInt(dimensions[3], 10);\n    }\n\n    return imageInfo;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/parse-iiif-manifest.js\n// module id = 12\n// module chunks = 0","var $ = require('jquery');\n\nvar diva = require('./diva-global');\nvar elt = require('./utils/elt');\n\nmodule.exports = createToolbar;\n\nfunction createToolbar(viewer)\n{\n    var settings = viewer.getSettings();\n\n    // FIXME(wabain): Temporarily copied from within Diva\n    var elemAttrs = function (ident, base)\n    {\n        var attrs = {\n            id: settings.ID + ident,\n            class: 'diva-' + ident\n        };\n\n        if (base)\n            return $.extend(attrs, base);\n        else\n            return attrs;\n    };\n\n    /** Convenience function to subscribe to a Diva event */\n    var subscribe = function (event, callback)\n    {\n        diva.Events.subscribe(event, callback, settings.ID);\n    };\n\n    // Creates a toolbar button\n    var createButtonElement = function(name, label, callback)\n    {\n        var button = elt('button', {\n            type: 'button',\n            id: settings.ID + name,\n            class: 'diva-' + name + ' diva-button',\n            title: label\n        });\n\n        if (callback)\n            button.addEventListener('click', callback, false);\n\n        return button;\n    };\n\n    // Higher-level function for creators of zoom and grid controls\n    var getResolutionControlCreator = function (config)\n    {\n        return function ()\n        {\n            var controls;\n\n            switch (settings[config.controllerSetting])\n            {\n                case 'slider':\n                    controls = config.createSlider();\n                    break;\n\n                case 'buttons':\n                    controls = config.createButtons();\n                    break;\n\n                default:\n                    // Don't display anything\n                    return null;\n            }\n\n            var wrapper = elt('span',\n                controls,\n                config.createLabel()\n            );\n\n            var updateWrapper = function ()\n            {\n                if (settings.inGrid === config.showInGrid)\n                    wrapper.style.display = 'inline';\n                else\n                    wrapper.style.display = 'none';\n            };\n\n            subscribe('ViewDidSwitch', updateWrapper);\n            subscribe('ObjectDidLoad', updateWrapper);\n\n            // Set initial value\n            updateWrapper();\n\n            return wrapper;\n        };\n    };\n\n    // Zoom controls\n    var createZoomControls = getResolutionControlCreator({\n        controllerSetting: 'enableZoomControls',\n        showInGrid: false,\n\n        createSlider: function ()\n        {\n            var elem = createSlider('zoom-slider', {\n                step: 0.1,\n                value: settings.zoomLevel,\n                min: settings.minZoomLevel,\n                max: settings.maxZoomLevel\n            });\n            var $elem = $(elem);\n\n            $elem.on('input', function()\n            {\n                var floatValue = parseFloat(this.value);\n                viewer.setZoomLevel(floatValue);\n            });\n\n            $elem.on('change', function ()\n            {\n                var floatValue = parseFloat(this.value);\n                if (floatValue !== settings.zoomLevel)\n                    viewer.setZoomLevel(floatValue);\n            });\n\n            var updateSlider = function ()\n            {\n                if (settings.zoomLevel !== $elem.val())\n                    $elem.val(settings.zoomLevel);\n            };\n\n            subscribe('ZoomLevelDidChange', updateSlider);\n            subscribe('ViewerDidLoad', function ()\n            {\n                elt.setAttributes(elem, {\n                    min: settings.minZoomLevel,\n                    max: settings.maxZoomLevel\n                });\n\n                updateSlider();\n            });\n\n            return elem;\n        },\n\n        createButtons: function ()\n        {\n            return elt('span',\n                createButtonElement('zoom-out-button', 'Zoom Out', function ()\n                {\n                    viewer.setZoomLevel(settings.zoomLevel - 1);\n                }),\n                createButtonElement('zoom-in-button', 'Zoom In', function ()\n                {\n                    viewer.setZoomLevel(settings.zoomLevel + 1);\n                })\n            );\n        },\n\n        createLabel: function ()\n        {\n            var elem = createLabel('diva-zoom-label', 'zoom-label', 'Zoom level: ', 'zoom-level', settings.zoomLevel);\n            var textSpan = $(elem).find(settings.selector + 'zoom-level')[0];\n\n            var updateText = function ()\n            {\n                textSpan.textContent = settings.zoomLevel.toFixed(2);\n            };\n\n            subscribe('ZoomLevelDidChange', updateText);\n            subscribe('ViewerDidLoad', updateText);\n\n            return elem;\n        }\n    });\n\n    // Grid controls\n    var createGridControls = getResolutionControlCreator({\n        controllerSetting: 'enableGridControls',\n        showInGrid: true,\n\n        createSlider: function ()\n        {\n            var elem = createSlider('grid-slider', {\n                value: settings.pagesPerRow,\n                min: settings.minPagesPerRow,\n                max: settings.maxPagesPerRow\n            });\n            var $elem = $(elem);\n\n            $elem.on('input', function()\n            {\n                var intValue = parseInt(elem.value, 10);\n                viewer.setGridPagesPerRow(intValue);\n            });\n\n            $elem.on('change', function ()\n            {\n                var intValue = parseInt(elem.value, 10);\n                if (intValue !== settings.pagesPerRow)\n                    viewer.setGridPagesPerRow(intValue);\n            });\n\n            subscribe('GridRowNumberDidChange', function ()\n            {\n                // Update the position of the handle within the slider\n                if (settings.pagesPerRow !== $elem.val())\n                    $elem.val(settings.pagesPerRow);\n            });\n\n            return elem;\n        },\n\n        createButtons: function ()\n        {\n            return elt('span',\n                createButtonElement('grid-out-button', 'Zoom Out', function ()\n                {\n                    viewer.setGridPagesPerRow(settings.pagesPerRow - 1);\n                }),\n                createButtonElement('grid-in-button', 'Zoom In', function ()\n                {\n                    viewer.setGridPagesPerRow(settings.pagesPerRow + 1);\n                })\n            );\n        },\n\n        createLabel: function ()\n        {\n            var elem = createLabel('diva-grid-label', 'grid-label', 'Pages per row: ', 'pages-per-row', settings.pagesPerRow);\n            var textSpan = $(elem).find(settings.selector + 'pages-per-row')[0];\n\n            subscribe('GridRowNumberDidChange', function ()\n            {\n                textSpan.textContent = settings.pagesPerRow;\n            });\n\n            return elem;\n        }\n    });\n\n    var createViewMenu = function()\n    {\n        var viewOptionsList = elt('div', elemAttrs('view-options'));\n\n        var changeViewButton = createButtonElement('view-icon', 'Change view', function ()\n        {\n            $(viewOptionsList).toggle();\n        });\n\n        $(document).mouseup(function (event)\n        {\n            var container = $(viewOptionsList);\n\n            if (!container.is(event.target) && container.has(event.target).length === 0 && event.target.id !== settings.ID + 'view-icon')\n            {\n                container.hide();\n            }\n        });\n\n        var selectView = function (view)\n        {\n            viewer.changeView(view);\n\n            //hide view menu\n            $(viewOptionsList).hide();\n        };\n\n        var updateViewMenu = function()\n        {\n            var viewIconClasses = ' diva-view-icon diva-button';\n\n            // display the icon of the mode we're currently in (?)\n            if (settings.inGrid)\n            {\n                changeViewButton.className = 'diva-grid-icon' + viewIconClasses;\n            }\n            else if (settings.inBookLayout)\n            {\n                changeViewButton.className = 'diva-book-icon' + viewIconClasses;\n            }\n            else\n            {\n                changeViewButton.className = 'diva-document-icon' + viewIconClasses;\n            }\n\n            var viewOptions = document.createDocumentFragment();\n\n            // then display document, book, and grid buttons in that order, excluding the current view\n            if (settings.inGrid || settings.inBookLayout)\n                viewOptions.appendChild(createButtonElement('document-icon', 'Document View', selectView.bind(null, 'document')));\n\n            if (settings.inGrid || !settings.inBookLayout)\n                viewOptions.appendChild(createButtonElement('book-icon', 'Book View', selectView.bind(null, 'book')));\n\n            if (!settings.inGrid)\n                viewOptions.appendChild(createButtonElement('grid-icon', 'Grid View', selectView.bind(null, 'grid')));\n\n            // remove old menu\n            while (viewOptionsList.firstChild)\n            {\n                viewOptionsList.removeChild(viewOptionsList.firstChild);\n            }\n\n            // insert new menu\n            viewOptionsList.appendChild(viewOptions);\n        };\n\n        subscribe('ViewDidSwitch', updateViewMenu);\n        subscribe('ObjectDidLoad', updateViewMenu);\n\n        return elt('div', elemAttrs('view-menu'),\n            changeViewButton,\n            viewOptionsList\n        );\n    };\n\n    var createSlider = function(name, options)\n    {\n        return elt('input', options, {\n            id: settings.ID + name,\n            class: 'diva-' + name + ' diva-slider',\n            type: 'range'\n        });\n    };\n\n    var createLabel = function(name, id, label, innerName, innerValue)\n    {\n        return elt('div', {\n                id: settings.ID + id,\n                class: name + ' diva-label'\n            },\n            [\n                label,\n                elt('span', {\n                    id: settings.ID + innerName\n                }, innerValue)\n            ]);\n    };\n\n    var createPageNavigationControls = function ()\n    {\n        // Go to page form\n        var gotoForm = settings.enableGotoPage ? createGotoPageForm() : null;\n\n        return elt('span', elemAttrs('page-nav'),\n            createPageLabel(), // 'Page x of y' label\n            gotoForm\n        );\n    };\n\n    var createGotoPageForm = function ()\n    {\n        var gotoPageInput = elt('input', {\n            id: settings.ID + 'goto-page-input',\n            class: 'diva-input diva-goto-page-input',\n            autocomplete: 'off',\n            type: 'text'\n        });\n\n        var gotoPageSubmit = elt('input', {\n            id: settings.ID + 'goto-page-submit',\n            class: 'diva-button diva-button-text',\n            type: 'submit',\n            value: 'Go'\n        });\n\n        var inputSuggestions = elt('div', {\n                id: settings.ID + 'input-suggestions',\n                class: 'diva-input-suggestions'\n            }\n        );\n\n        var gotoForm = elt('form', {\n                id: settings.ID + 'goto-page',\n                class: 'diva-goto-form'\n            },\n            gotoPageInput,\n            gotoPageSubmit,\n            inputSuggestions\n        );\n\n        $(gotoForm).on('submit', function ()\n        {\n            var desiredPageLabel = gotoPageInput.value;\n\n            if (settings.onGotoSubmit && typeof settings.onGotoSubmit === \"function\")\n            {\n                var pageIndex = settings.onGotoSubmit(desiredPageLabel);\n                if (!viewer.gotoPageByIndex(pageIndex))\n                    alert(\"No page could be found with that label or page number\");\n\n            }\n            else // Default if no function is specified in the settings\n            {\n                if (!viewer.gotoPageByLabel(desiredPageLabel))\n                    alert(\"No page could be found with that label or page number\");\n            }\n\n            // Hide the suggestions\n            inputSuggestions.style.display = 'none';\n\n            // Prevent the default action of reloading the page\n            return false;\n        });\n\n        $(gotoPageInput).on('input focus', function ()\n        {\n            inputSuggestions.innerHTML = ''; // Remove all previous suggestions\n\n            var value = gotoPageInput.value;\n            var numSuggestions = 0;\n            if (settings.enableGotoSuggestions && value)\n            {\n                var pages = settings.manifest.pages;\n                for (var i = 0, len = pages.length; i < len && numSuggestions < 10; i++)\n                {\n                    if (pages[i].l.toLowerCase().indexOf(value.toLowerCase()) > -1)\n                    {\n                        var newInputSuggestion = elt('div', {\n                                class: 'diva-input-suggestion'\n                            },\n                            pages[i].l\n                        );\n\n                        inputSuggestions.appendChild(newInputSuggestion);\n\n                        numSuggestions++;\n                    }\n                }\n\n                // Show label suggestions\n                if (numSuggestions > 0)\n                    inputSuggestions.style.display = 'block';\n            }\n            else\n                inputSuggestions.style.display = 'none';\n        });\n\n        $(gotoPageInput).on('keydown', function (e)\n        {\n            var el;\n            if (e.keyCode === 13) // 'Enter' key\n            {\n                var active = $('.active', inputSuggestions);\n                if (active.length)\n                    gotoPageInput.value = active.text();\n\n            }\n            if (e.keyCode === 38) // Up arrow key\n            {\n                el = $('.active', inputSuggestions);\n                var prevEl = el.prev();\n                if (prevEl.length)\n                {\n                    el.removeClass('active');\n                    prevEl.addClass('active');\n                }\n                else\n                {\n                    el.removeClass('active');\n                    $('.diva-input-suggestion:last', inputSuggestions).addClass('active');\n                }\n            }\n            else if (e.keyCode === 40) // Down arrow key\n            {\n                el = $('.active', inputSuggestions);\n                var nextEl = el.next();\n                if (nextEl.length)\n                {\n                    el.removeClass('active');\n                    nextEl.addClass('active');\n                }\n                else\n                {\n                    el.removeClass('active');\n                    $('.diva-input-suggestion:first', inputSuggestions).addClass('active');\n                }\n            }\n        });\n\n        $(inputSuggestions).on('mousedown', '.diva-input-suggestion', function()\n        {\n            gotoPageInput.value = this.textContent;\n            inputSuggestions.style.display = 'none';\n            $(gotoPageInput).trigger('submit');\n        });\n\n        $(gotoPageInput).on('blur', function ()\n        {\n            // Hide label suggestions\n            inputSuggestions.style.display = 'none';\n        });\n\n        return gotoForm;\n    };\n\n    var createPageLabel = function()\n    {\n        // Current page\n        var currentPage = elt('span', {\n            id: settings.ID + 'current-page'\n        });\n\n        var updateCurrentPage = function ()\n        {\n            currentPage.textContent = viewer.getCurrentAliasedPageIndex();\n        };\n\n        subscribe('VisiblePageDidChange', updateCurrentPage);\n        subscribe('ViewerDidLoad', updateCurrentPage);\n\n        // Number of pages\n        var numPages = elt('span', {\n            id: settings.ID + 'num-pages'\n        });\n\n        var updateNumPages = function ()\n        {\n            numPages.textContent = settings.numPages;\n        };\n\n        subscribe('NumberOfPagesDidChange', updateNumPages);\n        subscribe('ObjectDidLoad', updateNumPages);\n\n        return elt('span', {\n                class: 'diva-page-label diva-label'\n            },\n            'Page ', currentPage, ' of ', numPages\n        );\n    };\n\n    var createToolbarButtonGroup = function ()\n    {\n        var buttons = [createViewMenu()];\n\n        if (settings.enableLinkIcon)\n            buttons.push(createLinkIcon());\n\n        if (settings.enableNonPagedVisibilityIcon)\n            buttons.push(createToggleNonPagedButton());\n\n        if (settings.enableFullscreen)\n            buttons.push(createFullscreenButton());\n\n        return elt('span', elemAttrs('toolbar-button-group'), buttons);\n    };\n\n    var createLinkIcon = function ()\n    {\n        var elem = createButtonElement('link-icon', 'Link to this page');\n        var linkIcon = $(elem);\n\n        linkIcon.on('click', function ()\n        {\n            $('body').prepend(\n                elt('div', {\n                    id: settings.ID + 'link-popup',\n                    class: 'diva-popup diva-link-popup'\n                }, [\n                    elt('input', {\n                        id: settings.ID + 'link-popup-input',\n                        class: 'diva-input',\n                        type: 'text',\n                        value: viewer.getCurrentURL()\n                    })\n                ])\n            );\n\n            if (settings.inFullscreen)\n            {\n                $(settings.selector + 'link-popup').addClass('in-fullscreen');\n            }\n            else\n            {\n                // Calculate the left and top offsets\n                var leftOffset = linkIcon.offset().left - 222 + linkIcon.outerWidth();\n                var topOffset = linkIcon.offset().top + linkIcon.outerHeight() - 1;\n\n                $(settings.selector + 'link-popup').css({\n                    'top': topOffset + 'px',\n                    'left': leftOffset + 'px'\n                });\n            }\n\n            // Catch onmouseup events outside of this div\n            $('body').mouseup(function (event)\n            {\n                var targetID = event.target.id;\n\n                if (targetID !== settings.ID + 'link-popup' && targetID !== settings.ID + 'link-popup-input')\n                    $(settings.selector + 'link-popup').remove();\n            });\n\n            // Also delete it upon scroll and page up/down key events\n            // FIXME(wabain): This is aggressive\n            settings.viewportObject.scroll(function ()\n            {\n                $(settings.selector + 'link-popup').remove();\n            });\n            $(settings.selector + 'link-popup input').click(function ()\n            {\n                $(this).focus().select();\n            });\n\n            return false;\n        });\n\n        return elem;\n    };\n\n    var createFullscreenButton = function ()\n    {\n        return createButtonElement('fullscreen-icon', 'Toggle fullscreen mode', function ()\n        {\n            viewer.toggleFullscreenMode();\n        });\n    };\n\n    var createToggleNonPagedButton = function ()\n    {\n        var getClassName = function()\n        {\n            return 'toggle-nonpaged-icon' + (viewer.getSettings().showNonPagedPages ? '-active' : '');\n        };\n\n        var toggleNonPagedButton = createButtonElement(getClassName(), 'Toggle visibility of non-paged pages', function()\n        {\n            viewer.toggleNonPagedPagesVisibility();\n            var newClassName = 'diva-' + getClassName();\n            this.className = this.className.replace(/diva-toggle-nonpaged-icon(-active)?/, newClassName);\n        });\n\n        var updateNonPagedButtonVisibility = function ()\n        {\n            var pages = settings.manifest.pages;\n            for (var i = 0; i < pages.length; i++)\n            {\n                if (settings.manifest.paged && !pages[i].paged)\n                {\n                    // Show the button, there is at least one non-paged page\n                    toggleNonPagedButton.style.display = 'inline-block';\n                    return;\n                }\n            }\n\n            // No non-paged pages were found, hide the button\n            toggleNonPagedButton.style.display = 'none';\n        };\n        subscribe('ObjectDidLoad', updateNonPagedButtonVisibility);\n\n        return toggleNonPagedButton;\n    };\n\n    // Handles all status updating etc (both fullscreen and not)\n    var init = function ()\n    {\n        var leftTools = [createZoomControls(), createGridControls()];\n        var rightTools = [createPageNavigationControls(), createToolbarButtonGroup()];\n\n        var tools = elt('div', elemAttrs('tools'),\n            elt('div', elemAttrs('tools-left'), leftTools),\n            elt('div', elemAttrs('tools-right'), rightTools)\n        );\n\n        settings.toolbarParentObject.prepend(tools);\n\n        // Handle entry to and exit from fullscreen mode\n        var switchMode = function ()\n        {\n            var toolsRightElement = document.getElementById(settings.ID + 'tools-right');\n            var pageNavElement = document.getElementById(settings.ID + 'page-nav');\n\n            if (!settings.inFullscreen)\n            {\n                // Leaving fullscreen\n                $(tools).removeClass('diva-fullscreen-tools');\n\n                //move ID-page-nav to beginning of tools right\n                toolsRightElement.removeChild(pageNavElement);\n                toolsRightElement.insertBefore(pageNavElement, toolsRightElement.firstChild);\n            }\n            else\n            {\n                // Entering fullscreen\n                $(tools).addClass('diva-fullscreen-tools');\n\n                //move ID-page-nav to end of tools right\n                toolsRightElement.removeChild(pageNavElement);\n                toolsRightElement.appendChild(pageNavElement);\n            }\n        };\n\n        subscribe('ModeDidSwitch', switchMode);\n        subscribe('ViewerDidLoad', switchMode);\n\n        var toolbar = {\n            element: tools,\n            closePopups: function ()\n            {\n                $('.diva-popup').css('display', 'none');\n            }\n        };\n\n        return toolbar;\n    };\n\n    return init();\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/toolbar.js\n// module id = 13\n// module chunks = 0","var $ = require('jquery');\n\nrequire('./utils/jquery-extensions');\n\nvar elt = require('./utils/elt');\nvar getScrollbarWidth = require('./utils/get-scrollbar-width');\n\nvar gestureEvents = require('./gesture-events');\nvar diva = require('./diva-global');\nvar DocumentHandler = require('./document-handler');\nvar GridHandler = require('./grid-handler');\nvar PageOverlayManager = require('./page-overlay-manager');\nvar PluginRegistry = require('./plugin-registry');\nvar Renderer = require('./renderer');\nvar getPageLayouts = require('./page-layouts');\nvar createSettingsView = require('./settings-view');\nvar ValidationRunner = require('./validation-runner');\nvar Viewport = require('./viewport');\n\nvar debug = require('debug')('diva:ViewerCore');\n\nmodule.exports = ViewerCore;\n\n// Define validations\nvar optionsValidations = [\n    {\n        key: 'goDirectlyTo',\n        validate: function (value, settings)\n        {\n            if (value < 0 || value >= settings.manifest.pages.length)\n                return 0;\n        }\n    },\n    {\n        key: 'minPagesPerRow',\n        validate: function (value)\n        {\n            return Math.max(2, value);\n        }\n    },\n    {\n        key: 'maxPagesPerRow',\n        validate: function (value, settings)\n        {\n            return Math.max(value, settings.minPagesPerRow);\n        }\n    },\n    {\n        key: 'pagesPerRow',\n        validate: function (value, settings)\n        {\n            // Default to the maximum\n            if (value < settings.minPagesPerRow || value > settings.maxPagesPerRow)\n                return settings.maxPagesPerRow;\n        }\n    },\n    {\n        key: 'maxZoomLevel',\n        validate: function (value, settings, config)\n        {\n            // Changing this value isn't really an error, it just depends on the\n            // source manifest\n            config.suppressWarning();\n\n            if (value < 0 || value > settings.manifest.maxZoom)\n                return settings.manifest.maxZoom;\n        }\n    },\n    {\n        key: 'minZoomLevel',\n        validate: function (value, settings, config)\n        {\n            // Changes based on the manifest value shouldn't trigger a\n            // warning\n            if (value > settings.manifest.maxZoom)\n            {\n                config.suppressWarning();\n                return 0;\n            }\n\n            if (value < 0 || value > settings.maxZoomLevel)\n                return 0;\n        }\n    },\n    {\n        key: 'zoomLevel',\n        validate: function (value, settings, config)\n        {\n            if (value > settings.manifest.maxZoom)\n            {\n                config.suppressWarning();\n                return 0;\n            }\n\n            if (value < settings.minZoomLevel || value > settings.maxZoomLevel)\n                return settings.minZoomLevel;\n        }\n    }\n];\n\nfunction ViewerCore(element, options, publicInstance)\n{\n    var self = this;\n    var parentObject = $(element);\n\n    // Things that cannot be changed because of the way they are used by the script\n    // Many of these are declared with arbitrary values that are changed later on\n    var viewerState = {\n        currentPageIndex: 0,        // The current page in the viewport (center-most page)\n        horizontalOffset: 0,        // Distance from the center of the diva element to the top of the current page\n        horizontalPadding: 0,       // Either the fixed padding or adaptive padding\n        ID: null,                   // The prefix of the IDs of the elements (usually 1-diva-)\n        initialKeyScroll: false,    // Holds the initial state of enableKeyScroll\n        initialSpaceScroll: false,  // Holds the initial state of enableSpaceScroll\n        innerElement: null,         // The native .diva-outer DOM object\n        innerObject: {},            // $(settings.ID + 'inner'), for selecting the .diva-inner element\n        isActiveDiva: true,         // In the case that multiple diva panes exist on the same page, this should have events funneled to it.\n        isIIIF: false,              // Specifies whether objectData is in Diva native or IIIF Manifest format\n        isScrollable: true,         // Used in enable/disableScrollable public methods\n        isZooming: false,           // Flag to keep track of whether zooming is still in progress, for handleZoom\n        loaded: false,              // A flag for when everything is loaded and ready to go.\n        manifest: null,\n        mobileWebkit: false,        // Checks if the user is on a touch device (iPad/iPod/iPhone/Android)\n        numPages: 0,                // Number of pages in the array\n        oldZoomLevel: -1,           // Holds the previous zoom level after zooming in or out\n        options: options,\n        outerElement: null,         // The native .diva-outer DOM object\n        outerObject: {},            // $(settings.ID + 'outer'), for selecting the .diva-outer element\n        pageOverlays: new PageOverlayManager(),\n        pageTools: [],              // The plugins which are enabled as page tools\n        parentObject: parentObject, // JQuery object referencing the parent element\n        pendingManifestRequest: null, // Reference to the xhr request retrieving the manifest. Used to cancel the request on destroy()\n        plugins: [],                // Filled with the enabled plugins from the registry\n        renderer: null,\n        resizeTimer: -1,            // Holds the ID of the timeout used when resizing the window (for clearing)\n        scrollbarWidth: 0,          // Set to the actual scrollbar width in init()\n        selector: '',               // Uses the generated ID prefix to easily select elements\n        throbberTimeoutID: -1,      // Holds the ID of the throbber loading timeout\n        toolbar: null,              // Holds an object with some toolbar-related functions\n        verticalOffset: 0,          // Distance from the center of the diva element to the left side of the current page\n        verticalPadding: 0,         // Either the fixed padding or adaptive padding\n        viewHandler: null,\n        viewport: null,             // Object caching the viewport dimensions\n        viewportElement: null,\n        viewportObject: null\n    };\n\n    var settings = createSettingsView([options, viewerState]);\n\n    // Aliases for compatibilty\n    Object.defineProperties(settings, {\n        // Height of the document viewer pane\n        panelHeight: {\n            get: function ()\n            {\n                return viewerState.viewport.height;\n            }\n        },\n        // Width of the document viewer pane\n        panelWidth: {\n            get: function ()\n            {\n                return viewerState.viewport.width;\n            }\n        }\n    });\n\n    var optionsValidator = new ValidationRunner({\n        additionalProperties: [\n            {\n                key: 'manifest',\n                get: function ()\n                {\n                    return viewerState.manifest;\n                }\n            }\n        ],\n\n        validations: optionsValidations\n    });\n\n    var isValidOption = function (key, value)\n    {\n        return optionsValidator.isValid(key, value, viewerState.options);\n    };\n\n    var elemAttrs = function (ident, base)\n    {\n        var attrs = {\n            id: settings.ID + ident,\n            class: 'diva-' + ident\n        };\n\n        if (base)\n            return $.extend(attrs, base);\n        else\n            return attrs;\n    };\n\n    var getPageData = function (pageIndex, attribute)\n    {\n        return settings.manifest.pages[pageIndex].d[settings.zoomLevel][attribute];\n    };\n\n    // Reset some settings and empty the viewport\n    var clearViewer = function ()\n    {\n        viewerState.viewport.top = 0;\n\n        // Clear all the timeouts to prevent undesired pages from loading\n        clearTimeout(viewerState.resizeTimer);\n    };\n\n    /**\n     * Update settings to match the specified options. Load the viewer,\n     * fire appropriate events for changed options.\n     */\n    var reloadViewer = function (newOptions)\n    {\n        var queuedEvents = [];\n\n        newOptions = optionsValidator.getValidatedOptions(settings, newOptions);\n\n        // Set the zoom level if valid and fire a ZoomLevelDidChange event\n        if (hasChangedOption(newOptions, 'zoomLevel'))\n        {\n            viewerState.oldZoomLevel = settings.zoomLevel;\n            viewerState.options.zoomLevel = newOptions.zoomLevel;\n            queuedEvents.push([\"ZoomLevelDidChange\", newOptions.zoomLevel]);\n        }\n\n        // Set the pages per row if valid and fire an event\n        if (hasChangedOption(newOptions, 'pagesPerRow'))\n        {\n            viewerState.options.pagesPerRow = newOptions.pagesPerRow;\n            queuedEvents.push([\"GridRowNumberDidChange\", newOptions.pagesPerRow]);\n        }\n\n        // Update verticallyOriented (no event fired)\n        if (hasChangedOption(newOptions, 'verticallyOriented'))\n            viewerState.options.verticallyOriented = newOptions.verticallyOriented;\n\n        // Show/Hide non-paged pages\n        if (hasChangedOption(newOptions, 'showNonPagedPages'))\n        {\n            viewerState.options.showNonPagedPages = newOptions.showNonPagedPages;\n        }\n\n        // Update page position (no event fired here)\n        if ('goDirectlyTo' in newOptions)\n        {\n            viewerState.options.goDirectlyTo = newOptions.goDirectlyTo;\n\n            if ('verticalOffset' in newOptions)\n                viewerState.verticalOffset = newOptions.verticalOffset;\n\n            if ('horizontalOffset' in newOptions)\n                viewerState.horizontalOffset = newOptions.horizontalOffset;\n        }\n        else\n        {\n            // Otherwise the default is to remain on the current page\n            viewerState.options.goDirectlyTo = settings.currentPageIndex;\n        }\n\n        if (hasChangedOption(newOptions, 'inGrid') || hasChangedOption(newOptions, 'inBookLayout'))\n        {\n            if ('inGrid' in newOptions)\n                viewerState.options.inGrid = newOptions.inGrid;\n\n            if ('inBookLayout' in newOptions)\n                viewerState.options.inBookLayout = newOptions.inBookLayout;\n\n            queuedEvents.push([\"ViewDidSwitch\", settings.inGrid]);\n        }\n\n        // Note: prepareModeChange() depends on inGrid and the vertical/horizontalOffset (for now)\n        if (hasChangedOption(newOptions, 'inFullscreen'))\n        {\n            viewerState.options.inFullscreen = newOptions.inFullscreen;\n            prepareModeChange(newOptions);\n            queuedEvents.push([\"ModeDidSwitch\", settings.inFullscreen]);\n        }\n\n        clearViewer();\n        updateViewHandlerAndRendering();\n\n        if (viewerState.renderer)\n        {\n            // TODO: The usage of padding variables is still really\n            // messy and inconsistent\n            var rendererConfig = {\n                pageLayouts: getPageLayouts(settings),\n                padding: getPadding(),\n                maxZoomLevel: settings.inGrid ? null : viewerState.manifest.maxZoom,\n                verticallyOriented: settings.verticallyOriented || settings.inGrid,\n            };\n\n            var viewportPosition = {\n                zoomLevel: settings.inGrid ? null : settings.zoomLevel,\n                anchorPage: settings.goDirectlyTo,\n                verticalOffset: viewerState.verticalOffset,\n                horizontalOffset: viewerState.horizontalOffset\n            };\n\n            var sourceProvider = getCurrentSourceProvider();\n\n            if (debug.enabled)\n            {\n                var serialized = Object.keys(rendererConfig)\n                    .filter(function (key)\n                    {\n                        // Too long\n                        return key !== 'pageLayouts' && key !== 'padding';\n                    })\n                    .map(function (key)\n                    {\n                        var value = rendererConfig[key];\n                        return key + ': ' + JSON.stringify(value);\n                    })\n                    .join(', ');\n\n                debug('reload with %s', serialized);\n            }\n\n            viewerState.renderer.load(rendererConfig, viewportPosition, sourceProvider);\n        }\n\n        queuedEvents.forEach(function (params)\n        {\n            publish.apply(null, params);\n        });\n\n        return true;\n    };\n\n    var hasChangedOption = function (options, key)\n    {\n        return key in options && options[key] !== settings[key];\n    };\n\n    // Handles switching in and out of fullscreen mode\n    var prepareModeChange = function (options)\n    {\n        // Toggle the classes\n        var changeClass = options.inFullscreen ? 'addClass' : 'removeClass';\n        viewerState.outerObject[changeClass]('diva-fullscreen');\n        $('body')[changeClass]('diva-hide-scrollbar');\n        settings.parentObject[changeClass]('diva-full-width');\n\n        // Adjust Diva's internal panel size, keeping the old values\n        var storedHeight = settings.panelHeight;\n        var storedWidth = settings.panelWidth;\n        viewerState.viewport.invalidate();\n\n        // If this isn't the original load, the offsets matter, and the position isn't being changed...\n        if (!viewerState.loaded && !settings.inGrid && !('verticalOffset' in options))\n        {\n            //get the updated panel size\n            var newHeight = settings.panelHeight;\n            var newWidth = settings.panelWidth;\n\n            //and re-center the new panel on the same point\n            viewerState.verticalOffset += ((storedHeight - newHeight) / 2);\n            viewerState.horizontalOffset += ((storedWidth - newWidth) / 2);\n        }\n\n        //turn on/off escape key listener\n        if (options.inFullscreen)\n            $(document).on('keyup', escapeListener);\n        else\n            $(document).off('keyup', escapeListener);\n    };\n\n    // Update the view handler and the view rendering for the current view\n    var updateViewHandlerAndRendering = function ()\n    {\n        var Handler = settings.inGrid ? GridHandler : DocumentHandler;\n\n        if (viewerState.viewHandler && !(viewerState.viewHandler instanceof Handler))\n        {\n            viewerState.viewHandler.destroy();\n            viewerState.viewHandler = null;\n        }\n\n        if (!viewerState.viewHandler)\n            viewerState.viewHandler = new Handler(self);\n\n        if (!viewerState.renderer)\n            initializeRenderer();\n    };\n\n    // TODO: This could probably be done upon ViewerCore initialization\n    var initializeRenderer = function ()\n    {\n        var compatErrors = Renderer.getCompatibilityErrors();\n\n        if (compatErrors)\n        {\n            showError(compatErrors);\n        }\n        else\n        {\n            var options = {\n                viewport: viewerState.viewport,\n                outerElement: viewerState.outerElement,\n                innerElement: viewerState.innerElement\n            };\n\n            var hooks = {\n                onViewWillLoad: function ()\n                {\n                    viewerState.viewHandler.onViewWillLoad();\n                },\n                onViewDidLoad: function ()\n                {\n                    updatePageOverlays();\n                    viewerState.viewHandler.onViewDidLoad();\n                },\n                onViewDidUpdate: function (pages, targetPage)\n                {\n                    updatePageOverlays();\n                    viewerState.viewHandler.onViewDidUpdate(pages, targetPage);\n                },\n                onViewDidTransition: function ()\n                {\n                    updatePageOverlays();\n                },\n                onPageWillLoad: function (pageIndex)\n                {\n                    publish('PageWillLoad', pageIndex);\n                }\n            };\n\n            viewerState.renderer = new Renderer(options, hooks);\n        }\n    };\n\n    var getCurrentSourceProvider = function ()\n    {\n        if (settings.inGrid)\n        {\n            var gridSourceProvider = {\n                getAllZoomLevelsForPage: function (page)\n                {\n                    return [gridSourceProvider.getBestZoomLevelForPage(page)];\n                },\n                getBestZoomLevelForPage: function (page)\n                {\n                    var url = settings.manifest.getPageImageURL(page.index, {\n                        width: page.dimensions.width\n                    });\n\n                    return {\n                        zoomLevel: 1, // FIXME\n                        rows: 1,\n                        cols: 1,\n                        tiles: [{\n                            url: url,\n                            zoomLevel: 1, // FIXME\n                            row: 0,\n                            col: 0,\n                            dimensions: page.dimensions,\n                            offset: {\n                                top: 0,\n                                left: 0\n                            }\n                        }]\n                    };\n                }\n            };\n\n            return gridSourceProvider;\n        }\n\n        var tileDimens = {\n            width: settings.tileWidth,\n            height: settings.tileHeight\n        };\n\n        return {\n            getBestZoomLevelForPage: function (page)\n            {\n                return settings.manifest.getPageImageTiles(page.index, Math.ceil(settings.zoomLevel), tileDimens);\n            },\n            getAllZoomLevelsForPage: function (page)\n            {\n                var levels = [];\n\n                var levelCount = viewerState.manifest.maxZoom;\n                for (var level=0; level <= levelCount; level++)\n                {\n                    levels.push(settings.manifest.getPageImageTiles(page.index, level, tileDimens));\n                }\n\n                levels.reverse();\n\n                return levels;\n            }\n        };\n    };\n\n    var getPadding = function ()\n    {\n        var topPadding, leftPadding;\n        var docVPadding, docHPadding;\n\n        if (settings.inGrid)\n        {\n            docVPadding = settings.fixedPadding;\n            topPadding = leftPadding = docHPadding = 0;\n        }\n        else\n        {\n            topPadding = settings.verticallyOriented ? viewerState.verticalPadding : 0;\n            leftPadding = settings.verticallyOriented ? 0 : viewerState.horizontalPadding;\n\n            docVPadding = settings.verticallyOriented ? 0 : viewerState.verticalPadding;\n            docHPadding = settings.verticallyOriented ? viewerState.horizontalPadding : 0;\n        }\n\n        return {\n            document: {\n                top: docVPadding,\n                bottom: docVPadding,\n                left: docHPadding,\n                right: docHPadding\n            },\n            page: {\n                top: topPadding,\n                bottom: 0,\n                left: leftPadding,\n                right: 0\n            }\n        };\n    };\n\n    var updatePageOverlays = function ()\n    {\n        viewerState.pageOverlays.updateOverlays(viewerState.renderer.getRenderedPages());\n    };\n\n    //Shortcut for closing fullscreen with the escape key\n    var escapeListener = function (e)\n    {\n        if (e.keyCode == 27)\n        {\n            reloadViewer({\n                inFullscreen: !settings.inFullscreen\n            });\n        }\n    };\n\n    // Called to handle any zoom level\n    var handleZoom = function (newZoomLevel, focalPoint)\n    {\n        // If the zoom level provided is invalid, return false\n        if (!isValidOption('zoomLevel', newZoomLevel))\n            return false;\n\n        // If no focal point was given, zoom on the center of the viewport\n        if (focalPoint == null)\n        {\n            var viewport = viewerState.viewport;\n            var currentRegion = viewerState.renderer.layout.getPageRegion(settings.currentPageIndex);\n\n            focalPoint = {\n                anchorPage: settings.currentPageIndex,\n                offset: {\n                    left: (viewport.width / 2) - (currentRegion.left - viewport.left),\n                    top: (viewport.height / 2) - (currentRegion.top - viewport.top)\n                }\n            };\n        }\n\n        var pageRegion = viewerState.renderer.layout.getPageRegion(focalPoint.anchorPage);\n\n        // calculate distance from cursor coordinates to center of viewport\n        var focalXToCenter = (pageRegion.left + focalPoint.offset.left) -\n            (settings.viewport.left + (settings.viewport.width / 2));\n        var focalYToCenter = (pageRegion.top + focalPoint.offset.top) -\n            (settings.viewport.top + (settings.viewport.height / 2));\n\n        function getPositionForZoomLevel(zoomLevel)\n        {\n            var zoomRatio = Math.pow(2, zoomLevel - initialZoomLevel);\n\n            //TODO(jeromepl): Calculate position from page top left to viewport top left\n            // calculate horizontal/verticalOffset: distance from viewport center to page upper left corner\n            var horizontalOffset = (focalPoint.offset.left * zoomRatio) - focalXToCenter;\n            var verticalOffset = (focalPoint.offset.top * zoomRatio) - focalYToCenter;\n\n            return {\n                zoomLevel: zoomLevel,\n                anchorPage: focalPoint.anchorPage,\n                verticalOffset: verticalOffset,\n                horizontalOffset: horizontalOffset\n            };\n        }\n\n        var initialZoomLevel = viewerState.oldZoomLevel = settings.zoomLevel;\n        viewerState.options.zoomLevel = newZoomLevel;\n\n        var endPosition = getPositionForZoomLevel(newZoomLevel);\n        viewerState.options.goDirectlyTo = endPosition.anchorPage;\n        viewerState.verticalOffset = endPosition.verticalOffset;\n        viewerState.horizontalOffset = endPosition.horizontalOffset;\n\n        viewerState.renderer.transitionViewportPosition({\n            duration: 300,\n            parameters: {\n                zoomLevel: {\n                    from: initialZoomLevel,\n                    to: newZoomLevel\n                }\n            },\n            getPosition: function (parameters)\n            {\n                return getPositionForZoomLevel(parameters.zoomLevel);\n            },\n            onEnd: function (info)\n            {\n                viewerState.viewportObject.scroll(scrollFunction);\n\n                if (info.interrupted)\n                    viewerState.oldZoomLevel = newZoomLevel;\n            }\n        });\n\n        // Update the slider\n        publish(\"ZoomLevelDidChange\", newZoomLevel);\n\n        // While zooming, don't update scroll offsets based on the scaled version of diva-inner\n        viewerState.viewportObject.off('scroll');\n\n        return true;\n    };\n\n    /*\n     Gets the Y-offset for a specific point on a specific page\n     Acceptable values for \"anchor\":\n     \"top\" (default) - will anchor top of the page to the top of the diva-outer element\n     \"bottom\" - top, s/top/bottom\n     \"center\" - will center the page on the diva element\n     Returned value will be the distance from the center of the diva-outer element to the top of the current page for the specified anchor\n     */\n    var getYOffset = function (pageIndex, anchor)\n    {\n        pageIndex = (typeof(pageIndex) === \"undefined\" ? settings.currentPageIndex : pageIndex);\n\n        if (anchor === \"center\" || anchor === \"centre\") //how you can tell an American coded this\n        {\n            return parseInt(getPageData(pageIndex, \"h\") / 2, 10);\n        }\n        else if (anchor === \"bottom\")\n        {\n            return parseInt(getPageData(pageIndex, \"h\") - settings.panelHeight / 2, 10);\n        }\n        else\n        {\n            return parseInt(settings.panelHeight / 2, 10);\n        }\n    };\n\n    //Same as getYOffset with \"left\" and \"right\" as acceptable values instead of \"top\" and \"bottom\"\n    var getXOffset = function (pageIndex, anchor)\n    {\n        pageIndex = (typeof(pageIndex) === \"undefined\" ? settings.currentPageIndex : pageIndex);\n\n        if (anchor === \"left\")\n        {\n            return parseInt(settings.panelWidth / 2, 10);\n        }\n        else if (anchor === \"right\")\n        {\n            return parseInt(getPageData(pageIndex, \"w\") - settings.panelWidth / 2, 10);\n        }\n        else\n        {\n            return parseInt(getPageData(pageIndex, \"w\") / 2, 10);\n        }\n    };\n\n    // updates panelHeight/panelWidth on resize\n    var updatePanelSize = function ()\n    {\n        viewerState.viewport.invalidate();\n\n        // FIXME(wabain): This should really only be called after initial load\n        if (viewerState.renderer)\n        {\n            updateOffsets();\n            viewerState.renderer.goto(settings.currentPageIndex, viewerState.verticalOffset, viewerState.horizontalOffset);\n        }\n\n        return true;\n    };\n\n    var updateOffsets = function ()\n    {\n        var pageOffset = viewerState.renderer.layout.getPageToViewportCenterOffset(settings.currentPageIndex, viewerState.viewport);\n\n        if (pageOffset)\n        {\n            viewerState.horizontalOffset = pageOffset.x;\n            viewerState.verticalOffset = pageOffset.y;\n        }\n    };\n\n    // Bind mouse events (drag to scroll, double-click)\n    var bindMouseEvents = function()\n    {\n        // Set drag scroll on first descendant of class dragger on both selected elements\n        viewerState.viewportObject.dragscrollable({dragSelector: '.diva-dragger', acceptPropagatedEvent: true});\n        viewerState.innerObject.dragscrollable({dragSelector: '.diva-dragger', acceptPropagatedEvent: true});\n\n        gestureEvents.onDoubleClick(viewerState.viewportObject, function (event, coords)\n        {\n            debug('Double click at %s, %s', coords.left, coords.top);\n            viewerState.viewHandler.onDoubleClick(event, coords);\n        });\n    };\n\n    var onResize = function()\n    {\n        updatePanelSize();\n        // Cancel any previously-set resize timeouts\n        clearTimeout(viewerState.resizeTimer);\n\n        viewerState.resizeTimer = setTimeout(function ()\n        {\n            var pageOffset = viewerState.renderer.layout.getPageToViewportCenterOffset(settings.currentPageIndex, viewerState.viewport);\n\n            if (pageOffset)\n            {\n                reloadViewer({\n                    goDirectlyTo: settings.currentPageIndex,\n                    verticalOffset: pageOffset.y,\n                    horizontalOffset: pageOffset.x\n                });\n            }\n            else\n            {\n                reloadViewer({\n                    goDirectlyTo: settings.currentPageIndex\n                });\n            }\n        }, 200);\n    };\n\n    // Bind touch and orientation change events\n    var bindTouchEvents = function()\n    {\n        // Block the user from moving the window only if it's not integrated\n        if (settings.blockMobileMove)\n        {\n            $('body').bind('touchmove', function (event)\n            {\n                var e = event.originalEvent;\n                e.preventDefault();\n\n                return false;\n            });\n        }\n\n        // Touch events for swiping in the viewport to scroll pages\n        viewerState.viewportObject.kinetic({\n            triggerHardware: true\n        });\n\n        gestureEvents.onPinch(viewerState.viewportObject, function (event, coords, start, end)\n        {\n            debug('Pinch %s at %s, %s', end - start, coords.left, coords.top);\n            viewerState.viewHandler.onPinch(event, coords, start, end);\n        });\n\n        gestureEvents.onDoubleTap(viewerState.viewportObject, function (event, coords)\n        {\n            debug('Double tap at %s, %s', coords.left, coords.top);\n            viewerState.viewHandler.onDoubleClick(event, coords);\n        });\n    };\n\n    // Handle the scroll\n    var scrollFunction = function ()\n    {\n        var previousTopScroll = viewerState.viewport.top;\n        var previousLeftScroll = viewerState.viewport.left;\n\n        var direction;\n\n        viewerState.viewport.invalidate();\n\n        var newScrollTop = viewerState.viewport.top;\n        var newScrollLeft = viewerState.viewport.left;\n\n        if (settings.verticallyOriented || settings.inGrid)\n            direction = newScrollTop - previousTopScroll;\n        else\n            direction = newScrollLeft - previousLeftScroll;\n\n        //give adjust the direction we care about\n        viewerState.renderer.adjust(direction);\n\n        var primaryScroll = (settings.verticallyOriented || settings.inGrid) ? newScrollTop : newScrollLeft;\n\n        publish(\"ViewerDidScroll\", primaryScroll);\n\n        if (direction > 0)\n        {\n            publish(\"ViewerDidScrollDown\", primaryScroll);\n        }\n        else if (direction < 0)\n        {\n            publish(\"ViewerDidScrollUp\", primaryScroll);\n        }\n\n        updateOffsets();\n    };\n\n    // Binds most of the event handlers (some more in createToolbar)\n    var handleEvents = function ()\n    {\n        // Change the cursor for dragging\n        viewerState.innerObject.mousedown(function ()\n        {\n            viewerState.innerObject.addClass('diva-grabbing');\n        });\n\n        viewerState.innerObject.mouseup(function ()\n        {\n            viewerState.innerObject.removeClass('diva-grabbing');\n        });\n\n        bindMouseEvents();\n\n        viewerState.viewportObject.scroll(scrollFunction);\n\n        var upArrowKey = 38,\n            downArrowKey = 40,\n            leftArrowKey = 37,\n            rightArrowKey = 39,\n            spaceKey = 32,\n            pageUpKey = 33,\n            pageDownKey = 34,\n            homeKey = 36,\n            endKey = 35;\n\n        // Catch the key presses in document\n        $(document).on('keydown.diva', function (event)\n        {\n            if (!viewerState.isActiveDiva)\n                return true;\n\n            // Space or page down - go to the next page\n            if ((settings.enableSpaceScroll && !event.shiftKey && event.keyCode === spaceKey) || (settings.enableKeyScroll && event.keyCode === pageDownKey))\n            {\n                viewerState.viewport.top += settings.panelHeight;\n                return false;\n            }\n            else if (!settings.enableSpaceScroll && event.keyCode === spaceKey)\n            {\n                event.preventDefault();\n            }\n\n            if (settings.enableKeyScroll)\n            {\n                // Don't steal keyboard shortcuts (metaKey = command [OS X], super [Win/Linux])\n                if (event.shiftKey || event.ctrlKey || event.metaKey)\n                    return true;\n\n                switch (event.keyCode)\n                {\n                    case pageUpKey:\n                        // Page up - go to the previous page\n                        viewerState.viewport.top -= settings.panelHeight;\n                        return false;\n\n                    case upArrowKey:\n                        // Up arrow - scroll up\n                        viewerState.viewport.top -= settings.arrowScrollAmount;\n                        return false;\n\n                    case downArrowKey:\n                        // Down arrow - scroll down\n                        viewerState.viewport.top += settings.arrowScrollAmount;\n                        return false;\n\n                    case leftArrowKey:\n                        // Left arrow - scroll left\n                        viewerState.viewport.left -= settings.arrowScrollAmount;\n                        return false;\n\n                    case rightArrowKey:\n                        // Right arrow - scroll right\n                        viewerState.viewport.left += settings.arrowScrollAmount;\n                        return false;\n\n                    case homeKey:\n                        // Home key - go to the beginning of the document\n                        viewerState.viewport.top = 0;\n                        return false;\n\n                    case endKey:\n                        // End key - go to the end of the document\n                        // Count on the viewport coordinate value being normalized\n                        if (settings.verticallyOriented)\n                            viewerState.viewport.top = Infinity;\n                        else\n                            viewerState.viewport.left = Infinity;\n\n                        return false;\n\n                    default:\n                        return true;\n                }\n            }\n            return true;\n        });\n\n        diva.Events.subscribe('ViewerDidTerminate', function()\n        {\n            $(document).off('keydown.diva');\n        }, settings.ID);\n\n        bindTouchEvents();\n\n        // Handle window resizing events\n        window.addEventListener('resize', onResize, false);\n\n        diva.Events.subscribe('ViewerDidTerminate', function()\n        {\n            window.removeEventListener('resize', onResize, false);\n        }, settings.ID);\n\n        // Handle orientation change separately\n        if ('onorientationchange' in window)\n        {\n            window.addEventListener('orientationchange', onResize, false);\n\n            diva.Events.subscribe('ViewerDidTerminate', function()\n            {\n                window.removeEventListener('orientationchange', onResize, false);\n            }, settings.ID);\n        }\n\n        diva.Events.subscribe('PanelSizeDidChange', updatePanelSize, settings.ID);\n\n        // Clear page and resize timeouts when the viewer is destroyed\n        diva.Events.subscribe('ViewerDidTerminate', function ()\n        {\n            if (viewerState.renderer)\n                viewerState.renderer.destroy();\n\n            clearTimeout(viewerState.resizeTimer);\n        }, settings.ID);\n    };\n\n    var initPlugins = function ()\n    {\n        // Add all the plugins that have not been explicitly disabled to\n        // settings.plugins\n        PluginRegistry.getAll().forEach(function (plugin)\n        {\n            var pluginProperName = plugin.pluginName[0].toUpperCase() + plugin.pluginName.substring(1);\n\n            if (settings['enable' + pluginProperName])\n            {\n                // Call the init function and check return value\n                var enablePlugin = plugin.init(settings, publicInstance);\n\n                // If int returns false, consider the plugin disabled\n                if (!enablePlugin)\n                    return;\n\n                // Create the pageTools bar if handleClick is set to a function\n                if (typeof plugin.handleClick === 'function')\n                {\n                    viewerState.pageTools.push(plugin);\n                }\n\n                // Add it to settings.plugins so it can be used later\n                settings.plugins.push(plugin);\n            }\n        });\n    };\n\n    var showThrobber = function ()\n    {\n        hideThrobber();\n\n        viewerState.throbberTimeoutID = setTimeout(function ()\n        {\n            $(settings.selector + 'throbber').show();\n        }, settings.throbberTimeout);\n    };\n\n    var hideThrobber = function ()\n    {\n        // Clear the timeout, if it hasn't executed yet\n        clearTimeout(viewerState.throbberTimeoutID);\n\n        // Hide the throbber if it has already executed\n        $(settings.selector + 'throbber').hide();\n    };\n\n    var showError = function(message)\n    {\n        var errorElement = elt('div', elemAttrs('error'), [\n            elt('button', elemAttrs('error-close', {'aria-label': 'Close dialog'})),\n            elt('p',\n                elt('strong', 'Error')\n            ),\n            elt('div', message)\n        ]);\n\n        viewerState.outerObject.append(errorElement);\n\n        //bind dialog close button\n        $(settings.selector + 'error-close').on('click', function()\n        {\n            errorElement.parentNode.removeChild(errorElement);\n        });\n    };\n\n    var setManifest = function (manifest, isIIIF, loadOptions)\n    {\n        viewerState.manifest = manifest;\n\n        // FIXME: is isIIIF even needed?\n        viewerState.isIIIF = isIIIF;\n\n        hideThrobber();\n\n        // Convenience value\n        viewerState.numPages = settings.manifest.pages.length;\n\n        optionsValidator.validate(viewerState.options);\n\n        publish('NumberOfPagesDidChange', settings.numPages);\n\n        if (settings.enableAutoTitle)\n        {\n            if ($(settings.selector + 'title').length)\n                $(settings.selector + 'title').html(settings.manifest.itemTitle);\n            else\n                settings.parentObject.prepend(elt('div', elemAttrs('title'), [settings.manifest.itemTitle]));\n        }\n\n        // Calculate the horizontal and vertical inter-page padding based on the dimensions of the average zoom level\n        if (settings.adaptivePadding > 0)\n        {\n            var z = Math.floor((settings.minZoomLevel + settings.maxZoomLevel) / 2);\n            viewerState.horizontalPadding = parseInt(settings.manifest.getAverageWidth(z) * settings.adaptivePadding, 10);\n            viewerState.verticalPadding = parseInt(settings.manifest.getAverageHeight(z) * settings.adaptivePadding, 10);\n        }\n        else\n        {\n            // It's less than or equal to 0; use fixedPadding instead\n            viewerState.horizontalPadding = settings.fixedPadding;\n            viewerState.verticalPadding = settings.fixedPadding;\n        }\n\n        // Make sure the vertical padding is at least 40, if plugin icons are enabled\n        if (viewerState.pageTools.length)\n        {\n            viewerState.verticalPadding = Math.max(40, viewerState.verticalPadding);\n        }\n\n        // If we detect a viewingHint of 'paged' in the manifest or sequence, enable book view by default\n        if (settings.manifest.paged)\n        {\n            viewerState.options.inBookLayout = true;\n        }\n\n        // Plugin setup hooks should be bound to the ObjectDidLoad event\n        publish('ObjectDidLoad', settings);\n\n        // Adjust the document panel dimensions\n        updatePanelSize();\n\n        var needsXCoord, needsYCoord;\n\n        var anchoredVertically = false;\n        var anchoredHorizontally = false;\n\n        if (loadOptions.goDirectlyTo == null)\n        {\n            loadOptions.goDirectlyTo = settings.goDirectlyTo;\n            needsXCoord = needsYCoord = true;\n        }\n        else\n        {\n            needsXCoord = loadOptions.horizontalOffset == null || isNaN(loadOptions.horizontalOffset);\n            needsYCoord = loadOptions.verticalOffset == null || isNaN(loadOptions.verticalOffset);\n        }\n\n        // Set default values for the horizontal and vertical offsets\n        if (needsXCoord)\n        {\n            // FIXME: What if inBookLayout/verticallyOriented is changed by loadOptions?\n            if (loadOptions.goDirectlyTo === 0 && settings.inBookLayout && settings.verticallyOriented)\n            {\n                // if in book layout, center the first opening by default\n                loadOptions.horizontalOffset = viewerState.horizontalPadding;\n            }\n            else\n            {\n                anchoredHorizontally = true;\n                loadOptions.horizontalOffset = getXOffset(loadOptions.goDirectlyTo, \"center\");\n            }\n        }\n\n        if (needsYCoord)\n        {\n            anchoredVertically = true;\n            loadOptions.verticalOffset = getYOffset(loadOptions.goDirectlyTo, \"top\");\n        }\n\n        reloadViewer(loadOptions);\n\n        //prep dimensions one last time now that pages have loaded\n        updatePanelSize();\n\n        // FIXME: This is a hack to ensure that the outerElement scrollbars are taken into account\n        if (settings.verticallyOriented)\n            viewerState.innerElement.style.minWidth = settings.panelWidth + 'px';\n        else\n            viewerState.innerElement.style.minHeight = settings.panelHeight + 'px';\n\n        // FIXME: If the page was supposed to be positioned relative to the viewport we need to\n        // recalculate it to take into account the scrollbars\n        if (anchoredVertically || anchoredHorizontally)\n        {\n            if (anchoredVertically)\n                viewerState.verticalOffset = getYOffset(settings.currentPageIndex, \"top\");\n\n            if (anchoredHorizontally)\n                viewerState.horizontalOffset = getXOffset(settings.currentPageIndex, \"center\");\n\n            viewerState.renderer.goto(settings.currentPageIndex, viewerState.verticalOffset, viewerState.horizontalOffset);\n        }\n\n        // signal that everything should be set up and ready to go.\n        viewerState.loaded = true;\n\n        publish(\"ViewerDidLoad\", settings);\n    };\n\n    var publish = function (event)\n    {\n        var args = Array.prototype.slice.call(arguments, 1);\n        diva.Events.publish(event, args, publicInstance);\n    };\n\n    var init = function ()\n    {\n        // First figure out the width of the scrollbar in this browser\n        // TODO(wabain): Cache this somewhere else\n        // Only some of the plugins rely on this now\n        viewerState.scrollbarWidth = getScrollbarWidth();\n\n        // If window.orientation is defined, then it's probably mobileWebkit\n        viewerState.mobileWebkit = window.orientation !== undefined;\n\n        // Generate an ID that can be used as a prefix for all the other IDs\n        var idNumber = generateId();\n        viewerState.ID = 'diva-' + idNumber + '-';\n        viewerState.selector = '#' + settings.ID;\n\n        if (options.hashParamSuffix === null)\n        {\n            // Omit the suffix from the first instance\n            if (idNumber === 1)\n                options.hashParamSuffix = '';\n            else\n                options.hashParamSuffix = idNumber + '';\n        }\n\n        // Create the inner and outer panels\n        var innerElem = elt('div', elemAttrs('inner', { class: 'diva-inner diva-dragger' }));\n        var viewportElem = elt('div', elemAttrs('viewport'), innerElem);\n        var outerElem = elt('div', elemAttrs('outer'),\n            viewportElem,\n            elt('div', elemAttrs('throbber')));\n\n        viewerState.innerElement = innerElem;\n        viewerState.viewportElement = viewportElem;\n        viewerState.outerElement = outerElem;\n\n        viewerState.innerObject = $(innerElem);\n        viewerState.viewportObject = $(viewportElem);\n        viewerState.outerObject = $(outerElem);\n\n        settings.parentObject.append(outerElem);\n\n        viewerState.viewport = new Viewport(viewerState.viewportElement, {\n            intersectionTolerance: settings.viewportMargin\n        });\n\n        // Do all the plugin initialisation\n        initPlugins();\n\n        handleEvents();\n\n        // Show the throbber while waiting for the manifest to load\n        showThrobber();\n    };\n\n    this.getSettings = function ()\n    {\n        return settings;\n    };\n\n    // Temporary accessor for the state of the viewer core\n    // TODO: Replace this with a more restricted view of whatever needs\n    // be exposed through settings for backwards compat\n    this.getInternalState = function ()\n    {\n        return viewerState;\n    };\n\n    this.getPublicInstance = function ()\n    {\n        return publicInstance;\n    };\n\n    this.getPageTools = function ()\n    {\n        return viewerState.pageTools;\n    };\n\n    this.getCurrentLayout = function ()\n    {\n        return viewerState.renderer ? viewerState.renderer.layout : null;\n    };\n\n    /** Get a copy of the current viewport dimensions */\n    this.getViewport = function ()\n    {\n        var viewport = viewerState.viewport;\n\n        return {\n            top: viewport.top,\n            left: viewport.left,\n            bottom: viewport.bottom,\n            right: viewport.right,\n\n            width: viewport.width,\n            height: viewport.height\n        };\n    };\n\n    this.addPageOverlay = function (overlay)\n    {\n        viewerState.pageOverlays.addOverlay(overlay);\n    };\n\n    this.removePageOverlay = function (overlay)\n    {\n        viewerState.pageOverlays.removeOverlay(overlay);\n    };\n\n    this.getPageRegion = function (pageIndex, options)\n    {\n        var layout = viewerState.renderer.layout;\n        var region = layout.getPageRegion(pageIndex, options);\n\n        if (options && options.incorporateViewport)\n        {\n            var secondaryDim = settings.verticallyOriented ? 'width' : 'height';\n\n            if (viewerState.viewport[secondaryDim] > layout.dimensions[secondaryDim])\n            {\n                var docOffset = (viewerState.viewport[secondaryDim] - layout.dimensions[secondaryDim]) / 2;\n\n                if (settings.verticallyOriented)\n                {\n                    return {\n                        top: region.top,\n                        bottom: region.bottom,\n\n                        left: region.left + docOffset,\n                        right: region.right + docOffset\n                    };\n                }\n                else\n                {\n                    return {\n                        top: region.top + docOffset,\n                        bottom: region.bottom + docOffset,\n\n                        left: region.left,\n                        right: region.right\n                    };\n                }\n            }\n        }\n\n        return region;\n    };\n\n    this.getPagePositionAtViewportOffset = function (coords)\n    {\n        var docCoords = {\n            left: coords.left + viewerState.viewport.left,\n            top: coords.top + viewerState.viewport.top\n        };\n\n        var renderedPages = viewerState.renderer.getRenderedPages();\n        var pageCount = renderedPages.length;\n\n        // Find the page on which the coords occur\n        for (var i=0; i < pageCount; i++)\n        {\n            var pageIndex = renderedPages[i];\n            var region = viewerState.renderer.layout.getPageRegion(pageIndex);\n\n            if (region.left <= docCoords.left && region.right >= docCoords.left &&\n                region.top <= docCoords.top && region.bottom >= docCoords.top)\n            {\n                return {\n                    anchorPage: pageIndex,\n                    offset: {\n                        left: docCoords.left - region.left,\n                        top: docCoords.top - region.top\n                    }\n                };\n            }\n        }\n\n        // Fall back to current page\n        // FIXME: Would be better to use the closest page or something\n        var currentRegion = viewerState.renderer.layout.getPageRegion(settings.currentPageIndex);\n\n        return {\n            anchorPage: settings.currentPageIndex,\n            offset: {\n                left: docCoords.left - currentRegion.left,\n                top: docCoords.top - currentRegion.top\n            }\n        };\n    };\n\n    this.setManifest = function (manifest, isIIIF, loadOptions)\n    {\n        setManifest(manifest, isIIIF, loadOptions || {});\n    };\n\n    /**\n     * Set the current page to the given index, firing VisiblePageDidChange\n     *\n     * @param pageIndex\n     */\n    this.setCurrentPage = function (pageIndex)\n    {\n        if (viewerState.currentPageIndex !== pageIndex)\n        {\n            viewerState.currentPageIndex = pageIndex;\n            publish(\"VisiblePageDidChange\", pageIndex, this.getPageName(pageIndex));\n        }\n    };\n\n    this.getPageName = function (pageIndex)\n    {\n        return viewerState.manifest.pages[pageIndex].f;\n    };\n\n    this.reload = function (newOptions)\n    {\n        reloadViewer(newOptions);\n    };\n\n    this.zoom = function (zoomLevel, focalPoint)\n    {\n        return handleZoom(zoomLevel, focalPoint);\n    };\n\n    this.enableScrollable = function ()\n    {\n        if (!viewerState.isScrollable)\n        {\n            bindMouseEvents();\n            viewerState.options.enableKeyScroll = viewerState.initialKeyScroll;\n            viewerState.options.enableSpaceScroll = viewerState.initialSpaceScroll;\n            viewerState.viewportElement.style.overflow = 'auto';\n            viewerState.isScrollable = true;\n        }\n    };\n\n    this.disableScrollable = function ()\n    {\n        if (viewerState.isScrollable)\n        {\n            // block dragging/double-click zooming\n            if (viewerState.innerObject.hasClass('diva-dragger'))\n                viewerState.innerObject.unbind('mousedown');\n            viewerState.outerObject.unbind('dblclick');\n            viewerState.outerObject.unbind('contextmenu');\n\n            // disable all other scrolling actions\n            viewerState.viewportElement.style.overflow = 'hidden';\n\n            // block scrolling keys behavior, respecting initial scroll settings\n            viewerState.initialKeyScroll = settings.enableKeyScroll;\n            viewerState.initialSpaceScroll = settings.enableSpaceScroll;\n            viewerState.options.enableKeyScroll = false;\n            viewerState.options.enableSpaceScroll = false;\n\n            viewerState.isScrollable = false;\n        }\n    };\n\n    this.isValidOption = function (key, value)\n    {\n        return isValidOption(key, value);\n    };\n\n    this.showError = function (message)\n    {\n        // FIXME: Not totally sure it makes sense to always do that here\n        hideThrobber();\n\n        var errorElement = elt('div', elemAttrs('error'), [\n            elt('button', elemAttrs('error-close', {'aria-label': 'Close dialog'})),\n            elt('p',\n                elt('strong', 'Error')\n            ),\n            elt('div', message)\n        ]);\n\n        viewerState.outerObject.append(errorElement);\n\n        //bind dialog close button\n        $(settings.selector + 'error-close').on('click', function()\n        {\n            errorElement.parentNode.removeChild(errorElement);\n        });\n    };\n\n    this.getXOffset = function (pageIndex, xAnchor)\n    {\n        return getXOffset(pageIndex, xAnchor);\n    };\n\n    this.getYOffset = function (pageIndex, yAnchor)\n    {\n        return getYOffset(pageIndex, yAnchor);\n    };\n\n    this.publish = publish;\n\n    this.clear = function ()\n    {\n        clearViewer();\n    };\n\n    this.setPendingManifestRequest = function (pendingManifestRequest)\n    {\n        viewerState.pendingManifestRequest = pendingManifestRequest;\n    };\n\n    // Destroys this instance, tells plugins to do the same (for testing)\n    this.destroy = function ()\n    {\n        // Useful event to access elements in diva before they get destroyed. Used by the highlight plugin.\n        publish('ViewerWillTerminate', settings);\n\n        // Cancel any pending request retrieving a manifest\n        if (settings.pendingManifestRequest)\n            settings.pendingManifestRequest.abort();\n\n        // Removes the hide-scrollbar class from the body\n        $('body').removeClass('diva-hide-scrollbar');\n\n        // Empty the parent container and remove any diva-related data\n        settings.parentObject.parent().empty().removeData('diva');\n\n        // Remove any additional styling on the parent element\n        settings.parentObject.parent().removeAttr('style').removeAttr('class');\n\n        publish('ViewerDidTerminate', settings);\n\n        // Clear the Events cache\n        diva.Events.unsubscribeAll(settings.ID);\n    };\n\n    // Call the init function when this object is created.\n    init();\n}\n\ngenerateId.counter = 1;\n\nfunction generateId() {\n    return generateId.counter++;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/viewer-core.js\n// module id = 14\n// module chunks = 0","/* jshint unused: false */\n\nvar jQuery = require('jquery');\n\n/* istanbul ignore next This is a vendored dependency */\n/*\n * jQuery dragscrollable Plugin\n * version: 1.0 (25-Jun-2009)\n * Copyright (c) 2009 Miquel Herrera\n * http://plugins.jquery.com/project/Dragscrollable\n *\n * Dual licensed under the MIT and GPL licenses:\n *   http://www.opensource.org/licenses/mit-license.php\n *   http://www.gnu.org/licenses/gpl.html\n *\n */\n(function ($) { // secure $ jQuery alias\n\n    /**\n     * Adds the ability to manage elements scroll by dragging\n     * one or more of its descendant elements. Options parameter\n     * allow to specifically select which inner elements will\n     * respond to the drag events.\n     *\n     * options properties:\n     * ------------------------------------------------------------------------\n     *  dragSelector         | jquery selector to apply to each wrapped element\n     *                       | to find which will be the dragging elements.\n     *                       | Defaults to '>:first' which is the first child of\n     *                       | scrollable element\n     * ------------------------------------------------------------------------\n     *  acceptPropagatedEvent| Will the dragging element accept propagated\n     *                       | events? default is yes, a propagated mouse event\n     *                       | on a inner element will be accepted and processed.\n     *                       | If set to false, only events originated on the\n     *                       | draggable elements will be processed.\n     * ------------------------------------------------------------------------\n     *  preventDefault       | Prevents the event to propagate further effectivey\n     *                       | dissabling other default actions. Defaults to true\n     * ------------------------------------------------------------------------\n     *\n     *  usage examples:\n     *\n     *  To add the scroll by drag to the element id=viewport when dragging its\n     *  first child accepting any propagated events\n     *  $('#viewport').dragscrollable();\n     *\n     *  To add the scroll by drag ability to any element div of class viewport\n     *  when dragging its first descendant of class dragMe responding only to\n     *  evcents originated on the '.dragMe' elements.\n     *  $('div.viewport').dragscrollable({dragSelector:'.dragMe:first',\n *                                    acceptPropagatedEvent: false});\n     *\n     *  Notice that some 'viewports' could be nested within others but events\n     *  would not interfere as acceptPropagatedEvent is set to false.\n     *\n     */\n    $.fn.dragscrollable = function( options ){\n\n        var settings = $.extend(\n            {\n                dragSelector:'>:first',\n                acceptPropagatedEvent: true,\n                preventDefault: true\n            },options || {});\n\n\n        var dragscroll= {\n            mouseDownHandler : function(event) {\n                // mousedown, left click, check propagation\n                if (event.which!=1 ||\n                    (!event.data.acceptPropagatedEvent && event.target != this)){\n                    return false;\n                }\n\n                // Initial coordinates will be the last when dragging\n                event.data.lastCoord = {left: event.clientX, top: event.clientY};\n\n                $.event.add( document, \"mouseup\",\n                    dragscroll.mouseUpHandler, event.data );\n                $.event.add( document, \"mousemove\",\n                    dragscroll.mouseMoveHandler, event.data );\n                if (event.data.preventDefault) {\n                    event.preventDefault();\n                    return false;\n                }\n            },\n            mouseMoveHandler : function(event) { // User is dragging\n                // How much did the mouse move?\n                var delta = {left: (event.clientX - event.data.lastCoord.left),\n                    top: (event.clientY - event.data.lastCoord.top)};\n\n                // Set the scroll position relative to what ever the scroll is now\n                event.data.scrollable.scrollLeft(\n                    event.data.scrollable.scrollLeft() - delta.left);\n                event.data.scrollable.scrollTop(\n                    event.data.scrollable.scrollTop() - delta.top);\n\n                // Save where the cursor is\n                event.data.lastCoord={left: event.clientX, top: event.clientY};\n                if (event.data.preventDefault) {\n                    event.preventDefault();\n                    return false;\n                }\n\n            },\n            mouseUpHandler : function(event) { // Stop scrolling\n                $.event.remove( document, \"mousemove\", dragscroll.mouseMoveHandler);\n                $.event.remove( document, \"mouseup\", dragscroll.mouseUpHandler);\n                if (event.data.preventDefault) {\n                    event.preventDefault();\n                    return false;\n                }\n            }\n        };\n\n        // set up the initial events\n        this.each(function() {\n            // closure object data for each scrollable element\n            var data = {scrollable : $(this),\n                acceptPropagatedEvent : settings.acceptPropagatedEvent,\n                preventDefault : settings.preventDefault };\n            // Set mouse initiating event on the desired descendant\n            $(this).find(settings.dragSelector).\n            bind('mousedown', data, dragscroll.mouseDownHandler);\n        });\n    }; //end plugin dragscrollable\n\n})( jQuery ); // confine scope\n\n/* istanbul ignore next This is a vendored dependency */\n/**\n jQuery.kinetic v2.2.1\n Dave Taylor http://davetayls.me\n\n @license The MIT License (MIT)\n @preserve Copyright (c) 2012 Dave Taylor http://davetayls.me\n */\n(function ($){\n    'use strict';\n\n    var ACTIVE_CLASS = 'kinetic-active';\n\n    /**\n     * Provides requestAnimationFrame in a cross browser way.\n     * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n     */\n    if (!window.requestAnimationFrame){\n\n        window.requestAnimationFrame = ( function (){\n\n            return window.webkitRequestAnimationFrame ||\n                window.mozRequestAnimationFrame ||\n                window.oRequestAnimationFrame ||\n                window.msRequestAnimationFrame ||\n                function (/* function FrameRequestCallback */ callback, /* DOMElement Element */ element){\n                    window.setTimeout(callback, 1000 / 60);\n                };\n\n        }());\n\n    }\n\n    // add touch checker to jQuery.support\n    $.support = $.support || {};\n    $.extend($.support, {\n        touch: 'ontouchend' in document\n    });\n\n\n    // KINETIC CLASS DEFINITION\n    // ======================\n\n    var Kinetic = function (element, settings) {\n        this.settings = settings;\n        this.el       = element;\n        this.$el      = $(element);\n\n        this._initElements();\n\n        return this;\n    };\n\n    Kinetic.DATA_KEY = 'kinetic';\n    Kinetic.DEFAULTS = {\n        cursor: 'move',\n        decelerate: true,\n        triggerHardware: false,\n        threshold: 0,\n        y: true,\n        x: true,\n        slowdown: 0.9,\n        maxvelocity: 40,\n        throttleFPS: 60,\n        invert: false,\n        movingClass: {\n            up: 'kinetic-moving-up',\n            down: 'kinetic-moving-down',\n            left: 'kinetic-moving-left',\n            right: 'kinetic-moving-right'\n        },\n        deceleratingClass: {\n            up: 'kinetic-decelerating-up',\n            down: 'kinetic-decelerating-down',\n            left: 'kinetic-decelerating-left',\n            right: 'kinetic-decelerating-right'\n        }\n    };\n\n\n    // Public functions\n\n    Kinetic.prototype.start = function (options){\n        this.settings = $.extend(this.settings, options);\n        this.velocity = options.velocity || this.velocity;\n        this.velocityY = options.velocityY || this.velocityY;\n        this.settings.decelerate = false;\n        this._move();\n    };\n\n    Kinetic.prototype.end = function (){\n        this.settings.decelerate = true;\n    };\n\n    Kinetic.prototype.stop = function (){\n        this.velocity = 0;\n        this.velocityY = 0;\n        this.settings.decelerate = true;\n        if ($.isFunction(this.settings.stopped)){\n            this.settings.stopped.call(this);\n        }\n    };\n\n    Kinetic.prototype.detach = function (){\n        this._detachListeners();\n        this.$el\n            .removeClass(ACTIVE_CLASS)\n            .css('cursor', '');\n    };\n\n    Kinetic.prototype.attach = function (){\n        if (this.$el.hasClass(ACTIVE_CLASS)) {\n            return;\n        }\n        this._attachListeners(this.$el);\n        this.$el\n            .addClass(ACTIVE_CLASS)\n            .css('cursor', this.settings.cursor);\n    };\n\n\n    // Internal functions\n\n    Kinetic.prototype._initElements = function (){\n        this.$el.addClass(ACTIVE_CLASS);\n\n        $.extend(this, {\n            xpos: null,\n            prevXPos: false,\n            ypos: null,\n            prevYPos: false,\n            mouseDown: false,\n            throttleTimeout: 1000 / this.settings.throttleFPS,\n            lastMove: null,\n            elementFocused: null\n        });\n\n        this.velocity = 0;\n        this.velocityY = 0;\n\n        // make sure we reset everything when mouse up\n        $(document)\n            .mouseup($.proxy(this._resetMouse, this))\n            .click($.proxy(this._resetMouse, this));\n\n        this._initEvents();\n\n        this.$el.css('cursor', this.settings.cursor);\n\n        if (this.settings.triggerHardware){\n            this.$el.css({\n                '-webkit-transform': 'translate3d(0,0,0)',\n                '-webkit-perspective': '1000',\n                '-webkit-backface-visibility': 'hidden'\n            });\n        }\n    };\n\n    Kinetic.prototype._initEvents = function(){\n        var self = this;\n        this.settings.events = {\n            touchStart: function (e){\n                var touch;\n                if (self._useTarget(e.target, e)){\n                    touch = e.originalEvent.touches[0];\n                    self.threshold = self._threshold(e.target, e);\n                    self._start(touch.clientX, touch.clientY);\n                    e.stopPropagation();\n                }\n            },\n            touchMove: function (e){\n                var touch;\n                if (self.mouseDown){\n                    touch = e.originalEvent.touches[0];\n                    self._inputmove(touch.clientX, touch.clientY);\n                    if (e.preventDefault){\n                        e.preventDefault();\n                    }\n                }\n            },\n            inputDown: function (e){\n                if (self._useTarget(e.target, e)){\n                    self.threshold = self._threshold(e.target, e);\n                    self._start(e.clientX, e.clientY);\n                    self.elementFocused = e.target;\n                    if (e.target.nodeName === 'IMG'){\n                        e.preventDefault();\n                    }\n                    e.stopPropagation();\n                }\n            },\n            inputEnd: function (e){\n                if (self._useTarget(e.target, e)){\n                    self._end();\n                    self.elementFocused = null;\n                    if (e.preventDefault){\n                        e.preventDefault();\n                    }\n                }\n            },\n            inputMove: function (e){\n                if (self.mouseDown){\n                    self._inputmove(e.clientX, e.clientY);\n                    if (e.preventDefault){\n                        e.preventDefault();\n                    }\n                }\n            },\n            scroll: function (e){\n                if ($.isFunction(self.settings.moved)){\n                    self.settings.moved.call(self, self.settings);\n                }\n                if (e.preventDefault){\n                    e.preventDefault();\n                }\n            },\n            inputClick: function (e){\n                if (Math.abs(self.velocity) > 0){\n                    e.preventDefault();\n                    return false;\n                }\n            },\n            // prevent drag and drop images in ie\n            dragStart: function (e){\n                if (self._useTarget(e.target, e) && self.elementFocused){\n                    return false;\n                }\n            },\n            // prevent selection when dragging\n            selectStart: function (e){\n                if ($.isFunction(self.settings.selectStart)){\n                    return self.settings.selectStart.apply(self, arguments);\n                } else if (self._useTarget(e.target, e)) {\n                    return false;\n                }\n            }\n        };\n\n        this._attachListeners(this.$el, this.settings);\n\n    };\n\n    Kinetic.prototype._inputmove = function (clientX, clientY){\n        var $this = this.$el;\n        var el = this.el;\n\n        if (!this.lastMove || new Date() > new Date(this.lastMove.getTime() + this.throttleTimeout)){\n            this.lastMove = new Date();\n\n            if (this.mouseDown && (this.xpos || this.ypos)){\n                var movedX = (clientX - this.xpos);\n                var movedY = (clientY - this.ypos);\n                if (this.settings.invert) {\n                    movedX *= -1;\n                    movedY *= -1;\n                }\n                if(this.threshold > 0){\n                    var moved = Math.sqrt(movedX * movedX + movedY * movedY);\n                    if(this.threshold > moved){\n                        return;\n                    } else {\n                        this.threshold = 0;\n                    }\n                }\n                if (this.elementFocused){\n                    $(this.elementFocused).blur();\n                    this.elementFocused = null;\n                    $this.focus();\n                }\n\n                this.settings.decelerate = false;\n                this.velocity = this.velocityY = 0;\n\n                var scrollLeft = this.scrollLeft();\n                var scrollTop = this.scrollTop();\n\n                this.scrollLeft(this.settings.x ? scrollLeft - movedX : scrollLeft);\n                this.scrollTop(this.settings.y ? scrollTop - movedY : scrollTop);\n\n                this.prevXPos = this.xpos;\n                this.prevYPos = this.ypos;\n                this.xpos = clientX;\n                this.ypos = clientY;\n\n                this._calculateVelocities();\n                this._setMoveClasses(this.settings.movingClass);\n\n                if ($.isFunction(this.settings.moved)){\n                    this.settings.moved.call(this, this.settings);\n                }\n            }\n        }\n    };\n\n    Kinetic.prototype._calculateVelocities = function (){\n        this.velocity = this._capVelocity(this.prevXPos - this.xpos, this.settings.maxvelocity);\n        this.velocityY = this._capVelocity(this.prevYPos - this.ypos, this.settings.maxvelocity);\n        if (this.settings.invert) {\n            this.velocity *= -1;\n            this.velocityY *= -1;\n        }\n    };\n\n    Kinetic.prototype._end = function (){\n        if (this.xpos && this.prevXPos && this.settings.decelerate === false){\n            this.settings.decelerate = true;\n            this._calculateVelocities();\n            this.xpos = this.prevXPos = this.mouseDown = false;\n            this._move();\n        }\n    };\n\n    Kinetic.prototype._useTarget = function (target, event){\n        if ($.isFunction(this.settings.filterTarget)){\n            return this.settings.filterTarget.call(this, target, event) !== false;\n        }\n        return true;\n    };\n\n    Kinetic.prototype._threshold = function (target, event){\n        if ($.isFunction(this.settings.threshold)){\n            return this.settings.threshold.call(this, target, event);\n        }\n        return this.settings.threshold;\n    };\n\n    Kinetic.prototype._start = function (clientX, clientY){\n        this.mouseDown = true;\n        this.velocity = this.prevXPos = 0;\n        this.velocityY = this.prevYPos = 0;\n        this.xpos = clientX;\n        this.ypos = clientY;\n    };\n\n    Kinetic.prototype._resetMouse = function (){\n        this.xpos = false;\n        this.ypos = false;\n        this.mouseDown = false;\n    };\n\n    Kinetic.prototype._decelerateVelocity = function (velocity, slowdown){\n        return Math.floor(Math.abs(velocity)) === 0 ? 0 // is velocity less than 1?\n            : velocity * slowdown; // reduce slowdown\n    };\n\n    Kinetic.prototype._capVelocity = function (velocity, max){\n        var newVelocity = velocity;\n        if (velocity > 0){\n            if (velocity > max){\n                newVelocity = max;\n            }\n        } else {\n            if (velocity < (0 - max)){\n                newVelocity = (0 - max);\n            }\n        }\n        return newVelocity;\n    };\n\n    Kinetic.prototype._setMoveClasses = function (classes){\n        // FIXME: consider if we want to apply PL #44, this should not remove\n        // classes we have not defined on the element!\n        var settings = this.settings;\n        var $this = this.$el;\n\n        $this.removeClass(settings.movingClass.up)\n            .removeClass(settings.movingClass.down)\n            .removeClass(settings.movingClass.left)\n            .removeClass(settings.movingClass.right)\n            .removeClass(settings.deceleratingClass.up)\n            .removeClass(settings.deceleratingClass.down)\n            .removeClass(settings.deceleratingClass.left)\n            .removeClass(settings.deceleratingClass.right);\n\n        if (this.velocity > 0){\n            $this.addClass(classes.right);\n        }\n        if (this.velocity < 0){\n            $this.addClass(classes.left);\n        }\n        if (this.velocityY > 0){\n            $this.addClass(classes.down);\n        }\n        if (this.velocityY < 0){\n            $this.addClass(classes.up);\n        }\n\n    };\n\n\n    // do the actual kinetic movement\n    Kinetic.prototype._move = function (){\n        var $scroller = this._getScroller();\n        var scroller = $scroller[0];\n        var self = this;\n        var settings = self.settings;\n\n        // set scrollLeft\n        if (settings.x && scroller.scrollWidth > 0){\n            this.scrollLeft(this.scrollLeft() + this.velocity);\n            if (Math.abs(this.velocity) > 0){\n                this.velocity = settings.decelerate ?\n                    self._decelerateVelocity(this.velocity, settings.slowdown) : this.velocity;\n            }\n        } else {\n            this.velocity = 0;\n        }\n\n        // set scrollTop\n        if (settings.y && scroller.scrollHeight > 0){\n            this.scrollTop(this.scrollTop() + this.velocityY);\n            if (Math.abs(this.velocityY) > 0){\n                this.velocityY = settings.decelerate ?\n                    self._decelerateVelocity(this.velocityY, settings.slowdown) : this.velocityY;\n            }\n        } else {\n            this.velocityY = 0;\n        }\n\n        self._setMoveClasses(settings.deceleratingClass);\n\n        if ($.isFunction(settings.moved)){\n            settings.moved.call(this, settings);\n        }\n\n        if (Math.abs(this.velocity) > 0 || Math.abs(this.velocityY) > 0){\n            if (!this.moving) {\n                this.moving = true;\n                // tick for next movement\n                window.requestAnimationFrame(function (){\n                    self.moving = false;\n                    self._move();\n                });\n            }\n        } else {\n            self.stop();\n        }\n    };\n\n    // get current scroller to apply positioning to\n    Kinetic.prototype._getScroller = function(){\n        var $scroller = this.$el;\n        if (this.$el.is('body') || this.$el.is('html')){\n            $scroller = $(window);\n        }\n        return $scroller;\n    };\n\n    // set the scroll position\n    Kinetic.prototype.scrollLeft = function(left){\n        var $scroller = this._getScroller();\n        if (typeof left === 'number'){\n            $scroller.scrollLeft(left);\n            this.settings.scrollLeft = left;\n        } else {\n            return $scroller.scrollLeft();\n        }\n    };\n    Kinetic.prototype.scrollTop = function(top){\n        var $scroller = this._getScroller();\n        if (typeof top === 'number'){\n            $scroller.scrollTop(top);\n            this.settings.scrollTop = top;\n        } else {\n            return $scroller.scrollTop();\n        }\n    };\n\n    Kinetic.prototype._attachListeners = function (){\n        var $this = this.$el;\n        var settings = this.settings;\n\n        if ($.support.touch){\n            $this\n                .bind('touchstart', settings.events.touchStart)\n                .bind('touchend', settings.events.inputEnd)\n                .bind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .mousedown(settings.events.inputDown)\n            .mouseup(settings.events.inputEnd)\n            .mousemove(settings.events.inputMove);\n\n        $this\n            .click(settings.events.inputClick)\n            .scroll(settings.events.scroll)\n            .bind('selectstart', settings.events.selectStart)\n            .bind('dragstart', settings.events.dragStart);\n    };\n\n    Kinetic.prototype._detachListeners = function (){\n        var $this = this.$el;\n        var settings = this.settings;\n        if ($.support.touch){\n            $this\n                .unbind('touchstart', settings.events.touchStart)\n                .unbind('touchend', settings.events.inputEnd)\n                .unbind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .unbind('mousedown', settings.events.inputDown)\n            .unbind('mouseup', settings.events.inputEnd)\n            .unbind('mousemove', settings.events.inputMove);\n\n        $this\n            .unbind('click', settings.events.inputClick)\n            .unbind('scroll', settings.events.scroll)\n            .unbind('selectstart', settings.events.selectStart)\n            .unbind('dragstart', settings.events.dragStart);\n    };\n\n\n    // EXPOSE KINETIC CONSTRUCTOR\n    // ==========================\n    $.Kinetic = Kinetic;\n\n    // KINETIC PLUGIN DEFINITION\n    // =======================\n\n    $.fn.kinetic = function (option, callOptions) {\n        return this.each(function () {\n            var $this    = $(this);\n            var instance = $this.data(Kinetic.DATA_KEY);\n            var options  = $.extend({}, Kinetic.DEFAULTS, $this.data(), typeof option === 'object' && option);\n\n            if (!instance) {\n                $this.data(Kinetic.DATA_KEY, (instance = new Kinetic(this, options)));\n            }\n\n            if (typeof option === 'string') {\n                instance[option](callOptions);\n            }\n\n        });\n    };\n\n}(jQuery));\n\n/* istanbul ignore next\n    We should maybe be testing this, but realistically that would mean maintaining a real fork */\n\n// jQuery.kinetic core modifications for diva.js (compatible with jQuery.kinetic 2.2.1)\n// use jQuery.kinetic for touch handlers only since we are using dragscrollable for mouse handlers\n//    - (kinetic provides inertial scrolling [ease into stopped state on release] for touch events and dragscrollable\n//      allows non-inertial scrolling which we like for mice)\n\n(function($)\n{\n    $.Kinetic.prototype._attachListeners = function()\n    {\n        // attach only touch listeners\n        var $this = this.$el;\n        var settings = this.settings;\n\n        if ($.support.touch)\n        {\n            $this\n                .bind('touchstart', settings.events.touchStart)\n                .bind('touchend', settings.events.inputEnd)\n                .bind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .click(settings.events.inputClick)\n            .scroll(settings.events.scroll)\n            .bind('selectstart', settings.events.selectStart)\n            .bind('dragstart', settings.events.dragStart);\n    };\n\n    $.Kinetic.prototype._detachListeners = function()\n    {\n        // detach only touch listeners\n        var $this = this.$el;\n        var settings = this.settings;\n\n        if ($.support.touch)\n        {\n            $this\n                .unbind('touchstart', settings.events.touchStart)\n                .unbind('touchend', settings.events.inputEnd)\n                .unbind('touchmove', settings.events.touchMove);\n        }\n\n        $this\n            .unbind('click', settings.events.inputClick)\n            .unbind('scroll', settings.events.scroll)\n            .unbind('selectstart', settings.events.selectStart)\n            .unbind('dragstart', settings.events.dragStart);\n    };\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/utils/jquery-extensions.js\n// module id = 15\n// module chunks = 0","// From http://www.alexandre-gomes.com/?p=115, modified slightly\nmodule.exports = function getScrollbarWidth() {\n    var inner = document.createElement('p');\n    inner.style.width = '100%';\n    inner.style.height = '200px';\n\n    var outer = document.createElement('div');\n    outer.style.position = 'absolute';\n    outer.style.top = '0px';\n    outer.style.left = '0px';\n    outer.style.visibility = 'hidden';\n    outer.style.width = '200px';\n    outer.style.height = '150px';\n    outer.style.overflow = 'hidden';\n    outer.appendChild(inner);\n\n    document.body.appendChild(outer);\n\n    var w1 = inner.offsetWidth;\n    outer.style.overflow = 'scroll';\n    var w2 = inner.offsetWidth;\n    if (w1 == w2) {\n        w2 = outer.clientWidth; // for IE i think\n    }\n\n    document.body.removeChild(outer);\n    return w1 - w2;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/utils/get-scrollbar-width.js\n// module id = 16\n// module chunks = 0","module.exports = {\n    onDoubleClick: onDoubleClick,\n    onPinch: onPinch,\n    onDoubleTap: onDoubleTap\n};\n\nvar DOUBLE_CLICK_TIMEOUT = 500;\n\nvar DOUBLE_TAP_DISTANCE_THRESHOLD = 50;\nvar DOUBLE_TAP_TIMEOUT = 250;\n\nfunction onDoubleClick(elem, callback)\n{\n    elem.on('dblclick', function (event)\n    {\n        if (!event.ctrlKey)\n        {\n            callback(event, getRelativeOffset(event.currentTarget, event));\n        }\n    });\n\n    // Handle the control key for macs (in conjunction with double-clicking)\n    // FIXME: Does a click get handled with ctrl pressed on non-Macs?\n    var tracker = createDoubleEventTracker(DOUBLE_CLICK_TIMEOUT);\n\n    elem.on('contextmenu', function (event)\n    {\n        event.preventDefault();\n\n        if (event.ctrlKey)\n        {\n            if (tracker.isTriggered())\n            {\n                tracker.reset();\n                callback(event, getRelativeOffset(event.currentTarget, event));\n            }\n            else\n            {\n                tracker.trigger();\n            }\n        }\n    });\n}\n\nfunction onPinch(elem, callback)\n{\n    var startDistance = 0;\n\n    elem.on('touchstart', function(event)\n    {\n        // Prevent mouse event from firing\n        event.preventDefault();\n\n        if (event.originalEvent.touches.length === 2)\n        {\n            startDistance = distance(\n                event.originalEvent.touches[0].clientX,\n                event.originalEvent.touches[0].clientY,\n                event.originalEvent.touches[1].clientX,\n                event.originalEvent.touches[1].clientY\n            );\n        }\n    });\n\n    elem.on('touchmove', function(event)\n    {\n        // Prevent mouse event from firing\n        event.preventDefault();\n\n        if (event.originalEvent.touches.length === 2)\n        {\n            var touches = event.originalEvent.touches;\n\n            var moveDistance = distance(\n                touches[0].clientX,\n                touches[0].clientY,\n                touches[1].clientX,\n                touches[1].clientY\n            );\n\n            var zoomDelta = moveDistance - startDistance;\n\n            if (Math.abs(zoomDelta) > 0)\n            {\n                var touchCenter = {\n                    pageX: (touches[0].clientX + touches[1].clientX) / 2,\n                    pageY: (touches[0].clientY + touches[1].clientY) / 2\n                };\n\n                callback(event, getRelativeOffset(event.currentTarget, touchCenter), startDistance, moveDistance);\n            }\n        }\n    });\n}\n\nfunction onDoubleTap(elem, callback)\n{\n    var tracker = createDoubleEventTracker(DOUBLE_TAP_TIMEOUT);\n    var firstTap = null;\n\n    elem.on('touchend', function (event)\n    {\n        // Prevent mouse event from firing\n        event.preventDefault();\n\n        if (tracker.isTriggered())\n        {\n            tracker.reset();\n\n            // Doubletap has occurred\n            var secondTap = {\n                pageX: event.originalEvent.changedTouches[0].clientX,\n                pageY: event.originalEvent.changedTouches[0].clientY\n            };\n\n            // If first tap is close to second tap (prevents interference with scale event)\n            var tapDistance = distance(firstTap.pageX, firstTap.pageY, secondTap.pageX, secondTap.pageY);\n\n            // TODO: Could give something higher-level than secondTap to callback\n            if (tapDistance < DOUBLE_TAP_DISTANCE_THRESHOLD)\n                callback(event, getRelativeOffset(event.currentTarget, secondTap));\n\n            firstTap = null;\n        }\n        else\n        {\n            firstTap = {\n                pageX: event.originalEvent.changedTouches[0].clientX,\n                pageY: event.originalEvent.changedTouches[0].clientY\n            };\n\n            tracker.trigger();\n        }\n    });\n}\n\n// Pythagorean theorem to get the distance between two points (used for\n// calculating finger distance for double-tap and pinch-zoom)\nfunction distance(x1, y1, x2, y2)\n{\n    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n}\n\n// Utility to keep track of whether an event has been triggered twice\n// during a a given duration\nfunction createDoubleEventTracker(timeoutDuration)\n{\n    var triggered = false;\n    var timeoutId = null;\n\n    return {\n        trigger: function ()\n        {\n            triggered = true;\n            resetTimeout();\n            timeoutId = setTimeout(function ()\n            {\n                triggered = false;\n                timeoutId = null;\n            }, timeoutDuration);\n        },\n        isTriggered: function ()\n        {\n            return triggered;\n        },\n        reset: function ()\n        {\n            triggered = false;\n            resetTimeout();\n        }\n    };\n\n    function resetTimeout()\n    {\n        if (timeoutId !== null)\n        {\n            clearTimeout(timeoutId);\n            timeoutId = null;\n        }\n    }\n}\n\nfunction getRelativeOffset(elem, pageCoords)\n{\n    var bounds = elem.getBoundingClientRect();\n\n    return {\n        left: pageCoords.pageX - bounds.left,\n        top: pageCoords.pageY - bounds.top\n    };\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/gesture-events.js\n// module id = 17\n// module chunks = 0","var maxBy = require('lodash.maxby');\nvar PageToolsOverlay = require('./page-tools-overlay');\n\nmodule.exports = DocumentHandler;\n\nfunction DocumentHandler(viewerCore)\n{\n    this._viewerCore = viewerCore;\n    this._viewerState = viewerCore.getInternalState();\n    this._overlays = [];\n\n    if (viewerCore.getPageTools().length)\n    {\n        var numPages = viewerCore.getSettings().numPages;\n\n        for (var i=0; i < numPages; i++)\n        {\n            var overlay = new PageToolsOverlay(i, viewerCore);\n            this._overlays.push(overlay);\n            viewerCore.addPageOverlay(overlay);\n        }\n    }\n}\n\n// USER EVENTS\nDocumentHandler.prototype.onDoubleClick = function (event, coords)\n{\n    var settings = this._viewerCore.getSettings();\n    var newZoomLevel = event.ctrlKey ? settings.zoomLevel - 1 : settings.zoomLevel + 1;\n\n    var position = this._viewerCore.getPagePositionAtViewportOffset(coords);\n\n    this._viewerCore.zoom(newZoomLevel, position);\n};\n\nDocumentHandler.prototype.onPinch = function (event, coords, startDistance, endDistance)\n{\n    // FIXME: Do this check in a way which is less spaghetti code-y\n    var viewerState = this._viewerCore.getInternalState();\n    var settings = this._viewerCore.getSettings();\n\n    var newZoomLevel = Math.log(Math.pow(2, settings.zoomLevel) * endDistance / (startDistance * Math.log(2))) / Math.log(2);\n    newZoomLevel = Math.max(settings.minZoomLevel, newZoomLevel);\n    newZoomLevel = Math.min(settings.maxZoomLevel, newZoomLevel);\n\n    if (newZoomLevel === settings.zoomLevel)\n        return;\n\n    var position = this._viewerCore.getPagePositionAtViewportOffset(coords);\n\n    var layout = this._viewerCore.getCurrentLayout();\n    var centerOffset = layout.getPageToViewportCenterOffset(position.anchorPage, viewerState.viewport);\n    var scaleRatio = 1 / Math.pow(2, settings.zoomLevel - newZoomLevel);\n\n    this._viewerCore.reload({\n        zoomLevel: newZoomLevel,\n        goDirectlyTo: position.anchorPage,\n        horizontalOffset: (centerOffset.x - position.offset.left) + position.offset.left * scaleRatio,\n        verticalOffset: (centerOffset.y - position.offset.top) + position.offset.top * scaleRatio\n    });\n};\n\n// VIEW EVENTS\nDocumentHandler.prototype.onViewWillLoad = function ()\n{\n    this._viewerCore.publish('DocumentWillLoad', this._viewerCore.getSettings());\n};\n\nDocumentHandler.prototype.onViewDidLoad = function ()\n{\n    // TODO: Should only be necessary to handle changes on view update, not\n    // initial load\n    this._handleZoomLevelChange();\n\n    var currentPageIndex = this._viewerCore.getSettings().currentPageIndex;\n    var fileName = this._viewerCore.getPageName(currentPageIndex);\n    this._viewerCore.publish(\"DocumentDidLoad\", currentPageIndex, fileName);\n};\n\nDocumentHandler.prototype.onViewDidUpdate = function (renderedPages, targetPage)\n{\n    var currentPage = (targetPage !== null) ?\n        targetPage :\n        getCentermostPage(renderedPages, this._viewerCore.getCurrentLayout(), this._viewerCore.getViewport());\n\n    // Don't change the current page if there is no page in the viewport\n    // FIXME: Would be better to fall back to the page closest to the viewport\n    if (currentPage !== null)\n        this._viewerCore.setCurrentPage(currentPage);\n\n    if (targetPage !== null)\n        this._viewerCore.publish(\"ViewerDidJump\", targetPage);\n\n    this._handleZoomLevelChange();\n};\n\nDocumentHandler.prototype._handleZoomLevelChange = function ()\n{\n    var viewerState = this._viewerState;\n    var zoomLevel = viewerState.options.zoomLevel;\n\n    // If this is not the initial load, trigger the zoom events\n    if (viewerState.oldZoomLevel !== zoomLevel && viewerState.oldZoomLevel >= 0)\n    {\n        if (viewerState.oldZoomLevel < zoomLevel)\n        {\n            this._viewerCore.publish(\"ViewerDidZoomIn\", zoomLevel);\n        }\n        else\n        {\n            this._viewerCore.publish(\"ViewerDidZoomOut\", zoomLevel);\n        }\n\n        this._viewerCore.publish(\"ViewerDidZoom\", zoomLevel);\n    }\n\n    viewerState.oldZoomLevel = zoomLevel;\n};\n\nDocumentHandler.prototype.destroy = function ()\n{\n    this._overlays.forEach(function (overlay)\n    {\n        this._viewerCore.removePageOverlay(overlay);\n    }, this);\n};\n\nfunction getCentermostPage(renderedPages, layout, viewport)\n{\n    var centerY = viewport.top + (viewport.height / 2);\n    var centerX = viewport.left + (viewport.width / 2);\n\n    // Find the minimum distance from the viewport center to a page.\n    // Compute minus the squared distance from viewport center to the page's border.\n    // http://gamedev.stackexchange.com/questions/44483/how-do-i-calculate-distance-between-a-point-and-an-axis-aligned-rectangle\n    var centerPage = maxBy(renderedPages, function (pageIndex)\n    {\n        var dims = layout.getPageDimensions(pageIndex);\n        var imageOffset = layout.getPageOffset(pageIndex, {excludePadding: false});\n\n        var midX = imageOffset.left + (dims.height / 2);\n        var midY = imageOffset.top + (dims.width / 2);\n\n        var dx = Math.max(Math.abs(centerX - midX) - (dims.width / 2), 0);\n        var dy = Math.max(Math.abs(centerY - midY) - (dims.height / 2), 0);\n\n        return -(dx * dx + dy * dy);\n    });\n\n    return centerPage != null ? centerPage : null;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/document-handler.js\n// module id = 18\n// module chunks = 0","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used to compose bitmasks for comparison styles. */\nvar UNORDERED_COMPARE_FLAG = 1,\n    PARTIAL_COMPARE_FLAG = 2;\n\n/** Used as references for various `Number` constants. */\nvar INFINITY = 1 / 0,\n    MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    arrayTag = '[object Array]',\n    boolTag = '[object Boolean]',\n    dateTag = '[object Date]',\n    errorTag = '[object Error]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]',\n    mapTag = '[object Map]',\n    numberTag = '[object Number]',\n    objectTag = '[object Object]',\n    promiseTag = '[object Promise]',\n    regexpTag = '[object RegExp]',\n    setTag = '[object Set]',\n    stringTag = '[object String]',\n    symbolTag = '[object Symbol]',\n    weakMapTag = '[object WeakMap]';\n\nvar arrayBufferTag = '[object ArrayBuffer]',\n    dataViewTag = '[object DataView]',\n    float32Tag = '[object Float32Array]',\n    float64Tag = '[object Float64Array]',\n    int8Tag = '[object Int8Array]',\n    int16Tag = '[object Int16Array]',\n    int32Tag = '[object Int32Array]',\n    uint8Tag = '[object Uint8Array]',\n    uint8ClampedTag = '[object Uint8ClampedArray]',\n    uint16Tag = '[object Uint16Array]',\n    uint32Tag = '[object Uint32Array]';\n\n/** Used to match property names within property paths. */\nvar reIsDeepProp = /\\.|\\[(?:[^[\\]]*|([\"'])(?:(?!\\1)[^\\\\]|\\\\.)*?\\1)\\]/,\n    reIsPlainProp = /^\\w*$/,\n    reLeadingDot = /^\\./,\n    rePropName = /[^.[\\]]+|\\[(?:(-?\\d+(?:\\.\\d+)?)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))/g;\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to match backslashes in property paths. */\nvar reEscapeChar = /\\\\(\\\\)?/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Used to detect unsigned integer values. */\nvar reIsUint = /^(?:0|[1-9]\\d*)$/;\n\n/** Used to identify `toStringTag` values of typed arrays. */\nvar typedArrayTags = {};\ntypedArrayTags[float32Tag] = typedArrayTags[float64Tag] =\ntypedArrayTags[int8Tag] = typedArrayTags[int16Tag] =\ntypedArrayTags[int32Tag] = typedArrayTags[uint8Tag] =\ntypedArrayTags[uint8ClampedTag] = typedArrayTags[uint16Tag] =\ntypedArrayTags[uint32Tag] = true;\ntypedArrayTags[argsTag] = typedArrayTags[arrayTag] =\ntypedArrayTags[arrayBufferTag] = typedArrayTags[boolTag] =\ntypedArrayTags[dataViewTag] = typedArrayTags[dateTag] =\ntypedArrayTags[errorTag] = typedArrayTags[funcTag] =\ntypedArrayTags[mapTag] = typedArrayTags[numberTag] =\ntypedArrayTags[objectTag] = typedArrayTags[regexpTag] =\ntypedArrayTags[setTag] = typedArrayTags[stringTag] =\ntypedArrayTags[weakMapTag] = false;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Detect free variable `exports`. */\nvar freeExports = typeof exports == 'object' && exports && !exports.nodeType && exports;\n\n/** Detect free variable `module`. */\nvar freeModule = freeExports && typeof module == 'object' && module && !module.nodeType && module;\n\n/** Detect the popular CommonJS extension `module.exports`. */\nvar moduleExports = freeModule && freeModule.exports === freeExports;\n\n/** Detect free variable `process` from Node.js. */\nvar freeProcess = moduleExports && freeGlobal.process;\n\n/** Used to access faster Node.js helpers. */\nvar nodeUtil = (function() {\n  try {\n    return freeProcess && freeProcess.binding('util');\n  } catch (e) {}\n}());\n\n/* Node.js helper references. */\nvar nodeIsTypedArray = nodeUtil && nodeUtil.isTypedArray;\n\n/**\n * A specialized version of `_.some` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} predicate The function invoked per iteration.\n * @returns {boolean} Returns `true` if any element passes the predicate check,\n *  else `false`.\n */\nfunction arraySome(array, predicate) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (predicate(array[index], index, array)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * The base implementation of `_.property` without support for deep paths.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction baseProperty(key) {\n  return function(object) {\n    return object == null ? undefined : object[key];\n  };\n}\n\n/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/**\n * Converts `map` to its key-value pairs.\n *\n * @private\n * @param {Object} map The map to convert.\n * @returns {Array} Returns the key-value pairs.\n */\nfunction mapToArray(map) {\n  var index = -1,\n      result = Array(map.size);\n\n  map.forEach(function(value, key) {\n    result[++index] = [key, value];\n  });\n  return result;\n}\n\n/**\n * Creates a unary function that invokes `func` with its argument transformed.\n *\n * @private\n * @param {Function} func The function to wrap.\n * @param {Function} transform The argument transform.\n * @returns {Function} Returns the new function.\n */\nfunction overArg(func, transform) {\n  return function(arg) {\n    return func(transform(arg));\n  };\n}\n\n/**\n * Converts `set` to an array of its values.\n *\n * @private\n * @param {Object} set The set to convert.\n * @returns {Array} Returns the values.\n */\nfunction setToArray(set) {\n  var index = -1,\n      result = Array(set.size);\n\n  set.forEach(function(value) {\n    result[++index] = value;\n  });\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    Uint8Array = root.Uint8Array,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeKeys = overArg(Object.keys, Object);\n\n/* Built-in method references that are verified to be native. */\nvar DataView = getNative(root, 'DataView'),\n    Map = getNative(root, 'Map'),\n    Promise = getNative(root, 'Promise'),\n    Set = getNative(root, 'Set'),\n    WeakMap = getNative(root, 'WeakMap'),\n    nativeCreate = getNative(Object, 'create');\n\n/** Used to detect maps, sets, and weakmaps. */\nvar dataViewCtorString = toSource(DataView),\n    mapCtorString = toSource(Map),\n    promiseCtorString = toSource(Promise),\n    setCtorString = toSource(Set),\n    weakMapCtorString = toSource(WeakMap);\n\n/** Used to convert symbols to primitives and strings. */\nvar symbolProto = Symbol ? Symbol.prototype : undefined,\n    symbolValueOf = symbolProto ? symbolProto.valueOf : undefined,\n    symbolToString = symbolProto ? symbolProto.toString : undefined;\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values ? values.length : 0;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\n/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\n/**\n * Creates a stack cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Stack(entries) {\n  this.__data__ = new ListCache(entries);\n}\n\n/**\n * Removes all key-value entries from the stack.\n *\n * @private\n * @name clear\n * @memberOf Stack\n */\nfunction stackClear() {\n  this.__data__ = new ListCache;\n}\n\n/**\n * Removes `key` and its value from the stack.\n *\n * @private\n * @name delete\n * @memberOf Stack\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction stackDelete(key) {\n  return this.__data__['delete'](key);\n}\n\n/**\n * Gets the stack value for `key`.\n *\n * @private\n * @name get\n * @memberOf Stack\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction stackGet(key) {\n  return this.__data__.get(key);\n}\n\n/**\n * Checks if a stack value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Stack\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction stackHas(key) {\n  return this.__data__.has(key);\n}\n\n/**\n * Sets the stack `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Stack\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the stack cache instance.\n */\nfunction stackSet(key, value) {\n  var cache = this.__data__;\n  if (cache instanceof ListCache) {\n    var pairs = cache.__data__;\n    if (!Map || (pairs.length < LARGE_ARRAY_SIZE - 1)) {\n      pairs.push([key, value]);\n      return this;\n    }\n    cache = this.__data__ = new MapCache(pairs);\n  }\n  cache.set(key, value);\n  return this;\n}\n\n// Add methods to `Stack`.\nStack.prototype.clear = stackClear;\nStack.prototype['delete'] = stackDelete;\nStack.prototype.get = stackGet;\nStack.prototype.has = stackHas;\nStack.prototype.set = stackSet;\n\n/**\n * Creates an array of the enumerable property names of the array-like `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @param {boolean} inherited Specify returning inherited property names.\n * @returns {Array} Returns the array of property names.\n */\nfunction arrayLikeKeys(value, inherited) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  // Safari 9 makes `arguments.length` enumerable in strict mode.\n  var result = (isArray(value) || isArguments(value))\n    ? baseTimes(value.length, String)\n    : [];\n\n  var length = result.length,\n      skipIndexes = !!length;\n\n  for (var key in value) {\n    if ((inherited || hasOwnProperty.call(value, key)) &&\n        !(skipIndexes && (key == 'length' || isIndex(key, length)))) {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of methods like `_.max` and `_.min` which accepts a\n * `comparator` to determine the extremum value.\n *\n * @private\n * @param {Array} array The array to iterate over.\n * @param {Function} iteratee The iteratee invoked per iteration.\n * @param {Function} comparator The comparator used to compare values.\n * @returns {*} Returns the extremum value.\n */\nfunction baseExtremum(array, iteratee, comparator) {\n  var index = -1,\n      length = array.length;\n\n  while (++index < length) {\n    var value = array[index],\n        current = iteratee(value);\n\n    if (current != null && (computed === undefined\n          ? (current === current && !isSymbol(current))\n          : comparator(current, computed)\n        )) {\n      var computed = current,\n          result = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.get` without support for default values.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @returns {*} Returns the resolved value.\n */\nfunction baseGet(object, path) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var index = 0,\n      length = path.length;\n\n  while (object != null && index < length) {\n    object = object[toKey(path[index++])];\n  }\n  return (index && index == length) ? object : undefined;\n}\n\n/**\n * The base implementation of `getTag`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  return objectToString.call(value);\n}\n\n/**\n * The base implementation of `_.gt` which doesn't coerce arguments.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if `value` is greater than `other`,\n *  else `false`.\n */\nfunction baseGt(value, other) {\n  return value > other;\n}\n\n/**\n * The base implementation of `_.hasIn` without support for deep paths.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {Array|string} key The key to check.\n * @returns {boolean} Returns `true` if `key` exists, else `false`.\n */\nfunction baseHasIn(object, key) {\n  return object != null && key in Object(object);\n}\n\n/**\n * The base implementation of `_.isEqual` which supports partial comparisons\n * and tracks traversed objects.\n *\n * @private\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {boolean} [bitmask] The bitmask of comparison flags.\n *  The bitmask may be composed of the following flags:\n *     1 - Unordered comparison\n *     2 - Partial comparison\n * @param {Object} [stack] Tracks traversed `value` and `other` objects.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n */\nfunction baseIsEqual(value, other, customizer, bitmask, stack) {\n  if (value === other) {\n    return true;\n  }\n  if (value == null || other == null || (!isObject(value) && !isObjectLike(other))) {\n    return value !== value && other !== other;\n  }\n  return baseIsEqualDeep(value, other, baseIsEqual, customizer, bitmask, stack);\n}\n\n/**\n * A specialized version of `baseIsEqual` for arrays and objects which performs\n * deep comparisons and tracks traversed objects enabling objects with circular\n * references to be compared.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} [customizer] The function to customize comparisons.\n * @param {number} [bitmask] The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} [stack] Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction baseIsEqualDeep(object, other, equalFunc, customizer, bitmask, stack) {\n  var objIsArr = isArray(object),\n      othIsArr = isArray(other),\n      objTag = arrayTag,\n      othTag = arrayTag;\n\n  if (!objIsArr) {\n    objTag = getTag(object);\n    objTag = objTag == argsTag ? objectTag : objTag;\n  }\n  if (!othIsArr) {\n    othTag = getTag(other);\n    othTag = othTag == argsTag ? objectTag : othTag;\n  }\n  var objIsObj = objTag == objectTag && !isHostObject(object),\n      othIsObj = othTag == objectTag && !isHostObject(other),\n      isSameTag = objTag == othTag;\n\n  if (isSameTag && !objIsObj) {\n    stack || (stack = new Stack);\n    return (objIsArr || isTypedArray(object))\n      ? equalArrays(object, other, equalFunc, customizer, bitmask, stack)\n      : equalByTag(object, other, objTag, equalFunc, customizer, bitmask, stack);\n  }\n  if (!(bitmask & PARTIAL_COMPARE_FLAG)) {\n    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),\n        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');\n\n    if (objIsWrapped || othIsWrapped) {\n      var objUnwrapped = objIsWrapped ? object.value() : object,\n          othUnwrapped = othIsWrapped ? other.value() : other;\n\n      stack || (stack = new Stack);\n      return equalFunc(objUnwrapped, othUnwrapped, customizer, bitmask, stack);\n    }\n  }\n  if (!isSameTag) {\n    return false;\n  }\n  stack || (stack = new Stack);\n  return equalObjects(object, other, equalFunc, customizer, bitmask, stack);\n}\n\n/**\n * The base implementation of `_.isMatch` without support for iteratee shorthands.\n *\n * @private\n * @param {Object} object The object to inspect.\n * @param {Object} source The object of property values to match.\n * @param {Array} matchData The property names, values, and compare flags to match.\n * @param {Function} [customizer] The function to customize comparisons.\n * @returns {boolean} Returns `true` if `object` is a match, else `false`.\n */\nfunction baseIsMatch(object, source, matchData, customizer) {\n  var index = matchData.length,\n      length = index,\n      noCustomizer = !customizer;\n\n  if (object == null) {\n    return !length;\n  }\n  object = Object(object);\n  while (index--) {\n    var data = matchData[index];\n    if ((noCustomizer && data[2])\n          ? data[1] !== object[data[0]]\n          : !(data[0] in object)\n        ) {\n      return false;\n    }\n  }\n  while (++index < length) {\n    data = matchData[index];\n    var key = data[0],\n        objValue = object[key],\n        srcValue = data[1];\n\n    if (noCustomizer && data[2]) {\n      if (objValue === undefined && !(key in object)) {\n        return false;\n      }\n    } else {\n      var stack = new Stack;\n      if (customizer) {\n        var result = customizer(objValue, srcValue, key, object, source, stack);\n      }\n      if (!(result === undefined\n            ? baseIsEqual(srcValue, objValue, customizer, UNORDERED_COMPARE_FLAG | PARTIAL_COMPARE_FLAG, stack)\n            : result\n          )) {\n        return false;\n      }\n    }\n  }\n  return true;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.isTypedArray` without Node.js optimizations.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n */\nfunction baseIsTypedArray(value) {\n  return isObjectLike(value) &&\n    isLength(value.length) && !!typedArrayTags[objectToString.call(value)];\n}\n\n/**\n * The base implementation of `_.iteratee`.\n *\n * @private\n * @param {*} [value=_.identity] The value to convert to an iteratee.\n * @returns {Function} Returns the iteratee.\n */\nfunction baseIteratee(value) {\n  // Don't store the `typeof` result in a variable to avoid a JIT bug in Safari 9.\n  // See https://bugs.webkit.org/show_bug.cgi?id=156034 for more details.\n  if (typeof value == 'function') {\n    return value;\n  }\n  if (value == null) {\n    return identity;\n  }\n  if (typeof value == 'object') {\n    return isArray(value)\n      ? baseMatchesProperty(value[0], value[1])\n      : baseMatches(value);\n  }\n  return property(value);\n}\n\n/**\n * The base implementation of `_.keys` which doesn't treat sparse arrays as dense.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n */\nfunction baseKeys(object) {\n  if (!isPrototype(object)) {\n    return nativeKeys(object);\n  }\n  var result = [];\n  for (var key in Object(object)) {\n    if (hasOwnProperty.call(object, key) && key != 'constructor') {\n      result.push(key);\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.matches` which doesn't clone `source`.\n *\n * @private\n * @param {Object} source The object of property values to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatches(source) {\n  var matchData = getMatchData(source);\n  if (matchData.length == 1 && matchData[0][2]) {\n    return matchesStrictComparable(matchData[0][0], matchData[0][1]);\n  }\n  return function(object) {\n    return object === source || baseIsMatch(object, source, matchData);\n  };\n}\n\n/**\n * The base implementation of `_.matchesProperty` which doesn't clone `srcValue`.\n *\n * @private\n * @param {string} path The path of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction baseMatchesProperty(path, srcValue) {\n  if (isKey(path) && isStrictComparable(srcValue)) {\n    return matchesStrictComparable(toKey(path), srcValue);\n  }\n  return function(object) {\n    var objValue = get(object, path);\n    return (objValue === undefined && objValue === srcValue)\n      ? hasIn(object, path)\n      : baseIsEqual(srcValue, objValue, undefined, UNORDERED_COMPARE_FLAG | PARTIAL_COMPARE_FLAG);\n  };\n}\n\n/**\n * A specialized version of `baseProperty` which supports deep paths.\n *\n * @private\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n */\nfunction basePropertyDeep(path) {\n  return function(object) {\n    return baseGet(object, path);\n  };\n}\n\n/**\n * The base implementation of `_.toString` which doesn't convert nullish\n * values to empty strings.\n *\n * @private\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n */\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return symbolToString ? symbolToString.call(value) : '';\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Casts `value` to a path array if it's not one.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array} Returns the cast property path array.\n */\nfunction castPath(value) {\n  return isArray(value) ? value : stringToPath(value);\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for arrays with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Array} array The array to compare.\n * @param {Array} other The other array to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} customizer The function to customize comparisons.\n * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} stack Tracks traversed `array` and `other` objects.\n * @returns {boolean} Returns `true` if the arrays are equivalent, else `false`.\n */\nfunction equalArrays(array, other, equalFunc, customizer, bitmask, stack) {\n  var isPartial = bitmask & PARTIAL_COMPARE_FLAG,\n      arrLength = array.length,\n      othLength = other.length;\n\n  if (arrLength != othLength && !(isPartial && othLength > arrLength)) {\n    return false;\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(array);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var index = -1,\n      result = true,\n      seen = (bitmask & UNORDERED_COMPARE_FLAG) ? new SetCache : undefined;\n\n  stack.set(array, other);\n  stack.set(other, array);\n\n  // Ignore non-index properties.\n  while (++index < arrLength) {\n    var arrValue = array[index],\n        othValue = other[index];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, arrValue, index, other, array, stack)\n        : customizer(arrValue, othValue, index, array, other, stack);\n    }\n    if (compared !== undefined) {\n      if (compared) {\n        continue;\n      }\n      result = false;\n      break;\n    }\n    // Recursively compare arrays (susceptible to call stack limits).\n    if (seen) {\n      if (!arraySome(other, function(othValue, othIndex) {\n            if (!seen.has(othIndex) &&\n                (arrValue === othValue || equalFunc(arrValue, othValue, customizer, bitmask, stack))) {\n              return seen.add(othIndex);\n            }\n          })) {\n        result = false;\n        break;\n      }\n    } else if (!(\n          arrValue === othValue ||\n            equalFunc(arrValue, othValue, customizer, bitmask, stack)\n        )) {\n      result = false;\n      break;\n    }\n  }\n  stack['delete'](array);\n  stack['delete'](other);\n  return result;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for comparing objects of\n * the same `toStringTag`.\n *\n * **Note:** This function only supports comparing values with tags of\n * `Boolean`, `Date`, `Error`, `Number`, `RegExp`, or `String`.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {string} tag The `toStringTag` of the objects to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} customizer The function to customize comparisons.\n * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalByTag(object, other, tag, equalFunc, customizer, bitmask, stack) {\n  switch (tag) {\n    case dataViewTag:\n      if ((object.byteLength != other.byteLength) ||\n          (object.byteOffset != other.byteOffset)) {\n        return false;\n      }\n      object = object.buffer;\n      other = other.buffer;\n\n    case arrayBufferTag:\n      if ((object.byteLength != other.byteLength) ||\n          !equalFunc(new Uint8Array(object), new Uint8Array(other))) {\n        return false;\n      }\n      return true;\n\n    case boolTag:\n    case dateTag:\n    case numberTag:\n      // Coerce booleans to `1` or `0` and dates to milliseconds.\n      // Invalid dates are coerced to `NaN`.\n      return eq(+object, +other);\n\n    case errorTag:\n      return object.name == other.name && object.message == other.message;\n\n    case regexpTag:\n    case stringTag:\n      // Coerce regexes to strings and treat strings, primitives and objects,\n      // as equal. See http://www.ecma-international.org/ecma-262/7.0/#sec-regexp.prototype.tostring\n      // for more details.\n      return object == (other + '');\n\n    case mapTag:\n      var convert = mapToArray;\n\n    case setTag:\n      var isPartial = bitmask & PARTIAL_COMPARE_FLAG;\n      convert || (convert = setToArray);\n\n      if (object.size != other.size && !isPartial) {\n        return false;\n      }\n      // Assume cyclic values are equal.\n      var stacked = stack.get(object);\n      if (stacked) {\n        return stacked == other;\n      }\n      bitmask |= UNORDERED_COMPARE_FLAG;\n\n      // Recursively compare objects (susceptible to call stack limits).\n      stack.set(object, other);\n      var result = equalArrays(convert(object), convert(other), equalFunc, customizer, bitmask, stack);\n      stack['delete'](object);\n      return result;\n\n    case symbolTag:\n      if (symbolValueOf) {\n        return symbolValueOf.call(object) == symbolValueOf.call(other);\n      }\n  }\n  return false;\n}\n\n/**\n * A specialized version of `baseIsEqualDeep` for objects with support for\n * partial deep comparisons.\n *\n * @private\n * @param {Object} object The object to compare.\n * @param {Object} other The other object to compare.\n * @param {Function} equalFunc The function to determine equivalents of values.\n * @param {Function} customizer The function to customize comparisons.\n * @param {number} bitmask The bitmask of comparison flags. See `baseIsEqual`\n *  for more details.\n * @param {Object} stack Tracks traversed `object` and `other` objects.\n * @returns {boolean} Returns `true` if the objects are equivalent, else `false`.\n */\nfunction equalObjects(object, other, equalFunc, customizer, bitmask, stack) {\n  var isPartial = bitmask & PARTIAL_COMPARE_FLAG,\n      objProps = keys(object),\n      objLength = objProps.length,\n      othProps = keys(other),\n      othLength = othProps.length;\n\n  if (objLength != othLength && !isPartial) {\n    return false;\n  }\n  var index = objLength;\n  while (index--) {\n    var key = objProps[index];\n    if (!(isPartial ? key in other : hasOwnProperty.call(other, key))) {\n      return false;\n    }\n  }\n  // Assume cyclic values are equal.\n  var stacked = stack.get(object);\n  if (stacked && stack.get(other)) {\n    return stacked == other;\n  }\n  var result = true;\n  stack.set(object, other);\n  stack.set(other, object);\n\n  var skipCtor = isPartial;\n  while (++index < objLength) {\n    key = objProps[index];\n    var objValue = object[key],\n        othValue = other[key];\n\n    if (customizer) {\n      var compared = isPartial\n        ? customizer(othValue, objValue, key, other, object, stack)\n        : customizer(objValue, othValue, key, object, other, stack);\n    }\n    // Recursively compare objects (susceptible to call stack limits).\n    if (!(compared === undefined\n          ? (objValue === othValue || equalFunc(objValue, othValue, customizer, bitmask, stack))\n          : compared\n        )) {\n      result = false;\n      break;\n    }\n    skipCtor || (skipCtor = key == 'constructor');\n  }\n  if (result && !skipCtor) {\n    var objCtor = object.constructor,\n        othCtor = other.constructor;\n\n    // Non `Object` object instances with different constructors are not equal.\n    if (objCtor != othCtor &&\n        ('constructor' in object && 'constructor' in other) &&\n        !(typeof objCtor == 'function' && objCtor instanceof objCtor &&\n          typeof othCtor == 'function' && othCtor instanceof othCtor)) {\n      result = false;\n    }\n  }\n  stack['delete'](object);\n  stack['delete'](other);\n  return result;\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the property names, values, and compare flags of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @returns {Array} Returns the match data of `object`.\n */\nfunction getMatchData(object) {\n  var result = keys(object),\n      length = result.length;\n\n  while (length--) {\n    var key = result[length],\n        value = object[key];\n\n    result[length] = [key, value, isStrictComparable(value)];\n  }\n  return result;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Gets the `toStringTag` of `value`.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nvar getTag = baseGetTag;\n\n// Fallback for data views, maps, sets, and weak maps in IE 11,\n// for data views in Edge < 14, and promises in Node.js.\nif ((DataView && getTag(new DataView(new ArrayBuffer(1))) != dataViewTag) ||\n    (Map && getTag(new Map) != mapTag) ||\n    (Promise && getTag(Promise.resolve()) != promiseTag) ||\n    (Set && getTag(new Set) != setTag) ||\n    (WeakMap && getTag(new WeakMap) != weakMapTag)) {\n  getTag = function(value) {\n    var result = objectToString.call(value),\n        Ctor = result == objectTag ? value.constructor : undefined,\n        ctorString = Ctor ? toSource(Ctor) : undefined;\n\n    if (ctorString) {\n      switch (ctorString) {\n        case dataViewCtorString: return dataViewTag;\n        case mapCtorString: return mapTag;\n        case promiseCtorString: return promiseTag;\n        case setCtorString: return setTag;\n        case weakMapCtorString: return weakMapTag;\n      }\n    }\n    return result;\n  };\n}\n\n/**\n * Checks if `path` exists on `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @param {Function} hasFunc The function to check properties.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n */\nfunction hasPath(object, path, hasFunc) {\n  path = isKey(path, object) ? [path] : castPath(path);\n\n  var result,\n      index = -1,\n      length = path.length;\n\n  while (++index < length) {\n    var key = toKey(path[index]);\n    if (!(result = object != null && hasFunc(object, key))) {\n      break;\n    }\n    object = object[key];\n  }\n  if (result) {\n    return result;\n  }\n  var length = object ? object.length : 0;\n  return !!length && isLength(length) && isIndex(key, length) &&\n    (isArray(object) || isArguments(object));\n}\n\n/**\n * Checks if `value` is a valid array-like index.\n *\n * @private\n * @param {*} value The value to check.\n * @param {number} [length=MAX_SAFE_INTEGER] The upper bounds of a valid index.\n * @returns {boolean} Returns `true` if `value` is a valid index, else `false`.\n */\nfunction isIndex(value, length) {\n  length = length == null ? MAX_SAFE_INTEGER : length;\n  return !!length &&\n    (typeof value == 'number' || reIsUint.test(value)) &&\n    (value > -1 && value % 1 == 0 && value < length);\n}\n\n/**\n * Checks if `value` is a property name and not a property path.\n *\n * @private\n * @param {*} value The value to check.\n * @param {Object} [object] The object to query keys on.\n * @returns {boolean} Returns `true` if `value` is a property name, else `false`.\n */\nfunction isKey(value, object) {\n  if (isArray(value)) {\n    return false;\n  }\n  var type = typeof value;\n  if (type == 'number' || type == 'symbol' || type == 'boolean' ||\n      value == null || isSymbol(value)) {\n    return true;\n  }\n  return reIsPlainProp.test(value) || !reIsDeepProp.test(value) ||\n    (object != null && value in Object(object));\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Checks if `value` is likely a prototype object.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a prototype, else `false`.\n */\nfunction isPrototype(value) {\n  var Ctor = value && value.constructor,\n      proto = (typeof Ctor == 'function' && Ctor.prototype) || objectProto;\n\n  return value === proto;\n}\n\n/**\n * Checks if `value` is suitable for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` if suitable for strict\n *  equality comparisons, else `false`.\n */\nfunction isStrictComparable(value) {\n  return value === value && !isObject(value);\n}\n\n/**\n * A specialized version of `matchesProperty` for source values suitable\n * for strict equality comparisons, i.e. `===`.\n *\n * @private\n * @param {string} key The key of the property to get.\n * @param {*} srcValue The value to match.\n * @returns {Function} Returns the new spec function.\n */\nfunction matchesStrictComparable(key, srcValue) {\n  return function(object) {\n    if (object == null) {\n      return false;\n    }\n    return object[key] === srcValue &&\n      (srcValue !== undefined || (key in Object(object)));\n  };\n}\n\n/**\n * Converts `string` to a property path array.\n *\n * @private\n * @param {string} string The string to convert.\n * @returns {Array} Returns the property path array.\n */\nvar stringToPath = memoize(function(string) {\n  string = toString(string);\n\n  var result = [];\n  if (reLeadingDot.test(string)) {\n    result.push('');\n  }\n  string.replace(rePropName, function(match, number, quote, string) {\n    result.push(quote ? string.replace(reEscapeChar, '$1') : (number || match));\n  });\n  return result;\n});\n\n/**\n * Converts `value` to a string key if it's not a string or symbol.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {string|symbol} Returns the key.\n */\nfunction toKey(value) {\n  if (typeof value == 'string' || isSymbol(value)) {\n    return value;\n  }\n  var result = (value + '');\n  return (result == '0' && (1 / value) == -INFINITY) ? '-0' : result;\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates a function that memoizes the result of `func`. If `resolver` is\n * provided, it determines the cache key for storing the result based on the\n * arguments provided to the memoized function. By default, the first argument\n * provided to the memoized function is used as the map cache key. The `func`\n * is invoked with the `this` binding of the memoized function.\n *\n * **Note:** The cache is exposed as the `cache` property on the memoized\n * function. Its creation may be customized by replacing the `_.memoize.Cache`\n * constructor with one whose instances implement the\n * [`Map`](http://ecma-international.org/ecma-262/7.0/#sec-properties-of-the-map-prototype-object)\n * method interface of `delete`, `get`, `has`, and `set`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to have its output memoized.\n * @param {Function} [resolver] The function to resolve the cache key.\n * @returns {Function} Returns the new memoized function.\n * @example\n *\n * var object = { 'a': 1, 'b': 2 };\n * var other = { 'c': 3, 'd': 4 };\n *\n * var values = _.memoize(_.values);\n * values(object);\n * // => [1, 2]\n *\n * values(other);\n * // => [3, 4]\n *\n * object.a = 2;\n * values(object);\n * // => [1, 2]\n *\n * // Modify the result cache.\n * values.cache.set(object, ['a', 'b']);\n * values(object);\n * // => ['a', 'b']\n *\n * // Replace `_.memoize.Cache`.\n * _.memoize.Cache = WeakMap;\n */\nfunction memoize(func, resolver) {\n  if (typeof func != 'function' || (resolver && typeof resolver != 'function')) {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  var memoized = function() {\n    var args = arguments,\n        key = resolver ? resolver.apply(this, args) : args[0],\n        cache = memoized.cache;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    memoized.cache = cache.set(key, result);\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || MapCache);\n  return memoized;\n}\n\n// Assign cache to `_.memoize`.\nmemoize.Cache = MapCache;\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Checks if `value` is classified as a typed array.\n *\n * @static\n * @memberOf _\n * @since 3.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a typed array, else `false`.\n * @example\n *\n * _.isTypedArray(new Uint8Array);\n * // => true\n *\n * _.isTypedArray([]);\n * // => false\n */\nvar isTypedArray = nodeIsTypedArray ? baseUnary(nodeIsTypedArray) : baseIsTypedArray;\n\n/**\n * Converts `value` to a string. An empty string is returned for `null`\n * and `undefined` values. The sign of `-0` is preserved.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {string} Returns the string.\n * @example\n *\n * _.toString(null);\n * // => ''\n *\n * _.toString(-0);\n * // => '-0'\n *\n * _.toString([1, 2, 3]);\n * // => '1,2,3'\n */\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\n\n/**\n * Gets the value at `path` of `object`. If the resolved value is\n * `undefined`, the `defaultValue` is returned in its place.\n *\n * @static\n * @memberOf _\n * @since 3.7.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path of the property to get.\n * @param {*} [defaultValue] The value returned for `undefined` resolved values.\n * @returns {*} Returns the resolved value.\n * @example\n *\n * var object = { 'a': [{ 'b': { 'c': 3 } }] };\n *\n * _.get(object, 'a[0].b.c');\n * // => 3\n *\n * _.get(object, ['a', '0', 'b', 'c']);\n * // => 3\n *\n * _.get(object, 'a.b.c', 'default');\n * // => 'default'\n */\nfunction get(object, path, defaultValue) {\n  var result = object == null ? undefined : baseGet(object, path);\n  return result === undefined ? defaultValue : result;\n}\n\n/**\n * Checks if `path` is a direct or inherited property of `object`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Object\n * @param {Object} object The object to query.\n * @param {Array|string} path The path to check.\n * @returns {boolean} Returns `true` if `path` exists, else `false`.\n * @example\n *\n * var object = _.create({ 'a': _.create({ 'b': 2 }) });\n *\n * _.hasIn(object, 'a');\n * // => true\n *\n * _.hasIn(object, 'a.b');\n * // => true\n *\n * _.hasIn(object, ['a', 'b']);\n * // => true\n *\n * _.hasIn(object, 'b');\n * // => false\n */\nfunction hasIn(object, path) {\n  return object != null && hasPath(object, path, baseHasIn);\n}\n\n/**\n * Creates an array of the own enumerable property names of `object`.\n *\n * **Note:** Non-object values are coerced to objects. See the\n * [ES spec](http://ecma-international.org/ecma-262/7.0/#sec-object.keys)\n * for more details.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Object\n * @param {Object} object The object to query.\n * @returns {Array} Returns the array of property names.\n * @example\n *\n * function Foo() {\n *   this.a = 1;\n *   this.b = 2;\n * }\n *\n * Foo.prototype.c = 3;\n *\n * _.keys(new Foo);\n * // => ['a', 'b'] (iteration order is not guaranteed)\n *\n * _.keys('hi');\n * // => ['0', '1']\n */\nfunction keys(object) {\n  return isArrayLike(object) ? arrayLikeKeys(object) : baseKeys(object);\n}\n\n/**\n * This method returns the first argument it receives.\n *\n * @static\n * @since 0.1.0\n * @memberOf _\n * @category Util\n * @param {*} value Any value.\n * @returns {*} Returns `value`.\n * @example\n *\n * var object = { 'a': 1 };\n *\n * console.log(_.identity(object) === object);\n * // => true\n */\nfunction identity(value) {\n  return value;\n}\n\n/**\n * Creates a function that returns the value at `path` of a given object.\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Util\n * @param {Array|string} path The path of the property to get.\n * @returns {Function} Returns the new accessor function.\n * @example\n *\n * var objects = [\n *   { 'a': { 'b': 2 } },\n *   { 'a': { 'b': 1 } }\n * ];\n *\n * _.map(objects, _.property('a.b'));\n * // => [2, 1]\n *\n * _.map(_.sortBy(objects, _.property(['a', 'b'])), 'a.b');\n * // => [1, 2]\n */\nfunction property(path) {\n  return isKey(path) ? baseProperty(toKey(path)) : basePropertyDeep(path);\n}\n\n/**\n * This method is like `_.max` except that it accepts `iteratee` which is\n * invoked for each element in `array` to generate the criterion by which\n * the value is ranked. The iteratee is invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Math\n * @param {Array} array The array to iterate over.\n * @param {Function} [iteratee=_.identity] The iteratee invoked per element.\n * @returns {*} Returns the maximum value.\n * @example\n *\n * var objects = [{ 'n': 1 }, { 'n': 2 }];\n *\n * _.maxBy(objects, function(o) { return o.n; });\n * // => { 'n': 2 }\n *\n * // The `_.property` iteratee shorthand.\n * _.maxBy(objects, 'n');\n * // => { 'n': 2 }\n */\nfunction maxBy(array, iteratee) {\n  return (array && array.length)\n    ? baseExtremum(array, baseIteratee(iteratee, 2), baseGt)\n    : undefined;\n}\n\nmodule.exports = maxBy;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/lodash.maxby/index.js\n// module id = 19\n// module chunks = 0","module.exports = function(module) {\r\n\tif(!module.webpackPolyfill) {\r\n\t\tmodule.deprecate = function() {};\r\n\t\tmodule.paths = [];\r\n\t\t// module.parent = undefined by default\r\n\t\tmodule.children = [];\r\n\t\tmodule.webpackPolyfill = 1;\r\n\t}\r\n\treturn module;\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/module.js\n// module id = 20\n// module chunks = 0","var elt = require('./utils/elt');\n\nmodule.exports = PageToolsOverlay;\n\nfunction PageToolsOverlay(pageIndex, viewerCore)\n{\n    this.page = pageIndex;\n\n    this._viewerCore = viewerCore;\n\n    this._innerElement = viewerCore.getSettings().innerElement;\n    this._pageToolsElem = null;\n}\n\nPageToolsOverlay.prototype.mount = function ()\n{\n    if (this._pageToolsElem === null)\n    {\n        var buttons = this._initializePageToolButtons();\n\n        this._pageToolsElem = elt('div', {class: 'diva-page-tools-wrapper'},\n            elt('div', {class: 'diva-page-tools'}, buttons)\n        );\n    }\n\n    this.refresh();\n    this._innerElement.appendChild(this._pageToolsElem);\n};\n\nPageToolsOverlay.prototype._initializePageToolButtons = function ()\n{\n    // Callback parameters\n    var settings = this._viewerCore.getSettings();\n    var publicInstance = this._viewerCore.getPublicInstance();\n    var pageIndex = this.page;\n\n    return this._viewerCore.getPageTools().map(function (plugin)\n    {\n        // If the title text is undefined, use the name of the plugin\n        var titleText = plugin.titleText || plugin.pluginName[0].toUpperCase() + plugin.pluginName.substring(1) + \" plugin\";\n\n        var button = elt('div', {\n            class: 'diva-' + plugin.pluginName + '-icon',\n            title: titleText\n        });\n\n        button.addEventListener('click', function (event)\n        {\n            plugin.handleClick.call(this, event, settings, publicInstance, pageIndex);\n        }, false);\n\n        button.addEventListener('touchend', function (event)\n        {\n            // Prevent firing of emulated mouse events\n            event.preventDefault();\n\n            plugin.handleClick.call(this, event, settings, publicInstance, pageIndex);\n        }, false);\n\n        return button;\n    }, this);\n};\n\nPageToolsOverlay.prototype.unmount = function ()\n{\n    this._innerElement.removeChild(this._pageToolsElem);\n};\n\nPageToolsOverlay.prototype.refresh = function ()\n{\n    var pos = this._viewerCore.getPageRegion(this.page, {\n        excludePadding: true,\n        incorporateViewport: true\n    });\n\n    this._pageToolsElem.style.top = pos.top + 'px';\n    this._pageToolsElem.style.left = pos.left + 'px';\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-tools-overlay.js\n// module id = 21\n// module chunks = 0","var maxBy = require('lodash.maxby');\n\nmodule.exports = GridHandler;\n\nfunction GridHandler(viewerCore)\n{\n    this._viewerCore = viewerCore;\n}\n\n// USER EVENTS\nGridHandler.prototype.onDoubleClick = function (event, coords)\n{\n    var position = this._viewerCore.getPagePositionAtViewportOffset(coords);\n\n    var layout = this._viewerCore.getCurrentLayout();\n    var viewport = this._viewerCore.getViewport();\n    var pageToViewportCenterOffset = layout.getPageToViewportCenterOffset(position.anchorPage, viewport);\n\n    this._viewerCore.reload({\n        inGrid: false,\n        goDirectlyTo: position.anchorPage,\n        horizontalOffset: pageToViewportCenterOffset.x + position.offset.left,\n        verticalOffset: pageToViewportCenterOffset.y + position.offset.top\n    });\n};\n\nGridHandler.prototype.onPinch = function ()\n{\n    this._viewerCore.reload({ inGrid: false });\n};\n\n// VIEW EVENTS\nGridHandler.prototype.onViewWillLoad = function ()\n{\n    // FIXME(wabain): Should something happen here?\n    /* No-op */\n};\n\nGridHandler.prototype.onViewDidLoad = function ()\n{\n    // FIXME(wabain): Should something happen here?\n    /* No-op */\n};\n\nGridHandler.prototype.onViewDidUpdate = function (renderedPages, targetPage)\n{\n    if (targetPage !== null)\n    {\n        this._viewerCore.setCurrentPage(targetPage);\n        return;\n    }\n\n    // Select the current page from the first row if it is fully visible, or from\n    // the second row if it is fully visible, or from the centermost row otherwise.\n    // If the current page is in that group then don't change it. Otherwise, set\n    // the current page to the group's first page.\n\n    var layout = this._viewerCore.getCurrentLayout();\n    var groups = [];\n    renderedPages.forEach(function (pageIndex)\n    {\n        var group = layout.getPageInfo(pageIndex).group;\n        if (groups.length === 0 || group !== groups[groups.length - 1])\n            groups.push(group);\n    });\n\n    var viewport = this._viewerCore.getViewport();\n    var chosenGroup;\n\n    if (groups.length === 1 || groups[0].region.top >= viewport.top)\n        chosenGroup = groups[0];\n    else if (groups[1].region.bottom <= viewport.bottom)\n        chosenGroup = groups[1];\n    else\n        chosenGroup = getCentermostGroup(groups, viewport);\n\n    var currentPage = this._viewerCore.getSettings().currentPageIndex;\n\n    var hasCurrentPage = chosenGroup.pages.some(function (page)\n    {\n        return page.index === currentPage;\n    });\n\n    if (!hasCurrentPage)\n        this._viewerCore.setCurrentPage(chosenGroup.pages[0].index);\n};\n\nGridHandler.prototype.destroy = function ()\n{\n    // No-op\n};\n\nfunction getCentermostGroup(groups, viewport)\n{\n    var viewportMiddle = viewport.top + viewport.height / 2;\n\n    return maxBy(groups, function (group)\n    {\n        var groupMiddle = group.region.top + group.dimensions.height / 2;\n        return -Math.abs(viewportMiddle - groupMiddle);\n    });\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/grid-handler.js\n// module id = 22\n// module chunks = 0","module.exports = PageOverlayManager;\n\n/**\n * Manages a collection of page overlays, which implement a low-level\n * API for synchronizing HTML pages to the canvas. Each overlay needs\n * to implement the following protocol:\n *\n *   mount(): Called when a page is first rendered\n *   refresh(): Called when a page is moved\n *   unmount(): Called when a previously rendered page has stopped being rendered\n *\n * @class\n */\n\nfunction PageOverlayManager()\n{\n    this._pages = {};\n    this._renderedPages = [];\n    this._renderedPageMap = {};\n}\n\nPageOverlayManager.prototype.addOverlay = function (overlay)\n{\n    var overlaysByPage = this._pages[overlay.page] || (this._pages[overlay.page] = []);\n\n    overlaysByPage.push(overlay);\n\n    if (this._renderedPageMap[overlay.page])\n        overlay.mount();\n};\n\nPageOverlayManager.prototype.removeOverlay = function (overlay)\n{\n    var page = overlay.page;\n    var overlaysByPage = this._pages[page];\n\n    if (!overlaysByPage)\n        return;\n\n    var overlayIndex = overlaysByPage.indexOf(overlay);\n\n    if (overlayIndex === -1)\n        return;\n\n    if (this._renderedPageMap[page])\n        overlaysByPage[overlayIndex].unmount();\n\n    overlaysByPage.splice(overlayIndex, 1);\n\n    if (overlaysByPage.length === 0)\n        delete this._pages[page];\n};\n\nPageOverlayManager.prototype.updateOverlays = function (renderedPages)\n{\n    var previouslyRendered = this._renderedPages;\n    var newRenderedMap = {};\n\n    renderedPages.forEach(function (pageIndex)\n    {\n        newRenderedMap[pageIndex] = true;\n\n        if (!this._renderedPageMap[pageIndex])\n        {\n            this._renderedPageMap[pageIndex] = true;\n\n            this._invokeOnOverlays(pageIndex, function (overlay)\n            {\n                overlay.mount();\n            });\n        }\n    }, this);\n\n    previouslyRendered.forEach(function (pageIndex)\n    {\n        if (newRenderedMap[pageIndex])\n        {\n            this._invokeOnOverlays(pageIndex, function (overlay)\n            {\n                overlay.refresh();\n            });\n        }\n        else\n        {\n            delete this._renderedPageMap[pageIndex];\n\n            this._invokeOnOverlays(pageIndex, function (overlay)\n            {\n                overlay.unmount();\n            });\n        }\n    }, this);\n\n    this._renderedPages = renderedPages;\n};\n\nPageOverlayManager.prototype._invokeOnOverlays = function (pageIndex, func)\n{\n    var overlays = this._pages[pageIndex];\n    if (overlays)\n        overlays.forEach(func, this);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-overlay-manager.js\n// module id = 23\n// module chunks = 0","'use strict';\n\nvar debug = require('debug')('diva:Renderer');\nvar debugPaints = require('debug')('diva:Renderer:paints');\n\nvar elt = require('./utils/elt');\n\nvar CompositeImage = require('./composite-image');\nvar DocumentLayout = require('./document-layout');\nvar ImageCache = require('./image-cache');\nvar ImageRequestHandler = require('./image-request-handler');\nvar InterpolateAnimation = require('./interpolate-animation');\n\nvar REQUEST_DEBOUNCE_INTERVAL = 250;\n\n\nmodule.exports = Renderer;\n\nfunction Renderer(options, hooks)\n{\n    this._viewport = options.viewport;\n    this._outerElement = options.outerElement;\n    this._documentElement = options.innerElement;\n\n    this._hooks = hooks || {};\n\n    this._canvas = elt('canvas', { class: 'diva-viewer-canvas' });\n    this._ctx = this._canvas.getContext('2d');\n\n    this.layout = null;\n\n    this._sourceResolver = null;\n    this._renderedPages = null;\n    this._config = null;\n    this._zoomLevel = null;\n    this._compositeImages = null;\n    this._renderedTiles = null;\n    this._animation = null;\n\n    // FIXME(wabain): What level should this be maintained at?\n    // Diva global?\n    this._cache = new ImageCache();\n    this._pendingRequests = {};\n}\n\nRenderer.getCompatibilityErrors = function ()\n{\n    if (typeof HTMLCanvasElement !== 'undefined')\n        return null;\n\n    return [\n        'Your browser lacks support for the ', elt('pre', 'canvas'),\n        ' element. Please upgrade your browser.'\n    ];\n};\n\nRenderer.prototype.load = function (config, viewportPosition, sourceResolver)\n{\n    this._clearAnimation();\n\n    if (this._hooks.onViewWillLoad)\n        this._hooks.onViewWillLoad();\n\n    this._sourceResolver = sourceResolver;\n    this._config = config;\n    this._compositeImages = {};\n    this._setLayoutToZoomLevel(viewportPosition.zoomLevel);\n\n    // FIXME(wabain): Remove this when there's more confidence the check shouldn't be needed\n    if (!this.layout.getPageInfo(viewportPosition.anchorPage))\n        throw new Error('invalid page: ' + viewportPosition.anchorPage);\n\n    if (this._canvas.width !== this._viewport.width || this._canvas.height !== this._viewport.height)\n    {\n        debug('Canvas dimension change: (%s, %s) -> (%s, %s)', this._canvas.width, this._canvas.height,\n            this._viewport.width, this._viewport.height);\n\n        this._canvas.width = this._viewport.width;\n        this._canvas.height = this._viewport.height;\n    } else {\n        debug('Reload, no size change');\n    }\n\n    // FIXME: What hooks should be called here?\n    this.goto(viewportPosition.anchorPage, viewportPosition.verticalOffset, viewportPosition.horizontalOffset);\n\n    if (this._canvas.parentNode !== this._outerElement)\n        this._outerElement.insertBefore(this._canvas, this._outerElement.firstChild);\n\n    if (this._hooks.onViewDidLoad)\n        this._hooks.onViewDidLoad();\n};\n\nRenderer.prototype._setViewportPosition = function (viewportPosition)\n{\n    if (viewportPosition.zoomLevel !== this._zoomLevel)\n    {\n        if (this._zoomLevel === null)\n            throw new TypeError('The current view is not zoomable');\n        else if (viewportPosition.zoomLevel === null)\n            throw new TypeError('The current view requires a zoom level');\n\n        this._setLayoutToZoomLevel(viewportPosition.zoomLevel);\n    }\n\n    this._goto(viewportPosition.anchorPage, viewportPosition.verticalOffset, viewportPosition.horizontalOffset);\n};\n\nRenderer.prototype._setLayoutToZoomLevel = function (zoomLevel)\n{\n    this.layout = new DocumentLayout(this._config, zoomLevel);\n    this._zoomLevel = zoomLevel;\n\n    elt.setAttributes(this._documentElement, {\n        style: {\n            height: this.layout.dimensions.height + 'px',\n            width: this.layout.dimensions.width + 'px'\n        }\n    });\n\n    this._viewport.setInnerDimensions(this.layout.dimensions);\n};\n\nRenderer.prototype.adjust = function (direction)\n{\n    this._clearAnimation();\n\n    this._render(direction);\n\n    if (this._hooks.onViewDidUpdate)\n    {\n        this._hooks.onViewDidUpdate(this._renderedPages.slice(), null);\n    }\n};\n\n// FIXME(wabain): Remove the direction argument if it doesn't end up being needed.\nRenderer.prototype._render = function (direction) // jshint ignore:line\n{\n    var newRenderedPages = [];\n    this.layout.pageGroups.forEach(function (group)\n    {\n        if (!this._viewport.intersectsRegion(group.region))\n            return;\n\n        var visiblePages = group.pages\n            .filter(function (page)\n            {\n                return this.isPageVisible(page.index);\n            }, this)\n            .map(function (page)\n            {\n                return page.index;\n            });\n\n        newRenderedPages.push.apply(newRenderedPages, visiblePages);\n    }, this);\n\n    this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);\n    this._paintOutline(newRenderedPages);\n\n    newRenderedPages.forEach(function (pageIndex)\n    {\n        if (!this._compositeImages[pageIndex])\n        {\n            var page = this.layout.getPageInfo(pageIndex);\n            var zoomLevels = this._sourceResolver.getAllZoomLevelsForPage(page);\n            var composite = new CompositeImage(zoomLevels);\n            composite.updateFromCache(this._cache);\n            this._compositeImages[pageIndex] = composite;\n        }\n    }, this);\n\n    this._initiateTileRequests(newRenderedPages);\n\n    var changes = findChanges(this._renderedPages || [], newRenderedPages);\n\n    changes.removed.forEach(function (pageIndex)\n    {\n        delete this._compositeImages[pageIndex];\n    }, this);\n\n    this._renderedPages = newRenderedPages;\n    this._paint();\n\n    if (this._hooks.onPageWillLoad)\n    {\n        changes.added.forEach(function (pageIndex)\n        {\n            this._hooks.onPageWillLoad(pageIndex);\n        }, this);\n    }\n};\n\nRenderer.prototype._paint = function ()\n{\n    debug('Repainting');\n\n    var renderedTiles = [];\n\n    this._renderedPages.forEach(function (pageIndex)\n    {\n        this._compositeImages[pageIndex].getTiles(this._zoomLevel).forEach(function (source)\n        {\n            var scaled = getScaledTileRecord(source, this._zoomLevel);\n\n            if (this._isTileVisible(pageIndex, scaled))\n            {\n                renderedTiles.push(source.url);\n                this._drawTile(pageIndex, scaled, this._cache.get(source.url));\n            }\n        }, this);\n    }, this);\n\n    var cache = this._cache;\n\n    var changes = findChanges(this._renderedTiles || [], renderedTiles);\n\n    changes.added.forEach(function (url)\n    {\n        cache.acquire(url);\n    });\n\n    changes.removed.forEach(function (url)\n    {\n        cache.release(url);\n    });\n\n    if (changes.removed)\n    {\n        // FIXME: Should only need to update the composite images\n        // for which tiles were removed\n        this._renderedPages.forEach(function (pageIndex)\n        {\n            this._compositeImages[pageIndex].updateFromCache(this._cache);\n        }, this);\n    }\n\n    this._renderedTiles = renderedTiles;\n};\n\n// Paint a page outline while the tiles are loading.\nRenderer.prototype._paintOutline = function (pages)\n{\n    pages.forEach(function (pageIndex)\n    {\n        var pageInfo = this.layout.getPageInfo(pageIndex);\n        var pageOffset = this._getImageOffset(pageIndex);\n\n        // Ensure the document is drawn to the center of the viewport\n        var viewportPaddingX = Math.max(0, (this._viewport.width - this.layout.dimensions.width) / 2);\n        var viewportPaddingY = Math.max(0, (this._viewport.height - this.layout.dimensions.height) / 2);\n\n        var viewportOffsetX = pageOffset.left - this._viewport.left + viewportPaddingX;\n        var viewportOffsetY = pageOffset.top - this._viewport.top + viewportPaddingY;\n\n        var destXOffset = viewportOffsetX < 0 ? -viewportOffsetX : 0;\n        var destYOffset = viewportOffsetY < 0 ? -viewportOffsetY : 0;\n\n        var canvasX = Math.max(0, viewportOffsetX);\n        var canvasY = Math.max(0, viewportOffsetY);\n\n        var destWidth = pageInfo.dimensions.width - destXOffset;\n        var destHeight = pageInfo.dimensions.height - destYOffset;\n\n        this._ctx.strokeStyle = '#AAA';\n        // In order to get a 1px wide line using strokes, we need to start at a 'half pixel'\n        this._ctx.strokeRect(canvasX + 0.5, canvasY + 0.5, destWidth, destHeight);\n    }, this);\n};\n\n// This method should be sent all visible pages at once because it will initiate\n// all image requests and cancel any remaining image requests. In the case that\n// a request is ongoing and the tile is still visible in the viewport, the old request\n// is kept active instead of restarting it. The image requests are given a timeout\n// before loading in order to debounce them and have a small reaction time\n// to cancel them and avoid useless requests.\nRenderer.prototype._initiateTileRequests = function(pages)\n{\n    // Only requests in this object are kept alive, since all others are not visible in the viewport\n    var newPendingRequests = {};\n\n    // Used later as a closure to initiate the image requests with the right source and pageIndex\n    var initiateRequest = function (source, pageIndex)\n    {\n        var composite = this._compositeImages[pageIndex];\n\n        newPendingRequests[source.url] = new ImageRequestHandler({\n            url: source.url,\n            timeoutTime: REQUEST_DEBOUNCE_INTERVAL,\n            load: function (img)\n            {\n                delete this._pendingRequests[source.url];\n                this._cache.put(source.url, img);\n\n                // Awkward way to check for updates\n                if (composite === this._compositeImages[pageIndex])\n                {\n                    composite.updateWithLoadedUrls([source.url]);\n\n                    if (this._isTileForSourceVisible(pageIndex, source))\n                        this._paint();\n                    else\n                        debugPaints('Page %s, tile %s no longer visible on image load', pageIndex, source.url);\n                }\n            }.bind(this),\n            error: function ()\n            {\n                // TODO: Could make a limited number of retries, etc.\n                delete this._pendingRequests[source.url];\n            }.bind(this)\n        });\n    }.bind(this);\n\n    for (var i = 0; i < pages.length; i++)\n    {\n        var pageIndex = pages[i];\n        var tiles = this._sourceResolver.getBestZoomLevelForPage(this.layout.getPageInfo(pageIndex)).tiles;\n\n        for (var j = 0; j < tiles.length; j++)\n        {\n            var source = tiles[j];\n            if (this._cache.has(source.url) || !this._isTileForSourceVisible(pageIndex, source))\n                continue;\n\n            // Don't create a new request if the tile is already being loaded\n            if (this._pendingRequests[source.url])\n            {\n                newPendingRequests[source.url] = this._pendingRequests[source.url];\n                delete this._pendingRequests[source.url];\n                continue;\n            }\n\n            // Use a closure since the load and error methods are going to be called later and\n            // we need to keep the right reference to the source and the page index\n            initiateRequest(source, pageIndex);\n        }\n    }\n\n    for (var url in this._pendingRequests)\n        this._pendingRequests[url].abort();\n    this._pendingRequests = newPendingRequests;\n};\n\nRenderer.prototype._drawTile = function (pageIndex, scaledTile, img)\n{\n    var tileOffset = this._getTileToDocumentOffset(pageIndex, scaledTile);\n\n    // Ensure the document is drawn to the center of the viewport\n    var viewportPaddingX = Math.max(0, (this._viewport.width - this.layout.dimensions.width) / 2);\n    var viewportPaddingY = Math.max(0, (this._viewport.height - this.layout.dimensions.height) / 2);\n\n    var viewportOffsetX = tileOffset.left - this._viewport.left + viewportPaddingX;\n    var viewportOffsetY = tileOffset.top - this._viewport.top + viewportPaddingY;\n\n    var destXOffset = viewportOffsetX < 0 ? -viewportOffsetX : 0;\n    var destYOffset = viewportOffsetY < 0 ? -viewportOffsetY : 0;\n\n    var sourceXOffset = destXOffset / scaledTile.scaleRatio;\n    var sourceYOffset = destYOffset / scaledTile.scaleRatio;\n\n    var canvasX = Math.max(0, viewportOffsetX);\n    var canvasY = Math.max(0, viewportOffsetY);\n\n    // Ensure that the specified dimensions are no greater than the actual\n    // size of the image. Safari won't display the tile if they are.\n    var destWidth = Math.min(scaledTile.dimensions.width, img.width * scaledTile.scaleRatio) - destXOffset;\n    var destHeight = Math.min(scaledTile.dimensions.height, img.height * scaledTile.scaleRatio) - destYOffset;\n\n    var sourceWidth = destWidth / scaledTile.scaleRatio;\n    var sourceHeight = destHeight / scaledTile.scaleRatio;\n\n    if (debugPaints.enabled) {\n        debugPaints('Drawing page %s, tile %sx (%s, %s) from %s, %s to viewport at %s, %s, scale %s%%',\n            pageIndex,\n            scaledTile.sourceZoomLevel, scaledTile.row, scaledTile.col,\n            sourceXOffset, sourceYOffset,\n            canvasX, canvasY,\n            Math.round(scaledTile.scaleRatio * 100));\n    }\n\n    this._ctx.drawImage(\n        img,\n        sourceXOffset, sourceYOffset,\n        sourceWidth, sourceHeight,\n        canvasX, canvasY,\n        destWidth, destHeight);\n};\n\nRenderer.prototype._isTileForSourceVisible = function (pageIndex, tileSource)\n{\n    return this._isTileVisible(pageIndex, getScaledTileRecord(tileSource, this._zoomLevel));\n};\n\nRenderer.prototype._isTileVisible = function (pageIndex, scaledTile)\n{\n    var tileOffset = this._getTileToDocumentOffset(pageIndex, scaledTile);\n\n    // FIXME(wabain): This check is insufficient during a zoom transition\n    return this._viewport.intersectsRegion({\n        top: tileOffset.top,\n        bottom: tileOffset.top + scaledTile.dimensions.height,\n        left: tileOffset.left,\n        right: tileOffset.left + scaledTile.dimensions.width\n    });\n};\n\nRenderer.prototype._getTileToDocumentOffset = function (pageIndex, scaledTile)\n{\n    var imageOffset = this._getImageOffset(pageIndex);\n\n    return {\n        top: imageOffset.top + scaledTile.offset.top,\n        left: imageOffset.left + scaledTile.offset.left\n    };\n};\n\nRenderer.prototype._getImageOffset = function (pageIndex)\n{\n    return this.layout.getPageOffset(pageIndex, {excludePadding: true});\n};\n\n// TODO: Update signature\nRenderer.prototype.goto = function (pageIndex, verticalOffset, horizontalOffset)\n{\n    this._clearAnimation();\n    this._goto(pageIndex, verticalOffset, horizontalOffset);\n    if (this._hooks.onViewDidUpdate)\n    {\n        this._hooks.onViewDidUpdate(this._renderedPages.slice(), pageIndex);\n    }\n};\n\nRenderer.prototype._goto = function (pageIndex, verticalOffset, horizontalOffset)\n{\n    // FIXME(wabain): Move this logic to the viewer\n    var pageOffset = this.layout.getPageOffset(pageIndex);\n\n    var desiredVerticalCenter = pageOffset.top + verticalOffset;\n    var top = desiredVerticalCenter - parseInt(this._viewport.height / 2, 10);\n\n    var desiredHorizontalCenter = pageOffset.left + horizontalOffset;\n    var left = desiredHorizontalCenter - parseInt(this._viewport.width / 2, 10);\n\n    this._viewport.top = top;\n    this._viewport.left = left;\n\n    this._render(0);\n};\n\nRenderer.prototype.transitionViewportPosition = function (options)\n{\n    this._clearAnimation();\n\n    var getPosition = options.getPosition;\n    var self = this;\n\n    var onViewDidTransition = this._hooks.onViewDidTransition;\n\n    this._animation = InterpolateAnimation.animate({\n        duration: options.duration,\n        parameters: options.parameters,\n        onUpdate: function (values)\n        {\n            // TODO: Do image preloading, work with that\n            self._setViewportPosition(getPosition(values));\n\n            if (onViewDidTransition)\n                onViewDidTransition();\n        },\n        onEnd: function (info)\n        {\n            if (options.onEnd)\n                options.onEnd(info);\n\n            if (self._hooks.onViewDidUpdate && !info.interrupted)\n            {\n                self._hooks.onViewDidUpdate(self._renderedPages.slice(), null);\n            }\n        }\n    });\n};\n\nRenderer.prototype._clearAnimation = function ()\n{\n    if (this._animation)\n    {\n        this._animation.cancel();\n        this._animation = null;\n    }\n};\n\nRenderer.prototype.preload = function ()\n{\n    // TODO\n};\n\nRenderer.prototype.isPageVisible = function (pageIndex)\n{\n    if (!this.layout)\n        return false;\n\n    var page = this.layout.getPageInfo(pageIndex);\n\n    if (!page)\n        return false;\n\n    return this._viewport.intersectsRegion(this.layout.getPageRegion(pageIndex));\n};\n\nRenderer.prototype.getRenderedPages = function ()\n{\n    return this._renderedPages.slice();\n};\n\nRenderer.prototype.destroy = function ()\n{\n    this._clearAnimation();\n\n    // FIXME(wabain): I don't know if we should actually do this\n    Object.keys(this._pendingRequests).forEach(function (req)\n    {\n        var handler = this._pendingRequests[req];\n        delete this._pendingRequests[req];\n\n        handler.abort();\n    }, this);\n\n    this._canvas.parentNode.removeChild(this._canvas);\n};\n\nfunction getScaledTileRecord(source, scaleFactor)\n{\n    var scaleRatio;\n\n    if (scaleFactor === null)\n        scaleRatio = 1;\n    else\n        scaleRatio = Math.pow(2, scaleFactor - source.zoomLevel);\n\n    return {\n        sourceZoomLevel: source.zoomLevel,\n        scaleRatio: scaleRatio,\n        row: source.row,\n        col: source.col,\n        dimensions: {\n            width: source.dimensions.width * scaleRatio,\n            height: source.dimensions.height * scaleRatio\n        },\n        offset: {\n            left: source.offset.left * scaleRatio,\n            top: source.offset.top * scaleRatio\n        },\n        url: source.url\n    };\n}\n\nfunction findChanges(oldArray, newArray)\n{\n    if (oldArray === newArray)\n    {\n        return {\n            added: [],\n            removed: []\n        };\n    }\n\n    var removed = oldArray.filter(function (oldEntry)\n    {\n        return newArray.indexOf(oldEntry) === -1;\n    });\n\n    var added = newArray.filter(function (newEntry)\n    {\n        return oldArray.indexOf(newEntry) === -1;\n    });\n\n    return {\n        added: added,\n        removed: removed\n    };\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/renderer.js\n// module id = 24\n// module chunks = 0","/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = 'undefined' != typeof chrome\n               && 'undefined' != typeof chrome.storage\n                  ? chrome.storage.local\n                  : localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  'lightseagreen',\n  'forestgreen',\n  'goldenrod',\n  'dodgerblue',\n  'darkorchid',\n  'crimson'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // NB: In an Electron preload script, document will be defined but not fully\n  // initialized. Since we know we're in Chrome, we'll just detect this case\n  // explicitly\n  if (typeof window !== 'undefined' && window && typeof window.process !== 'undefined' && window.process.type === 'renderer') {\n    return true;\n  }\n\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  // document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n  return (typeof document !== 'undefined' && document && 'WebkitAppearance' in document.documentElement.style) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (typeof window !== 'undefined' && window && window.console && (console.firebug || (console.exception && console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (typeof navigator !== 'undefined' && navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n    // double check webkit in userAgent just in case we are in a worker\n    (typeof navigator !== 'undefined' && navigator && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  try {\n    return JSON.stringify(v);\n  } catch (err) {\n    return '[UnexpectedJSONParseError]: ' + err.message;\n  }\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return;\n\n  var c = 'color: ' + this.color;\n  args.splice(1, 0, c, 'color: inherit')\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-zA-Z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // this hackery is required for IE8/9, where\n  // the `console.log` function doesn't have 'apply'\n  return 'object' === typeof console\n    && console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      exports.storage.removeItem('debug');\n    } else {\n      exports.storage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = exports.storage.debug;\n  } catch(e) {}\n\n  // If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n  if (!r && typeof process !== 'undefined' && 'env' in process) {\n    r = process.env.DEBUG;\n  }\n\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n  try {\n    return window.localStorage;\n  } catch (e) {}\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/debug/src/browser.js\n// module id = 25\n// module chunks = 0","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 26\n// module chunks = 0","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = createDebug.debug = createDebug['default'] = createDebug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = require('ms');\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n */\n\nexports.formatters = {};\n\n/**\n * Previous log timestamp.\n */\n\nvar prevTime;\n\n/**\n * Select a color.\n * @param {String} namespace\n * @return {Number}\n * @api private\n */\n\nfunction selectColor(namespace) {\n  var hash = 0, i;\n\n  for (i in namespace) {\n    hash  = ((hash << 5) - hash) + namespace.charCodeAt(i);\n    hash |= 0; // Convert to 32bit integer\n  }\n\n  return exports.colors[Math.abs(hash) % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction createDebug(namespace) {\n\n  function debug() {\n    // disabled?\n    if (!debug.enabled) return;\n\n    var self = debug;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // turn the `arguments` into a proper Array\n    var args = new Array(arguments.length);\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %O\n      args.unshift('%O');\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-zA-Z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    // apply env-specific formatting (colors, etc.)\n    exports.formatArgs.call(self, args);\n\n    var logFn = debug.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n\n  debug.namespace = namespace;\n  debug.enabled = exports.enabled(namespace);\n  debug.useColors = exports.useColors();\n  debug.color = selectColor(namespace);\n\n  // env-specific initialization logic for debug instances\n  if ('function' === typeof exports.init) {\n    exports.init(debug);\n  }\n\n  return debug;\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  exports.names = [];\n  exports.skips = [];\n\n  var split = (namespaces || '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (var i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/debug/src/debug.js\n// module id = 27\n// module chunks = 0","/**\n * Helpers.\n */\n\nvar s = 1000\nvar m = s * 60\nvar h = m * 60\nvar d = h * 24\nvar y = d * 365.25\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} options\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function (val, options) {\n  options = options || {}\n  var type = typeof val\n  if (type === 'string' && val.length > 0) {\n    return parse(val)\n  } else if (type === 'number' && isNaN(val) === false) {\n    return options.long ?\n\t\t\tfmtLong(val) :\n\t\t\tfmtShort(val)\n  }\n  throw new Error('val is not a non-empty string or a valid number. val=' + JSON.stringify(val))\n}\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str)\n  if (str.length > 10000) {\n    return\n  }\n  var match = /^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str)\n  if (!match) {\n    return\n  }\n  var n = parseFloat(match[1])\n  var type = (match[2] || 'ms').toLowerCase()\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n\n    default:\n      return undefined\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  if (ms >= d) {\n    return Math.round(ms / d) + 'd'\n  }\n  if (ms >= h) {\n    return Math.round(ms / h) + 'h'\n  }\n  if (ms >= m) {\n    return Math.round(ms / m) + 'm'\n  }\n  if (ms >= s) {\n    return Math.round(ms / s) + 's'\n  }\n  return ms + 'ms'\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  return plural(ms, d, 'day') ||\n    plural(ms, h, 'hour') ||\n    plural(ms, m, 'minute') ||\n    plural(ms, s, 'second') ||\n    ms + ' ms'\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) {\n    return\n  }\n  if (ms < n * 1.5) {\n    return Math.floor(ms / n) + ' ' + name\n  }\n  return Math.ceil(ms / n) + ' ' + name + 's'\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/ms/index.js\n// module id = 28\n// module chunks = 0","module.exports = CompositeImage;\n\n/**\n * @class CompositeImage\n * @private\n *\n * Utility class to composite tiles into a complete image\n * and track the rendered state of an image as new tiles\n * load.\n */\n\n/**\n * @param levels {Array.<Array.<Tile>>}\n * @constructor\n */\nfunction CompositeImage(levels)\n{\n    this._levels = levels;  // Assume levels sorted high-res first\n    var urlsToTiles = this._urlsToTiles = {};\n\n    levels.forEach(function (level)\n    {\n        level.tiles.forEach(function (tile)\n        {\n            urlsToTiles[tile.url] = {\n                zoomLevel: level.zoomLevel,\n                row: tile.row,\n                col: tile.col\n            };\n        });\n    });\n\n    this.clear();\n}\n\nCompositeImage.prototype.clear = function ()\n{\n    var loadedByLevel = this._loadedByLevel = {};\n\n    this._levels.forEach(function (level)\n    {\n        loadedByLevel[level.zoomLevel] = new TileCoverageMap(level.rows, level.cols);\n    });\n};\n\nCompositeImage.prototype.getTiles = function (baseZoomLevel)\n{\n    var toRenderByLevel = [];\n    var highestZoomLevel = this._levels[0].zoomLevel;\n    var covered = new TileCoverageMap(this._levels[0].rows, this._levels[0].cols);\n\n    var bestLevelIndex;\n\n    // Default to the lowest zoom level\n    if (baseZoomLevel === null)\n    {\n        bestLevelIndex = 0;\n    }\n    else\n    {\n        var ceilLevel = Math.ceil(baseZoomLevel);\n        bestLevelIndex = findIndex(this._levels, function (level)\n        {\n            return level.zoomLevel <= ceilLevel;\n        });\n    }\n\n\n    // The best level, followed by higher-res levels in ascending order of resolution,\n    // followed by lower-res levels in descending order of resolution\n    var levelsByPreference = this._levels.slice(0, bestLevelIndex + 1).reverse()\n        .concat(this._levels.slice(bestLevelIndex + 1));\n\n    levelsByPreference.forEach(function (level)\n    {\n        var loaded = this._loadedByLevel[level.zoomLevel];\n\n        var additionalTiles = level.tiles.filter(function (tile)\n        {\n            return loaded.isLoaded(tile.row, tile.col);\n        });\n\n        // Filter out entirely covered tiles\n\n        // FIXME: Is it better to draw all of a partially covered tile,\n        // with some of it ultimately covered, or to pick out the region\n        // which needs to be drawn?\n        // See https://github.com/DDMAL/diva.js/issues/358\n\n        var scaleRatio = Math.pow(2, highestZoomLevel - level.zoomLevel);\n\n        additionalTiles = additionalTiles.filter(function (tile)\n        {\n            var isNeeded = false;\n\n            var highResRow = tile.row * scaleRatio;\n            var highResCol = tile.col * scaleRatio;\n\n            for (var i=0; i < scaleRatio; i++)\n            {\n                for (var j=0; j < scaleRatio; j++)\n                {\n                    if (!covered.isLoaded(highResRow + i, highResCol + j))\n                    {\n                        isNeeded = true;\n                        covered.set(highResRow + i, highResCol + j, true);\n                    }\n                }\n            }\n\n            return isNeeded;\n        });\n\n        toRenderByLevel.push(additionalTiles);\n    }, this);\n\n    // Less-preferred tiles should come first\n    toRenderByLevel.reverse();\n\n    var tiles = [];\n\n    toRenderByLevel.forEach(function (byLevel)\n    {\n        tiles.push.apply(tiles, byLevel);\n    });\n\n    return tiles;\n};\n\n/**\n * Update the composite image to take into account all the URLs\n * loaded in an image cache.\n *\n * @param cache {ImageCache}\n */\nCompositeImage.prototype.updateFromCache = function (cache)\n{\n    this.clear();\n\n    this._levels.forEach(function (level)\n    {\n        var loaded = this._loadedByLevel[level.zoomLevel];\n\n        level.tiles.forEach(function (tile)\n        {\n            if (cache.has(tile.url))\n                loaded.set(tile.row, tile.col, true);\n        });\n    }, this);\n};\n\nCompositeImage.prototype.updateWithLoadedUrls = function (urls)\n{\n    urls.forEach(function (url)\n    {\n        var entry = this._urlsToTiles[url];\n        this._loadedByLevel[entry.zoomLevel].set(entry.row, entry.col, true);\n    }, this);\n};\n\nfunction TileCoverageMap(rows, cols)\n{\n    this._rows = rows;\n    this._cols = cols;\n\n    this._map = fill(rows).map(function ()\n    {\n        return fill(cols, false);\n    });\n}\n\nTileCoverageMap.prototype.isLoaded = function (row, col)\n{\n    // Return true for out of bounds tiles because they\n    // don't need to load. (Unfortunately this will also\n    // mask logical errors.)\n    if (row >= this._rows || col >= this._cols)\n        return true;\n\n    return this._map[row][col];\n};\n\nTileCoverageMap.prototype.set = function (row, col, value)\n{\n    this._map[row][col] = value;\n};\n\nfunction fill(count, value)\n{\n    var arr = new Array(count);\n\n    for (var i=0; i < count; i++)\n        arr[i] = value;\n\n    return arr;\n}\n\nfunction findIndex(array, predicate)\n{\n    var length = array.length;\n    for (var i = 0; i < length; i++)\n    {\n        if (predicate(array[i], i))\n            return i;\n    }\n\n    return -1;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/composite-image.js\n// module id = 29\n// module chunks = 0","module.exports = DocumentLayout;\n\n/**\n * Translate page layouts, as generated by page-layouts, into an\n * object which computes layout information for the document as\n * a whole.\n */\nfunction DocumentLayout(config, zoomLevel)\n{\n    var computedLayout = getComputedLayout(config, zoomLevel);\n\n    this.dimensions = computedLayout.dimensions;\n    this.pageGroups = computedLayout.pageGroups;\n    this._pageLookup = getPageLookup(computedLayout.pageGroups);\n}\n\n/**\n * @typedef {Object} PageInfo\n * @property {number} index\n * @property {{index, dimensions, pages, region, padding}} group\n * @property {{height: number, width: number}} dimensions\n * @property {{top: number, left: number}} groupOffset\n */\n\n/**\n * @param pageIndex\n * @returns {PageInfo|null}\n */\nDocumentLayout.prototype.getPageInfo = function (pageIndex)\n{\n    return this._pageLookup[pageIndex] || null;\n};\n\n/**\n * Get the dimensions of a page\n *\n * @param pageIndex\n * @returns {{height: number, width: number}}\n */\nDocumentLayout.prototype.getPageDimensions = function (pageIndex)\n{\n    if (!this._pageLookup || !this._pageLookup[pageIndex])\n        return null;\n\n    var region = getPageRegionFromPageInfo(this._pageLookup[pageIndex]);\n\n    return {\n        height: region.bottom - region.top,\n        width: region.right - region.left\n    };\n};\n\n// TODO(wabain): Get rid of this; it's a subset of the page region, so\n// give that instead\n/**\n * Get the top-left coordinates of a page, including*** padding\n *\n * @param pageIndex\n * @param options\n * @returns {{top: number, left: number} | null}\n */\nDocumentLayout.prototype.getPageOffset = function (pageIndex, options)\n{\n    var region = this.getPageRegion(pageIndex, options);\n\n    if (!region)\n        return null;\n\n    return {\n        top: region.top,\n        left: region.left\n    };\n};\n\nDocumentLayout.prototype.getPageRegion = function (pageIndex, options)\n{\n    var pageInfo = this._pageLookup[pageIndex];\n\n    if (!pageInfo)\n        return null;\n\n    var region = getPageRegionFromPageInfo(pageInfo);\n\n    if (options && options.excludePadding)\n    {\n        // FIXME?\n        var padding = pageInfo.group.padding;\n\n        return {\n            top: region.top + padding.top,\n            left: region.left + padding.left,\n            bottom: region.bottom,\n            right: region.right\n        };\n    }\n\n    return region;\n};\n\n/**\n * Get the distance from the top-right of the page to the center of the\n * specified viewport region\n *\n * @param pageIndex\n * @param viewport {{top: number, left: number, bottom: number, right: number}}\n * @returns {{x: number, y: number}}\n */\nDocumentLayout.prototype.getPageToViewportCenterOffset = function (pageIndex, viewport)\n{\n    var scrollLeft = viewport.left;\n    var elementWidth = viewport.right - viewport.left;\n\n    var offset = this.getPageOffset(pageIndex);\n\n    var x = scrollLeft - offset.left + parseInt(elementWidth / 2, 10);\n\n    var scrollTop = viewport.top;\n    var elementHeight = viewport.bottom - viewport.top;\n\n    var y = scrollTop - offset.top + parseInt(elementHeight / 2, 10);\n\n    return {\n        x: x,\n        y: y\n    };\n};\n\nfunction getPageRegionFromPageInfo(page)\n{\n    var top    = page.groupOffset.top  + page.group.region.top;\n    var bottom = top + page.dimensions.height;\n    var left   = page.groupOffset.left + page.group.region.left;\n    var right  = left + page.dimensions.width;\n\n    return {\n        top: top,\n        bottom: bottom,\n        left: left,\n        right: right\n    };\n}\n\nfunction getPageLookup(pageGroups)\n{\n    var pageLookup = {};\n\n    pageGroups.forEach(function (group)\n    {\n        group.pages.forEach(function (page)\n        {\n            pageLookup[page.index] = {\n                index: page.index,\n                group: group,\n                dimensions: page.dimensions,\n                groupOffset: page.groupOffset\n            };\n        });\n    });\n\n    return pageLookup;\n}\n\nfunction getComputedLayout(config, zoomLevel)\n{\n    var scaledLayouts = zoomLevel === null ? config.pageLayouts : getScaledPageLayouts(config, zoomLevel);\n\n    var documentSecondaryExtent = getExtentAlongSecondaryAxis(config, scaledLayouts);\n\n    // The current position in the document along the primary axis\n    var primaryDocPosition = config.verticallyOriented ?\n        config.padding.document.top :\n        config.padding.document.left;\n\n    var pageGroups = [];\n\n    // TODO: Use bottom, right as well\n    var pagePadding = {\n        top: config.padding.page.top,\n        left: config.padding.page.left\n    };\n\n    scaledLayouts.forEach(function (layout, index)\n    {\n        var top, left;\n\n        if (config.verticallyOriented)\n        {\n            top = primaryDocPosition;\n            left = (documentSecondaryExtent - layout.dimensions.width) / 2;\n        }\n        else\n        {\n            top = (documentSecondaryExtent - layout.dimensions.height) / 2;\n            left = primaryDocPosition;\n        }\n\n        var region = {\n            top: top,\n            bottom: top + pagePadding.top + layout.dimensions.height,\n            left: left,\n            right: left + pagePadding.left + layout.dimensions.width\n        };\n\n        pageGroups.push({\n            index: index,\n            dimensions: layout.dimensions,\n            pages: layout.pages,\n            region: region,\n            padding: pagePadding\n        });\n\n        primaryDocPosition = config.verticallyOriented ? region.bottom : region.right;\n    });\n\n    var height, width;\n\n    if (config.verticallyOriented)\n    {\n        height = primaryDocPosition + pagePadding.top;\n        width = documentSecondaryExtent;\n    }\n    else\n    {\n        height = documentSecondaryExtent;\n        width = primaryDocPosition + pagePadding.left;\n    }\n\n    return {\n        dimensions: {\n            height: height,\n            width: width\n        },\n        pageGroups: pageGroups\n    };\n}\n\nfunction getScaledPageLayouts(config, zoomLevel)\n{\n    var scaleRatio = Math.pow(2, zoomLevel - config.maxZoomLevel);\n\n    return config.pageLayouts.map(function (group)\n    {\n        return {\n            dimensions: scaleDimensions(group.dimensions, scaleRatio),\n            pages: group.pages.map(function (page)\n            {\n                return {\n                    index: page.index,\n                    groupOffset: {\n                        top: Math.floor(page.groupOffset.top * scaleRatio),\n                        left: Math.floor(page.groupOffset.left * scaleRatio)\n                    },\n                    dimensions: scaleDimensions(page.dimensions, scaleRatio)\n                };\n            })\n        };\n    });\n}\n\nfunction scaleDimensions(dimensions, scaleRatio)\n{\n    return {\n        height: Math.floor(dimensions.height * scaleRatio),\n        width: Math.floor(dimensions.width * scaleRatio)\n    };\n}\n\nfunction getExtentAlongSecondaryAxis(config, scaledLayouts)\n{\n    // Get the extent of the document along the secondary axis\n    var secondaryDim, secondaryPadding;\n    var docPadding = config.padding.document;\n\n    if (config.verticallyOriented)\n    {\n        secondaryDim = 'width';\n        secondaryPadding = docPadding.left + docPadding.right;\n    }\n    else\n    {\n        secondaryDim = 'height';\n        secondaryPadding = docPadding.top + docPadding.bottom;\n    }\n\n    return secondaryPadding + scaledLayouts.reduce(function (maxDim, layout)\n    {\n        return Math.max(layout.dimensions[secondaryDim], maxDim);\n    }, 0);\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/document-layout.js\n// module id = 30\n// module chunks = 0","'use strict';\n\nvar debug = require('debug')('diva:ImageCache');\n\nmodule.exports = ImageCache;\n\n/* FIXME(wabain): The caching strategy here is completely\n * arbitrary and the implementation isn't especially efficient.\n */\n\nvar DEFAULT_MAX_KEYS = 100;\n\nfunction ImageCache(options)\n{\n    options = options || { maxKeys: DEFAULT_MAX_KEYS };\n    this.maxKeys = options.maxKeys || DEFAULT_MAX_KEYS;\n\n    this._held = {};\n    this._urls = {};\n    this._lru = [];\n}\n\nImageCache.prototype.get = function (url)\n{\n    var record = this._urls[url];\n    return record ? record.img : null;\n};\n\nImageCache.prototype.has = function (url)\n{\n    return !!this._urls[url];\n};\n\nImageCache.prototype.put = function (url, img)\n{\n    var record = this._urls[url];\n    if (record)\n    {\n        // FIXME: Does this make sense for this use case?\n        record.img = img;\n        this._promote(record);\n    }\n    else\n    {\n        record = {\n            img: img,\n            url: url\n        };\n\n        this._urls[url] = record;\n        this._tryEvict(1);\n        this._lru.unshift(record);\n    }\n};\n\nImageCache.prototype._promote = function (record)\n{\n    var index = this._lru.indexOf(record);\n    this._lru.splice(index, 1);\n    this._lru.unshift(record);\n};\n\nImageCache.prototype._tryEvict = function (extraCapacity)\n{\n    var allowedEntryCount = this.maxKeys - extraCapacity;\n\n    if (this._lru.length <= allowedEntryCount)\n        return;\n\n    var evictionIndex = this._lru.length - 1;\n\n    for (;;)\n    {\n        var target = this._lru[evictionIndex];\n\n        if (!this._held[target.url])\n        {\n            debug('Evicting image %s', target.url);\n            this._lru.splice(evictionIndex, 1);\n            delete this._urls[target.url];\n\n            if (this._lru.length <= allowedEntryCount)\n                break;\n        }\n\n        if (evictionIndex === 0)\n        {\n            /* istanbul ignore next */\n            debug.enabled && debug('Cache overfull by %s (all entries are being held)',\n                this._lru.length - allowedEntryCount);\n\n            break;\n        }\n\n        evictionIndex--;\n    }\n};\n\nImageCache.prototype.acquire = function (url)\n{\n    this._held[url] = (this._held[url] || 0) + 1;\n    this._promote(this._urls[url]);\n};\n\nImageCache.prototype.release = function (url)\n{\n    var count = this._held[url];\n\n    if (count > 1)\n        this._held[url]--;\n    else\n        delete this._held[url];\n\n    this._tryEvict(0);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/image-cache.js\n// module id = 31\n// module chunks = 0","var debug = require('debug')('diva:ImageRequestHandler');\n\nmodule.exports = ImageRequestHandler;\n\n/**\n * Handler for the request for an image tile\n *\n * @param url\n * @param callback\n * @constructor\n */\nfunction ImageRequestHandler(options)\n{\n    this._url = options.url;\n    this._callback = options.load;\n    this._errorCallback = options.error;\n    this.timeoutTime = options.timeoutTime || 0;\n    this._aborted = this._complete = false;\n\n    //Use a timeout to allow the requests to be debounced (as they are in renderer)\n    this.timeout = setTimeout(function()\n    {\n        // Initiate the request\n        this._image = new Image();\n        this._image.crossOrigin = \"anonymous\";\n        this._image.onload = this._handleLoad.bind(this);\n        this._image.onerror = this._handleError.bind(this);\n        this._image.src = options.url;\n\n        debug('Requesting image %s', options.url);\n    }.bind(this), this.timeoutTime);\n}\n\nImageRequestHandler.prototype.abort = function ()\n{\n    debug('Aborting request to %s', this._url);\n\n    clearTimeout(this.timeout);\n\n    // FIXME\n    // People on the Internet say that doing this {{should/should not}} abort the request. I believe\n    // it corresponds to what the WHATWG HTML spec says should happen when the UA\n    // updates the image data if selected source is null.\n    //\n    // Sources:\n    //\n    // https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element\n    // http://stackoverflow.com/questions/7390888/does-changing-the-src-attribute-of-an-image-stop-the-image-from-downloading\n    if (this._image)\n    {\n        this._image.onload = this._image.onerror = null;\n\n        this._image.src = '';\n    }\n\n    this._aborted = true;\n};\n\nImageRequestHandler.prototype._handleLoad = function ()\n{\n    if (this._aborted)\n    {\n        console.error('ImageRequestHandler invoked on cancelled request for ' + this._url);\n        return;\n    }\n\n    if (this._complete)\n    {\n        console.error('ImageRequestHandler invoked on completed request for ' + this._url);\n        return;\n    }\n\n    this._complete = true;\n\n    debug('Received image %s', this._url);\n    this._callback(this._image);\n};\n\nImageRequestHandler.prototype._handleError = function ()\n{\n    debug('Failed to load image %s', this._url);\n    this._errorCallback(this._image);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/image-request-handler.js\n// module id = 32\n// module chunks = 0","/* global performance */\n\n// TODO: requestAnimationFrame fallback\n\nmodule.exports = {\n    animate: animate,\n    easing: {\n        linear: linearEasing\n    }\n};\n\nfunction animate(options)\n{\n    var durationMs = options.duration;\n    var parameters = options.parameters;\n    var onUpdate = options.onUpdate;\n    var onEnd = options.onEnd;\n\n    // Setup\n    // Times are in milliseconds from a basically arbitrary start\n    var start = now();\n    var end = start + durationMs;\n\n    var tweenFns = {};\n    var values = {};\n    var paramKeys = Object.keys(parameters);\n\n    paramKeys.forEach(function (key)\n    {\n        var config = parameters[key];\n        tweenFns[key] = interpolate(config.from, config.to, config.easing || linearEasing);\n    });\n\n    // Run it!\n    var requestId = requestAnimationFrame(update);\n\n    return {\n        cancel: function ()\n        {\n            if (requestId !== null)\n            {\n                cancelAnimationFrame(requestId);\n                handleAnimationCompletion({\n                    interrupted: true\n                });\n            }\n        }\n    };\n\n    function update()\n    {\n        var current = now();\n        var elapsed = Math.min((current - start) / durationMs, 1);\n\n        updateValues(elapsed);\n        onUpdate(values);\n\n        if (current < end)\n            requestId = requestAnimationFrame(update);\n        else\n            handleAnimationCompletion({\n                interrupted: false\n            });\n    }\n\n    function updateValues(elapsed)\n    {\n        paramKeys.forEach(function (key)\n        {\n            values[key] = tweenFns[key](elapsed);\n        });\n    }\n\n    function handleAnimationCompletion(info)\n    {\n        requestId = null;\n\n        if (onEnd)\n            onEnd(info);\n    }\n}\n\nfunction interpolate(start, end, easing)\n{\n    return function (elapsed)\n    {\n        return start + (end - start) * easing(elapsed);\n    };\n}\n\nfunction linearEasing(e)\n{\n    return e;\n}\n\nvar now;\n\nif (typeof performance !== 'undefined' && performance.now)\n{\n    now = function ()\n    {\n        return performance.now();\n    };\n}\nelse\n{\n    now = function ()\n    {\n        return Date.now();\n    };\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/interpolate-animation.js\n// module id = 33\n// module chunks = 0","var getBookLayoutGroups = require('./book-layout');\nvar getSinglesLayoutGroups = require('./singles-layout');\nvar getGridLayoutGroups = require('./grid-layout');\n\nmodule.exports = getPageLayouts;\n\n/** Get the relative positioning of pages for the current view */\nfunction getPageLayouts(settings)\n{\n    if (settings.inGrid)\n    {\n        return getGridLayoutGroups(pluck(settings, [\n            'manifest',\n            'viewport',\n            'pagesPerRow',\n            'fixedHeightGrid',\n            'fixedPadding',\n            'showNonPagedPages'\n        ]));\n    }\n    else\n    {\n        var config = pluck(settings, ['manifest', 'verticallyOriented', 'showNonPagedPages']);\n\n        if (settings.inBookLayout)\n            return getBookLayoutGroups(config);\n        else\n            return getSinglesLayoutGroups(config);\n    }\n}\n\nfunction pluck(obj, keys)\n{\n    var out = {};\n    keys.forEach(function (key)\n    {\n        out[key] = obj[key];\n    });\n    return out;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-layouts/index.js\n// module id = 34\n// module chunks = 0","var getPageDimensions = require('./page-dimensions');\n\nmodule.exports = getBookLayoutGroups;\n\nfunction getBookLayoutGroups(viewerConfig)\n{\n    var groupings = getGroupings(viewerConfig);\n\n    return groupings.map(function (grouping)\n    {\n        return getGroupLayoutsFromPageGrouping(viewerConfig, grouping);\n    });\n}\n\nfunction getGroupings(viewerConfig)\n{\n    var manifest = viewerConfig.manifest;\n\n    var pagesByGroup = [];\n    var leftPage = null;\n    var nonPagedPages = []; // Pages to display below the current group\n\n    var _addNonPagedPages = function()\n    {\n        for (var i = 0; i < nonPagedPages.length; i++)\n        {\n            pagesByGroup.push([ nonPagedPages[i] ]);\n        }\n        nonPagedPages = [];\n    };\n\n    manifest.pages.forEach(function (page, index)\n    {\n        var pageRecord = {\n            index: index,\n            dimensions: getPageDimensions(index, manifest),\n            paged: (!manifest.paged || page.paged)\n        };\n\n        // Only display non-paged pages if specified in the settings\n        if (!viewerConfig.showNonPagedPages && !pageRecord.paged)\n            return;\n\n        if (!pageRecord.paged)\n        {\n            nonPagedPages.push(pageRecord);\n        }\n        else if (index === 0 || page.facingPages)\n        {\n            // The first page is placed on its own\n            pagesByGroup.push([pageRecord]);\n            _addNonPagedPages();\n        }\n        else if (leftPage === null)\n        {\n            leftPage = pageRecord;\n        }\n        else\n        {\n            pagesByGroup.push([leftPage, pageRecord]);\n            leftPage = null;\n            _addNonPagedPages();\n        }\n    });\n\n    // Flush a final left page\n    if (leftPage !== null)\n    {\n        pagesByGroup.push([leftPage]);\n        _addNonPagedPages();\n    }\n\n    return pagesByGroup;\n}\n\nfunction getGroupLayoutsFromPageGrouping(viewerConfig, grouping)\n{\n    var verticallyOriented = viewerConfig.verticallyOriented;\n\n    if (grouping.length === 2)\n        return getFacingPageGroup(grouping[0], grouping[1], verticallyOriented);\n\n    var page = grouping[0];\n    var pageDims = page.dimensions;\n\n    // The first page is placed on its own to the right in vertical orientation.\n    // NB that this needs to be the page with index 0; if the first page is excluded\n    // from the layout then this special case shouldn't apply.\n    // If the page is tagged as 'non-paged', center it horizontally\n    var leftOffset;\n    if (page.paged)\n        leftOffset = (page.index === 0 && verticallyOriented) ? pageDims.width : 0;\n    else\n        leftOffset = (verticallyOriented) ? pageDims.width / 2 : 0;\n\n    var shouldBeHorizontallyAdjusted =\n        verticallyOriented && !viewerConfig.manifest.pages[page.index].facingPages;\n\n    // We need to left-align the page in vertical orientation, so we double\n    // the group width\n    return {\n        dimensions: {\n            height: pageDims.height,\n            width: shouldBeHorizontallyAdjusted ? pageDims.width * 2 : pageDims.width\n        },\n        pages: [{\n            index: page.index,\n            groupOffset: {\n                top: 0,\n                left: leftOffset\n            },\n            dimensions: pageDims\n        }]\n    };\n}\n\nfunction getFacingPageGroup(leftPage, rightPage, verticallyOriented)\n{\n    var leftDims = leftPage.dimensions;\n    var rightDims = rightPage.dimensions;\n\n    var height = Math.max(leftDims.height, rightDims.height);\n\n    var width, firstLeftOffset, secondLeftOffset;\n\n    if (verticallyOriented)\n    {\n        var midWidth = Math.max(leftDims.width, rightDims.width);\n\n        width = midWidth * 2;\n\n        firstLeftOffset = midWidth - leftDims.width;\n        secondLeftOffset = midWidth;\n    }\n    else\n    {\n        width = leftDims.width + rightDims.width;\n        firstLeftOffset = 0;\n        secondLeftOffset = leftDims.width;\n    }\n\n    return {\n        dimensions: {\n            height: height,\n            width: width\n        },\n        pages: [\n            {\n                index: leftPage.index,\n                dimensions: leftDims,\n                groupOffset: {\n                    top: 0,\n                    left: firstLeftOffset\n                }\n            },\n            {\n                index: rightPage.index,\n                dimensions: rightDims,\n                groupOffset: {\n                    top: 0,\n                    left: secondLeftOffset\n                }\n            }\n        ]\n    };\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-layouts/book-layout.js\n// module id = 35\n// module chunks = 0","module.exports = function getPageDimensions(pageIndex, manifest)\n{\n    var dims = manifest.getMaxPageDimensions(pageIndex);\n\n    return {\n        width: Math.floor(dims.width),\n        height: Math.floor(dims.height)\n    };\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-layouts/page-dimensions.js\n// module id = 36\n// module chunks = 0","var getPageDimensions = require('./page-dimensions');\n\nmodule.exports = function getSinglesLayoutGroups(viewerConfig)\n{\n    var manifest = viewerConfig.manifest;\n\n    // Render each page alone in a group\n    var pages = [];\n    manifest.pages.forEach(function (page, index)\n    {\n        if (!viewerConfig.showNonPagedPages && manifest.paged && !page.paged)\n            return;\n\n        var pageDims = getPageDimensions(index, manifest);\n\n        pages.push({\n            dimensions: pageDims,\n            pages: [\n                {\n                    index: index,\n                    groupOffset: {top: 0, left: 0},\n                    dimensions: pageDims\n                }\n            ]\n        });\n    });\n\n    return pages;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-layouts/singles-layout.js\n// module id = 37\n// module chunks = 0","module.exports = getGridLayoutGroups;\n\nfunction getGridLayoutGroups(viewerConfig)\n{\n    var viewportWidth = viewerConfig.viewport.width;\n    var manifest = viewerConfig.manifest;\n    var pagesPerRow = viewerConfig.pagesPerRow;\n    var fixedHeightGrid = viewerConfig.fixedHeightGrid;\n    var fixedPadding = viewerConfig.fixedPadding;\n    var showNonPagedPages = viewerConfig.showNonPagedPages;\n\n    var horizontalPadding = fixedPadding * (pagesPerRow + 1);\n    var pageWidth = (viewportWidth - horizontalPadding) / pagesPerRow;\n    var gridPageWidth = pageWidth;\n\n    // Calculate the row height depending on whether we want to fix the width or the height\n    var rowHeight = (fixedHeightGrid) ? fixedPadding + manifest.minRatio * pageWidth : fixedPadding + manifest.maxRatio * pageWidth;\n\n    var groups = [];\n    var currentPages = [];\n\n    var getGridPageDimensions = function (pageData)\n    {\n        // Calculate the width, height and horizontal placement of this page\n        // Get dimensions at max zoom level, although any level should be fine\n        var pageDimenData = pageData.d[pageData.d.length - 1];\n        var heightToWidthRatio = pageDimenData.h / pageDimenData.w;\n\n        var pageWidth, pageHeight;\n\n        if (fixedHeightGrid)\n        {\n            pageWidth = (rowHeight - fixedPadding) / heightToWidthRatio;\n            pageHeight = rowHeight - fixedPadding;\n        }\n        else\n        {\n            pageWidth = gridPageWidth;\n            pageHeight = pageWidth * heightToWidthRatio;\n        }\n\n        return {\n            width: Math.round(pageWidth),\n            height: Math.round(pageHeight)\n        };\n    };\n\n    var rowDimensions = {\n        height: rowHeight,\n        width: viewportWidth\n    };\n\n    manifest.pages.forEach(function (page, pageIndex)\n    {\n        if (!showNonPagedPages && manifest.paged && !page.paged)\n            return;\n\n        // Calculate the width, height and horizontal placement of this page\n        var pageDimens = getGridPageDimensions(page);\n        var leftOffset = Math.floor(currentPages.length * (fixedPadding + gridPageWidth) + fixedPadding);\n\n        // Center the page if the height is fixed (otherwise, there is no horizontal padding)\n        if (fixedHeightGrid)\n        {\n            leftOffset += (gridPageWidth - pageDimens.width) / 2;\n        }\n\n        // TODO: Precompute page dimensions everywhere\n        currentPages.push({\n            index: pageIndex,\n            dimensions: pageDimens,\n            groupOffset: {\n                top: 0,\n                left: leftOffset\n            }\n        });\n\n        if (currentPages.length === pagesPerRow)\n        {\n            groups.push({\n                dimensions: rowDimensions,\n                pages: currentPages\n            });\n\n            currentPages = [];\n        }\n    });\n\n    if (currentPages.length > 0)\n    {\n        groups.push({\n            dimensions: rowDimensions,\n            pages: currentPages\n        });\n    }\n\n    return groups;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/page-layouts/grid-layout.js\n// module id = 38\n// module chunks = 0","module.exports = createSettingsView;\n\nfunction createSettingsView(sources)\n{\n    var obj = {};\n\n    sources.forEach(function (source)\n    {\n        registerMixin(obj, source);\n    });\n\n    return obj;\n}\n\nfunction registerMixin(obj, mixin)\n{\n    Object.keys(mixin).forEach(function (key)\n    {\n        Object.defineProperty(obj, key, {\n            get: function ()\n            {\n                return mixin[key];\n            },\n            set: function ()\n            {\n                // TODO: Make everything strict mode so this isn't needed\n                throw new TypeError('Cannot set settings.' + key);\n            }\n        });\n    });\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/settings-view.js\n// module id = 39\n// module chunks = 0","var extend = require('jquery').extend;\n\nmodule.exports = ValidationRunner;\n\nfunction ValidationRunner(options)\n{\n    this.whitelistedKeys = options.whitelistedKeys || [];\n    this.additionalProperties = options.additionalProperties || [];\n    this.validations = options.validations;\n}\n\nValidationRunner.prototype.isValid = function (key, value, settings)\n{\n    // Get the validation index\n    var validationIndex = null;\n\n    this.validations.some(function (validation, index)\n    {\n        if (validation.key !== key)\n            return false;\n\n        validationIndex = index;\n        return true;\n    });\n\n    if (validationIndex === null)\n        return true;\n\n    // Run the validation\n    var dummyChanges = {};\n    dummyChanges[key] = value;\n    var proxier = createSettingsProxier(settings, dummyChanges, this);\n\n    return !this._runValidation(validationIndex, value, proxier);\n};\n\nValidationRunner.prototype.validate = function (settings)\n{\n    this._validateOptions({}, settings);\n};\n\nValidationRunner.prototype.getValidatedOptions = function (settings, options)\n{\n    var cloned = extend({}, options);\n    this._validateOptions(settings, cloned);\n    return cloned;\n};\n\nValidationRunner.prototype._validateOptions = function (settings, options)\n{\n    var settingsProxier = createSettingsProxier(settings, options, this);\n    this._applyValidations(options, settingsProxier);\n};\n\nValidationRunner.prototype._applyValidations = function (options, proxier)\n{\n    this.validations.forEach(function (validation, index)\n    {\n        if (!options.hasOwnProperty(validation.key))\n            return;\n\n        var input = options[validation.key];\n        var corrected = this._runValidation(index, input, proxier);\n\n        if (corrected)\n        {\n            if (!corrected.warningSuppressed)\n                emitWarning(validation.key, input, corrected.value);\n\n            options[validation.key] = corrected.value;\n        }\n    }, this);\n};\n\nValidationRunner.prototype._runValidation = function (index, input, proxier)\n{\n    var validation = this.validations[index];\n\n    proxier.index = index;\n\n    var warningSuppressed = false;\n    var config = {\n        suppressWarning: function ()\n        {\n            warningSuppressed = true;\n        }\n    };\n\n    var outputValue = validation.validate(input, proxier.proxy, config);\n\n    if (outputValue === undefined || outputValue === input)\n        return null;\n\n    return {\n        value: outputValue,\n        warningSuppressed: warningSuppressed\n    };\n};\n\n/**\n * The settings proxy wraps the settings object and ensures that\n * only values which have previously been validated are accessed,\n * throwing a TypeError otherwise.\n *\n * FIXME(wabain): Is it worth keeping this? When I wrote it I had\n * multiple validation stages and it was a lot harder to keep track\n * of everything, so this was more valuable.\n */\nfunction createSettingsProxier(settings, options, runner)\n{\n    var proxier = {\n        proxy: {},\n        index: null\n    };\n\n    var lookup = lookupValue.bind(null, settings, options);\n\n    var properties = {};\n\n    runner.whitelistedKeys.forEach(function (whitelisted)\n    {\n        properties[whitelisted] = {\n            get: lookup.bind(null, whitelisted)\n        };\n    });\n\n    runner.additionalProperties.forEach(function (additional)\n    {\n        properties[additional.key] = {\n            get: additional.get\n        };\n    });\n\n    runner.validations.forEach(function (validation, validationIndex)\n    {\n        properties[validation.key] = {\n            get: function ()\n            {\n                if (validationIndex < proxier.index)\n                    return lookup(validation.key);\n\n                var currentKey = runner.validations[proxier.index].key;\n                throw new TypeError('Cannot access setting ' + validation.key + ' while validating ' + currentKey);\n            }\n        };\n    });\n\n    Object.defineProperties(proxier.proxy, properties);\n\n    return proxier;\n}\n\nfunction emitWarning(key, original, corrected)\n{\n    console.warn('Invalid value for ' + key + ': ' + original + '. Using ' + corrected + ' instead.');\n}\n\nfunction lookupValue(base, extension, key)\n{\n    if (key in extension)\n        return extension[key];\n\n    return base[key];\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/validation-runner.js\n// module id = 40\n// module chunks = 0","module.exports = Viewport;\n\nfunction Viewport(outer, options)\n{\n    options = options || {};\n\n    this.intersectionTolerance = options.intersectionTolerance || 0;\n    this.maxExtent = options.maxExtent || 2000;\n\n    this.outer = outer;\n\n    this._top = this._left = this._width = this._height = this._innerDimensions = null;\n\n    this.invalidate();\n}\n\nViewport.prototype.intersectsRegion = function (region)\n{\n    return this.hasHorizontalOverlap(region) && this.hasVerticalOverlap(region);\n};\n\nViewport.prototype.hasVerticalOverlap = function (region)\n{\n    var top = this.top - this.intersectionTolerance;\n    var bottom = this.bottom + this.intersectionTolerance;\n\n    return (\n        fallsBetween(region.top, top, bottom) ||\n        fallsBetween(region.bottom, top, bottom) ||\n        (region.top <= top && region.bottom >= bottom)\n    );\n};\n\nViewport.prototype.hasHorizontalOverlap = function (region)\n{\n    var left = this.left - this.intersectionTolerance;\n    var right = this.right + this.intersectionTolerance;\n\n    return (\n        fallsBetween(region.left, left, right) ||\n        fallsBetween(region.right, left, right) ||\n        (region.left <= left && region.right >= right)\n    );\n};\n\nViewport.prototype.invalidate = function ()\n{\n    // FIXME: Should this check the inner dimensions as well?\n    this._width = clampMax(this.outer.clientWidth, this.maxExtent);\n    this._height = clampMax(this.outer.clientHeight, this.maxExtent);\n\n    this._top = this.outer.scrollTop;\n    this._left = this.outer.scrollLeft;\n};\n\nViewport.prototype.setInnerDimensions = function (dimensions)\n{\n    this._innerDimensions = dimensions;\n\n    if (dimensions)\n    {\n        this._top = clamp(this._top, 0, dimensions.height - this._height);\n        this._left = clamp(this._left, 0, dimensions.width - this._width);\n    }\n};\n\nObject.defineProperties(Viewport.prototype, {\n    top: getCoordinateDescriptor('top', 'height'),\n    left: getCoordinateDescriptor('left', 'width'),\n\n    width: getDimensionDescriptor('width'),\n    height: getDimensionDescriptor('height'),\n\n    bottom: {\n        get: function ()\n        {\n            return this._top + this._height;\n        }\n    },\n    right: {\n        get: function ()\n        {\n            return this._left + this._width;\n        }\n    }\n});\n\nfunction getCoordinateDescriptor(coord, associatedDimension)\n{\n    var privateProp = '_' + coord;\n    var source = 'scroll' + coord.charAt(0).toUpperCase() + coord.slice(1);\n\n    return {\n        get: function ()\n        {\n            return this[privateProp];\n        },\n        set: function (newValue)\n        {\n            var normalized;\n\n            if (this._innerDimensions)\n            {\n                var maxAllowed = this._innerDimensions[associatedDimension] - this[associatedDimension];\n                normalized = clamp(newValue, 0, maxAllowed);\n            }\n            else\n            {\n                normalized = clampMin(newValue, 0);\n            }\n\n            this[privateProp] = this.outer[source] = normalized;\n        }\n    };\n}\n\nfunction getDimensionDescriptor(dimen)\n{\n    return {\n        get: function ()\n        {\n            return this['_' + dimen];\n        }\n    };\n}\n\nfunction fallsBetween(point, start, end)\n{\n    return point >= start && point <= end;\n}\n\nfunction clamp(value, min, max)\n{\n    return clampMin(clampMax(value, max), min);\n}\n\nfunction clampMin(value, min)\n{\n    return Math.max(value, min);\n}\n\nfunction clampMax(value, max)\n{\n    return Math.min(value, max);\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/viewport.js\n// module id = 41\n// module chunks = 0","/*\n\nCanvas plugin for diva.js\nAdds an adjustment icon next to each image\n\n*/\n\nvar jQuery = require('jquery');\nvar diva = require('../diva');\n\nrequire('../utils/jquery-extensions');\n\n(function ($)\n{\n    module.exports = (function ()\n    {\n        var canvas = {},\n            map = {},\n            settings = {},\n            image,\n            sliders,\n            sliderMode;\n\n        // Set up some default settings (can be overridden the normal way)\n        var defaults = {\n            brightnessMax: 150,\n            brightnessMin: -100,\n            brightnessStep: 1,\n            contrastMax: 3,\n            contrastMin: -1,\n            contrastStep: 0.05,\n            localStoragePrefix: 'canvas-',\n            mobileWebkitMaxZoom: 2,\n            rgbMax: 50,\n            rgbMin: -50,\n            throbberFadeSpeed: 200,\n            throbberTimeout: 100,\n            buttons: [\n                'contrast',\n                'brightness',\n                'rotation',\n                'zoom'\n            ]\n        };\n\n        // Convert an angle from degrees to radians\n        var toRadians = function (angle)\n        {\n            return angle * Math.PI / 180;\n        };\n\n        // Determine the new center of the page after rotating by the given angle\n        var getNewCenter = function (currentCenter, angle)\n        {\n            var x = currentCenter.x - canvas.centerX;\n            // Take the negative because the rotation is counterclockwise\n            var y = -(currentCenter.y - canvas.centerY);\n\n            var theta = toRadians(sliders.rotation.previous - angle);\n            var newX = Math.cos(theta) * x - Math.sin(theta) * y + canvas.centerX;\n            var newY = -(Math.sin(theta) * x + Math.cos(theta) * y) + canvas.centerY;\n\n            return {'x': newX, 'y': newY};\n        };\n\n        // Rotates the image on the given canvas by the given angle\n        var rotateCanvas = function (aCanvas, angle)\n        {\n            var context = aCanvas.context;\n            var center = aCanvas.size / 2;\n            var startX = -(aCanvas.width / 2);\n            var startY = -(aCanvas.height / 2);\n\n            // Clear the canvas so that remnants of the old image don't show\n            context.clearRect(0, 0, aCanvas.size, aCanvas.size);\n\n            // Do the rotation\n            context.save();\n            context.translate(center, center);\n            context.rotate(toRadians(angle));\n            context.drawImage(image, startX, startY, aCanvas.width, aCanvas.height);\n            context.restore();\n\n            // Save the new pixel data so that it can later be adjusted in adjustLevels\n            aCanvas.data = context.getImageData(0, 0, aCanvas.size, aCanvas.size);\n        };\n\n        // Determine if we need to update the large canvas\n        var shouldAdjustLevels = function ()\n        {\n            var slider;\n\n            // Returns true if something has been changed\n            for (slider in sliders)\n            {\n                if (sliders[slider].current !== sliders[slider].previous)\n                {\n                    return true;\n                }\n            }\n\n            return false;\n        };\n\n        // Sets the \"previous\" value to the \"current\" value for every slider\n        var updatePreviousLevels = function ()\n        {\n            var slider;\n\n            for (slider in sliders)\n            {\n                sliders[slider].previous = sliders[slider].current;\n            }\n        };\n\n        // Update the thumbnail preview (called when a slider is moved/reset)\n        var updateMap = function ()\n        {\n            rotateCanvas(map, sliders.rotation.current);\n            adjustLevels(map);\n        };\n\n        // Update the large canvas (rotation, zooming, scrolling, pixel manipulation)\n        var updateCanvas = function ()\n        {\n            var angle = sliders.rotation.current;\n            var oldAngle = sliders.rotation.previous;\n            var zoomLevel = sliders.zoom.current;\n            var oldZoomLevel = sliders.zoom.previous;\n\n            // Scroll the user to the desired location\n            if (angle !== oldAngle || zoomLevel !== oldZoomLevel)\n            {\n                // First figure out the current center of the viewport\n                var leftScroll = $('#diva-canvas-wrapper').scrollLeft();\n                var topScroll = $('#diva-canvas-wrapper').scrollTop();\n                var leftOffset = settings.viewport.width / 2;\n                var topOffset = settings.viewport.height / 2;\n\n                // Then determine the new center (the same part of the image)\n                var newCenter = getNewCenter({x: leftScroll + leftOffset, y: topScroll + topOffset}, angle);\n\n                // Incorporate the zoom change ratio (would be 1 if no change)\n                var zoomChange = Math.pow(2, zoomLevel - oldZoomLevel);\n                var toLeftScroll = zoomChange * newCenter.x - leftOffset;\n                var toTopScroll = zoomChange * newCenter.y - topOffset;\n\n                // Rotate the large canvas\n                rotateCanvas(canvas, angle);\n\n                // Scroll to the new center\n                $('#diva-canvas-wrapper').scrollLeft(toLeftScroll);\n                $('#diva-canvas-wrapper').scrollTop(toTopScroll);\n            }\n\n            // Only call adjustLevels again if we really need to (expensive)\n            if (shouldAdjustLevels())\n            {\n                adjustLevels(canvas);\n                updatePreviousLevels();\n            }\n        };\n\n        // Copies the canvas' pixel array and returns the copy\n        var copyImageData = function (aCanvas)\n        {\n            var oldImageData = aCanvas.data;\n            var newImageData = aCanvas.context.createImageData(oldImageData);\n            var pixelArray = newImageData.data;\n            var i, length;\n\n            for (i = 0, length = pixelArray.length; i < length; i++)\n            {\n                pixelArray[i] = oldImageData.data[i];\n            }\n\n            return newImageData;\n        };\n\n        // Determines whether or not we need to adjust this level - very simple\n        var shouldAdjust = function (mode)\n        {\n            var thisChanged = sliders[mode].current !== sliders[mode].previous;\n            var thisNotDefault = sliders[mode].current !== sliders[mode].initial;\n\n            return thisChanged || thisNotDefault;\n        };\n\n        var adjustLevels = function (aCanvas)\n        {\n            // Copy the pixel array to avoid destructively modifying the original\n            var imageData = copyImageData(aCanvas);\n            var pixelArray = imageData.data;\n\n            // Store and calculate some scale factors and offsets\n            var brightness = sliders.brightness.current;\n            var contrast = sliders.contrast.current;\n\n            var brightMul = 1 + Math.min(settings.brightnessMax, Math.max(settings.brightnessMin, brightness)) / settings.brightnessMax;\n            var brightTimesContrast = brightMul * contrast;\n            var contrastOffset = 128 - (contrast * 128);\n\n            var redOffset = sliders.red.current;\n            var greenOffset = sliders.green.current;\n            var blueOffset = sliders.blue.current;\n\n            // Determine whether or not we need to adjust certain things\n            var adjustRed = shouldAdjust('red');\n            var adjustGreen = shouldAdjust('green');\n            var adjustBlue = shouldAdjust('blue');\n\n            var adjustBrightness = shouldAdjust('brightness');\n            var adjustContrast = shouldAdjust('contrast');\n            var adjustOthers = adjustBrightness || adjustContrast;\n\n            var x, y, width, height, offset, r, g, b;\n\n            for (x = 0, width = imageData.width; x < width; x++)\n            {\n                for (y = 0, height = imageData.height; y < height; y++)\n                {\n                    offset = (y * width + x) * 4;\n\n                    r = pixelArray[offset];\n                    g = pixelArray[offset + 1];\n                    b = pixelArray[offset + 2];\n\n                    // Only do something if the pixel is not black originally\n                    if (r + g + b > 0)\n                    {\n                        // Only adjust individual colour channels if necessary\n                        if (adjustRed && r)\n                            r += redOffset;\n\n                        if (adjustGreen && g)\n                            g += greenOffset;\n\n                        if (adjustBlue && b)\n                            b += blueOffset;\n\n                        // If we need to adjust brightness and/or contrast\n                        if (adjustOthers)\n                        {\n                            if (r)\n                                r = r * brightTimesContrast + contrastOffset;\n\n                            if (g)\n                                g = g * brightTimesContrast + contrastOffset;\n\n                            if (b)\n                                b = b * brightTimesContrast + contrastOffset;\n                        }\n\n                        pixelArray[offset] = r;\n                        pixelArray[offset + 1] = g;\n                        pixelArray[offset + 2] = b;\n                    }\n                }\n            }\n\n            aCanvas.context.clearRect(0, 0, width, height);\n            aCanvas.context.putImageData(imageData, 0, 0);\n        };\n\n        // Update the box in the preview showing where you currently are\n        var updateViewbox = function ()\n        {\n            // Determine the top left corner coordinates based on our current position\n            var cornerX = $('#diva-canvas-wrapper').scrollLeft() * map.scaleFactor;\n            var cornerY = $('#diva-canvas-wrapper').scrollTop() * map.scaleFactor;\n\n            // Subtract 4 to compensate for the borders\n            var height = Math.min(Math.round(settings.viewport.height * map.scaleFactor), settings.mapSize) - 4;\n            var width = Math.min(Math.round(settings.viewport.width * map.scaleFactor), settings.mapSize) - 4;\n\n            $('#diva-map-viewbox').height(height).width(width).css({top: cornerY, left: cornerX});\n        };\n\n        // Draw the thumbnail preview in the toolbar\n        var loadMap = function (image)\n        {\n            map.canvas = document.getElementById('diva-canvas-minimap');\n            map.size = settings.mapSize;\n            map.canvas.width = map.size;\n            map.canvas.height = map.size;\n\n            // Give it a black background\n            map.context = map.canvas.getContext('2d');\n            map.context.fillRect(0, 0, map.size, map.size);\n\n            // Determine the coordinates/dimensions of the preview\n            map.scaleFactor = settings.mapSize / canvas.size;\n            map.cornerX = canvas.cornerX * map.scaleFactor;\n            map.cornerY = canvas.cornerY * map.scaleFactor;\n            map.width = image.width * map.scaleFactor;\n            map.height = image.height * map.scaleFactor;\n\n            // Draw the image within the map (no adjustments) and save the pixel array\n            map.context.drawImage(image, map.cornerX, map.cornerY, map.width, map.height);\n            map.data = map.context.getImageData(0, 0, settings.mapSize, settings.mapSize);\n\n            // Show the viewbox, make it reflect where we currently are\n            $('#diva-map-viewbox').show();\n            updateViewbox();\n        };\n\n        // Load the image within the large and small canvases\n        var loadCanvas = function (imageURL, callback)\n        {\n            image = new Image();\n            image.crossOrigin = \"anonymous\";\n\n            image.onload = function ()\n            {\n                // Determine the size of the (square) canvas based on the hypoteneuse\n                canvas.size = Math.sqrt(image.width * image.width + image.height * image.height);\n\n                // Resize the canvas if necessary\n                canvas.canvas = document.getElementById('diva-canvas');\n                canvas.canvas.width = canvas.size;\n                canvas.canvas.height = canvas.size;\n                canvas.cornerX = (canvas.size - image.width) / 2;\n                canvas.cornerY = (canvas.size - image.height) / 2;\n                canvas.width = image.width;\n                canvas.height = image.height;\n                canvas.centerX = canvas.size / 2;\n                canvas.centerY = canvas.size / 2;\n\n                // Draw the image to the large canvas, and save the pixel array\n                canvas.context = canvas.canvas.getContext('2d');\n                canvas.context.drawImage(image, canvas.cornerX, canvas.cornerY, canvas.width, canvas.height);\n                try\n                {\n                    canvas.data = canvas.context.getImageData(0, 0, canvas.size, canvas.size);\n                }\n                catch (error)\n                {\n                    var canvasError = '<div id=\"diva-error\" class=\"diva-error\"><p><strong>Error</strong></p><p>' + error.message + '</p>';\n\n                    if (error.name === 'SecurityError')\n                    {\n                        canvasError += '<p>You may need to update your server configuration in order to use the image manipulation tools. ' +\n                        'For help, see the <a href=\"https://github.com/DDMAL/diva.js/wiki/The-API-and-Plugins#a-note-about-' +\n                        'canvas-and-cross-site-data\" target=\"_blank\">canvas cross-site data documentation</a>.</p>' +\n                        '</div>';\n                    }\n                    else\n                    {\n                        throw error;\n                    }\n\n                    canvasError += '</div>';\n                    $('#diva-canvas-backdrop').append(canvasError);\n                    hideThrobber();\n                }\n\n                // Only load the map the first time (when there is no callback)\n                if (callback === undefined) {\n                    loadMap(image);\n                }\n\n                // Update the map and the canvas if necessary\n                updateMap();\n                updateCanvas(canvas);\n\n                // Hide the throbber if it is visible\n                hideThrobber();\n\n                // If the callback function exists, execute it (for zooming)\n                if (typeof callback === 'function')\n                    callback.call(callback);\n            };\n\n            image.src = imageURL;\n\n            // make sure the load event fires for cached images too\n            if ( image.complete || image.complete === undefined ) {\n                image.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\n                image.src = imageURL;\n            }\n        };\n\n        var updateSliderLabel = function ()\n        {\n            var thisSlider = sliders[sliderMode];\n            var value = thisSlider.current;\n            var stringValue = (thisSlider.transform) ? thisSlider.transform(value) : value;\n            $('#diva-canvas-value').html(stringValue);\n        };\n\n        var updateSliderValue = function ()\n        {\n            $('#diva-canvas-slider').val(sliders[sliderMode].current);\n        };\n\n        // Returns the URL for the image at the specified zoom level\n        var getImageURL = function (zoomLevel)\n        {\n            var width = settings.zoomWidthRatio * Math.pow(2, zoomLevel);\n\n            return settings.divaInstance.getPageImageURL(settings.selectedPageIndex, { width: width });\n        };\n\n        var showThrobber = function ()\n        {\n            // Only show the throbber if it will take a long time\n            if (sliders.zoom.current > 0 || settings.mobileWebkit)\n                $(settings.selector + 'throbber').addClass('canvas-throbber').show();\n        };\n\n        // Hides the loading indicator icon\n        var hideThrobber = function ()\n        {\n            $(settings.selector + 'throbber').removeClass('canvas-throbber').hide();\n        };\n\n        // If any modifications have been applied, save them to localStorage\n        var saveSettings = function ()\n        {\n            var sliderSettings = {};\n            var changed = false;\n            var storageKey = settings.localStoragePrefix + settings.filename;\n            var slider;\n\n            for (slider in sliders)\n            {\n                if (sliders[slider].previous !== sliders[slider].initial)\n                {\n                    sliderSettings[slider] = sliders[slider].previous;\n                    changed = true;\n                }\n            }\n\n            // If modifications need to be saved, update the canvas plugin icon\n            if (changed)\n            {\n                settings.pluginIcon.addClass('new');\n                storeObject(storageKey, sliderSettings);\n            }\n            else\n            {\n                settings.pluginIcon.removeClass('new');\n                localStorage.removeItem(storageKey);\n            }\n        };\n\n        // Handles zooming in when the zoom slider is changed and the change is applied\n        var updateZoom = function (newZoomLevel, callback)\n        {\n            settings.zoomLevel = newZoomLevel;\n\n            // Figure out the URL for the image at this new zoom level\n            var imageURL = getImageURL(newZoomLevel);\n\n            loadCanvas(imageURL, function ()\n            {\n                // Set the new scale factor and update the viewbox\n                map.scaleFactor = map.size / canvas.size;\n                updateViewbox();\n\n                saveSettings();\n            });\n        };\n\n        var bindCanvasKeyEvents = function (event)\n        {\n            var upArrowKey = 38,\n                downArrowKey = 40,\n                leftArrowKey = 37,\n                rightArrowKey = 39;\n\n            switch (event.keyCode)\n            {\n                case upArrowKey:\n                    // Up arrow - scroll up\n                    $('#diva-canvas-wrapper').scrollTop(document.getElementById('diva-canvas-wrapper').scrollTop - settings.arrowScrollAmount);\n                    return false;\n\n                case downArrowKey:\n                    // Down arrow - scroll down\n                    $('#diva-canvas-wrapper').scrollTop(document.getElementById('diva-canvas-wrapper').scrollTop + settings.arrowScrollAmount);\n                    return false;\n\n                case leftArrowKey:\n                    // Left arrow - scroll left\n                    $('#diva-canvas-wrapper').scrollLeft(document.getElementById('diva-canvas-wrapper').scrollLeft - settings.arrowScrollAmount);\n                    return false;\n\n                case rightArrowKey:\n                    // Right arrow - scroll right\n                    $('#diva-canvas-wrapper').scrollLeft(document.getElementById('diva-canvas-wrapper').scrollLeft + settings.arrowScrollAmount);\n                    return false;\n            }\n        };\n\n        // Serialize an object to JSON and save it in localStorage\n        var storeObject = function (key, value) {\n            localStorage.setItem(key, JSON.stringify(value));\n        };\n\n        // Load and deserialize a localStorage object\n        var loadStoredObject = function (key) {\n            var value = localStorage.getItem(key);\n            return value && JSON.parse(value);\n        };\n\n        var retval =\n        {\n            init: function (divaSettings, divaInstance)\n            {\n                // If the browser does not support canvas, do nothing\n                // And, disable this plugin\n                var canvasSupported = !!window.HTMLCanvasElement;\n                if (!canvasSupported)\n                    return false;\n\n                // Override all the configurable settings defined under canvasPlugin\n                $.extend(settings, defaults, divaSettings.canvasPlugin);\n\n                settings.divaInstance = divaInstance;\n                settings.inCanvas = false;\n                settings.iipServerURL = divaSettings.iipServerURL;\n                settings.imageDir = divaSettings.imageDir;\n                settings.selector = divaSettings.selector;\n                settings.mobileWebkit = divaSettings.mobileWebkit;\n                settings.arrowScrollAmount = divaSettings.arrowScrollAmount;\n\n                // Set up the settings for the sliders/icons\n                sliders = {\n                    'contrast': {\n                        'initial': 1,\n                        'min': settings.contrastMin,\n                        'max': settings.contrastMax,\n                        'step': settings.contrastStep,\n                        'transform': function (value) {\n                            return value.toFixed(2);\n                        },\n                        'title': 'Change the contrast'\n                    },\n                    'brightness': {\n                        'initial': 0,\n                        'min': settings.brightnessMin,\n                        'max': settings.brightnessMax,\n                        'step': settings.brightnessStep,\n                        'title': 'Adjust the brightness'\n                    },\n                    'rotation': {\n                        'initial': 0,\n                        'min': 0,\n                        'max': 359,\n                        'step': 1,\n                        'transform': function (value) {\n                            return value + '&deg;';\n                        },\n                        'title': 'Rotate the image'\n                    },\n                    'zoom': {\n                        // Default, min and max values updated within setupHook\n                        'initial': 0,\n                        'min': 0,\n                        'max': 0,\n                        'step': 1,\n                        'title': 'Adjust the zoom level'\n                    },\n                    'red': {\n                        'initial': 0,\n                        'min': settings.rgbMin,\n                        'max': settings.rgbMax,\n                        'step': 1,\n                        'title': 'Adjust the red channel'\n                    },\n                    'green': {\n                        'initial': 0,\n                        'min': settings.rgbMin,\n                        'max': settings.rgbMax,\n                        'step': 1,\n                        'title': 'Adjust the green channel'\n                    },\n                    'blue': {\n                        'initial': 0,\n                        'min': settings.rgbMin,\n                        'max': settings.rgbMax,\n                        'step': 1,\n                        'title': 'Adjust the blue channel'\n                    }\n                };\n\n                // Copy the \"default\" value into \"value\" and \"previous\" for each slider\n                var resetSliders = function ()\n                {\n                    var defaultValue, thisSlider, slider;\n                    for (slider in sliders)\n                    {\n                        thisSlider = sliders[slider];\n                        defaultValue = thisSlider.initial;\n                        thisSlider.current = defaultValue;\n                        thisSlider.previous = defaultValue;\n                    }\n                };\n\n                resetSliders();\n\n                // Create the DOM elements if they haven't already been created\n                if ($('#diva-canvas-backdrop').length)\n                {\n                    // Return true to keep the plugin enabled\n                    return true;\n                }\n\n                var canvasButtonsList = [];\n                var buttonHTML, button, buttonTitle, i;\n\n                for (i in settings.buttons)\n                {\n                    button = settings.buttons[i];\n                    buttonTitle = sliders[button].title;\n                    buttonHTML = '<div class=\"' + button + '\" title=\"' + buttonTitle + '\"></div>';\n                    canvasButtonsList.push(buttonHTML);\n                }\n                var canvasButtons = canvasButtonsList.join('');\n\n                var canvasTools = '<div id=\"diva-canvas-tools\">' +\n                    '<div id=\"diva-canvas-toolbar\">' +\n                        '<div id=\"diva-canvas-close\" title=\"Return to the document viewer\"></div>' +\n                        '<div id=\"diva-canvas-minimise\" title=\"Minimise the toolbar\"></div>' +\n                        '<span id=\"diva-canvas-info\">Test</span>' +\n                    '</div>' +\n                    '<div id=\"diva-canvas-toolwindow\">' +\n                        '<div id=\"diva-map-viewbox\"></div>' +\n                        '<canvas id=\"diva-canvas-minimap\"></canvas>' +\n                        '<div id=\"diva-canvas-buttons\">' +\n                            canvasButtons +\n                        '</div>' +\n                        '<div id=\"diva-canvas-pane\">' +\n                            '<p id=\"diva-canvas-tooltip\">' +\n                                '<span id=\"diva-canvas-mode\">contrast</span>: ' +\n                                '<span id=\"diva-canvas-value\">0</span> ' +\n                                '<span id=\"diva-canvas-reset\" class=\"link\">(Reset)</span>' +\n                            '</p>' +\n                            '<input type=\"range\" id=\"diva-canvas-slider\"></input>' +\n                        '</div>' +\n                        '<br />' +\n                        '<div class=\"action-buttons\">' +\n                            '<a href=\"#\" id=\"diva-canvas-reset-all\">Reset all</a>' +\n                            '<a href=\"#\" id=\"diva-canvas-apply\">Apply</a>' +\n                        '</div>' +\n                    '</div>' +\n                '</div>';\n                var canvasWrapper = '<div id=\"diva-canvas-wrapper\">' +\n                    '<canvas id=\"diva-canvas\"></canvas>' +\n                '</div>';\n                var canvasString = '<div id=\"diva-canvas-backdrop\">' +\n                    canvasTools +\n                    canvasWrapper +\n                '</div>';\n\n                $('body').append(canvasString);\n\n                // Save the size of the map, as defined in the CSS\n                settings.mapSize = $('#diva-canvas-minimap').width();\n\n                // Adjust the slider when something is clicked, and make that the current mode\n                $('#diva-canvas-buttons div').click(function ()\n                {\n                    $('#diva-canvas-buttons .clicked').removeClass('clicked');\n                    updateSlider($(this).attr('class'));\n                });\n\n                var updateSlider = function (newMode)\n                {\n                    sliderMode = newMode;\n                    var sliderData = sliders[sliderMode];\n\n                    $('#diva-canvas-buttons .' + sliderMode).addClass('clicked');\n\n                    $('#diva-canvas-mode').text(sliderMode);\n\n                    var newValue = sliderData.current;\n                    var newValueString = (sliderData.transform) ? sliderData.transform(newValue) : newValue;\n\n                    var slider = document.getElementById('diva-canvas-slider');\n                    slider.min = sliderData.min;\n                    slider.max = sliderData.max;\n                    slider.step = sliderData.step;\n                    $('#diva-canvas-slider').val(newValue);\n                    $('#diva-canvas-value').html(newValueString);\n                };\n\n                updateSlider('contrast');\n\n                // Create the slider\n                $('#diva-canvas-slider').on('input', function(e){\n                    sliders[sliderMode].current = parseFloat(this.value);\n                    updateSliderLabel();\n                    updateMap();\n                });\n\n                // Reset all the sliders to the default value\n                $('#diva-canvas-reset-all').click(function ()\n                {\n                    var slider;\n\n                    for (slider in sliders)\n                    {\n                        sliders[slider].current = sliders[slider].initial;\n                    }\n\n                    // Change the value of the label\n                    updateSliderLabel();\n                    updateSliderValue();\n\n                    // Update the preview\n                    updateMap();\n                });\n\n                // Reset the current slider to the default value\n                $('#diva-canvas-reset').click(function ()\n                {\n                    // Update the current value and the slider\n                    sliders[sliderMode].current = sliders[sliderMode].initial;\n                    updateSliderLabel();\n                    updateSliderValue();\n\n                    // Update the preview\n                    updateMap();\n                });\n\n                // Update the large canvas when the apply button is clicked\n                $('#diva-canvas-apply').click(function ()\n                {\n                    if (shouldAdjustLevels())\n                    {\n                        showThrobber();\n\n                        setTimeout(function ()\n                        {\n                            if (sliders.zoom.current !== sliders.zoom.previous)\n                            {\n                                updateZoom(sliders.zoom.current);\n                            }\n                            else\n                            {\n                                updateCanvas();\n                                hideThrobber();\n\n                                // Save modifications to localSettings (also done in updateZoom callback)\n                                saveSettings();\n                            }\n                        }, settings.throbberTimeout);\n                    }\n                });\n\n                // Handle exiting canvas mode\n                $('#diva-canvas-close').click(function ()\n                {\n                    $('body').removeClass('overflow-hidden');\n\n                    // Clear the canvases and hide things\n                    // This needs to be improved - not done properly?\n                    canvas.context.clearRect(0, 0, canvas.size, canvas.size);\n                    map.context.clearRect(0, 0, map.size, map.size);\n                    $('#diva-canvas-wrapper').scrollTop(0).scrollLeft(0);\n                    $('#diva-canvas-backdrop').hide();\n                    $('#diva-map-viewbox').hide();\n                    hideThrobber();\n\n                    // Re-enable scrolling of diva when it is in the background\n                    divaInstance.enableScrollable();\n                    $(document).off('keydown', bindCanvasKeyEvents);\n\n                    // Reset everything\n                    resetSliders();\n                    updateSliderLabel();\n                    updateSliderValue();\n                    $('#diva-canvas-buttons .clicked').removeClass('clicked');\n                    updateSlider('contrast');\n\n                    diva.Events.publish(\"CanvasViewDidHide\");\n                });\n\n                // Hide the toolbar when the minimise icon is clicked\n                $('#diva-canvas-minimise').click(function ()\n                {\n                    $('#diva-canvas-toolwindow').slideToggle('fast');\n                });\n\n                // Adjust the size of the canvas when the browser window is resized\n                $(window).resize(function ()\n                {\n                    settings.viewport = {\n                        height: window.innerHeight - divaSettings.scrollbarWidth,\n                        width: window.innerWidth - divaSettings.scrollbarWidth\n                    };\n\n                    // Always update the settings but only redraw if in canvas\n                    if (settings.inCanvas)\n                        updateViewbox();\n                });\n\n                // Update the viewbox when the large canvas is scrolled\n                $('#diva-canvas-wrapper').scroll(function ()\n                {\n                    if (settings.inCanvas)\n                        updateViewbox();\n                });\n\n                // Handle clicking/dragging of the viewbox (should scroll the large canvas)\n                $('#diva-canvas-minimap, #diva-map-viewbox').mouseup(function (event)\n                {\n                    // Consider caching this eventually (can't be done in init though)\n                    var offset = $('#diva-canvas-minimap').offset();\n\n                    var scaledX = (event.pageX - offset.left) / map.scaleFactor;\n                    var scaledY = (event.pageY - offset.top) / map.scaleFactor;\n\n                    $('#diva-canvas-wrapper').scrollTop(scaledY - settings.viewport.height / 2);\n                    $('#diva-canvas-wrapper').scrollLeft(scaledX - settings.viewport.width / 2);\n                });\n\n                // Enable drag scroll\n                $('#diva-canvas').mousedown(function ()\n                {\n                    $(this).addClass('grabbing');\n                }).mouseup(function ()\n                {\n                    $(this).removeClass('grabbing');\n                });\n\n                // touch events\n                $('#diva-canvas-wrapper').kinetic();\n\n                // mouse events\n                $('#diva-canvas-wrapper').dragscrollable({\n                    acceptPropagatedEvent: true\n                });\n\n                diva.Events.subscribe('ObjectDidLoad', this.setupHook, divaSettings.ID);\n                diva.Events.subscribe('ViewerDidTerminate', this.destroy, divaSettings.ID);\n                diva.Events.subscribe('PageDidLoad', this.onPageLoad, divaSettings.ID);\n\n                return true;\n            },\n\n            pluginName: 'canvas',\n\n            titleText: 'View the image on a canvas and adjust various settings',\n\n            setupHook: function(divaSettings)\n            {\n                settings.viewport = {\n                    height: window.innerHeight - divaSettings.scrollbarWidth,\n                    width: window.innerWidth - divaSettings.scrollbarWidth\n                };\n\n                // Save the min and max zoom level, and update the zoom slider\n                settings.minZoomLevel = divaSettings.minZoomLevel;\n                settings.maxZoomLevel = divaSettings.maxZoomLevel;\n\n                // If we're on the iPad, limit the max zoom level to 2\n                // Can't do canvas elements that are > 5 megapixels (issue #112)\n                if (settings.mobileWebkit)\n                    settings.maxZoomLevel = Math.min(settings.maxZoomLevel, settings.mobileWebkitMaxZoom);\n\n                sliders.zoom.min = settings.minZoomLevel;\n                sliders.zoom.max = settings.maxZoomLevel;\n            },\n\n            handleClick: function(event, divaSettings, divaInstance, selectedPageIndex)\n            {\n                // loadCanvas() calls all the other necessary functions to load\n                var filename = divaInstance.getFilenames()[selectedPageIndex];\n\n                // TODO: Move rationale for -1 from Wiki (TLDR an old IIP bug)\n                var width = divaInstance\n                    .getPageDimensions(selectedPageIndex)\n                    .width - 1;\n\n                var zoomLevel = divaSettings.zoomLevel;\n                var slider;\n\n                settings.zoomWidthRatio = width / Math.pow(2, zoomLevel);\n                settings.pluginIcon = $(this);\n\n                settings.manifest = divaSettings.manifest;\n                settings.selectedPageIndex = selectedPageIndex;\n\n                // Limit the max zoom level if we're on the iPad\n                if (settings.mobileWebkit) {\n                    zoomLevel = Math.min(settings.maxZoomLevel, zoomLevel);\n                }\n\n                settings.filename = filename;\n                sliders.zoom.initial = zoomLevel;\n                sliders.zoom.current = zoomLevel;\n\n                // Find the settings stored in localStorage, if they exist\n                var sliderSettings = loadStoredObject(settings.localStoragePrefix + settings.filename);\n                if (sliderSettings)\n                {\n                    for (slider in sliderSettings)\n                    {\n                        sliders[slider].current = sliderSettings[slider];\n\n                        // If the current slider's value has changed, update it\n                        if (slider === sliderMode)\n                        {\n                            updateSliderLabel();\n                            updateSliderValue();\n                        }\n\n                        if (slider === 'zoom')\n                        {\n                            zoomLevel = sliderSettings[slider];\n                        }\n                    }\n                }\n\n                sliders.zoom.previous = zoomLevel;\n\n                // Prevent scroll in body, and show the canvas backdrop\n                $('body').addClass('overflow-hidden');\n                $('#diva-canvas-backdrop').show();\n\n                // Disable scrolling on main diva instance\n                divaInstance.disableScrollable();\n                // Enable canvas scrolling\n                $(document).keydown(bindCanvasKeyEvents);\n\n                // Set this to true so events can be captured\n                settings.inCanvas = true;\n\n                var imageURL = getImageURL(zoomLevel);\n\n                // Change the title of the page\n                // FIXME: This is legacy behaviour. Should this be a filename/label?\n                $('#diva-canvas-info').text('Page ' + (selectedPageIndex + 1));\n\n                showThrobber();\n\n                diva.Events.publish('CanvasViewDidActivate', [selectedPageIndex]);\n\n                loadCanvas(imageURL);\n            },\n\n            onPageLoad: function(pageIndex, filename, selector)\n            {\n                // If something exists for this page in localStorage, then change icon color\n                var storageKey = settings.localStoragePrefix + filename;\n\n                if (localStorage.getItem(storageKey) !== null)\n                {\n                    $(selector).find('.diva-canvas-icon').addClass('new');\n                }\n            },\n\n            destroy: function(divaSettings, divaInstance)\n            {\n                $('#diva-canvas-backdrop').remove();\n            }\n        };\n\n        // this returns an object with all of the necessary hooks and callbacks\n        // embedded.\n        return retval;\n\n    })();\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugins/canvas.js\n// module id = 42\n// module chunks = 0","/*\nDownload plugin for diva.js\nAllows you to download images served by IIPImage or IIIF compatible image servers\n*/\n\nvar jQuery = require('jquery');\n\n(function ($)\n{\n    module.exports = (function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                settings.divaInstance = divaInstance;\n                return true;\n            },\n            pluginName: 'download',\n            titleText: 'Download image at the given zoom level',\n            handleClick: function(event, divaSettings, divaInstance, pageIndex)\n            {\n                // TODO: Move rationale for -1 from Wiki (TLDR an old IIP bug)\n                var width = divaInstance\n                        .getPageDimensions(pageIndex)\n                        .width - 1;\n\n                var image = settings.divaInstance.getPageImageURL(pageIndex, { width: width });\n\n                window.open(image);\n            }\n        };\n\n        return retval;\n    })();\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugins/download.js\n// module id = 43\n// module chunks = 0","/*\nHighlight plugin for diva.js\nAllows you to highlight regions of a page image\n*/\n\nvar jQuery = require('jquery');\nvar elt = require('../utils/elt');\nvar diva = require('../diva');\n\n(function ($)\n{\n    module.exports = (function()\n    {\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                var highlightManager = new HighlightManager(divaInstance);\n                divaSettings.parentObject.data('highlightManager', highlightManager);\n\n                var currentHighlight;\n\n                /*\n                    Reset the highlights object and removes all highlights from the document.\n                */\n                divaInstance.resetHighlights = function()\n                {\n                    highlightManager.clear();\n                };\n\n                /*\n                    Resets the highlights for a single page.\n                */\n                divaInstance.removeHighlightsOnPage = function(pageIdx)\n                {\n                    highlightManager.removeHighlightsOnPage(pageIdx);\n                };\n\n                /*\n                    Highlights regions on multiple pages.\n                    @param pageIdxs An array of page index numbers\n                    @param regions  An array of regions\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                */\n                divaInstance.highlightOnPages = function(pageIdxs, regions, colour, divClass)\n                {\n                    var j = pageIdxs.length;\n                    while (j--)\n                    {\n                        divaInstance.highlightOnPage(pageIdxs[j], regions[j], colour, divClass);\n                    }\n                };\n\n                /*\n                    Highlights regions on a page.\n                    @param pageIdx  A page index number\n                    @param regions  An array of regions. Use {'width':i, 'height':i, 'ulx':i, 'uly': i, 'divID': str} for each region.\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                    @param divClass (optional) A class to identify a group of highlighted regions on a specific page by\n                */\n                divaInstance.highlightOnPage = function(pageIdx, regions, colour, divClass)\n                {\n                    if (colour === undefined)\n                    {\n                        colour = 'rgba(255, 0, 0, 0.2)';\n                    }\n\n                    if (divClass === undefined)\n                    {\n                        divClass = divaSettings.ID + 'highlight diva-highlight';\n                    }\n                    else\n                    {\n                        divClass = divaSettings.ID + 'highlight diva-highlight ' + divClass;\n                    }\n\n                    highlightManager.addHighlight({\n                        page: pageIdx,\n                        regions: regions,\n                        colour: colour,\n                        divClass: divClass\n                    });\n\n                    return true;\n                };\n\n                /*\n                    Jumps to a highlight somewhere in the document.\n                    @param divID The ID of the div to jump to. This ID must be attached to the div using .highlightOnPage(s) as the highlight may not be currently appended to the DOM.\n                */\n                divaInstance.gotoHighlight = function(divID)\n                {\n                    var result = highlightManager.getHighlightByRegionId(divID);\n\n                    if (result)\n                        return gotoDiv(result.highlight.page, result.region);\n\n                    console.warn(\"Diva just tried to find a highlight that doesn't exist.\");\n                    return false;\n                };\n\n                /**\n                * Moves the diva pane to (page) and makes a darker border on (thisDiv)\n                */\n                var gotoDiv = function(page, thisDiv)\n                {\n                    //gets center of the div\n                    var centerYOfDiv = parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2;\n                    var centerXOfDiv = parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2;\n\n                    var desiredY = divaInstance.translateFromMaxZoomLevel(centerYOfDiv);\n                    var desiredX = divaInstance.translateFromMaxZoomLevel(centerXOfDiv);\n\n                    //navigates to the page\n                    page = parseInt(page, 10);\n                    divaInstance.gotoPageByIndex(page);\n                    var viewportObject = divaInstance.getSettings().viewportObject;\n                    var currentTop = viewportObject.scrollTop() + desiredY - (viewportObject.height() / 2) + divaSettings.verticalPadding;\n                    var currentLeft = viewportObject.scrollLeft() + desiredX - (viewportObject.width() / 2) + divaSettings.horizontalPadding;\n\n                    //changes the scroll location to center on the div as much as is possible\n                    viewportObject.scrollTop(currentTop);\n                    viewportObject.scrollLeft(currentLeft);\n\n                    currentHighlight = {\n                        region: thisDiv,\n                        page: page\n                    };\n\n                    diva.Events.publish(\"SelectedHighlightChanged\", [thisDiv.id, currentHighlight.page]);\n\n                    //selects the highlight\n                    updateCurrentHighlight(divaInstance, currentHighlight);\n                    return thisDiv.id;\n                };\n\n                var getDivCenter = function(thisDiv)\n                {\n                    if (divaSettings.verticallyOriented) return divaInstance.translateFromMaxZoomLevel(parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2);\n                    else return divaInstance.translateFromMaxZoomLevel(parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2);\n                };\n\n                /*\n                    Jumps to the next highlight along the primary axis of the document.\n                */\n                var findAdjacentHighlight = function(forward)\n                {\n                    var centerOfTargetDiv;\n                    var highlightFound = false;\n                    var centerOfCurrentDiv;\n                    var currentPage;\n                    var regionArr, arrIndex;\n                    var pageDims;\n                    var centerOfDiv, targetDiv;\n\n                    var thisDiv;\n                    var compFunction;\n\n                    // If currentHighlight does not already exists,\n                    // just pretend we're starting at the northwest corner of diva-inner\n                    if (!currentHighlight)\n                    {\n                        centerOfCurrentDiv = 0;\n                        currentPage = 0;\n                    }\n                    else {\n                        currentPage = currentHighlight.page;\n\n                        //find the center of the current div\n                        centerOfCurrentDiv = getDivCenter(currentHighlight.region);\n                    }\n\n                    //if we do have a current highlight, try to find the next one in the same page\n\n                    regionArr = highlightManager.getHighlightRegions(currentPage);\n                    arrIndex = regionArr.length;\n                    pageDims = divaInstance.getPageDimensionsAtZoomLevel(currentPage, divaInstance.getZoomLevel());\n\n                    //initialize the center of the div to the maximum possible value\n                    if(forward) centerOfTargetDiv = (divaSettings.verticallyOriented) ? pageDims.height : pageDims.width;\n                    else centerOfTargetDiv = 0;\n\n                    if(forward)\n                    {\n                        compFunction = function(thisC, curC, targetC)\n                        {\n                            return (thisC > curC && thisC < targetC);\n                        };\n                    }\n                    else\n                    {\n                        compFunction = function(thisC, curC, targetC)\n                        {\n                            return (thisC < curC && thisC > targetC);\n                        };\n                    }\n\n                    while(arrIndex--)\n                    {\n                        thisDiv = regionArr[arrIndex];\n                        centerOfDiv = getDivCenter(thisDiv);\n\n                        //if this div is farther along the main axis but closer than the current closest\n                        if (compFunction(centerOfDiv, centerOfCurrentDiv, centerOfTargetDiv))\n                        {\n                            //update targetDiv\n                            highlightFound = true;\n                            centerOfTargetDiv = centerOfDiv;\n                            targetDiv = thisDiv;\n                        }\n                    }\n\n                    //if a highlight was found on the current page that was next; this can get overwritten but we're still good\n                    if (highlightFound) return gotoDiv(currentPage, targetDiv);\n                    //if it wasn't found, continue on...\n\n                    //find the minimum div on the next page with highlights and loop around if necessary\n\n                    //find the next page in the pageArr; this will be in order\n                    var pageArr = highlightManager.getHighlightedPages();\n                    var curIdx = pageArr.indexOf(currentPage.toString());\n\n                    var targetPage;\n\n                    if(forward)\n                    {\n                        while (!targetPage || !divaInstance.isPageIndexValid (targetPage))\n                        {\n                            //default to first page, move to next if possible\n                            if (curIdx == pageArr.length - 1) targetPage = pageArr[0];\n                            else targetPage = pageArr[++curIdx];\n                        }\n                    }\n\n                    else\n                    {\n                        while (!targetPage || !divaInstance.isPageIndexValid (targetPage))\n                        {\n                            //default to last page, move to previous if possible\n                            if (curIdx === 0) targetPage = pageArr[pageArr.length - 1];\n                            else targetPage = pageArr[--curIdx];\n                        }\n                    }\n\n                    //reset regionArr and centerOfTargetDiv for the new page we're testing\n                    regionArr = highlightManager.getHighlightRegions(targetPage);\n                    arrIndex = regionArr.length;\n                    pageDims = divaInstance.getPageDimensionsAtZoomLevel(targetPage, divaInstance.getMaxZoomLevel());\n\n                    if(forward) centerOfTargetDiv = (divaSettings.verticallyOriented) ? pageDims.height : pageDims.width;\n                    else centerOfTargetDiv = 0;\n\n                    //find the minimum this time\n                    if(forward)\n                    {\n                        compFunction = function(thisC, targetC)\n                        {\n                            return (thisC < targetC);\n                        };\n                    }\n                    else\n                    {\n                        compFunction = function(thisC, targetC)\n                        {\n                            return (thisC > targetC);\n                        };\n                    }\n\n                    while(arrIndex--)\n                    {\n                        thisDiv = regionArr[arrIndex];\n                        centerOfDiv = getDivCenter(thisDiv);\n                        if (compFunction(centerOfDiv, centerOfTargetDiv))\n                        {\n                            highlightFound = true;\n                            centerOfTargetDiv = centerOfDiv;\n                            targetDiv = thisDiv;\n                        }\n                    }\n\n                    //we've found it this time, as there'll be a region in the full regionArr to be the minimum\n                    return gotoDiv(targetPage, targetDiv);\n                };\n\n                /*\n                    Jumps to the next highlight along the primary axis of the document.\n                */\n                divaInstance.gotoNextHighlight = function()\n                {\n                    if (highlightManager.getHighlightCount() > 0)\n                        return findAdjacentHighlight(true);\n                    else\n                        return false;\n                };\n\n                /*\n                    Jumps to the previous highlight along the primary axis of the document.\n                */\n                divaInstance.gotoPreviousHighlight = function()\n                {\n                    if (highlightManager.getHighlightCount() > 0)\n                        return findAdjacentHighlight(false);\n                    else\n                        return false;\n                };\n\n                diva.Events.subscribe('ViewerWillTerminate', this.destroy, divaSettings.ID);\n\n                return true;\n            },\n            destroy: function (divaSettings)\n            {\n                var highlightManager = divaSettings.parentObject.data('highlightManager');\n                highlightManager.clear();\n                divaSettings.parentObject.removeData('highlightManager');\n            },\n            pluginName: 'highlight',\n            titleText: 'Highlight regions of pages',\n\n            // Exposed export\n            HighlightManager: HighlightManager\n        };\n        return retval;\n    })();\n})(jQuery);\n\n/** Manages the addition and removal of the page overlays which display the highlights */\nfunction HighlightManager(divaInstance, getCurrentHighlight)\n{\n    this._divaInstance = divaInstance;\n    this._overlays = {};\n    this._getCurrentHighlight = getCurrentHighlight;\n}\n\nHighlightManager.prototype.getHighlightCount = function ()\n{\n    var count = 0;\n    Object.keys(this._overlays).forEach(function (key)\n    {\n        count += this._overlays[key].highlight.regions.length;\n    }, this);\n\n    return count;\n};\n\nHighlightManager.prototype.getHighlightRegions = function (pageIndex)\n{\n    if (!this._overlays[pageIndex])\n        return [];\n\n    return this._overlays[pageIndex].highlight.regions;\n};\n\nHighlightManager.prototype.getHighlightedPages = function ()\n{\n    // FIXME: Conceptually awkward that these are strings\n    return Object.keys(this._overlays);\n};\n\nHighlightManager.prototype.getHighlightByRegionId = function (id)\n{\n    for (var i in this._overlays)\n    {\n        if (!this._overlays.hasOwnProperty(i))\n            continue;\n\n        var regions = this._overlays[i].highlight.regions;\n        for (var j in regions)\n        {\n            if (!regions.hasOwnProperty(j))\n                continue;\n\n            if (regions[j].divID === id)\n            {\n                return {\n                    highlight: this._overlays[i].highlight,\n                    region: regions[j]\n                };\n            }\n        }\n    }\n\n    return null;\n};\n\nHighlightManager.prototype.addHighlight = function (highlight)\n{\n    var existingOverlay = this._overlays[highlight.page];\n\n    if (existingOverlay)\n        this._divaInstance.__removePageOverlay(existingOverlay);\n\n    var overlay = new HighlightPageOverlay(highlight, this._divaInstance, this._getCurrentHighlight);\n    this._overlays[highlight.page] = overlay;\n    this._divaInstance.__addPageOverlay(overlay);\n};\n\nHighlightManager.prototype.removeHighlightsOnPage = function (pageIndex)\n{\n    if (!this._overlays[pageIndex])\n        return;\n\n    this._divaInstance.__removePageOverlay(this._overlays[pageIndex]);\n    delete this._overlays[pageIndex];\n};\n\nHighlightManager.prototype.clear = function ()\n{\n    for (var i in this._overlays)\n    {\n        if (!this._overlays.hasOwnProperty(i))\n            continue;\n\n        this._divaInstance.__removePageOverlay(this._overlays[i]);\n    }\n\n    this._overlays = {};\n};\n\n/**\n When a new page is loaded, this overlay will be called with the\n page index for the page. It looks at the 'highlights' data object\n set on the diva parent element, and determines whether\n highlights exist for that page.\n\n If so, the overlay will create and render elements for every\n highlighted box.\n\n @param highlight\n @param divaInstance\n @param getCurrentHighlight (optional)\n */\nfunction HighlightPageOverlay(highlight, divaInstance, getCurrentHighlight)\n{\n    this.page = highlight.page;\n    this.highlight = highlight;\n    this._highlightRegions = [];\n    this._divaInstance = divaInstance;\n    this._getCurrentHighlight = getCurrentHighlight;\n}\n\nHighlightPageOverlay.prototype.mount = function ()\n{\n    var divaSettings = this._divaInstance.getSettings();\n\n    var highlight = this.highlight;\n    var regions = highlight.regions;\n    var colour = highlight.colour;\n    var divClass = highlight.divClass;\n\n    var j = regions.length;\n    while (j--)\n    {\n        var region = regions[j];\n\n        // FIXME: Use CSS class instead of inline style\n        var box = elt('div', {\n            class: divClass,\n            style: {\n                background: colour,\n                border: \"1px solid #555\",\n                position: \"absolute\",\n                zIndex: 100\n            }\n        });\n\n        if (region.divID !== undefined)\n        {\n            box.setAttribute('data-highlight-id', region.divID);\n        }\n\n        // Used by IIIFHighlight\n        if (region.name !== undefined)\n        {\n            box.setAttribute('data-name', region.name);\n        }\n\n        this._highlightRegions.push({\n            element: box,\n            region: region\n        });\n    }\n\n    this.refresh();\n\n    var frag = document.createDocumentFragment();\n    this._highlightRegions.forEach(function (highlight)\n    {\n        frag.appendChild(highlight.element);\n    });\n\n    divaSettings.innerElement.appendChild(frag);\n\n    if (this._getCurrentHighlight)\n        updateCurrentHighlight(this._divaInstance, this._getCurrentHighlight());\n\n    diva.Events.publish(\"HighlightCompleted\", [this.page, this._divaInstance.getFilenames()[this.page]]);\n};\n\nHighlightPageOverlay.prototype.unmount = function ()\n{\n    var innerElement = this._divaInstance.getSettings().innerElement;\n\n    this._highlightRegions.forEach(function (highlight)\n    {\n        innerElement.removeChild(highlight.element);\n    });\n\n    this._highlightRegions = [];\n};\n\n// FIXME: Updating a box per highlight region might be too expensive\n// Maybe stick all the elements in a container and then scale it using CSS transforms?\nHighlightPageOverlay.prototype.refresh = function ()\n{\n    var maxZoom = this._divaInstance.getMaxZoomLevel();\n\n    var maxZoomWidth = this._divaInstance.getPageDimensionsAtZoomLevel(this.page, maxZoom).width;\n    var currentWidth = this._divaInstance.getPageDimensions(this.page).width;\n    var zoomDifference = Math.log(maxZoomWidth / currentWidth) / Math.log(2);\n\n    var pageOffset = this._divaInstance.getPageOffset(this.page, {\n        excludePadding: true,\n        incorporateViewport: true\n    });\n\n    this._highlightRegions.forEach(function (highlight)\n    {\n        var region = highlight.region;\n\n        elt.setAttributes(highlight.element, {\n            style: {\n                width: incorporateZoom(region.width, zoomDifference) + \"px\",\n                height: incorporateZoom(region.height, zoomDifference) + \"px\",\n                top: pageOffset.top + incorporateZoom(region.uly, zoomDifference) + \"px\",\n                left: pageOffset.left + incorporateZoom(region.ulx, zoomDifference) + \"px\"\n            }\n        });\n    });\n};\n\nfunction incorporateZoom(position, zoomDifference)\n{\n    return position / Math.pow(2, zoomDifference);\n}\n\nfunction updateCurrentHighlight(divaInstance, currentHighlight)\n{\n    var classString = divaInstance.getInstanceId() + \"selected-highlight\";\n    var classElem = document.getElementsByClassName(classString);\n    var idx;\n    var box;\n    var boxes;\n\n    for (idx = 0; idx < classElem.length; idx++)\n    {\n        box = classElem[idx];\n        if (box.id !== currentHighlight.id)\n        {\n            box.className = box.className.replace(' '+classString, '');\n            box.style.border = \"1px solid #555\";\n        }\n    }\n\n    if (divaInstance.isPageInViewport(currentHighlight.page))\n    {\n        boxes = document.querySelectorAll(\"*[data-highlight-id=\" + currentHighlight.id + \"]\");\n        for(idx = 0; idx < boxes.length; idx++)\n        {\n            box = boxes[idx];\n            box.className = box.className + \" \" + classString;\n            box.style.border = \"2px solid #000\";\n        }\n    }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugins/highlight.js\n// module id = 44\n// module chunks = 0","/*\nIIIF Highlight plugin for diva.js\nAllows you to highlight regions of a page image based off of annotations in a IIIF Manifest\n*/\n\nvar jQuery = require('jquery');\nvar diva = require('../diva');\nvar HighlightManager = require('./highlight').HighlightManager;\n\n(function ($)\n{\n    module.exports = (function()\n    {\n        var settings = {};\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                var highlightManager = new HighlightManager(divaInstance);\n                divaSettings.parentObject.data('highlightManager', highlightManager);\n\n                settings.highlightedPages = [];\n\n                /*\n                    Reset the highlights object and removes all highlights from the document.\n                */\n                divaInstance.resetHighlights = function()\n                {\n                    highlightManager.clear();\n                };\n\n                /*\n                    Resets the highlights for a single page.\n                */\n                divaInstance.removeHighlightsOnPage = function(pageIdx)\n                {\n                    highlightManager.removeHighlightsOnPage(pageIdx);\n                };\n\n                divaInstance.hideHighlights = function()\n                {\n                    settings.highlightsVisible = false;\n                    $(divaSettings.innerElement).addClass('annotations-hidden');\n                };\n\n                divaInstance.showHighlights = function()\n                {\n                    settings.highlightsVisible = true;\n                    $(divaSettings.innerElement).removeClass('annotations-hidden');\n                };\n\n                /*\n                    Highlights regions on multiple pages.\n                    @param pageIdxs An array of page index numbers\n                    @param regions  An array of regions\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                */\n                divaInstance.highlightOnPages = function(pageIdxs, regions, colour, divClass)\n                {\n                    var j = pageIdxs.length;\n                    while (j--)\n                    {\n                        divaInstance.highlightOnPage(pageIdxs[j], regions[j], colour, divClass);\n                    }\n                };\n\n                /*\n                    Highlights regions on a page.\n                    @param pageIdx  A page index number\n                    @param regions  An array of regions. Use {'width':i, 'height':i, 'ulx':i, 'uly': i, 'divID': str} for each region.\n                    @param colour   (optional) A colour for the highlighting, specified in RGBA CSS format\n                    @param divClass (optional) A class to identify a group of highlighted regions on a specific page by\n                */\n                divaInstance.highlightOnPage = function(pageIdx, regions, colour, divClass)\n                {\n                    if (colour === undefined)\n                    {\n                        colour = 'rgba(255, 0, 0, 0.2)';\n                    }\n\n                    if (divClass === undefined)\n                    {\n                        divClass = divaSettings.ID + 'highlight diva-highlight';\n                    }\n                    else\n                    {\n                        divClass = divaSettings.ID + 'highlight diva-highlight ' + divClass;\n                    }\n\n                    highlightManager.addHighlight({\n                        page: pageIdx,\n                        regions: regions,\n                        colour: colour,\n                        divClass: divClass\n                    });\n\n                    return true;\n                };\n\n                                /*\n                    Jumps to a highlight somewhere in the document.\n                    @param divID The ID of the div to jump to. This ID must be attached to the div using .highlightOnPage(s) as the highlight may not be appended to the DOM.\n                */\n                divaInstance.gotoHighlight = function(divID)\n                {\n                    var result = highlightManager.getHighlightByRegionId(divID);\n\n                    if (result)\n                        return gotoDiv(result.highlight.page, result.region);\n\n                    console.warn(\"Diva just tried to find a highlight that doesn't exist.\");\n                    return false;\n                };\n\n                /**\n                 * Moves the diva pane to (page)\n                 */\n                var gotoDiv = function(page, thisDiv)\n                {\n                    //gets center of the div\n                    var centerYOfDiv = parseFloat(thisDiv.uly) + parseFloat(thisDiv.height) / 2;\n                    var centerXOfDiv = parseFloat(thisDiv.ulx) + parseFloat(thisDiv.width) / 2;\n\n                    var desiredY = divaInstance.translateFromMaxZoomLevel(centerYOfDiv);\n                    var desiredX = divaInstance.translateFromMaxZoomLevel(centerXOfDiv);\n\n                    //navigates to the page\n                    page = parseInt(page, 10);\n                    divaInstance.gotoPageByIndex(page);\n                    var viewportObject = divaInstance.getSettings().viewportObject;\n                    var currentTop = viewportObject.scrollTop() + desiredY - (viewportObject.height() / 2) + divaSettings.verticalPadding;\n                    var currentLeft = viewportObject.scrollLeft() + desiredX - (viewportObject.width() / 2) + divaSettings.horizontalPadding;\n\n                    //changes the scroll location to center on the div as much as is possible\n                    viewportObject.scrollTop(currentTop);\n                    viewportObject.scrollLeft(currentLeft);\n                };\n\n                var showAnnotations = function(canvasIndex)\n                {\n                    return function(data, status, jqXHR)\n                    {\n                        var canvasAnnotations = data;\n                        var numAnnotations = data.length;\n\n                        //convert annotations in annotations object to diva highlight objects\n                        var regions = [];\n\n                        //loop over annotations in a single canvas\n                        for (var k = 0; k < numAnnotations; k++)\n                        {\n                            var currentAnnotation = canvasAnnotations[k];\n                            // get text content\n                            var text = currentAnnotation.resource.chars;\n\n                            // get x,y,w,h (slice string from '#xywh=' to end)\n                            var onString = currentAnnotation.on;\n                            var coordString = onString.slice(onString.indexOf('#xywh=') + 6);\n                            var coordinates = coordString.split(',');\n\n                            var region = {\n                                ulx: parseInt(coordinates[0], 10),\n                                uly: parseInt(coordinates[1], 10),\n                                width: parseInt(coordinates[2], 10),\n                                height: parseInt(coordinates[3], 10),\n                                name: text\n                            };\n\n                            regions.push(region);\n                        }\n\n                        divaInstance.highlightOnPage(canvasIndex, regions);\n                        //flag this page's annotations as having been retrieved\n                        settings.highlightedPages.push(canvasIndex);\n                    };\n                };\n\n                var getAnnotationsList = function(pageIndex)\n                {\n                    //if page has annotationList\n                    var canvases = settings.manifest.sequences[0].canvases;\n\n                    if (canvases[pageIndex].hasOwnProperty('otherContent'))\n                    {\n                        var otherContent = canvases[pageIndex].otherContent;\n\n                        for (var j = 0; j < otherContent.length; j++)\n                        {\n                            if (otherContent[j]['@type'] === 'sc:AnnotationList')\n                            {\n                                // canvas has annotations. get the annotations:\n                                $.ajax({\n                                    url: otherContent[j]['@id'],\n                                    cache: true,\n                                    dataType: 'json',\n                                    success: showAnnotations(pageIndex)\n                                });\n                            }\n                        }\n                    }\n                };\n\n                var setManifest = function(manifest)\n                {\n                    settings.manifest = manifest;\n                };\n\n                diva.Events.subscribe('ManifestDidLoad', setManifest, divaSettings.ID);\n\n                diva.Events.subscribe('PageWillLoad', function(pageIndex)\n                {\n                    if (!settings.highlightsVisible)\n                    {\n                        return;\n                    }\n\n                    //if highlights for this page have already been checked/loaded, return\n                    for (var i = 0; i < settings.highlightedPages.length; i++)\n                    {\n                        if (settings.highlightedPages[i] === pageIndex)\n                        {\n                            return;\n                        }\n                    }\n\n                    getAnnotationsList(pageIndex, settings.manifest);\n                }, divaSettings.ID);\n\n                var activeOverlays = [];\n\n                //on mouseover, show the annotation text\n                divaSettings.innerObject.on('mouseenter', '.' + divaSettings.ID + 'highlight', function(e)\n                {\n                    var annotationElement = e.target;\n                    var name = annotationElement.dataset.name;\n                    var textOverlay = document.createElement('div');\n\n                    textOverlay.style.top = (annotationElement.offsetTop + annotationElement.offsetHeight - 1) + 'px';\n                    textOverlay.style.left = annotationElement.style.left;\n                    textOverlay.style.background = '#fff';\n                    textOverlay.style.border = '1px solid #555';\n                    textOverlay.style.position = 'absolute';\n                    textOverlay.style.zIndex = 101;\n                    textOverlay.className = 'annotation-overlay';\n                    textOverlay.textContent = name;\n\n                    annotationElement.parentNode.appendChild(textOverlay);\n                    activeOverlays.push(textOverlay);\n                });\n\n                divaSettings.innerObject.on('mouseleave', '.' + divaSettings.ID + 'highlight', function(e)\n                {\n                    while (activeOverlays.length)\n                    {\n                        var textOverlay = activeOverlays.pop();\n                        textOverlay.parentNode.removeChild(textOverlay);\n                    }\n                });\n\n                diva.Events.subscribe('ViewerDidLoad', function(){\n                    //button to toggle annotations\n                    $('#' + divaSettings.ID + 'page-nav').before('<div id=\"' + divaSettings.ID + 'annotations-icon\" class=\"diva-button diva-annotations-icon\" title=\"Turn annotations on or off\"></div>');\n\n                    $(divaSettings.selector + 'annotations-icon').addClass('annotations-icon-active');\n\n                    $('#' + divaSettings.ID + 'annotations-icon').on('click', function(e)\n                    {\n                        //toggle visibility of annotations\n                        if (settings.highlightsVisible)\n                        {\n                            divaInstance.hideHighlights();\n                            $(divaSettings.selector + 'annotations-icon').removeClass('annotations-icon-active');\n                        }\n                        else\n                        {\n                            divaInstance.showHighlights();\n                            $(divaSettings.selector + 'annotations-icon').addClass('annotations-icon-active');\n                        }\n                    });\n                }, divaSettings.ID);\n\n                //enable annotations by default\n                settings.highlightsVisible = true;\n\n                return true;\n            },\n            destroy: function (divaSettings, divaInstance)\n            {\n                divaSettings.parentObject.removeData('highlights');\n            },\n            pluginName: 'IIIFHighlight',\n            titleText: 'Highlight regions of pages'\n        };\n        return retval;\n    })();\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugins/iiif-highlight.js\n// module id = 45\n// module chunks = 0","// IIIF Metadata plugin for diva.js\n// Displays object metadata from a IIIF manifest\n\nvar jQuery = require('jquery');\nvar diva = require('../diva');\n\n(function ($)\n{\n    module.exports = (function()\n    {\n        var retval =\n        {\n            init: function(divaSettings, divaInstance)\n            {\n                var _displayMetadata = function(manifest)\n                {\n                    var showMetadata = function(label, value)\n                    {\n                        var labelProper = label.charAt(0).toUpperCase() + label.slice(1);\n                        var labelFormatted = labelProper.replace('_', ' ');\n\n                        if (value.match(/^https?:\\/\\//))\n                        {\n                            value = '<a href=\"' + value + '\" target=\"_blank\">' + value + '</a>';\n                        }\n\n                        return '<div class=\"metadata-row\"><span class=\"metadata-label\">' + labelFormatted + ':</span> <span class=\"metadata-value\">' +\n                            value  + '</span></div>';\n                    };\n\n                    var getDataForLanguage = function(data, language)\n                    {\n                        for (var i = 0; i < data.length; i++)\n                        {\n                            if (data[i]['@language'] === language)\n                            {\n                                return data[i]['@value'];\n                            }\n                        }\n\n                        // Handle the case where no language is specified, or when a single object is passed\n                        return data[0]['@value'] || data['@value'];\n                    };\n\n                    /**\n                     * Shows metadata from label names (if the metadata exists).\n                     * @param names {Array} - An array of strings representing field names to display.\n                     */\n                    var showMetadataFromLabelNames = function(names)\n                    {\n                        var elements = '';\n\n                        for (var i = 0; i < names.length; i++)\n                        {\n                            var field = names[i];\n\n                            if (manifest.hasOwnProperty(field))\n                            {\n                                if (manifest[field].constructor === Array)\n                                {\n                                    //multiple languages\n                                    var localizedData = getDataForLanguage(manifest[field], 'en');\n                                    elements += showMetadata(field, localizedData);\n                                }\n                                else\n                                {\n                                    elements += showMetadata(field, manifest[field]);\n                                }\n                            }\n                        }\n\n                        return elements;\n                    };\n\n                    var metadataElement = '<div id=\"' + divaSettings.ID + 'metadata\" class=\"diva-modal\">';\n                    metadataElement += showMetadataFromLabelNames(['label']);\n\n                    if (manifest.hasOwnProperty('metadata'))\n                    {\n                        var metadataField = manifest.metadata;\n\n                        for (var i = 0; i < metadataField.length; i++)\n                        {\n                            if (metadataField[i].value.constructor === Array)\n                            {\n                                var canonicalData = getDataForLanguage(metadataField[i].value, 'en');\n                                metadataElement += showMetadata(metadataField[i].label, canonicalData);\n                            }\n                            else\n                            {\n                                metadataElement += showMetadata(metadataField[i].label, metadataField[i].value);\n                            }\n                        }\n                    }\n\n                    metadataElement += showMetadataFromLabelNames([\n                        'description',\n                        'within',\n                        'see_also',\n                        'license',\n                        'attribution'\n                    ]);\n\n                    metadataElement += '</div>';\n\n                    divaSettings.parentObject.prepend(metadataElement);\n                    $(divaSettings.selector + 'metadata').hide();\n                };\n\n                //subscribe to ManifestDidLoad event, get the manifest\n                diva.Events.subscribe('ManifestDidLoad', _displayMetadata, divaSettings.ID);\n\n                divaSettings.parentObject.prepend('<div style=\"text-align: center; clear: both\"><a href=\"#\" id=\"' + divaSettings.ID + 'metadata-link\" class=\"diva-metadata-link\">Details</a></div>');\n                // $(divaSettings.selector + 'title').append('<div><a href=\"#\" id=\"' + divaSettings.ID + 'metadata-link\" class=\"diva-metadata-link\">Details</a></div>');\n\n                $(divaSettings.selector + 'metadata-link').on('click', function(e)\n                {\n                    $(divaSettings.selector + 'metadata').fadeToggle('fast');\n                });\n\n                return true;\n            },\n            destroy: function (divaSettings, divaInstance)\n            {\n            },\n            pluginName: 'IIIFMetadata',\n            titleText: 'Show metadata from a IIIF manifest'\n        };\n        return retval;\n    })();\n})(jQuery);\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./source/js/plugins/iiif-metadata.js\n// module id = 46\n// module chunks = 0"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC1LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC1PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACroCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AClRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC/rBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACv9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACjtBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC9LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACztEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACpkBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC1LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACnLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACzMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACpJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC/MA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AChSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AClFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC9GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACrKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACnKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACt8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC9jBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;","sourceRoot":""}