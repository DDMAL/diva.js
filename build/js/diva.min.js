Storage.prototype.setObject=function(b,e){this.setItem(b,JSON.stringify(e))};Storage.prototype.getObject=function(b){return(b=this.getItem(b))&&JSON.parse(b)};(function(b){var e=1;b.generateId=function(b){var d;do d=e++ +(b?"-"+b:"");while(document.getElementById(d));return d}})(jQuery);
(function(b){b.getScrollbarWidth=function(){var b=document.createElement("p");b.style.width="100%";b.style.height="200px";var c=document.createElement("div");c.style.position="absolute";c.style.top="0px";c.style.left="0px";c.style.visibility="hidden";c.style.width="200px";c.style.height="150px";c.style.overflow="hidden";c.appendChild(b);document.body.appendChild(c);var d=b.offsetWidth;c.style.overflow="scroll";b=b.offsetWidth;d==b&&(b=c.clientWidth);document.body.removeChild(c);return d-b}})(jQuery);
(function(b){b.getHashParam=function(b){var c=window.location.hash;if(""!==c){var d=0<c.indexOf("&"+b+"=")?c.indexOf("&"+b+"="):c.indexOf("#"+b+"=");if(0<=d)return d+=b.length+2,b=c.indexOf("&",d),b>d?c.substring(d,b):0>b?c.substring(d):""}return!1}})(jQuery);
(function(b){b.updateHashParam=function(e,c){var d=b.getHashParam(e),a=window.location.hash;if(d!==c)if("string"==typeof d){var f=0<a.indexOf("&"+e+"=")?a.indexOf("&"+e+"="):a.indexOf("#"+e+"="),d=f+e.length+2+d.length;window.location.replace(a.substring(0,f)+(0==f?"#":"&")+e+"="+c+a.substring(d))}else 0===a.length?window.location.replace("#"+e+"="+c):window.location.replace(a+"&"+e+"="+c)}})(jQuery);
jQuery.fn.oneFingerScroll=function(){var b,e;$(this).bind("touchstart",function(c){c=c.originalEvent;b=$(this).scrollTop()+c.touches[0].pageY;e=$(this).scrollLeft()+c.touches[0].pageX;c.preventDefault()});$(this).bind("touchmove",function(c){c=c.originalEvent;$(this).scrollTop(b-c.touches[0].pageY);$(this).scrollLeft(e-c.touches[0].pageX);c.preventDefault()});return this};
(function(b){b.fn.dragscrollable=function(e){var c,d,a,f=b.extend({dragSelector:">:first",acceptPropagatedEvent:!0,preventDefault:!0},e||{});a=function(a){if(1!=a.which||!a.data.acceptPropagatedEvent&&a.target!=this)return!1;a.data.lastCoord={left:a.clientX,top:a.clientY};b.event.add(document,"mouseup",c,a.data);b.event.add(document,"mousemove",d,a.data);if(a.data.preventDefault)return a.preventDefault(),!1};d=function(a){var b=a.clientX-a.data.lastCoord.left,c=a.clientY-a.data.lastCoord.top;a.data.scrollable.scrollLeft(a.data.scrollable.scrollLeft()-
b);a.data.scrollable.scrollTop(a.data.scrollable.scrollTop()-c);a.data.lastCoord={left:a.clientX,top:a.clientY};if(a.data.preventDefault)return a.preventDefault(),!1};c=function(a){b.event.remove(document,"mousemove",d);b.event.remove(document,"mouseup",c);if(a.data.preventDefault)return a.preventDefault(),!1};this.each(function(){var c={scrollable:b(this),acceptPropagatedEvent:f.acceptPropagatedEvent,preventDefault:f.preventDefault};b(this).find(f.dragSelector).bind("mousedown",c,a)})}})(jQuery);
(function(b,e){function c(a){return!b(a).parents().andSelf().filter(function(){return"hidden"===b.curCSS(this,"visibility")||b.expr.filters.hidden(this)}).length}function d(a,f){var d=a.nodeName.toLowerCase();if("area"===d){var d=a.parentNode,e=d.name;if(!a.href||!e||"map"!==d.nodeName.toLowerCase())return!1;d=b("img[usemap=#"+e+"]")[0];return!!d&&c(d)}return(/input|select|textarea|button|object/.test(d)?!a.disabled:"a"==d?a.href||f:f)&&c(a)}b.ui=b.ui||{};b.ui.version||(b.extend(b.ui,{version:"1.8.17",
keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),b.fn.extend({propAttr:b.fn.prop||b.fn.attr,_focus:b.fn.focus,focus:function(a,c){return"number"==typeof a?this.each(function(){var d=
this;setTimeout(function(){b(d).focus();c&&c.call(d)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;b.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?a=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(b.curCSS(this,"position",1))&&/(auto|scroll)/.test(b.curCSS(this,"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1))}).eq(0):a=this.parents().filter(function(){return/(auto|scroll)/.test(b.curCSS(this,
"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!a.length?b(document):a},zIndex:function(a){if(a!==e)return this.css("zIndex",a);if(this.length)for(var a=b(this[0]),c;a.length&&a[0]!==document;){c=a.css("position");if("absolute"===c||"relative"===c||"fixed"===c)if(c=parseInt(a.css("zIndex"),10),!isNaN(c)&&0!==c)return c;a=a.parent()}return 0},disableSelection:function(){return this.bind((b.support.selectstart?"selectstart":
"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),b.each(["Width","Height"],function(a,c){function d(a,c,f,e){b.each(i,function(){c-=parseFloat(b.curCSS(a,"padding"+this,!0))||0;f&&(c-=parseFloat(b.curCSS(a,"border"+this+"Width",!0))||0);e&&(c-=parseFloat(b.curCSS(a,"margin"+this,!0))||0)});return c}var i="Width"===c?["Left","Right"]:["Top","Bottom"],j=c.toLowerCase(),p={innerWidth:b.fn.innerWidth,innerHeight:b.fn.innerHeight,
outerWidth:b.fn.outerWidth,outerHeight:b.fn.outerHeight};b.fn["inner"+c]=function(a){return a===e?p["inner"+c].call(this):this.each(function(){b(this).css(j,d(this,a)+"px")})};b.fn["outer"+c]=function(a,e){return"number"!=typeof a?p["outer"+c].call(this,a):this.each(function(){b(this).css(j,d(this,a,!0,e)+"px")})}}),b.extend(b.expr[":"],{data:function(a,c,d){return!!b.data(a,d[3])},focusable:function(a){return d(a,!isNaN(b.attr(a,"tabindex")))},tabbable:function(a){var c=b.attr(a,"tabindex"),e=isNaN(c);
return(e||0<=c)&&d(a,!e)}}),b(function(){var a=document.body,c=a.appendChild(c=document.createElement("div"));b.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});b.support.minHeight=100===c.offsetHeight;b.support.selectstart="onselectstart"in c;a.removeChild(c).style.display="none"}),b.extend(b.ui,{plugin:{add:function(a,c,d){var a=b.ui[a].prototype,e;for(e in d)a.plugins[e]=a.plugins[e]||[],a.plugins[e].push([c,d[e]])},call:function(a,b,c){if((b=a.plugins[b])&&a.element[0].parentNode)for(var d=
0;d<b.length;d++)a.options[b[d][0]]&&b[d][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(a,c){if("hidden"===b(a).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;if(0<a[d])return!0;a[d]=1;e=0<a[d];a[d]=0;return e},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(a,c,d,e,j,p){return b.ui.isOverAxis(a,d,j)&&b.ui.isOverAxis(c,e,p)}}))})(jQuery);
(function(b,e){if(b.cleanData){var c=b.cleanData;b.cleanData=function(a){for(var d=0,e;null!=(e=a[d]);d++)try{b(e).triggerHandler("remove")}catch(i){}c(a)}}else{var d=b.fn.remove;b.fn.remove=function(a,c){return this.each(function(){c||(!a||b.filter(a,[this]).length)&&b("*",this).add([this]).each(function(){try{b(this).triggerHandler("remove")}catch(a){}});return d.call(b(this),a,c)})}}b.widget=function(a,c,d){var e=a.split(".")[0],j,a=a.split(".")[1];j=e+"-"+a;d||(d=c,c=b.Widget);b.expr[":"][j]=
function(c){return!!b.data(c,a)};b[e]=b[e]||{};b[e][a]=function(a,b){arguments.length&&this._createWidget(a,b)};c=new c;c.options=b.extend(!0,{},c.options);b[e][a].prototype=b.extend(!0,c,{namespace:e,widgetName:a,widgetEventPrefix:b[e][a].prototype.widgetEventPrefix||a,widgetBaseClass:j},d);b.widget.bridge(a,b[e][a])};b.widget.bridge=function(a,c){b.fn[a]=function(d){var i="string"==typeof d,j=Array.prototype.slice.call(arguments,1),p=this,d=!i&&j.length?b.extend.apply(null,[!0,d].concat(j)):d;if(i&&
"_"===d.charAt(0))return p;i?this.each(function(){var c=b.data(this,a),f=c&&b.isFunction(c[d])?c[d].apply(c,j):c;if(f!==c&&f!==e)return p=f,!1}):this.each(function(){var e=b.data(this,a);e?e.option(d||{})._init():b.data(this,a,new c(d,this))});return p}};b.Widget=function(a,b){arguments.length&&this._createWidget(a,b)};b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(a,c){b.data(c,this.widgetName,this);this.element=b(c);this.options=b.extend(!0,
{},this.options,this._getCreateOptions(),a);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(a,c){var d=a;if(0===arguments.length)return b.extend({},this.options);if("string"==typeof a){if(c===e)return this.options[a];d={};d[a]=c}this._setOptions(d);return this},_setOptions:function(a){var c=this;b.each(a,function(a,b){c._setOption(a,b)});return this},_setOption:function(a,b){this.options[a]=b;"disabled"===a&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
b);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(a,c,d){var e,j=this.options[a],d=d||{},c=b.Event(c);c.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();c.target=this.element[0];if(a=c.originalEvent)for(e in a)e in c||(c[e]=a[e]);this.element.trigger(c,d);return!(b.isFunction(j)&&!1===j.call(this.element[0],c,d)||c.isDefaultPrevented())}}})(jQuery);
(function(b){var e=!1;b(document).mouseup(function(){e=!1});b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var c=this;this.element.bind("mousedown."+this.widgetName,function(b){return c._mouseDown(b)}).bind("click."+this.widgetName,function(d){if(!0===b.data(d.target,c.widgetName+".preventClickEvent"))return b.removeData(d.target,c.widgetName+".preventClickEvent"),d.stopImmediatePropagation(),!1});this.started=!1},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName)},_mouseDown:function(c){if(!e){this._mouseStarted&&this._mouseUp(c);this._mouseDownEvent=c;var d=this,a=1==c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?b(c.target).closest(this.options.cancel).length:!1;if(!a||f||!this._mouseCapture(c))return!0;(this.mouseDelayMet=!this.options.delay)||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=!1!==this._mouseStart(c),
!this._mouseStarted))return c.preventDefault(),!0;!0===b.data(c.target,this.widgetName+".preventClickEvent")&&b.removeData(c.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(a){return d._mouseMove(a)};this._mouseUpDelegate=function(a){return d._mouseUp(a)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);c.preventDefault();return e=!0}},_mouseMove:function(c){if(b.browser.msie&&!(9<=document.documentMode)&&
!c.button)return this._mouseUp(c);if(this._mouseStarted)return this._mouseDrag(c),c.preventDefault();this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,c),this._mouseStarted?this._mouseDrag(c):this._mouseUp(c));return!this._mouseStarted},_mouseUp:function(c){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);this._mouseStarted&&(this._mouseStarted=!1,c.target==
this._mouseDownEvent.target&&b.data(c.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(c));return!1},_mouseDistanceMet:function(b){return Math.max(Math.abs(this._mouseDownEvent.pageX-b.pageX),Math.abs(this._mouseDownEvent.pageY-b.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);
(function(b){b.widget("ui.slider",b.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var e=this,c=this.options,d=this.element.find(".handle").addClass("ui-state-default ui-corner-all"),a=c.values&&c.values.length||1,f=[];this._mouseSliding=this._keySliding=!1;this._animateOff=!0;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(c.disabled?" ui-slider-disabled ui-disabled":""));this.range=b([]);c.range&&(!0===c.range&&(c.values||(c.values=[this._valueMin(),this._valueMin()]),c.values.length&&2!==c.values.length&&(c.values=[c.values[0],c.values[0]])),this.range=b("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===c.range||"max"===c.range?" ui-slider-range-"+c.range:"")));for(var g=d.length;g<a;g+=1)f.push("<a class='handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=d.add(b(f.join("")).appendTo(e.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){c.disabled||b(this).addClass("hover")},function(){b(this).removeClass("hover")}).focus(function(){c.disabled?b(this).blur():(b(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),b(this).addClass("ui-state-focus"))}).blur(function(){b(this).removeClass("ui-state-focus")});this.handles.each(function(a){b(this).data("index.handle",
a)});this.handles.keydown(function(a){var c=!0,d=b(this).data("index.handle"),h,f,g;if(!e.options.disabled){switch(a.keyCode){case b.ui.keyCode.HOME:case b.ui.keyCode.END:case b.ui.keyCode.PAGE_UP:case b.ui.keyCode.PAGE_DOWN:case b.ui.keyCode.UP:case b.ui.keyCode.RIGHT:case b.ui.keyCode.DOWN:case b.ui.keyCode.LEFT:if(c=!1,!e._keySliding&&(e._keySliding=!0,b(this).addClass("active"),h=e._start(a,d),!1===h))return}h=e.options.step;e.options.values&&e.options.values.length?f=g=e.values(d):f=g=e.value();
switch(a.keyCode){case b.ui.keyCode.HOME:g=e._valueMin();break;case b.ui.keyCode.END:g=e._valueMax();break;case b.ui.keyCode.PAGE_UP:g=e._trimAlignValue(f+(e._valueMax()-e._valueMin())/5);break;case b.ui.keyCode.PAGE_DOWN:g=e._trimAlignValue(f-(e._valueMax()-e._valueMin())/5);break;case b.ui.keyCode.UP:case b.ui.keyCode.RIGHT:if(f===e._valueMax())return;g=e._trimAlignValue(f+h);break;case b.ui.keyCode.DOWN:case b.ui.keyCode.LEFT:if(f===e._valueMin())return;g=e._trimAlignValue(f-h)}e._slide(a,d,g);
return c}}).keyup(function(a){var c=b(this).data("index.handle");e._keySliding&&(e._keySliding=!1,e._stop(a,c),e._change(a,c),b(this).removeClass("active"))});this._refreshValue();this._animateOff=!1},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();return this},_mouseCapture:function(e){var c=
this.options,d,a,f,g,i;if(c.disabled)return!1;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();d=this._normValueFromMouse({x:e.pageX,y:e.pageY});a=this._valueMax()-this._valueMin()+1;g=this;this.handles.each(function(c){var e=Math.abs(d-g.values(c));a>e&&(a=e,f=b(this),i=c)});!0===c.range&&this.values(1)===c.min&&(i+=1,f=b(this.handles[i]));if(!1===this._start(e,i))return!1;this._mouseSliding=!0;g._handleIndex=i;f.addClass("active").focus();
c=f.offset();this._clickOffset=!b(e.target).parents().andSelf().is(".handle")?{left:0,top:0}:{left:e.pageX-c.left-f.width()/2,top:e.pageY-c.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)};this.handles.hasClass("hover")||this._slide(e,i,d);return this._animateOff=!0},_mouseStart:function(){return!0},_mouseDrag:function(b){var c=this._normValueFromMouse({x:b.pageX,y:b.pageY});this._slide(b,this._handleIndex,
c);return!1},_mouseStop:function(b){this.handles.removeClass("active");this._mouseSliding=!1;this._stop(b,this._handleIndex);this._change(b,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(b){var c,d;"horizontal"===this.orientation?(c=this.elementSize.width,d=b.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:
0)):(c=this.elementSize.height,d=b.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0));b=d/c;1<b&&(b=1);0>b&&(b=0);"vertical"===this.orientation&&(b=1-b);c=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+b*c)},_start:function(b,c){var d={handle:this.handles[c],value:this.value()};this.options.values&&this.options.values.length&&(d.value=this.values(c),d.values=this.values());return this._trigger("start",b,d)},_slide:function(b,c,d){var a,f,g;this.options.values&&
this.options.values.length?(a=this.values(c?0:1),2===this.options.values.length&&!0===this.options.range&&(0===c&&d>a||1===c&&d<a)&&(d=a),d!==this.values(c)&&(f=this.values(),f[c]=d,g=this._trigger("slide",b,{handle:this.handles[c],value:d,values:f}),this.values(c?0:1),!1!==g&&this.values(c,d,!0))):d!==this.value()&&(g=this._trigger("slide",b,{handle:this.handles[c],value:d}),!1!==g&&this.value(d))},_stop:function(b,c){var d={handle:this.handles[c],value:this.value()};this.options.values&&this.options.values.length&&
(d.value=this.values(c),d.values=this.values());this._trigger("stop",b,d)},_change:function(b,c){if(!this._keySliding&&!this._mouseSliding){var d={handle:this.handles[c],value:this.value()};this.options.values&&this.options.values.length&&(d.value=this.values(c),d.values=this.values());this._trigger("change",b,d)}},value:function(b){if(arguments.length)this.options.value=this._trimAlignValue(b),this._refreshValue(),this._change(null,0);else return this._value()},values:function(e,c){var d,a,f;if(1<
arguments.length)this.options.values[e]=this._trimAlignValue(c),this._refreshValue(),this._change(null,e);else{if(!arguments.length)return this._values();if(!b.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();d=this.options.values;a=arguments[0];for(f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(a[f]),this._change(null,f);this._refreshValue()}},_setOption:function(e,c){var d,a=0;b.isArray(this.options.values)&&(a=this.options.values.length);
b.Widget.prototype._setOption.apply(this,arguments);switch(e){case "disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case "orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;
case "value":this._animateOff=!0;this._refreshValue();this._change(null,0);this._animateOff=!1;break;case "values":this._animateOff=!0;this._refreshValue();for(d=0;d<a;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){var b=this.options.value;return b=this._trimAlignValue(b)},_values:function(b){var c,d;if(arguments.length)return c=this.options.values[b],c=this._trimAlignValue(c);c=this.options.values.slice();for(d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c},_trimAlignValue:function(b){if(b<=
this._valueMin())return this._valueMin();if(b>=this._valueMax())return this._valueMax();var c=0<this.options.step?this.options.step:1,d=(b-this._valueMin())%c,b=b-d;2*Math.abs(d)>=c&&(b+=0<d?c:-c);return parseFloat(b.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e=this.options.range,c=this.options,d=this,a=this._animateOff?!1:c.animate,f,g={},i,j,p,h;this.options.values&&this.options.values.length?this.handles.each(function(e){f=
100*((d.values(e)-d._valueMin())/(d._valueMax()-d._valueMin()));g["horizontal"===d.orientation?"left":"bottom"]=f+"%";b(this).stop(1,1)[a?"animate":"css"](g,c.animate);!0===d.options.range&&("horizontal"===d.orientation?(0===e&&d.range.stop(1,1)[a?"animate":"css"]({left:f+"%"},c.animate),1===e&&d.range[a?"animate":"css"]({width:f-i+"%"},{queue:!1,duration:c.animate})):(0===e&&d.range.stop(1,1)[a?"animate":"css"]({bottom:f+"%"},c.animate),1===e&&d.range[a?"animate":"css"]({height:f-i+"%"},{queue:!1,
duration:c.animate})));i=f}):(j=this.value(),p=this._valueMin(),h=this._valueMax(),f=h!==p?100*((j-p)/(h-p)):0,g["horizontal"===d.orientation?"left":"bottom"]=f+"%",this.handle.stop(1,1)[a?"animate":"css"](g,c.animate),"min"===e&&"horizontal"===this.orientation&&this.range.stop(1,1)[a?"animate":"css"]({width:f+"%"},c.animate),"max"===e&&"horizontal"===this.orientation&&this.range[a?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:c.animate}),"min"===e&&"vertical"===this.orientation&&this.range.stop(1,
1)[a?"animate":"css"]({height:f+"%"},c.animate),"max"===e&&"vertical"===this.orientation&&this.range[a?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:c.animate}))}});b.extend(b.ui.slider,{version:"1.8.17"})})(jQuery);
(function(b){var e={decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:0.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}};window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}());b.support=b.support||{};b.extend(b.support,{touch:"ontouchend"in document});var c=function(){return false},d=function(a,b){var c=a;a>0?a>b&&(c=b):a<0-b&&(c=0-b);return c},a=function(a,b){this.removeClass(a.movingClass.up).removeClass(a.movingClass.down).removeClass(a.movingClass.left).removeClass(a.movingClass.right).removeClass(a.deceleratingClass.up).removeClass(a.deceleratingClass.down).removeClass(a.deceleratingClass.left).removeClass(a.deceleratingClass.right);
a.velocity>0&&this.addClass(b.right);a.velocity<0&&this.addClass(b.left);a.velocityY>0&&this.addClass(b.down);a.velocityY<0&&this.addClass(b.up)},f=function(b,c){var d=b[0];if(c.x&&d.scrollWidth>0){d.scrollLeft=c.scrollLeft=d.scrollLeft+c.velocity;if(Math.abs(c.velocity)>0)c.velocity=c.decelerate?Math.floor(Math.abs(c.velocity))===0?0:c.velocity*c.slowdown:c.velocity}else c.velocity=0;if(c.y&&d.scrollHeight>0){d.scrollTop=c.scrollTop=d.scrollTop+c.velocityY;if(Math.abs(c.velocityY)>0)c.velocityY=
c.decelerate?Math.floor(Math.abs(c.velocityY))===0?0:c.velocityY*c.slowdown:c.velocityY}else c.velocityY=0;a.call(b,c,c.deceleratingClass);typeof c.moved==="function"&&c.moved.call(b,c);Math.abs(c.velocity)>0||Math.abs(c.velocityY)>0?window.requestAnimationFrame(function(){f(b,c)}):typeof c.stopped==="function"&&c.stopped.call(b,c)},g=function(a,c){var d=b.kinetic.callMethods[a],e=Array.prototype.slice.call(arguments);d&&this.each(function(){var a=e.slice(1),c=b(this).data("kinetic-settings");a.unshift(c);
d.apply(this,a)})},i=function(a,d){var e=a[0];if(b.support.touch){e.addEventListener("touchstart",d.events.touchStart,false);e.addEventListener("touchend",d.events.inputEnd,false);e.addEventListener("touchmove",d.events.touchMove,false)}else a.mousedown(d.events.inputDown).mouseup(d.events.inputEnd).mousemove(d.events.inputMove);a.click(d.events.inputClick).bind("selectstart",c);a.bind("dragstart",d.events.dragStart)},j=function(c){this.addClass("kinetic-active").each(function(){var h=b.extend({},
e,c),g=this,j=b(this),m,q=false,n,k=false,t=false,F=1E3/h.throttleFPS,r,s;h.velocity=0;h.velocityY=0;var J=function(){t=n=m=false};b(document).mouseup(J).click(J);var G=function(){h.velocity=d(q-m,h.maxvelocity);h.velocityY=d(k-n,h.maxvelocity)},l=function(a){return b.isFunction(h.filterTarget)?h.filterTarget.call(g,a)!==false:true},o=function(a,b){t=true;h.velocity=q=0;h.velocityY=k=0;m=a;n=b},H=function(c,d){if(!r||new Date>new Date(r.getTime()+F)){r=new Date;if(t&&(m||n)){if(s){b(s).blur();s=null;
j.focus()}h.decelerate=false;h.velocity=h.velocityY=0;j[0].scrollLeft=h.scrollLeft=h.x?j[0].scrollLeft-(c-m):j[0].scrollLeft;j[0].scrollTop=h.scrollTop=h.y?j[0].scrollTop-(d-n):j[0].scrollTop;q=m;k=n;m=c;n=d;G();a.call(j,h,h.movingClass);typeof h.moved==="function"&&h.moved.call(j,h)}}};h.events={touchStart:function(a){if(l(a.target)){o(a.touches[0].clientX,a.touches[0].clientY);a.stopPropagation()}},touchMove:function(a){if(t){H(a.touches[0].clientX,a.touches[0].clientY);a.preventDefault&&a.preventDefault()}},
inputDown:function(a){if(l(a.target)){o(a.clientX,a.clientY);s=a.target;a.target.nodeName==="IMG"&&a.preventDefault();a.stopPropagation()}},inputEnd:function(a){if(m&&q&&h.decelerate===false){h.decelerate=true;G();m=q=t=false;f(j,h)}s=null;a.preventDefault&&a.preventDefault()},inputMove:function(a){if(t){H(a.clientX,a.clientY);a.preventDefault&&a.preventDefault()}},inputClick:function(a){if(Math.abs(h.velocity)>0){a.preventDefault();return false}},dragStart:function(){if(s)return false}};i(j,h);j.data("kinetic-settings",
h).css("cursor","move");h.triggerHardware&&j.css("-webkit-transform","translate3d(0,0,0)")})};b.kinetic={settingsKey:"kinetic-settings",callMethods:{start:function(a,c){var d=b(this);if(a=b.extend(a,c)){a.decelerate=false;f(d,a)}},end:function(a){b(this);if(a)a.decelerate=true},stop:function(a){a.velocity=0;a.velocityY=0;a.decelerate=true},detach:function(a){var d=b(this),e=d[0];if(b.support.touch){e.removeEventListener("touchstart",a.events.touchStart,false);e.removeEventListener("touchend",a.events.inputEnd,
false);e.removeEventListener("touchmove",a.events.touchMove,false)}else d.unbind("mousedown",a.events.inputDown).unbind("mouseup",a.events.inputEnd).unbind("mousemove",a.events.inputMove);d.unbind("click",a.events.inputClick).unbind("selectstart",c);d.unbind("dragstart",a.events.dragStart);d.removeClass("kinetic-active").css("cursor","")},attach:function(a){var c=b(this);i(c,a);c.addClass("kinetic-active").css("cursor","move")}}};b.fn.kinetic=function(a){typeof a==="string"?g.apply(this,arguments):
j.call(this,a);return this}})(window.jQuery||window.Zepto);window.divaPlugins=[];
(function(b){var e=function(c,d){var a=b.extend({},{adaptivePadding:0.05,contained:!1,divaserveURL:"",enableAutoHeight:!1,enableAutoTitle:!0,enableAutoWidth:!0,enableCanvas:!0,enableDownload:!0,enableFilename:!0,enableFullscreen:!0,enableGotoPage:!0,enableGrid:!0,enableGridSlider:!0,enableKeyScroll:!0,enableLink:!0,enableSpaceScroll:!1,enableZoomSlider:!0,fixedPadding:10,fixedHeightGrid:!0,goDirectlyTo:0,iipServerURL:"",inFullscreen:!1,inGrid:!1,imageDir:"",maxPagesPerRow:8,maxZoomLevel:-1,minPagesPerRow:2,
minZoomLevel:0,onModeToggle:null,onViewToggle:null,onJump:null,onPageLoad:null,onReady:null,onScroll:null,onScrollDown:null,onScrollUp:null,onZoom:null,onZoomIn:null,onZoomOut:null,pageLoadTimeout:200,pagesPerRow:5,rowLoadTimeout:50,tileFadeSpeed:0,tileHeight:256,tileWidth:256,viewportMargin:200,zoomLevel:2},d);b.extend(a,{allTilesLoaded:[],averageHeights:[],averageWidths:[],currentPageIndex:0,dimAfterZoom:0,firstPageLoaded:-1,firstRowLoaded:-1,gridPageWidth:0,hashParamSuffix:"",heightAbovePages:[],
horizontalOffset:0,horizontalPadding:0,ID:null,innerSelector:"",itemTitle:"",lastPageLoaded:-1,lastRowLoaded:-1,leftScrollSoFar:0,maxHeights:[],maxWidths:[],maxRatio:0,minHeight:0,minRatio:0,minWidth:0,mobileWebkit:!1,numPages:0,numRows:0,oldPagesPerRow:0,oldZoomLevel:-1,orientationChange:!1,originalHeight:0,originalWidth:0,outerSelector:"",pages:[],pageLeftOffsets:[],pageTimeouts:[],pageTools:"",panelHeight:0,panelWidth:0,plugins:[],previousTopScroll:0,preZoomOffset:null,realMaxZoom:-1,resizeTimer:-1,
rowHeight:0,scaleWait:!1,selector:"",scrollbarWidth:0,toolbar:null,topScrollSoFar:0,totalHeights:[],totalHeight:0,verticalOffset:0,verticalPadding:0,viewerXOffset:0,viewerYOffset:0});var e=this,g=function(a){var b,c,d;if("function"===typeof a){b=[];c=1;for(d=arguments.length;c<d;c++)b.push(arguments[c]);a.apply(e,b);return!0}return!1},i=function(b,c){return a.pages[b].d[a.zoomLevel][c]},j=function(b){var c;for(c=0;c<a.numPages;c++)if(a.pages[c].f===b)return c;return-1},p=function(b,c){var d=a.topScrollSoFar-
a.viewportMargin,e=d+a.panelHeight+2*a.viewportMargin;return b>=d&&b<=e||b<=d&&c>=e||c>=d&&c<=e},h=function(b){return 0<=b&&b<a.numPages},E=function(b){var c=a.heightAbovePages[b],b=c+i(b,"h")+a.verticalPadding;return p(c,b)},x=function(c){if(!(0<b(a.selector+"page-"+c).length&&a.allTilesLoaded[c])){var d=a.pages[c].f,e=i(c,"w"),f=i(c,"h"),l=a.heightAbovePages[c]+a.verticalPadding,h=a.selector+"page-"+c,A;if(!(0<b(a.selector+"page-"+c).length))for(A in b(a.innerSelector).append('<div id="'+a.ID+"page-"+
c+'" style="top: '+l+"px; width: "+e+"px; height: "+f+'px;" class="diva-document-page" title="Page '+(c+1)+'" data-index="'+c+'" data-filename="'+d+'">'+a.pageTools+"</div>"),g(a.onPageLoad,c,d,h),a.plugins)g(a.plugins[A].onPageLoad,c,d,h);a.pageTimeouts.push(setTimeout(function(){if(E(c)){var l=i(c,"r"),h=i(c,"c"),A=a.pages[c].m,g=a.iipServerURL+d+"&amp;JTL=",o=[],j=[],H=!0,u=0,z=f-(l-1)*a.tileHeight,w=e-(h-1)*a.tileWidth,v,K,D,I,q,t,m,n;for(v=0;v<l;v++)for(K=0;K<h;K++){q=v*a.tileHeight;t=K*a.tileWidth;
m=a.tileFadeSpeed?"none":"inline";n=a.zoomLevel+A-a.realMaxZoom;D=v===l-1?z:a.tileHeight;I=K===h-1?w:a.tileWidth;n=g+n+","+u;if(!(0<b(a.selector+"tile-"+c+"-"+u).length)){var k=a.heightAbovePages[c]+v*a.tileHeight+a.verticalPadding,N=a.pageLeftOffsets[c]+K*a.tileWidth,s=N+a.tileWidth;if(k=p(k,k+a.tileHeight))var k=a.leftScrollSoFar-a.viewportMargin,r=k+a.panelWidth+2*a.viewportMargin,L=s>=k&&s<=r,s=N<=k&&s>=r,k=N>=k&&N<=r||s||L;k?(j.push('<div id="'+a.ID+"tile-"+c+"-"+u+'" style="'+m+"; position: absolute; top: "+
q+"px; left: "+t+"px; background-image: url('"+n+"'); height: "+D+"px; width: "+I+'px;"></div>'),o.push(u)):H=!1}u++}a.allTilesLoaded[c]=H;if(o.length){b(a.selector+"page-"+c).append(j.join(""));for(l=0;l<o.length;l++)b(a.selector+"tile-"+c+"-"+o[l]).fadeIn(a.tileFadeSpeed)}}},a.pageLoadTimeout))}},m=function(c){b(a.selector+"page-"+c).empty().remove()},q=function(b,c){0<c?h(b)&&(E(b)?(x(b),a.lastPageLoaded=b,q(a.lastPageLoaded+1,c)):a.heightAbovePages[b]+i(b,"h")+a.verticalPadding<a.topScrollSoFar&&
q(b+1,c)):h(b)&&(E(b)?(x(b),a.firstPageLoaded=b,q(a.firstPageLoaded-1,c)):a.heightAbovePages[b]>a.topScrollSoFar+a.panelHeight&&q(b-1,c))},n=function(b,c){0<c?h(b)&&a.heightAbovePages[b]+i(b,"h")+a.verticalPadding<a.topScrollSoFar&&(m(b),a.firstPageLoaded=b+1,n(a.firstPageLoaded,c)):h(b)&&a.heightAbovePages[b]>a.topScrollSoFar+a.panelHeight&&(m(b),a.lastPageLoaded=b-1,n(a.lastPageLoaded,c))},k=function(b){return 0<=b&&b<a.numRows},t=function(b){b*=a.rowHeight;return p(b,b+a.rowHeight+a.fixedPadding)},
F=function(c){if(!(0<b(a.selector+"row-"+c).length)){var d=[];d.push('<div class="diva-row" id="'+a.ID+"row-"+c+'" style="height: '+a.rowHeight+"; top: "+(a.rowHeight*c+a.fixedPadding)+'px;">');var e,f,l,g,A,o;for(e=0;e<a.pagesPerRow;e++){f=c*a.pagesPerRow+e;if(!h(f))break;l=a.pages[f].f;g=i(f,"w");A=i(f,"h");o=a.fixedHeightGrid?(a.rowHeight-a.fixedPadding)*g/A:a.gridPageWidth;g=a.fixedHeightGrid?a.rowHeight-a.fixedPadding:o/g*A;A=parseInt(e*(a.fixedPadding+a.gridPageWidth)+a.fixedPadding,10);o=parseInt(o,
10);g=parseInt(g,10);A+=a.fixedHeightGrid?(a.gridPageWidth-o)/2:0;l=a.iipServerURL+l+"&amp;HEI="+(g+2)+"&amp;CVT=JPEG";d.push('<div id="'+a.ID+"page-"+f+'" class="diva-page" style="width: '+o+"px; height: "+g+"px; left: "+A+'px;" title="Page '+(f+1)+'"></div>');J(c,f,l,o,g)}d.push("</div>");b(a.innerSelector).append(d.join(""))}},r=function(b,c){0<c?k(b)&&(t(b)?(F(b),a.lastRowLoaded=b,r(a.lastRowLoaded+1,c)):a.rowHeight*(b+1)<a.topScrollSoFar&&r(b+1,c)):k(b)&&(t(b)?(F(b),a.firstRowLoaded=b,r(a.firstRowLoaded-
1,c)):a.rowHeight*b>a.topScrollSoFar+a.panelHeight&&r(b-1,c))},s=function(c,d){0<d?k(c)&&a.rowHeight*(c+1)<a.topScrollSoFar&&(b(a.selector+"row-"+c).empty().remove(),a.firstRowLoaded++,s(a.firstRowLoaded,d)):k(c)&&a.rowHeight*c>a.topScrollSoFar+a.panelHeight&&(b(a.selector+"row-"+c).empty().remove(),a.lastRowLoaded--,s(a.lastRowLoaded,d))},J=function(c,d,e,f,l){a.pageTimeouts.push(setTimeout(function(){t(c)&&b(a.selector+"page-"+d).html('<img src="'+e+'" style="width: '+f+"px; height: "+l+'px;" />')},
a.rowLoadTimeout))},G=function(b){var c=a.topScrollSoFar+a.panelHeight/2,d=a.currentPageIndex,e=a.currentPageIndex+parseInt(b,10),f=!1;0>b?0<=e&&a.heightAbovePages[e]+i(e,"h")+a.verticalPadding>=c&&(f=!0):0<b&&a.heightAbovePages[d]+i(d,"h")+a.verticalPadding<c&&(f=!0);return f?(a.currentPageIndex=e,0!==b&&(G(b)||a.toolbar.updateCurrentPage()),!0):!1},l=function(b){var c=Math.floor(a.currentPageIndex/a.pagesPerRow),d=c+parseInt(b,10),e=a.topScrollSoFar+a.panelHeight/2,f=!1;if(0>b){if(0<=d&&(a.rowHeight*
c>=e||a.rowHeight*d>=a.topScrollSoFar))f=!0}else 0<b&&a.rowHeight*(c+1)<a.topScrollSoFar&&k(d)&&(f=!0);return f?(a.currentPageIndex=d*a.pagesPerRow,0!==b&&(l(b)||a.toolbar.updateCurrentPage()),!0):!1},o=function(c,d,e){d=a.heightAbovePages[c]+d;e=(a.maxWidths[a.zoomLevel]-a.panelWidth)/2+a.horizontalPadding+e;b(a.outerSelector).scrollTop(d);b(a.outerSelector).scrollLeft(e);a.currentPageIndex=c;a.toolbar.updateCurrentPage();g(a.onJump,c)},H=function(c){var d=Math.floor(c/a.pagesPerRow)*a.rowHeight;
b(a.outerSelector).scrollTop(d);a.currentPageIndex=c;a.toolbar.updateCurrentPage()},z=function(){a.allTilesLoaded=[];b(a.outerSelector).scrollTop(0);a.topScrollSoFar=0;b(a.innerSelector).empty();a.firstPageLoaded=0;a.firstRowLoaded=-1;a.previousTopScroll=0;for(clearTimeout(a.resizeTimer);a.pageTimeouts.length;)clearTimeout(a.pageTimeouts.pop())},w=function(){a.inGrid?I():v()},v=function(){z();a.zoomLevel=a.zoomLevel>=a.minZoomLevel&&a.zoomLevel<=a.maxZoomLevel?a.zoomLevel:a.minZoomLevel;var c=a.zoomLevel;
0<a.adaptivePadding?(a.horizontalPadding=a.averageWidths[c]*a.adaptivePadding,a.verticalPadding=a.averageHeights[c]*a.adaptivePadding):(a.horizontalPadding=a.fixedPadding,a.verticalPadding=a.fixedPadding);a.plugins&&(a.verticalPadding=Math.max(40,a.horizontalPadding));a.totalHeight=a.totalHeights[c]+a.verticalPadding*(a.numPages+1);a.dimAfterZoom=a.totalHeight;var d=Math.max(a.maxWidths[c]+2*a.horizontalPadding,a.panelWidth),e=0,f;for(f=0;f<a.numPages;f++)a.heightAbovePages[f]=e,e=a.heightAbovePages[f]+
i(f,"h")+a.verticalPadding,a.pageLeftOffsets[f]=(d-i(f,"w"))/2,E(f)&&(x(f),a.lastPageLoaded=f);0<=a.oldZoomLevel&&(a.oldZoomLevel>a.zoomLevel?g(a.onZoomIn,c):g(a.onZoomOut,c),g(a.onZoom,c));b(a.innerSelector).height(Math.round(a.totalHeight));b(a.innerSelector).width(Math.round(d));a.preZoomOffset?(d=a.preZoomOffset.i,c=a.heightAbovePages[d]+a.verticalPadding,e=a.pageLeftOffsets[d],d=Math.pow(2,a.zoomLevel-a.oldZoomLevel),e=a.preZoomOffset.x*d-(a.preZoomOffset.originalX-a.viewerXOffset)+e,c=a.preZoomOffset.y*
d-(a.preZoomOffset.originalY-a.viewerYOffset)+c,b(a.outerSelector).scrollTop(c).scrollLeft(e),a.preZoomOffset=void 0):(h(a.goDirectlyTo)||(a.goDirectlyTo=0),o(a.goDirectlyTo,a.verticalOffset,a.horizontalOffset),a.horizontalOffset=0,a.verticalOffset=0);a.scaleWait&&(a.scaleWait=!1)},I=function(){z();a.pagesPerRow=a.pagesPerRow>=a.minPagesPerRow&&a.pagesPerRow<=a.maxPagesPerRow?a.pagesPerRow:a.maxPagesPerRow;var c=(a.panelWidth-a.fixedPadding*(a.pagesPerRow+1))/a.pagesPerRow;a.gridPageWidth=c;a.rowHeight=
a.fixedHeightGrid?a.fixedPadding+a.minRatio*c:a.fixedPadding+a.maxRatio*c;a.numRows=Math.ceil(a.numPages/a.pagesPerRow);a.totalHeight=a.numRows*a.rowHeight+a.fixedPadding;b(a.innerSelector).height(Math.round(a.totalHeight));b(a.innerSelector).width(Math.round(a.panelWidth));H(a.goDirectlyTo);for(var d,c=0;c<a.numPages;c+=a.pagesPerRow)d=Math.floor(c/a.pagesPerRow),t(d)&&(a.firstRowLoaded=0>a.firstRowLoaded?d:a.firstRowLoaded,F(d),a.lastRowLoaded=d)},O=function(c){if(0<=a.oldZoomLevel&&!a.inGrid){var d=
b(a.selector+"page-"+a.currentPageIndex).offset(),e=-(d.top-a.verticalPadding-a.viewerYOffset),f=(a.panelWidth-i(a.currentPageIndex,"w"))/2,d=-(d.left-a.viewerXOffset-f);a.verticalOffset=e;a.horizontalOffset=d}a.toolbar.switchMode();b(a.selector+"fullscreen").toggleClass("diva-in-fullscreen");b(a.outerSelector).toggleClass("diva-fullscreen");b("body").toggleClass("diva-hide-scrollbar");b(a.parentSelector).toggleClass("diva-full-width");a.panelHeight=b(a.outerSelector).height();a.panelWidth=b(a.outerSelector).width()-
a.scrollbarWidth;b(a.innerSelector).width(a.panelWidth);a.viewerXOffset=b(a.outerSelector).offset().left;a.viewerYOffset=b(a.outerSelector).offset().top;c?(a.inGrid=!a.inGrid,u()):w();g(a.onModeToggle)},u=function(){a.toolbar.switchSlider();w();g(a.onViewToggle)},D=function(){a.goDirectlyTo=a.currentPageIndex;a.inFullscreen=!a.inFullscreen;O()},L=function(){a.goDirectlyTo=a.currentPageIndex;a.inGrid=!a.inGrid;u()},M=function(b){var c=b>=a.minZoomLevel&&b<=a.maxZoomLevel?b:a.minZoomLevel;if(c!==b)return!1;
a.oldZoomLevel=a.zoomLevel;a.zoomLevel=c;a.toolbar.updateZoomSlider();v();return!0},P=function(b){var c=b>=a.minPagesPerRow&&b<=a.maxPagesPerRow?b:a.maxPagesPerRow;if(c!==b)return!1;a.oldPagesPerRow=a.zoomLevel;a.pagesPerRow=c;a.toolbar.updateGridSlider();I()},Q=function(){var c=a.inFullscreen,d=a.inGrid,e=a.zoomLevel,f=a.pagesPerRow,l=a.enableFilename?a.pages[a.currentPageIndex].f:!1,g=a.enableFilename?!1:a.currentPageIndex+1,h;a.inGrid?h=!1:(h=b(a.outerSelector).scrollTop(),h=parseInt(h-a.heightAbovePages[a.currentPageIndex],
10));var o;a.inGrid?o=!1:(o=(a.maxWidths[a.zoomLevel]+2*a.horizontalPadding-a.panelWidth)/2,o=parseInt(b(a.outerSelector).scrollLeft()-o,10));return{f:c,g:d,z:e,n:f,i:l,p:g,y:h,x:o,h:a.inFullscreen?!1:a.panelHeight,w:a.inFullscreen?!1:b(a.outerSelector).width()}},R=function(){var b=Q(),c=[],d;for(d in b)!1!==b[d]&&c.push(d+a.hashParamSuffix+"="+b[d]);return c.join("&")},S=function(){return location.protocol+"//"+location.host+location.pathname+"#"+R()},T=function(){var c=b(a.outerSelector).offset().top;
a.panelHeight=window.innerHeight-c-15;a.panelWidth=window.innerWidth-30;b(a.parentSelector).width(a.panelWidth);b(a.outerSelector).height(a.panelHeight).width(a.panelWidth)},B=function(){var c=b(a.outerSelector).height(),d=b(a.parentSelector).width()-a.scrollbarWidth,e=b(a.outerSelector).offset().top,f=window.innerWidth-30-a.scrollbarWidth-2,l=window.innerHeight-e-15-1;a.enableAutoHeight&&(c+e+16>window.innerHeight?c=l:c<=a.originalHeight&&(c=Math.min(l,a.originalHeight)));a.enableAutoWidth&&(d+32>
window.innerWidth?d=f:d<=a.originalWidth&&(d=Math.min(f,a.originalWidth)),b(a.parentSelector).width(d+a.scrollbarWidth));return d!==a.panelWidth||c!==a.panelHeight?(b(a.outerSelector).height(c).width(d+a.scrollbarWidth),a.panelWidth=d,a.panelHeight=c,!0):!1},y=function(c,d){c>=a.minWidth&&(a.originalWidth=c,b(a.outerSelector).width(c),a.panelWidth=c-a.scrollbarWidth,b(a.parentSelector).width(c));d>=a.minHeight&&(a.originalHeight=d,b(a.outerSelector).height(d),a.panelHeight=d)},C=function(){a.enableFullscreen&&
b(a.selector+"fullscreen").click(function(){D()});b(a.innerSelector).mouseover(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});b(a.innerSelector).mouseout(function(){b(this).removeClass("diva-grab")});b(a.innerSelector).mousedown(function(){b(this).removeClass("diva-grab").addClass("diva-grabbing")});b(a.innerSelector).mouseup(function(){b(this).removeClass("diva-grabbing").addClass("diva-grab")});b(a.outerSelector+", "+a.innerSelector).dragscrollable({dragSelector:".diva-dragger",
acceptPropagatedEvent:!0});b(a.outerSelector).scroll(function(){if(a.inGrid){a.topScrollSoFar=b(a.outerSelector).scrollTop();var c=a.topScrollSoFar-a.previousTopScroll;0>c?(r(a.firstRowLoaded,-1),l(-1),s(a.lastRowLoaded,-1)):0<c&&(r(a.lastRowLoaded,1),l(1),s(a.firstRowLoaded,1));g(a.onScroll,a.topScrollSoFar);0<c?g(a.onScrollDown,a.topScrollSoFar):0>c&&g(a.onScrollUp,a.topScrollSoFar);a.previousTopScroll=a.topScrollSoFar}else{a.topScrollSoFar=b(a.outerSelector).scrollTop();var c=a.topScrollSoFar-
a.previousTopScroll,d;if(0>c)q(a.firstPageLoaded,c),G(-1),n(a.lastPageLoaded,c);else if(0<c)q(a.lastPageLoaded,c),G(1),n(a.firstPageLoaded,c);else for(d=Math.max(a.firstPageLoaded,0);d<=a.lastPageLoaded;d++)E(d)&&x(d);g(a.onScroll,a.topScrollSoFar);0<c?g(a.onScrollDown,a.topScrollSoFar):0>c&&g(a.onScrollUp,a.topScrollSoFar);a.previousTopScroll=a.topScrollSoFar;a.leftScrollSoFar=b(this).scrollLeft()}});b(a.outerSelector).on("dblclick",".diva-document-page",function(c){var d=b(this).offset();a.preZoomOffset=
{x:c.pageX-d.left,y:c.pageY-d.top,originalX:c.pageX,originalY:c.pageY,i:b(this).attr("data-index")};M(c.ctrlKey?a.zoomLevel-1:a.zoomLevel+1)});b(a.outerSelector).on("contextmenu",".diva-document-page",function(a){if(a.ctrlKey)return!1});b(a.outerSelector).on("dblclick",".diva-row",function(c){var d=c.pageX-a.viewerXOffset+b(a.outerSelector).scrollLeft(),c=c.pageY-a.viewerYOffset+b(a.outerSelector).scrollTop();a.goDirectlyTo=Math.floor(c/a.rowHeight)*a.pagesPerRow+Math.floor(d/(a.panelWidth/a.pagesPerRow));
a.inGrid=!1;u()});if(a.mobileWebkit){var c=[];c.push('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />');c.push('<meta name="apple-mobile-web-app-capable" content="yes" />');c.push('<meta name="apple-mobile-web-app-status-bar-style" content="black" />');b("head").append(c.join("\n"));b("body").bind("touchmove",function(a){a.originalEvent.preventDefault();return!1});b("body").bind("gestureend",function(b){b=b.originalEvent;if(!a.scaleWait)if(a.goDirectlyTo=
a.currentPageIndex,a.inGrid)a.inGrid=!1,u();else a:{var c=a.zoomLevel;if(1<b.scale&&c<a.maxZoomLevel)c++;else if(1>b.scale&&c>a.minZoomLevel)c--;else break a;a.scaleWait=!0;M(c)}return!1});b("body").bind("orientationchange",function(){a.orientationChange=!0;T();a.goDirectlyTo=a.currentPageIndex;w()});b(a.outerSelector).kinetic()}if(a.enableSpaceScroll||a.enableKeyScroll){var d=b.ui.keyCode.SPACE,e=b.ui.keyCode.PAGE_UP,f=b.ui.keyCode.PAGE_DOWN,h=b.ui.keyCode.HOME,o=b.ui.keyCode.END;b(document).keydown(function(c){if(a.enableSpaceScroll&&
c.keyCode===d||a.enableKeyScroll&&c.keyCode===f)return b(a.outerSelector).scrollTop(a.topScrollSoFar+a.panelHeight),!1;if(a.enableKeyScroll&&c.keyCode===e)return b(a.outerSelector).scrollTop(a.topScrollSoFar-a.panelHeight),!1;if(a.enableKeyScroll&&c.keyCode===h)return b(a.outerSelector).scrollTop(0),!1;if(a.enableKeyScroll&&c.keyCode===o)return b(a.outerSelector).scrollTop(a.totalHeight),!1});a.mobileWebkit||b(window).resize(function(){var b;a.inFullscreen?(a.panelWidth=window.innerWidth-a.scrollbarWidth,
a.panelHeight=window.innerHeight,b=!0):b=B();b&&(clearTimeout(a.resizeTimer),a.resizeTimer=setTimeout(function(){a.goDirectlyTo=a.currentPageIndex;w()},200))})}},V=function(){var c=a.enableGrid?'<div class="diva-grid-icon'+(a.inGrid?" diva-in-grid":"")+'" id="'+a.ID+'grid-icon" title="Toggle grid view"></div>':"",d=a.enableLink?'<div class="diva-link-icon" id="'+a.ID+'link-icon" style="'+(a.enableGrid?"border-left: 0px":"")+'" title="Link to this page"></div>':"",e=a.enableZoomSlider?'<div id="'+
a.ID+'zoom-slider"></div>':"",f=a.enableGridSlider?'<div id="'+a.ID+'grid-slider"></div>':"",l=a.enableGotoPage?'<form id="'+a.ID+'goto-page" class="diva-goto-form"><input type="text" id="'+a.ID+'goto-page-input" / class="diva-input"> <input type="submit" value="Go" style="margin-top: 0px;" /></form>':"",g=a.enableZoomSlider?'<div id="'+a.ID+'zoom-slider-label" class="diva-slider-label">Zoom level: <span id="'+a.ID+'zoom-level">'+a.zoomLevel+"</span></div>":"",j=a.enableGridSlider?'<div id="'+a.ID+
'grid-slider-label" class="diva-slider-label">Pages per row: <span id="'+a.ID+'pages-per-row">'+a.pagesPerRow+"</span></div>":"",u='<div class="diva-page-label">Page <span id="'+a.ID+'current-page">1</span> of <span id="'+a.ID+'num-pages">'+a.numPages+"</span></div>",i="";a.contained&&("static"===b(a.parentSelector).css("position")&&b(a.parentSelector).addClass("diva-relative-position"),i=" diva-fullscreen-space",a.enableAutoTitle&&b(a.selector+"fullscreen").addClass("diva-contained"));c='<div id="'+
a.ID+'tools-left" class="diva-tools-left'+i+'">'+e+f+g+j+'</div><div id="'+a.ID+'tools-right" class="diva-tools-right">'+d+c+'<div class="diva-page-nav">'+l+u+"</div></div>";b(a.parentSelector).prepend('<div id="'+a.ID+'tools" class="diva-tools">'+c+"</div>");b(a.selector+"zoom-slider").slider({value:a.zoomLevel,min:a.minZoomLevel,max:a.maxZoomLevel,step:1,slide:function(c,d){var e=a.currentPageIndex;a.goDirectlyTo=e;var f=Math.pow(2,d.value-a.zoomLevel),l=a.maxWidths[a.zoomLevel]+a.horizontalPadding*
2,U=b(a.outerSelector).scrollLeft()-(l-a.panelWidth)/2;a.horizontalOffset=l>a.panelWidth?U*f:0;a.verticalOffset=f*(b(a.outerSelector).scrollTop()-a.heightAbovePages[e]);M(d.value)},change:function(b,c){c.value!==a.zoomLevel&&M(c.value)}});b(a.selector+"grid-slider").slider({value:a.pagesPerRow,min:a.minPagesPerRow,max:a.maxPagesPerRow,step:1,slide:function(a,b){P(b.value)},change:function(b,c){c.value!==a.pagesPerRow&&P(c.value)}});b(a.selector+"grid-icon").click(function(){L()});b(a.selector+"goto-page").submit(function(){var c=
parseInt(b(a.selector+"goto-page-input").val(),10)-1;h(c)?a.inGrid?H(c):o(c,0,0):alert("Invalid page number");return false});b(a.selector+"link-icon").click(function(){b("body").prepend('<div id="'+a.ID+'link-popup" class="diva-link-popup"><input id="'+a.ID+'link-popup-input" class="diva-input" type="text" value="'+S()+'"/></div>');if(a.inFullscreen)b(a.selector+"link-popup").addClass("in-fullscreen");else{var c=b(a.outerSelector).offset().left+a.panelWidth,c=c+(a.scrollbarWidth-240-1),d=b(a.outerSelector).offset().top+
1;b(a.selector+"link-popup").removeClass("in-fullscreen").css({top:d+"px",left:c+"px"})}b("body").mouseup(function(c){c=c.target.id;c!==a.ID+"link-popup"&&c!==a.ID+"link-popup-input"&&b(a.selector+"link-popup").remove()});b(a.outerSelector).scroll(function(){b(a.selector+"link-popup").remove()});b(a.selector+"link-popup input").click(function(){b(this).focus().select()});return false});var z=a.inGrid?"grid":"zoom";b(a.selector+z+"-slider").show();b(a.selector+z+"-slider-label").show();return{updateCurrentPage:function(){b(a.selector+
"current-page").text(a.currentPageIndex+1)},setNumPages:function(c){b(a.selector+"num-pages").text(c)},updateZoomSlider:function(){a.zoomLevel!==b(a.selector+"zoom-slider").slider("value")&&b(a.selector+"zoom-slider").slider({value:a.zoomLevel});b(a.selector+"zoom-level").text(a.zoomLevel)},updateGridSlider:function(){a.pagesPerRow!==b(a.selector+"grid-slider").slider("value")&&b(a.selector+"grid-slider").slider({value:a.pagesPerRow});b(a.selector+"pages-per-row").text(a.pagesPerRow)},switchSlider:function(){b(a.selector+
z+"-slider").hide();b(a.selector+z+"-slider-label").hide();z=a.inGrid?"grid":"zoom";b(a.selector+z+"-slider").show();b(a.selector+z+"-slider-label").show();b(a.selector+"grid-icon").toggleClass("diva-in-grid")},switchMode:function(){b(a.selector+"tools").toggleClass("diva-fullscreen-tools");if(a.inFullscreen){b(a.selector+"tools-right").after(b(a.selector+"tools-left"));b(a.selector+"tools-left").addClass("in-fullscreen")}else{b(a.selector+"tools-left").after(b(a.selector+"tools-right"));b(a.selector+
"tools-left").removeClass("in-fullscreen")}}}},W=function(){if(window.divaPlugins){var c=['<div class="diva-page-tools">'];b.each(window.divaPlugins,function(d,e){var f=e.pluginName[0].toUpperCase()+e.pluginName.substring(1);a["enable"+f]&&(g(e.init,a),f=e.titleText||f+" plugin","function"===typeof e.handleClick&&(c.push('<div class="diva-'+e.pluginName+'-icon" title="'+f+'"></div>'),b(a.outerSelector).delegate(".diva-"+e.pluginName+"-icon","click",function(b){e.handleClick.call(this,b,a)})),a.plugins.push(e))});
c.push("</div>");a.pageTools=c.join("")}},X=function(){b.ajax({url:a.divaserveURL,data:{d:a.imageDir},cache:!0,dataType:"json",error:function(c){b(a.outerSelector).text("Invalid URL. Error code: "+c.status)},success:function(c){a.pages=c.pgs;a.maxRatio=c.dims.max_ratio;a.minRatio=c.dims.min_ratio;a.itemTitle=c.item_title;a.numPages=c.pgs.length;a.maxWidths=c.dims.max_w;a.maxHeights=c.dims.max_h;a.averageWidths=c.dims.a_wid;a.averageHeights=c.dims.a_hei;a.totalHeights=c.dims.t_hei;a.realMaxZoom=c.max_zoom;
a.maxZoomLevel=0<=a.maxZoomLevel&&a.maxZoomLevel<=c.max_zoom?a.maxZoomLevel:c.max_zoom;a.minZoomLevel=0<=a.minZoomLevel&&a.minZoomLevel<=a.maxZoomLevel?a.minZoomLevel:0;a.minPagesPerRow=Math.max(2,a.minPagesPerRow);a.maxPagesPerRow=Math.max(a.minPagesPerRow,a.maxPagesPerRow);a.enableFilename?(c=b.getHashParam("i"+a.hashParamSuffix),c=j(c)):c=parseInt(b.getHashParam("p"+a.hashParamSuffix),10)-1;h(c)&&(a.goDirectlyTo=c);b.each(a.plugins,function(b,c){g(c.setupHook,a)});a.toolbar=V();b(a.selector+"current label").text(a.numPages);
a.enableAutoTitle&&b(a.parentSelector).prepend('<div id="'+a.ID+'title" class="diva-title">'+a.itemTitle+"</div>");a.mobileWebkit?T():(a.originalWidth=b(a.parentSelector).width()-a.scrollbarWidth,a.originalHeight=b(a.outerSelector).height(),B());c=b(a.outerSelector).offset();a.viewerXOffset=c.left;a.viewerYOffset=c.top;a.inFullscreen?O():w();g(a.onReady,a)}})};(function(){a.scrollbarWidth=b.getScrollbarWidth();a.mobileWebkit=void 0!==window.orientation;a.ID=b.generateId("diva-");a.selector="#"+a.ID;
var c=parseInt(a.ID,10);1<c&&(a.hashParamSuffix=c);a.outerSelector=a.selector+"outer";a.innerSelector=a.selector+"inner";b(a.parentSelector).append('<div id="'+a.ID+'outer" class="diva-outer"></div>');b(a.outerSelector).append('<div id="'+a.ID+'inner" class="diva-inner diva-dragger"></div>');a.enableFullscreen&&b(a.parentSelector).prepend('<div id="'+a.ID+'fullscreen" class="diva-fullscreen-icon" title="Toggle fullscreen mode"></div>');c=parseInt(b.getHashParam("n"+a.hashParamSuffix),10);c>=a.minPagesPerRow&&
c<=a.maxPagesPerRow&&(a.pagesPerRow=c);c=b.getHashParam("z"+a.hashParamSuffix);""!==c&&(c=parseInt(c,10),c>=a.minZoomLevel&&(a.zoomLevel=c));c=parseInt(b.getHashParam("y"+a.hashParamSuffix),10);isNaN(c)||(a.verticalOffset=c);c=parseInt(b.getHashParam("x"+a.hashParamSuffix),10);isNaN(c)||(a.horizontalOffset=c);var c=b.getHashParam("g"+a.hashParamSuffix),d="true"===c,e=b.getHashParam("f"+a.hashParamSuffix);a.inGrid=a.inGrid&&"false"!==c||d;a.inFullscreen=a.inFullscreen&&"false"!==e||"true"===e;c=parseInt(b.getHashParam("h"+
a.hashParamSuffix),10);d=parseInt(b.getHashParam("w"+a.hashParamSuffix),10);a.minHeight=parseInt(b(a.outerSelector).css("min-height"),10);a.minWidth=parseInt(b(a.outerSelector).css("min-width"),10);(0<c||0<d)&&y(d,c);X();W();C()})();this.getItemTitle=function(){return a.itemTitle};this.gotoPage=function(a){a-=1;h(a)&&o(a)};this.getCurrentPage=function(){return a.currentPageIndex};this.getZoomLevel=function(){return a.zoomLevel};this.setZoomLevel=function(a){return M(a)};this.zoomIn=function(){return this.setZoomLevel(a.zoomLevel+
1)};this.zoomOut=function(){return this.setZoomLevel(a.zoomLevel-1)};this.inViewport=function(b,c,d){b=a.heightAbovePages[b-1]+c;return p(b,b+d)};this.toggleMode=function(){D()};this.enterFullscreen=function(){if(a.inFullscreen)return!1;D();return!0};this.leaveFullscreen=function(){return a.inFullscreen?(D(),!0):!1};this.toggleView=function(){L()};this.enterGrid=function(){if(a.inGrid)return!1;L();return!0};this.leaveGrid=function(){return a.inGrid?(L(),!0):!1};this.gotoPageByName=function(a){a=j(a);
return h(a)?(o(a),!0):!1};this.getPageIndex=function(a){return j(a)};this.getCurrentURL=function(){return S()};this.getURLHash=function(){return R()};this.getState=function(){return Q()};this.setState=function(b){var c;y(b.w,b.h);c=j(b.i);h(c)?a.goDirectlyTo=c:h(b.p)&&(a.goDirectlyTo=b.p);a.horizontalOffset=parseInt(b.x,10);a.verticalOffset=parseInt(b.y,10);b.z>=a.minZoomLevel&&b.z<=a.maxZoomLevel&&(a.zoomLevel=b.z);b.n>=a.minPagesPerRow&&b.n<=a.maxPagesPerRow&&(a.pagesPerRow=b.n);a.inFullscreen!==
b.f?(a.inFullscreen=b.f,O(a.inGrid!==b.g)):a.inGrid!==b.g?(a.inGrid=b.g,u()):w()};this.resize=function(a,b){y(a,b);w()};this.destroy=function(){b("body").removeClass("diva-hide-scrollbar");b(a.parentSelector).empty().removeData("diva");b.each(a.plugins,function(a,b){g(b.destroy)});b(a.parentSelector).removeAttr("style").removeAttr("class")}};b.fn.diva=function(c){return this.each(function(){var d=b(this);if(!d.data("diva")){c.parentSelector=d;var a=new e(this,c);d.data("diva",a)}})}})(jQuery);(function(b){window.divaPlugins.push(function(){var e={},c={},d={},a,f,g,i={brightnessMax:150,brightnessMin:-100,brightnessStep:1,contrastMax:3,contrastMin:-1,contrastStep:0.05,localStoragePrefix:"canvas-",rgbMax:50,rgbMin:-50,timeout:200},j=function(b,c){var d=b.context,e=b.size/2,f=-(b.width/2),g=-(b.height/2);d.clearRect(0,0,b.size,b.size);d.save();d.translate(e,e);d.rotate(c*Math.PI/180);d.drawImage(a,f,g,b.width,b.height);d.restore();b.data=d.getImageData(0,0,b.size,b.size)},p=function(){for(var a in f)if(f[a].current!==
f[a].previous)return!0;return!1},h=function(){j(c,f.rotation.current);m(c)},E=function(){var a=f.rotation.current,c=f.zoom.current,g=f.zoom.previous;if(a!==f.rotation.previous||c!==g){var h=b("#diva-canvas-wrapper").scrollLeft(),i=b("#diva-canvas-wrapper").scrollTop(),v=d.viewport.width/2,k=d.viewport.height/2,h=h+v-e.centerX,q=-(i+k-e.centerY),u=(f.rotation.previous-a)*Math.PI/180,i=Math.cos(u)*h-Math.sin(u)*q+e.centerX,h=-(Math.sin(u)*h+Math.cos(u)*q)+e.centerY,c=Math.pow(2,c-g),v=c*i-v,k=c*h-k;
j(e,a);b("#diva-canvas-wrapper").scrollLeft(v);b("#diva-canvas-wrapper").scrollTop(k)}if(p()){m(e);for(var D in f)f[D].previous=f[D].current}},x=function(a){var b=f[a].current!==f[a].initial;return f[a].current!==f[a].previous||b},m=function(a){var b=a.data,c=a.context.createImageData(b),e=c.data,g,h;g=0;for(h=e.length;g<h;g++)e[g]=b.data[g];b=c.data;g=f.contrast.current;e=(1+Math.min(d.brightnessMax,Math.max(d.brightnessMin,f.brightness.current))/d.brightnessMax)*g;g=128-128*g;h=f.red.current;var j=
f.green.current,i=f.blue.current,u=x("red"),k=x("green"),q=x("blue"),p=x("brightness"),n=x("contrast"),p=p||n,s,t,m,r,B,y,C,n=0;for(t=c.width;n<t;n++){s=0;for(m=c.height;s<m;s++)r=4*(s*t+n),B=b[r],y=b[r+1],C=b[r+2],0<B+y+C&&(u&&B&&(B+=h),k&&y&&(y+=j),q&&C&&(C+=i),p&&(B&&(B=B*e+g),y&&(y=y*e+g),C&&(C=C*e+g)),b[r]=B,b[r+1]=y,b[r+2]=C)}a.context.clearRect(0,0,t,m);a.context.putImageData(c,0,0)},q=function(){var a=b("#diva-canvas-wrapper").scrollLeft()*c.scaleFactor,e=b("#diva-canvas-wrapper").scrollTop()*
c.scaleFactor,f=Math.min(Math.round(d.viewport.height*c.scaleFactor),d.mapSize)-4,g=Math.min(Math.round(d.viewport.width*c.scaleFactor),d.mapSize)-4;b("#diva-map-viewbox").height(f).width(g).css({top:e,left:a})},n=function(f,g){a=new Image;a.src=f;a.onload=function(){e.size=Math.sqrt(a.width*a.width+a.height*a.height);e.canvas=document.getElementById("diva-canvas");e.canvas.width=e.size;e.canvas.height=e.size;e.cornerX=(e.size-a.width)/2;e.cornerY=(e.size-a.height)/2;e.width=a.width;e.height=a.height;
e.centerX=e.size/2;e.centerY=e.size/2;e.context=e.canvas.getContext("2d");e.context.drawImage(a,e.cornerX,e.cornerY,e.width,e.height);e.data=e.context.getImageData(0,0,e.size,e.size);if(void 0===g){var f=a;c.canvas=document.getElementById("diva-canvas-minimap");c.size=d.mapSize;c.canvas.width=c.size;c.canvas.height=c.size;c.context=c.canvas.getContext("2d");c.context.fillRect(0,0,c.size,c.size);c.scaleFactor=d.mapSize/e.size;c.cornerX=e.cornerX*c.scaleFactor;c.cornerY=e.cornerY*c.scaleFactor;c.width=
f.width*c.scaleFactor;c.height=f.height*c.scaleFactor;c.context.drawImage(f,c.cornerX,c.cornerY,c.width,c.height);c.data=c.context.getImageData(0,0,d.mapSize,d.mapSize);b("#diva-map-viewbox").show();q()}h();E(e);s();"function"===typeof g&&g.call(g)}},k=function(){var a=f[g],c=a.current,a=a.transform?a.transform(c):c;b("#diva-canvas-value").html(a)},t=function(){b("#diva-canvas-slider").slider({value:f[g].current})},F=function(a){a=d.zoomWidthRatio*Math.pow(2,a);return d.proxyURL?d.proxyURL+"?f="+
d.filename+"&w="+a:d.iipServerURL+d.filename+"&WID="+a+"&CVT=JPEG"},r=function(){2<f.zoom.current&&b("#diva-canvas-loading").fadeIn(d.timeout)},s=function(){b("#diva-canvas-loading").fadeOut("slow")},J=function(){var a={},b=!1,c=d.localStoragePrefix+d.filename,e;for(e in f)f[e].previous!==f[e].initial&&(a[e]=f[e].previous,b=!0);b?(d.pluginIcon.addClass("new"),localStorage.setObject(c,a)):(d.pluginIcon.removeClass("new"),localStorage.removeItem(c))},G=function(a){d.zoomLevel=a;a=F(a);n(a,function(){c.scaleFactor=
c.size/e.size;q();J()})};return{init:function(a){b.extend(d,i,a.canvasPlugin);d.viewport={height:window.innerHeight-a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};d.inCanvas=!1;d.iipServerURL=a.iipServerURL;f={contrast:{initial:1,min:d.contrastMin,max:d.contrastMax,step:d.contrastStep,transform:function(a){return a.toFixed(2)},title:"Change the contrast"},brightness:{initial:0,min:d.brightnessMin,max:d.brightnessMax,step:d.brightnessStep,title:"Adjust the brightness"},rotation:{initial:0,
min:0,max:359,step:1,transform:function(a){return a+"&deg;"},title:"Rotate the image"},zoom:{initial:0,min:0,max:0,step:1,title:"Adjust the zoom level"},red:{initial:0,min:d.rgbMin,max:d.rgbMax,step:1,title:"Adjust the red channel"},green:{initial:0,min:d.rgbMin,max:d.rgbMax,step:1,title:"Adjust the green channel"},blue:{initial:0,min:d.rgbMin,max:d.rgbMax,step:1,title:"Adjust the blue channel"}};var j=function(){var a,b,c;for(c in f)b=f[c],a=b.initial,b.current=a,b.previous=a};j();if(!b("#diva-canvas-backdrop").length){var n=
"contrast,brightness,rotation,zoom,red,green,blue".split(","),m=[],w,v,I;for(I in n)w=n[I],v=f[w].title,w='<div class="'+w+'" title="'+v+'"></div>',m.push(w);n='<div id="diva-canvas-backdrop">'+('<div id="diva-canvas-tools"><div id="diva-canvas-toolbar"><div id="diva-canvas-close" title="Return to the document viewer"></div><div id="diva-canvas-minimise" title="Minimise the toolbar"></div><span id="diva-canvas-info">Test</span></div><div id="diva-canvas-toolwindow"><div id="diva-map-viewbox"></div><canvas id="diva-canvas-minimap"></canvas><div id="diva-canvas-buttons">'+
m.join("")+'</div><div id="diva-canvas-pane"><p id="diva-canvas-tooltip"><span id="diva-canvas-mode">contrast</span>: <span id="diva-canvas-value">0</span> <span id="diva-canvas-reset" class="link">(Reset)</span></p><div id="diva-canvas-slider"></div></div><br /><div class="action-buttons"><a href="#" id="diva-canvas-reset-all">Reset all</a><a href="#" id="diva-canvas-apply">Apply</a></div></div></div>')+'<div id="diva-canvas-wrapper"><canvas id="diva-canvas"></canvas></div><div id="diva-canvas-loading"></div></div>';
b("body").append(n);d.mapSize=b("#diva-canvas-minimap").width();b("#diva-canvas-buttons div").click(function(){b("#diva-canvas-buttons .clicked").removeClass("clicked");x(b(this).attr("class"))});var x=function(a){g=a;a=f[g];b("#diva-canvas-buttons ."+g).addClass("clicked");b("#diva-canvas-mode").text(g);var c=a.current,d=a.transform?a.transform(c):c;b("#diva-canvas-slider").slider({min:a.min,max:a.max,step:a.step}).slider("value",c);b("#diva-canvas-value").html(d)};x("contrast");b("#diva-canvas-slider").slider({slide:function(a,
b){f[g].current=b.value;k();h()}});b("#diva-canvas-reset-all").click(function(){for(var a in f)f[a].current=f[a].initial;k();t();h()});b("#diva-canvas-reset").click(function(){f[g].current=f[g].initial;k();t();h()});b("#diva-canvas-apply").click(function(){p()&&(r(),setTimeout(function(){f.zoom.current!==f.zoom.previous?G(f.zoom.current):(E(),s(),J())},0))});b("#diva-canvas-close").click(function(){b("body").removeClass("overflow-hidden");e.context.clearRect(0,0,e.size,e.size);c.context.clearRect(0,
0,c.size,c.size);b("#diva-canvas-wrapper").scrollTop(0).scrollLeft(0);b("#diva-canvas-backdrop").hide();b("#diva-map-viewbox").hide();j();k();t();b("#diva-canvas-buttons .clicked").removeClass("clicked");x("contrast")});b("#diva-canvas-minimise").click(function(){b("#diva-canvas-toolwindow").slideToggle("fast")});b(window).resize(function(){d.viewport={height:window.innerHeight-a.scrollbarWidth,width:window.innerWidth-a.scrollbarWidth};d.inCanvas&&q()});b("#diva-canvas-wrapper").scroll(function(){d.inCanvas&&
q()});b("#diva-canvas-minimap, #diva-map-viewbox").mouseup(function(a){var e=b("#diva-canvas-minimap").offset(),f=(a.pageX-e.left)/c.scaleFactor,a=(a.pageY-e.top)/c.scaleFactor;b("#diva-canvas-wrapper").scrollTop(a-d.viewport.height/2);b("#diva-canvas-wrapper").scrollLeft(f-d.viewport.width/2)});b("#diva-canvas").mousedown(function(){b(this).addClass("grabbing")}).mouseup(function(){b(this).removeClass("grabbing")});b("#diva-canvas-wrapper").dragscrollable({acceptPropagatedEvent:!0});"function"===
typeof d.onInit&&d.onInit.call(this,d)}},pluginName:"canvas",titleText:"View the image on a canvas and adjust various settings",setupHook:function(a){d.minZoomLevel=a.minZoomLevel;d.maxZoomLevel=a.maxZoomLevel;f.zoom.min=d.minZoomLevel;f.zoom.max=d.maxZoomLevel},handleClick:function(a,c){var e=b(this).parent().parent(),h=b(e).attr("data-filename"),j=b(e).width()-1,i=c.zoomLevel,m;d.zoomWidthRatio=j/Math.pow(2,i);d.pluginIcon=b(this);d.filename=h;f.zoom.initial=i;f.zoom.current=i;if(h=localStorage.getObject(d.localStoragePrefix+
d.filename))for(m in h)f[m].current=h[m],m===g&&(k(),t()),"zoom"===m&&(i=h[m]);f.zoom.previous=i;b("body").addClass("overflow-hidden");b("#diva-canvas-backdrop").show();d.inCanvas=!0;i=F(i);b("#diva-canvas-info").text(b(e).attr("title"));r();n(i)},onPageLoad:function(a,c,e){null!==localStorage.getItem(d.localStoragePrefix+c)&&b(e).find(".diva-canvas-icon").addClass("new")},destroy:function(){b("#diva-canvas-backdrop").remove()}}}())})(jQuery);(function(b){window.divaPlugins.push(function(){var e;return{init:function(b){e=b.iipServerURL},pluginName:"download",titleText:"Download image at the given zoom level",handleClick:function(){var c=b(this).parent().parent(),d=b(c).attr("data-filename"),c=b(c).width()-1;window.open(e+d+"&WID="+c+"&CVT=JPEG")}}}())})(jQuery);
